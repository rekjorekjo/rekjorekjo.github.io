<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/23/ISCTF2025-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/ISCTF2025-wp/" class="post-title-link" itemprop="url">ISCTF2025_wp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-23 13:11:43 / Modified: 14:16:53" itemprop="dateCreated datePublished" datetime="2025-12-23T13:11:43+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ISCTF-2025"><a href="#ISCTF-2025" class="headerlink" title="ISCTF 2025"></a>ISCTF 2025</h1><hr>
<p>[TOC]</p>
<p>说明 由于本人web和病毒分析纯ai做法，没有实际价值，不在wp中赘述</p>
<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><strong>Reverse</strong></h3><p>比赛体量太大，重心没放在reverse上，个人仅做了两个题。</p>
<ul>
<li><p>ELF</p>
<blockquote>
<p>这个elf有点奇怪呢</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─# file main</span><br><span class="line">main: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="keyword">for</span> GNU/Linux 3.2.0, BuildID[sha1]=f5e4eb9bd95f0a14f41d1ef1a6f8ee703c85a059, stripped</span><br></pre></td></tr></table></figure>

<p>file一下，stripped被剥离了符号表，果然打开ida啥也不是</p>
<p>strings检查发现爆出很多”python”字符串，是<strong>PyInstaller打包的Python程序</strong></p>
<p>用特定脚本解包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/extremecoders-re/pyinstxtractor/master/pyinstxtractor.py</span><br><span class="line">python3 pyinstxtractor.py main</span><br></pre></td></tr></table></figure>

<p>反编译,注意不同python版本需要选择不同的工具。</p>
<p>3.1-3.9 uncompyle6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncompyle6 -o main.pyc main.py</span><br></pre></td></tr></table></figure>

<p>3.7-3.9 decompyle3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decompyle3 main.pyc &gt; main.py</span><br></pre></td></tr></table></figure>

<p>3.1+ or 3.10+</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> pycdc</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">./pycdc ../main.pyc &gt; main.py</span><br></pre></td></tr></table></figure>

<p>本题用pycdc得到main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: main.pyc (Python 3.10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">flag = <span class="string">&#x27;8d13c398b72151b1dad78762553dbbd59dba9b0b2330b03b401ea4f2a6d4731d479220fe900b520f6b4753667fe1cdf9eff8d3b833a0013c4083fa1ad27d056486702bda245f3c1aa0fbf84b237d8f2dec9a80791fe66625adfe3669419a104cbb67293eaada20f79cebf69d84d326025dd35dec09a2c97ad838efa5beba9e72&#x27;</span></span><br><span class="line">YourInput = <span class="built_in">input</span>(<span class="string">&#x27;Please input your flag:&#x27;</span>)</span><br><span class="line">enc = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(YourInput) != <span class="number">24</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Length Wrong!!!&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rep</span>(<span class="params">hash_data</span>):</span><br><span class="line">    random.seed(<span class="number">161</span>)</span><br><span class="line">    result = <span class="built_in">list</span>(hash_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        swap_index = random.randint(<span class="number">0</span>, i)</span><br><span class="line">        result[i] = result[swap_index]</span><br><span class="line">        result[swap_index] = result[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(YourInput) // <span class="number">3</span>):</span><br><span class="line">    c2b = base64.b64encode(YourInput[i * <span class="number">3</span>:(i + <span class="number">1</span>) * <span class="number">3</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">hash</span> = hashlib.md5(c2b).hexdigest()</span><br><span class="line">    enc += Rep(<span class="built_in">hash</span>)</span><br><span class="line"><span class="keyword">if</span> enc == flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Your are win!!!&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="literal">None</span>(<span class="string">&#x27;Your are lose!!!&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>加密流程：</p>
<p>1.24字节的flag分成8组，每组base64加密变为4字节</p>
<p>2.计算hex的md5</p>
<p>3.每组调用rep函数加密</p>
<p>rep函数是<strong>Fisher-Yates 洗牌算法</strong>的逆序版本<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_61840987/article/details/143226112">洗牌算法（Shuffle Algorithm）Fisher-Yates 洗牌算法详细解读-CSDN博客</a></p>
<p>由于seed&#x3D;161已知，洗牌的过程可以复现出来。每组三字节，爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;8d13c398b72151b1dad78762553dbbd59dba9b0b2330b03b401ea4f2a6d4731d479220fe900b520f6b4753667fe1cdf9eff8d3b833a0013c4083fa1ad27d056486702bda245f3c1aa0fbf84b237d8f2dec9a80791fe66625adfe3669419a104cbb67293eaada20f79cebf69d84d326025dd35dec09a2c97ad838efa5beba9e72&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rep</span>(<span class="params">hash_data, reverse=<span class="literal">False</span></span>):</span><br><span class="line">    random.seed(<span class="number">161</span>)</span><br><span class="line">    result = <span class="built_in">list</span>(hash_data)</span><br><span class="line">    n = <span class="built_in">len</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 记录正向交换序列</span></span><br><span class="line">    swaps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        swap_index = random.randint(<span class="number">0</span>, i)</span><br><span class="line">        swaps.append((i, swap_index))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> reverse:</span><br><span class="line">        <span class="comment"># 逆向执行交换</span></span><br><span class="line">        <span class="keyword">for</span> i, swap_index <span class="keyword">in</span> <span class="built_in">reversed</span>(swaps):</span><br><span class="line">            result[i], result[swap_index] = result[swap_index], result[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 正向执行交换</span></span><br><span class="line">        <span class="keyword">for</span> i, swap_index <span class="keyword">in</span> swaps:</span><br><span class="line">            result[i], result[swap_index] = result[swap_index], result[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 分割flag为8组</span></span><br><span class="line">groups = [flag[i*<span class="number">32</span>:(i+<span class="number">1</span>)*<span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;分组:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, g <span class="keyword">in</span> <span class="built_in">enumerate</span>(groups):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;组<span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;g&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 对每组逆向Rep得到原始MD5</span></span><br><span class="line">original_md5s = []</span><br><span class="line"><span class="keyword">for</span> g <span class="keyword">in</span> groups:</span><br><span class="line">    original_md5 = Rep(g, reverse=<span class="literal">True</span>)</span><br><span class="line">    original_md5s.append(original_md5)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;逆向Rep后: <span class="subst">&#123;original_md5&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 爆破所有可能的3字节输入</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_original_text</span>(<span class="params">md5_target</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>*<span class="number">256</span>*<span class="number">256</span>):  <span class="comment"># 3字节所有可能</span></span><br><span class="line">        <span class="comment"># 生成3字节</span></span><br><span class="line">        b = <span class="built_in">bytes</span>([</span><br><span class="line">            (i &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>,</span><br><span class="line">            (i &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>,</span><br><span class="line">            i &amp; <span class="number">0xFF</span></span><br><span class="line">        ])</span><br><span class="line">        <span class="comment"># Base64编码</span></span><br><span class="line">        b64 = base64.b64encode(b)</span><br><span class="line">        <span class="comment"># 计算MD5</span></span><br><span class="line">        md5 = hashlib.md5(b64).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> md5 == md5_target:</span><br><span class="line">            <span class="keyword">return</span> b.decode(<span class="string">&#x27;latin-1&#x27;</span>)  <span class="comment"># 可能不是ASCII</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 逐个爆破</span></span><br><span class="line">flag_parts = []</span><br><span class="line"><span class="keyword">for</span> i, md5_target <span class="keyword">in</span> <span class="built_in">enumerate</span>(original_md5s):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n爆破第<span class="subst">&#123;i&#125;</span>组...&quot;</span>)</span><br><span class="line">    found = find_original_text(md5_target)</span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        flag_parts.append(found)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;找到: <span class="subst">&#123;found&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;未找到匹配的3字节&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 拼接flag</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag_parts) == <span class="number">8</span>:</span><br><span class="line">    final_flag = <span class="string">&#x27;&#x27;</span>.join(flag_parts)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nFlag: <span class="subst">&#123;final_flag&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未能找到所有部分&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{NO7_3x3_i5_3Lf!!!}</strong></p>
<ul>
<li><p>ezpy</p>
<blockquote>
<p>这是什么库？没见过呢</p>
</blockquote>
</li>
</ul>
<p>strings检查发现了python痕迹，pyinstaller打包</p>
<p>同样，用脚本解包,pycdc反编译失败了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└─# decompyle3 ezpy.pyc &gt; ezpy_decompiled.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unsupported bytecode in file ezpy.pyc</span></span><br><span class="line"><span class="comment"># Unsupported Python version, 3.13.0, for decompilation</span></span><br></pre></td></tr></table></figure>

<p>3.13太新了，pycdc失败</p>
<p>Rycbartbad师傅先做了此题，说有花指令，看看花指令什么情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_obfuscation</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 跳过可能的头部</span></span><br><span class="line">        data = f.read()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 尝试在不同偏移加载</span></span><br><span class="line">    <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="number">500</span>, <span class="built_in">len</span>(data)), <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            code = marshal.loads(data[offset:])</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✓ 成功在偏移 <span class="subst">&#123;offset&#125;</span> 处加载代码对象&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  代码长度: <span class="subst">&#123;<span class="built_in">len</span>(code.co_code)&#125;</span> 字节&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 查看字节码模式</span></span><br><span class="line">            bytecode = code.co_code</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  前100字节: <span class="subst">&#123;bytecode[:<span class="number">100</span>].<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 统计操作码频率</span></span><br><span class="line">            <span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">            opcodes = [bytecode[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bytecode), <span class="number">2</span>) <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(bytecode)]</span><br><span class="line">            freq = Counter(opcodes)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  常见操作码: <span class="subst">&#123;freq.most_common(<span class="number">10</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 查找可能的NOP（0x09）或其他花指令</span></span><br><span class="line">            nop_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> b <span class="keyword">in</span> bytecode <span class="keyword">if</span> b == <span class="number">0x09</span>)</span><br><span class="line">            <span class="keyword">if</span> nop_count &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  发现 <span class="subst">&#123;nop_count&#125;</span> 个NOP指令（可能为花指令）&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 尝试反汇编</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n  尝试反汇编（可能失败）:&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                dis.dis(code)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  反汇编失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">analyze_obfuscation(<span class="string">&#x27;ezpy.pyc&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>发现在开头有一个nop。可以去，也可以不管直接看字节码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ezpy.pyc&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载主模块</span></span><br><span class="line">code = marshal.loads(data[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找main函数的代码对象</span></span><br><span class="line"><span class="keyword">for</span> const <span class="keyword">in</span> code.co_consts:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(const, <span class="string">&#x27;co_code&#x27;</span>):  <span class="comment"># 是一个代码对象</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n=== 函数: <span class="subst">&#123;const.co_name&#125;</span> ===&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文件: <span class="subst">&#123;const.co_filename&#125;</span>, 行: <span class="subst">&#123;const.co_firstlineno&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 反汇编这个函数</span></span><br><span class="line">        dis.dis(const)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果有字符串常量，显示它们</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n常量:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(const.co_consts):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, <span class="built_in">str</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  [<span class="subst">&#123;i&#125;</span>] <span class="subst">&#123;<span class="built_in">repr</span>(c)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(c, <span class="built_in">bytes</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  [<span class="subst">&#123;i&#125;</span>] bytes: <span class="subst">&#123;c[:<span class="number">50</span>]&#125;</span><span class="subst">&#123;<span class="string">&#x27;...&#x27;</span> <span class="keyword">if</span> <span class="built_in">len</span>(c) &gt; <span class="number">50</span> <span class="keyword">else</span> <span class="string">&#x27;&#x27;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">└─# python3 1.py</span><br><span class="line"></span><br><span class="line">=== 函数: main ===</span><br><span class="line">文件: ezpy.py, 行: 8</span><br><span class="line">  8           RESUME                   0</span><br><span class="line"></span><br><span class="line">  9           LOAD_GLOBAL              1 (input + NULL)</span><br><span class="line">              LOAD_CONST               1 (<span class="string">&#x27;Please input your flag: &#x27;</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              LOAD_ATTR                3 (strip + NULL|self)</span><br><span class="line">              CALL                     0</span><br><span class="line">              STORE_FAST               0 (user_input)</span><br><span class="line"></span><br><span class="line"> 11           LOAD_GLOBAL              5 (check + NULL)</span><br><span class="line">              LOAD_FAST                0 (user_input)</span><br><span class="line">              CALL                     1</span><br><span class="line">              TO_BOOL</span><br><span class="line">              POP_JUMP_IF_FALSE       12 (to L1)</span><br><span class="line"></span><br><span class="line"> 12           LOAD_GLOBAL              7 (<span class="built_in">print</span> + NULL)</span><br><span class="line">              LOAD_CONST               2 (<span class="string">&#x27;Correct!&#x27;</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              POP_TOP</span><br><span class="line">              RETURN_CONST             0 (None)</span><br><span class="line"></span><br><span class="line"> 14   L1:     LOAD_GLOBAL              7 (<span class="built_in">print</span> + NULL)</span><br><span class="line">              LOAD_CONST               3 (<span class="string">&#x27;Wrong!&#x27;</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              POP_TOP</span><br><span class="line">              RETURN_CONST             0 (None)</span><br><span class="line"></span><br><span class="line">常量:</span><br><span class="line">  [1] <span class="string">&#x27;Please input your flag: &#x27;</span></span><br><span class="line">  [2] <span class="string">&#x27;Correct!&#x27;</span></span><br><span class="line">  [3] <span class="string">&#x27;Wrong!&#x27;</span></span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>逻辑基本清楚。</p>
<p>接下来可以用strings搜索</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># strings mypy.cp313-win_amd64.pyd</span></span><br></pre></td></tr></table></figure>

<p>可以找到以下字符串</p>
<p>ISCTF202H    RC4 flag checker module    check    Check if the flag is correct    </p>
<p>可以看到可能只进行了RC4加密，密钥是ISCTF202H。但是密钥明显不正常，可以猜到应该是ISCTF2025，接下来找密文</p>
<p>ida打开mypy.cp313-win_amd64.pyd</p>
<p>懒得看函数了，直接手动找data段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.rdata:000000036F4D4007 aRc4FlagChecker db &#x27;RC4 flag checker module&#x27;,0</span><br><span class="line">.rdata:000000036F4D4007                                         ; DATA XREF: .data:000000036F4D3050↑o</span><br><span class="line">.rdata:000000036F4D401F aCheck          db &#x27;check&#x27;,0            ; DATA XREF: .data:off_36F4D30A0↑o</span><br><span class="line">.rdata:000000036F4D4025 aCheckIfTheFlag db &#x27;Check if the flag is correct&#x27;,0</span><br><span class="line">.rdata:000000036F4D4025                                         ; DATA XREF: .data:000000036F4D30B8↑o</span><br><span class="line">.rdata:000000036F4D4042                 align 10h</span><br><span class="line">.rdata:000000036F4D4050 unk_36F4D4050   db  1Dh                 ; DATA XREF: sub_36F4D1519+C2↑o</span><br><span class="line">.rdata:000000036F4D4051                 db 0D5h</span><br><span class="line">.rdata:000000036F4D4052                 db  38h ; 8</span><br><span class="line">.rdata:000000036F4D4053                 db  33h ; 3</span><br><span class="line">.rdata:000000036F4D4054                 db 0AFh</span><br><span class="line">.rdata:000000036F4D4055                 db 0B5h</span><br><span class="line">.rdata:000000036F4D4056                 db  51h ; Q</span><br><span class="line">.rdata:000000036F4D4057                 db 0F3h</span><br><span class="line">.rdata:000000036F4D4058                 db  2Ch ; ,</span><br><span class="line">.rdata:000000036F4D4059                 db  6Bh ; k</span><br><span class="line">.rdata:000000036F4D405A                 db  6Eh ; n</span><br><span class="line">.rdata:000000036F4D405B                 db 0FEh</span><br><span class="line">.rdata:000000036F4D405C                 db  41h ; A</span><br><span class="line">.rdata:000000036F4D405D                 db  24h ; $</span><br><span class="line">.rdata:000000036F4D405E                 db  43h ; C</span><br><span class="line">.rdata:000000036F4D405F                 db 0D2h</span><br><span class="line">.rdata:000000036F4D4060                 db  71h ; q</span><br><span class="line">.rdata:000000036F4D4061                 db 0CFh</span><br><span class="line">.rdata:000000036F4D4062                 db 0A4h</span><br><span class="line">.rdata:000000036F4D4063                 db  4Ch ; L</span><br><span class="line">.rdata:000000036F4D4064                 db 0E3h</span><br><span class="line">.rdata:000000036F4D4065                 db  9Ah</span><br><span class="line">.rdata:000000036F4D4066                 db  9Ah</span><br><span class="line">.rdata:000000036F4D4067                 db 0B5h</span><br><span class="line">.rdata:000000036F4D4068                 db  31h ; 1</span><br><span class="line">.rdata:000000036F4D4069                 db    0</span><br><span class="line">.rdata:000000036F4D406A                 db    0</span><br><span class="line">.rdata:000000036F4D406B                 db    0</span><br><span class="line">.rdata:000000036F4D406C                 db    0</span><br><span class="line">.rdata:000000036F4D406D                 db    0</span><br><span class="line">.rdata:000000036F4D406E                 db    0</span><br><span class="line">.rdata:000000036F4D406F                 db    0</span><br><span class="line">.rdata:000000036F4D4070                 db    0</span><br><span class="line">.rdata:000000036F4D4071                 db    0</span><br><span class="line">.rdata:000000036F4D4072                 db    0</span><br><span class="line">.rdata:000000036F4D4073                 db    0</span><br><span class="line">.rdata:000000036F4D4074                 db    0</span><br><span class="line">.rdata:000000036F4D4075                 db    0</span><br><span class="line">.rdata:000000036F4D4076                 db    0</span><br><span class="line">.rdata:000000036F4D4077                 db    0</span><br><span class="line">.rdata:000000036F4D4078                 db    0</span><br><span class="line">.rdata:000000036F4D4079                 db    0</span><br><span class="line">.rdata:000000036F4D407A                 db    0</span><br><span class="line">.rdata:000000036F4D407B                 db    0</span><br><span class="line">.rdata:000000036F4D407C                 db    0</span><br><span class="line">.rdata:000000036F4D407D                 db    0</span><br><span class="line">.rdata:000000036F4D407E                 db    0</span><br><span class="line">.rdata:000000036F4D407F                 db    0</span><br></pre></td></tr></table></figure>

<p>可以看到大概率从4D4050开始的都是密文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;RC4算法实现&quot;&quot;&quot;</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    result = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        k = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        result.append(char ^ k)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的密文（25字节，直到0x31，后面的0是填充）</span></span><br><span class="line">ciphertext = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x1D</span>, <span class="number">0xD5</span>, <span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0xAF</span>, <span class="number">0xB5</span>, <span class="number">0x51</span>, <span class="number">0xF3</span>,</span><br><span class="line">    <span class="number">0x2C</span>, <span class="number">0x6B</span>, <span class="number">0x6E</span>, <span class="number">0xFE</span>, <span class="number">0x41</span>, <span class="number">0x24</span>, <span class="number">0x43</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0x71</span>, <span class="number">0xCF</span>, <span class="number">0xA4</span>, <span class="number">0x4C</span>, <span class="number">0xE3</span>, <span class="number">0x9A</span>, <span class="number">0x9A</span>, <span class="number">0xB5</span>,</span><br><span class="line">    <span class="number">0x31</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">keys = [<span class="string">&quot;ISCTF2025&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key_str <span class="keyword">in</span> keys:</span><br><span class="line">    key = key_str.encode()</span><br><span class="line">    decrypted = rc4(key, ciphertext)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n密钥: &#x27;<span class="subst">&#123;key_str&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密结果: <span class="subst">&#123;<span class="built_in">repr</span>(decrypted)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试解码为字符串</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 先尝试ASCII</span></span><br><span class="line">        ascii_text = decrypted.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> ascii_text <span class="keyword">and</span> <span class="built_in">any</span>(c.isprintable() <span class="keyword">for</span> c <span class="keyword">in</span> ascii_text):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;ASCII文本: <span class="subst">&#123;ascii_text&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试UTF-8</span></span><br><span class="line">        utf8_text = decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> utf8_text <span class="keyword">and</span> utf8_text != ascii_text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;UTF-8文本: <span class="subst">&#123;utf8_text&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>得到<strong>ISCTF{Y0U_GE7_7HE_PYD!!!}</strong></p>
<p>那ISCTF202H是怎么回事呢？</p>
<p>IDA手动找数字5，找到的结果如下:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:000000036F4D1535                 mov     word ptr [rsp+158h+var_132+8], 35h ; &#x27;5&#x27;</span><br></pre></td></tr></table></figure>

<p>所在函数反编译的结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">__m128i *__fastcall <span class="title function_">sub_36F4D1519</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rsi</span></span><br><span class="line">  __m128i *v3; <span class="comment">// rbx</span></span><br><span class="line">  __m128i *v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">274</span>]; <span class="comment">// [rsp+26h] [rbp-132h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *Str; <span class="comment">// [rsp+138h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">&quot;ISCTF2025&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)PyArg_ParseTuple(a2, &amp;unk_36F4D4000, &amp;Str) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v2 = Str;</span><br><span class="line">  v3 = (__m128i *)Py_FalseStruct;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">strlen</span>(Str) == <span class="number">25</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = (__m128i *)<span class="built_in">malloc</span>(<span class="number">0x19u</span>);</span><br><span class="line">    v3 = v5;</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      *v5 = _mm_loadu_si128((<span class="type">const</span> __m128i *)v2);</span><br><span class="line">      *(__m128i *)((<span class="type">char</span> *)v5 + <span class="number">9</span>) = _mm_loadu_si128((<span class="type">const</span> __m128i *)(v2 + <span class="number">9</span>));</span><br><span class="line">      v6 = <span class="built_in">strlen</span>(v8);</span><br><span class="line">      sub_36F4D1430(&amp;v8[<span class="number">10</span>], v8, v6);</span><br><span class="line">      sub_36F4D149C(&amp;v8[<span class="number">10</span>], v3, <span class="number">25</span>);</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ( v3-&gt;m128i_i8[v7] == byte_36F4D4050[v7] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( ++v7 == <span class="number">25</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">free</span>(v3);</span><br><span class="line">          <span class="keyword">return</span> (__m128i *)Py_TrueStruct;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">free</span>(v3);</span><br><span class="line">      <span class="keyword">return</span> (__m128i *)Py_FalseStruct;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      PyErr_NoMemory();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Hex试图可见</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">000000036F4D1520  01 00 00 48 89 D1 48 B8  49 53 43 54 46 32 30 32  ...H....ISCTF202</span><br><span class="line">000000036F4D1530  48 89 44 24 26 66 C7 44  24 2E 35 00 4C 8D 84 24  H.D$&amp;f..$.5.L..$</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20251213161624559.png"></p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h3><ul>
<li><p>沉迷数学的小蓝鲨</p>
<blockquote>
<p>小蓝鲨最近沉迷于椭圆曲线，但是有一个椭圆曲线问题它始终做不出来，据说它广泛应用于区块链技术。如果你可以帮助小蓝鲨解决这个问题，它将会给予你丰厚的报酬。</p>
<p>Hint1:你验证过基点 G 真的在曲线上吗？(这只是个ez题，别想太复杂）<br>Hint2:G是这条曲线上的冒牌货，但代数运算不在乎，因为计算机可不是数学家</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">y² = x³ + 3x + <span class="number">27</span> (mod p)</span><br><span class="line"></span><br><span class="line">Q(<span class="number">0xa61ae2f42348f8b84e4b8271ee8ce3f19d7760330ef6a5f6ec992430dccdc167</span>, <span class="number">0x8a3ceb15b94ee7c6ce435147f31ca8028d1dd07a986711966980f7de20490080</span>)</span><br><span class="line"></span><br><span class="line">k= ?</span><br><span class="line"></span><br><span class="line">最终flag请将解出k值的<span class="number">16</span>进制转换为<span class="number">32</span>位md5以ISCTF&#123;&#125;包裹提交</span><br></pre></td></tr></table></figure>

<p>信息过少，p，G都不知道，于是猜想是secp256k1固定参数</p>
<p>根据Hint1，b&#x3D;27是假的，需要重新找到一个b’</p>
<p>k不大，<strong>在小范围内搜索才能跑的出来是关键</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># secp256k1 参数</span></span><br><span class="line">p = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F</span></span><br><span class="line">Fp = GF(p)</span><br><span class="line"></span><br><span class="line">Gx = <span class="number">0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798</span></span><br><span class="line">Gy = <span class="number">0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8</span></span><br><span class="line"></span><br><span class="line">Qx = <span class="number">0xa61ae2f42348f8b84e4b8271ee8ce3f19d7760330ef6a5f6ec992430dccdc167</span></span><br><span class="line">Qy = <span class="number">0x8a3ceb15b94ee7c6ce435147f31ca8028d1dd07a986711966980f7de20490080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于 G 不在 y² = x³ + 3x + 27 上，我们需要找到真正的 b</span></span><br><span class="line">b = (Fp(Gy)**<span class="number">2</span> - (Fp(Gx)**<span class="number">3</span> + <span class="number">3</span>*Fp(Gx)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;b = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建曲线</span></span><br><span class="line">E = EllipticCurve(Fp, [<span class="number">3</span>, b])</span><br><span class="line">G_pt = E(Gx, Gy)</span><br><span class="line">Q_pt = E(Qx, Qy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查曲线阶</span></span><br><span class="line">order = E.order()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;阶分解: <span class="subst">&#123;factor(order)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于 k 不大，直接搜索小范围</span></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000000</span>):</span><br><span class="line">    <span class="keyword">if</span> k * G_pt == Q_pt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;找到 k = <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">k_hex = <span class="built_in">hex</span>(k)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;hex(k) = <span class="subst">&#123;k_hex&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">md5 = hashlib.md5(k_hex.encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nFlag: ISCTF&#123;&#123;<span class="subst">&#123;md5&#125;</span>&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(sagemath) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/c/users/rekjo/desktop]</span><br><span class="line">└─# sage ecc.sage</span><br><span class="line">b = 66385389407800359838405813331870212727788158969948345552414605934650319155613</span><br><span class="line">阶分解: 2 * 3^2 * 7 * 53 * 4733 * 17669 * 42437 * 4885840951767371464006724254428399138698319915522809195449609</span><br><span class="line">找到 k = 954761</span><br><span class="line">hex(k) = e9189</span><br><span class="line"></span><br><span class="line">Flag: ISCTF&#123;43896099feea21a3d5804863075e1aaa&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{43896099feea21a3d5804863075e1aaa}</strong></p>
<ul>
<li><p>小蓝鲨的费马谜题</p>
<blockquote>
<p>小蓝鲨在一次网络探险中发现了一个神秘的加密系统。他发现这个系统好像使用了费马小定理来保护重要信息，但是又好像不太一样。小蓝鲨设法截获了系统的加密输出，但不知道如何解密，你可以帮帮它吗？</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">p = get_prime(<span class="number">1024</span>)</span><br><span class="line">q = get_prime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">bases = get_primes_up_to(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">hints = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bases)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(bases)):</span><br><span class="line">        hint_value = (<span class="built_in">pow</span>(bases[i], p-<span class="number">1</span>, n) + <span class="built_in">pow</span>(bases[j], p-<span class="number">1</span>, n)) % n</span><br><span class="line">        hints.append((bases[i], bases[j], hint_value))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = 7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hints (format: base1, base2, hint_value):</span></span><br><span class="line"><span class="string">Hint 1: 11, 41, 403072318395713195475880235840306655046644537786837658466183670390322357403650602210882802453171853452</span></span><br><span class="line"><span class="string">Hint 2: 73, 7, 3401877351823051464833008106697922874740843547186522246399577691648145322938787488999079423405760696040635223407580102549819096176975820017380148265275786281647240647714533261221890310813882987089721138616513427711006945061727486708277298401545762448776593105730005387022319319199166969225690343981500127626848336242187816071435842118963634505746771844269484845077330851526393327015758760003053231670737896550596266539249975891234238005583184203089180325261872944167834576158878843510707348603774425827560724587546720860765943393963597645881666559247252842017499263265738255716811999328445725902262302532911214255949</span></span><br><span class="line"><span class="string">Hint 3: 59, 73, 695583691945177012011155613294846891840015729899504980764916686517371703553347581254163445300367305365949600797847620946823894152274689248119430670857791635723385692575931740078475490085973951317953049329486264578815530286784178680687403627415153526425715193114420845091853572366108176759184115038228886689580295865909953096284457818874267153151571968297454864850732608316298813594124020007025412733770104355236849081247730461956131749267446455113813284775308663385548094921945410215359273656658830019785099633226412843434625002115741084636776823289994271249660745143685585443820708578849162449717982725541307852715</span></span><br><span class="line"><span class="string">Hint 4: 53, 17, 971645701575323882519635342913625889703399294086</span></span><br><span class="line"><span class="string">Hint 5: 17, 53, 15015015166119321293244100074414416277924832658329700344653519929879563546652512240571777007009139132526751717913688831473249036114283479537249767699902565862566840754892319936718933957878788242522102884592375092063435348463420495622162622111752797419564087812071877456034189172928466087325995711799494559632348117577986369270044265839851198529901138826760234172452522279821372814789053868333623123766583799003287221335420456780264904184548645200345715153696373219687248029519611142514212181449677795769427641367964609639782220743835161725500332507591502818244881229659746207461229056486960160782643424330243354078694</span></span><br><span class="line"><span class="string">Hint 6: 59, 19, 4427802296687944448870952484227318</span></span><br><span class="line"><span class="string">Hint 7: 19, 43, 19174465169354813231681320402781559275699092043658101294284851123118510716279410</span></span><br><span class="line"><span class="string">Hint 8: 23, 31, 6031706827842456717715236244872427215835819411314168938820265741988730625387931647610750902952789928566569174296650515449892611198040938188209413722806254050103019879240215344570043498312370280623702924998835728624935413985841142180365335178468710734638030582183503463305813229510689954065159041592316788178873050291779739508108222965509434291492950189742558594400755699777715854046635146464467729949201239668741264832027750549876625288984575624485894153879412247669943493660233937543961086506015000295606199222800612415043850877838520358081044378561877650595040905680464898635661677396546195369907960492865630959945</span></span><br><span class="line"><span class="string">Hint 9: 73, 31, 14201978515584496685882877364621713654579319459919970854066889531106363038011334520524797899491133943665135480301300406440254472658620428164578914318059588912647092994632856690</span></span><br><span class="line"><span class="string">Hint 10: 31, 3, 17761887753093897979823770061456102763834352</span></span><br><span class="line"><span class="string">Hint 11: 13, 5, 4150700388609705807509972385476068337626559497757356803399419065000783917890225153250286903799441660433187538279583874523190497602462150199426414868861228792088666515397312761673326022980940385774334828394940770351447957541072690963220641780722897399543555486513918873014494692941882646929202605685305683969151271831603708612223260616432695010847067252877343217676963276876850265407927146383572955861063428706012170676831524971272198283920333900403902257748241220365118645448662797961778388544299359695919130547938351588261698392641490575786350259413542725944665834486513968924860904668074607650304874723425230270137</span></span><br><span class="line"><span class="string">Hint 12: 59, 53, 2093308535564899860358544644764036388478107502010763064242342417957960952425000274395405300689532194265342136032111944045432326085818281844400947666782274940461183395046865284971635536544260910022728631047126094710543502860882170401987674931187922422766222327719930375318976698721098197543008758760603140658147997152753438270623866111022164350986375651437321309108736011279113592001916870502347116720151257306071411569096876275005515839079136440506703094781753301521917670413306257490297241974169467740732230454155267623129991881695623072243477621355484939295049508367225410929080326109567111654067945546042372106278</span></span><br><span class="line"><span class="string">Hint 13: 11, 89, 5773679028890369456276328097218681131210336197851484718484213121094699090839722641329327818066934448088431288328288112007488949292271360565624555172295051667285077138864510745740214905953043079468933679191715551224964421931824712984605682049449568976492220103844351216496482668448767237697296740468431846671505265143619239976063901580555986558904470931013978569579237148514276178765419852198637961774494186181747458089405228411950572658310072067499489988259824774767508198451267875000556446298608250644009748818937568123418528009187811944967998576518784004540892824519032050506460017670585483238226301820712571645579</span></span><br><span class="line"><span class="string">Hint 14: 59, 19, 10974757986236006288348468568336947121923978268025782618680419380484847824293845383379274809628633982884248524866285416869994466804493799071019695089232140692475376148645650118342055726520583120333882910989811592931370723715884717392658914626279560914541425986351478710240862377226197891323537525676367683258652280225895980668977840969537035757009985713502197856706880646989184201990423727195172560560704893733494792945340405983958264929760613990510042281137251536502371683060105493456566203202995676363796508260438545252515574493473542492715179349497866152824132141129238032807684278789579870873990631709515352502373</span></span><br><span class="line"><span class="string">Hint 15: 11, 59, 8286765915642893643722267671556930668422080363489440619486004330134849571178036674986475802754804260626759450923775241201472288503107728483612582960417838690160802</span></span><br><span class="line"><span class="string">Hint 16: 3, 83, 8670564904343374156075891784422797917915847070310520984332279769504164524019002920437878667712734918407503893528964609388615752378009668179394550543334742880513288696193899579334352041612737521648871122300770732109991958777364103317237896209222739571605930423722098331428587046952745581887767018125449661836385756401767146216848185513274686419811084754784129338190887685792489185844961970682436930953762662159256843649680197802836233628748219421311091068027884246286801955132580168006746385788553263325371239064547214943270463799271582693307097866515323559640081377472410365311796667103389327125755510398234792960539</span></span><br><span class="line"><span class="string">Hint 17: 47, 71, 15189655529337297599070621327692775647472437654342284733419279459044091245709484592008784236836038238199431339530080798833863694019082099360867975411468181802365883838048650755521947739185044832121750278668725458779161264572106488221158049174704002405104694045711051726668876267794954827804265584531526809688162851528267958117474561865081871142026481602702358611977383838840467216409782013973906761226139903245114056975231832568083538564658843330419770362826462102622789108069389249602641189148715388059622341376715417265924644704691316367196722599195793773962428198040205512616444509750834973953022693785550802266112</span></span><br><span class="line"><span class="string">Hint 18: 19, 29, 14661046810005357468594301664850836437610256328712330874381003343699942748425302158171105550644727048051206458117828772075144383589551129619743654527620413132286889305278690645291359466534057249273843187124449541437587033949823571613090619667989912739101162245067852658322665279694710401800444138141346856093835079283227374648099624120782619771322472623630789096431414534527222485118949515372622085183912510018177895906649522504991475861146404995703763107816964209369487501529056212864220862713277632632268594192926804994930950930762255940853728034617285828125545163750399143037606327606535126251763073693473953686744</span></span><br><span class="line"><span class="string">Hint 19: 11, 89, 13357214564583644951510034650716277516325510600111365531856471059002907497767937445827192806732793166523983315887101899445087845542550038342480500237151465231405685422545530090065005109607310864977025325103465672450850540379234341279749113886947539400845321822481006994262700375964062063857363515290494376286961284725864589465065587339836635723085250544188242927462327068925005089561746960078398647971113589281563663689024296134195815738058179266887469473137997216792436310641839801585271790331365746442208348676200753457562160444740691258422882276851839616144554731981681550535123108350101531030525324694963994545288</span></span><br><span class="line"><span class="string">Hint 20: 13, 19, 9015439113692415723812039454602636203717179069784080604236209577969030957184510380132987544909218798262905505307236620420364723156896628015021747981816896133290154232921264396063118665954041870382404950626337554885082880595372492300185559547705412727112020773895391734178675568118417294113429562448849544338564697858353479059676992341239979279973948191000090925611122966827392226766571948922617345703402518639464697367975459916964712370264229447747875703346922955116402649868815187647332682627727429521327349380558524025434437065348919358179886784373948470464530596295968257196117932806673623409596232224263656709447</span></span><br><span class="line"><span class="string">Hint 21: 17, 89, 1232624071183606371752171179827692250773859330394635710762162149851456772281037111827897119725547063233395640472176481922500789994068941245743063373416785659254352015310032922118348550975562</span></span><br><span class="line"><span class="string">Hint 22: 67, 83, 1126066176169173986258375138688137558142264839106063302940880092042502490911057016254959754435510429411384392032847908273635563612047472121950839934733905729015943917767915064618640585969621038467420076188953203812632416692873236731402216410500667938438399832227071790611412372173974174687603713326333791754140419675029772154828193139783484205710539042656417324250808919494712510406268629862104562237889399268931862879343990757365436458551497886263701914349819002099339457690106946122543529626710290881457346334759953170142024757161589525394691005814751979092184245953191693247075620270045838678527511170972567753351</span></span><br><span class="line"><span class="string">Hint 23: 41, 97, 15061728396574720128871454281806425283902878531290205263072044930084328354647716799950058691868870125292816458036423472349601649870044904984377004711678761714808846252355372756850495640148784156530292575757175420916873271609977179541391067607437946628688811886889502712607514447458904992024279765998865875618672417318528806259694052202283848620150531327490085874935926140164888318138777816635210686133434879564761574366090585467327313351792501721900090022412568322566880308204689579089754113916523137219409702840025596606460438071507115794360457519041650146002247978792944063933568992230154174930543323173071240960636</span></span><br><span class="line"><span class="string">Hint 24: 7, 23, 107006904423598033367949136709476534616</span></span><br><span class="line"><span class="string">Hint 25: 79, 47, 11094334665560612802457947914579705831928780165312070004861180761238832002874428458670163845939464475999733253092738012391076484871479088986479536610030564639805718143084622127711215172458485326388902083413575454799106868355391943732802994224342313418146481622340282330554260946195940723120836406549666330792363893799020720281135898034922255022048435484533585962047978284629786026663018345757890693521562666203031553493103945295693195640052093415731503407816366337336182698796883001653465915740746118519384260984893835094879165736186434278489286286227662273545663256993867922180157248380291757381125272120891684062194</span></span><br><span class="line"><span class="string">Hint 26: 59, 73, 4064264878148785166802093462858575465400091342645180541176126645875623098033551060982695656331190143572426766578696362147717218779335361493125256534627342192680373626652482508115615860816250319187188097915962706304133850035098343668277834974105321147191342624944627482006284223163704828843061145141268544104282644658022010819808655796239544272048394743182820455393255285941665799519906799024432739271653191031181064778284104887384076188431552852025837101339257686236262365247791750207700069395619856622961279534162976795147959769683692604340368460731405668330115156114576764572051491629821619308816381773343755003534</span></span><br><span class="line"><span class="string">Hint 27: 67, 37, 13951782965760049234481961368802553800278133941697263631552649243302664977209715848353709633491008434674270268090076527067844931388512019333805006404853566312201157392447713057698715800623288234051899693554210937852453814575305705182660789018065999222430838475037429354174069134372859946362529872754325135924297601113491133129277121309644377255711296412090554983403167436585565758988120192517511808267055408632606896756685326534561420410005038161122481109870042764517919065341900975187982359357007105413042469550052322588976438466403370644683889314221651454587673986716491269580073476431119104550125907982617819198239</span></span><br><span class="line"><span class="string">Hint 28: 71, 31, 14592451107942406172703460352000704126425716661469483183610425663886284772375260143470595014699236417504356417924516247683378564032172689094243907515271202472795378941272772693424353756938883720892780719870429492112844354792067076527090697208293397879373413452057503440196643066732299886678533556377726500394447831070628632364135576812382061688937462189566815186722078015421531935330987991868677259308976254080329342447669466494877857082494259824027412023017042305976083947770306599290459206333751309651343338718031684134413354721116695889173022783305688553309591139544114673672159391172663588390812561345603404875445</span></span><br><span class="line"><span class="string">Hint 29: 61, 37, 150312118586919145020616357224172487248862369450901081305248777087453651799298780184965167114015639778324633934952775965666791061680751287444693564273797597220185626300049938</span></span><br><span class="line"><span class="string">Hint 30: 47, 89, 5435525789990781146665058968159824543197878249058619814486157180575648579639831493916004219973973832266296536703517577992770</span></span><br><span class="line"><span class="string">Hint 31: 23, 47, 16103071775810171711924674905790805963818714309292465098237116772593040021211622298924186932004880334851627830206994635151992140064405277570483377357957039009351094902151630023493150975576584876244834021621269645929479405478143057020268612485343670663377970673925984030126760947109176763636955974818654880191024493408598053751276065135442200582652319408920748644591450674320233708025358524648197707659990862662361862539842868417063320792767415984991601751165223638123837341091365974671765054733794332399697028713963544373254318631595083356458002718583341127602790857490164278343070475882464426640213476914415482369850</span></span><br><span class="line"><span class="string">Hint 32: 29, 5, 13149325842021723251134510511729784479095642778506166091034934686556554381120350749714138697288609601129918017821541343485285067285202422145639363694603240119439803374916552440509169187395808575353190466385753062164445875730603626277916455911345416839502129509688066724158296752117066013823226052016786749548019509350864881585069802037870118674424466298682508091272797804735861773714128160193020313575834557745724129735757517340056227714959610755715392915985854554070909168057367535004631491240072926342019254725105436116655974774609052713231818128446311960013765270122065871739363402131985754839033491581530499347992</span></span><br><span class="line"><span class="string">Hint 33: 89, 47, 630043523370452187379224662747648830902214688021486477430843243593080113724992705480996062907676256037302619160067814028518895461989971281884155808829193898017336</span></span><br><span class="line"><span class="string">Hint 34: 19, 59, 5312300113767710347282768227082829679387523215214639151760217349511385597102767288546324009076948101196442028352053632460946433171294574346446379257281949909272350819311609431501573807000878460778313626108872598317920103278246614995180550162481588759079785633301645095994306260526442257399195256822168763040046685053639779110740308012206330181637380011462498603874585251040951562533555627840386291011622732627801692079226133918094516784934996032323522126557227339640405344352939596441336679652918394074410690904621730980459695004938137633444530118011543020946033976566969594506053598637256025269420788063085529221486</span></span><br><span class="line"><span class="string">Hint 35: 59, 3, 13338480097536050870847065134681408887393061870891194580910295898171005379071202538125320488322264936939611934926773854147441861842696082224910493485968940453414962504999277326912024770737526865763322593711772391102570024742439366641421857370464779798305027785021436688758138471130400190763565033556147205447698037378616533728663507465789889356211004747849498360714349678453175418183091908832867382402195272783569030789904261178845317149753713695808383033170623145131434242158410724256492198680651336056844232593215970896169424430059260906555229446741538286239350780216208715553935143523165464773688871774009588738407</span></span><br><span class="line"><span class="string">Hint 36: 67, 2, 8256928556897492704838762552986750294374712035464071847912955091323033935694693535736594865997626239305042785518308139569682623007419575794366667620985270619928978345775201291927479777879409352040290541010779775363393802966114845982777093715738330158248145557248971011553853095404328553837691636026735523457849132602891079774484964955413419103753159331087739019434888120001297351898315190776895144785024767468167340726846414096469818750219466508467856583779003457862584610836846910059997868710036273917335512342095635575374346404071250572917845292452258621324256922950179010754476790644241744968537946791784277331172</span></span><br><span class="line"><span class="string">Hint 37: 11, 89, 469829525495433863398701036274262995240821686827512278740409156383771339857992568557981522</span></span><br><span class="line"><span class="string">Hint 38: 53, 17, 15381013223078846537731461466880636394199540595403435401138127547481863401431466372374802606225281410197388364722944495843405467862781503434970989158584650159590980399087359088118746163629618532987297413548047215179053477589410157484215376788161320381404390190467326828317085039705167675630596365709188985681649747552770255068423205419746730136649403555515290098619746175600947097893366036430479763751257652595334352418296864541247999321025232348500763810371215286305853572498789766256531460974011022731922336715523379552064525311328532274496963226072015892784253991084576242734695083889820166631064731394426574244137</span></span><br><span class="line"><span class="string">Hint 39: 59, 3, 8639902842024035953048638563768315927624671856924547112209526883962456853052089935252707927468432895933170836045185383394096573378220873632433306851623471094895240704466661122788392467144892335530991171751297377896525529639348516066396938968040587426508605861054726429454030686327018745441753930983556245291730653368996527050046737903050080495173995563726990564829713815768651787483101363848070083858443766098560638337868296111441788798574965477355431173836128839250967090465226610709666720508328978510631834435136772497463531551713080290889081436462800389414847971067210139076388894646477223534324245688231308651402</span></span><br><span class="line"><span class="string">Hint 40: 71, 2, 35228394523315997738820412922291535639435039748226420541446858967158850258697393757215146296389518178994242807247547892971367759083443187781159</span></span><br><span class="line"><span class="string">Hint 41: 71, 89, 6240983929786483220051416467719053988488038641934890929981073832233939427834145472336915358758745943895354212032680367743535480193473825955326802869864352912264819240397323037315537988324410288546472301626890591739573348191915387074878814318018257079325106269383242877918486075024690767741729879076813581842036944498326059102754583317760100647490256432861228914984872474683425397073112462956198249407553140398404673370857128292911829788563089759423977978816627360219756198454057710015406165962422617662704219899517474510659197047034325834333381214858621450033089047323717051044225354940003754145032127292424992011101</span></span><br><span class="line"><span class="string">Hint 42: 41, 11, 6984059054701243194406577182995741240436897138602476775543220094645161472633895356320870691493565356230021817198695018272393666667370608977208110764253393769787442206738887651454907864559105056199727308147026476795306714769493199003447522266774033773324562270207374768320253619068701592065984601594887388312013493599257403722865953095442171057100657271578293280686338908523864018983343500587769033822586560003572736592272152317739316444108939218480574158527171198620726886917802598591993658035939705289787249746288650701612275221097113840902054486416966701593345265607809381111897049158093808534604642731640119152868</span></span><br><span class="line"><span class="string">Hint 43: 13, 29, 9610425425501485449537748361164652677158792621032292104946727266655594704290554003044377640635938997615382559405839696633456524257520749570798069876408676921921508491566094310451535812726509625559772552216775984034994654686077581771306574807821000988687494843385541833458873739204271564568689723925761973189708592881482846646426280049739796580929850941981882154358359008000707906221459919505725630791914755910838899191924833300609856950819107362413681305294507489838444421285910012653866140490877420620551310798317895506704520509435554786438387597440096937627702835916143794698887778982888695219967982245649746655470</span></span><br><span class="line"><span class="string">Hint 44: 47, 97, 794708560552308405126546731517428100557886745717835758758542380710685584</span></span><br><span class="line"><span class="string">Hint 45: 3, 41, 4366286865897405386543255708293800522386204706169307328366554555364884083859171277798722946451756634920858627299532823660480318239049230750988476049477513092520844569149267106332990711387926038335306437738094725423916554317517443566123618496555545533680705744831228568422251969382492688050958971980479679805428102801749764130245809570484750989852311926567073592760547445916703018635471776441628270869914109919847570929937108398744190319099944135878164624117925789234408527770792315261913666378047301366117348007407689729553121872429672477943763065031289363375897860958687532065443830782060680953252171706108298186067</span></span><br><span class="line"><span class="string">Hint 46: 53, 13, 16599275744410550408933364882313950383421717117863259063696626313760940800128182804380262220526496674159136503269710326208644142632589833265263673629452996345476574747374747172655476596826644020872255782962700686562762713813009141052898954099526049199438330249525172937305118217295550996402876461138835393788249817466964132570303998739392864522160381559518796827917831858448710285259754350691301608261901046038810797165013301247129220438986641677769203536623610901604156282036632560795746698128751128683870700853339493839501889121028640592461819470558005091594236201609522690232023400257649767388230656904982965702400</span></span><br><span class="line"><span class="string">Hint 47: 61, 83, 9953189432255063894070711778963178970743198121753649081719130469512753806047549503962109442976714615255038871181051195512724207218843889262884288045589566753004137388059340730864662203711021106738767094228552897493653199240432249671119014845998208040396103544771523200759949973732641979644934204944350638114647371917538547803820215871447465362042956264048360078551647879310238285850657470764222027085496193016418088396386760643015475367197907378932626248164269818716905644542858090723472987968554892684192736976050169896444520698548656309379499864809652240244453616286236722509397142224233180948147011605558427902848</span></span><br><span class="line"><span class="string">Hint 48: 47, 73, 11137871466581047781242984634852964336706264103460602528475970728553465644713327296350923627071860721778412789236714773697433892321959279504008377433584604885817319604115996426320874382244073671694322092160768350159529231732048447670177579115854882538413223938721279445190025525651472499343624011272214336778696111400347742318222789215043195711269360705507743463500549755479755775737105743290208621332589467304719937369513194207595213182980370357559166180993485168866418076474829491707312908665547905615295104716814273672708222960604034067248688735024594069804630472429600684961470444745009128678939204098625367015452</span></span><br><span class="line"><span class="string">Hint 49: 37, 43, 8547801237237556680245447121357531340087815887730999035326630934574339083867172461996679202294604204246415617087303468869638590371489396511890451394149215396045103967365422720335104673107126428846330142015210956274026922065251671248521248406703003517010268831048835400375497130725745344823402860499648204664008236488552255035422928921490487905318800334939525030207122862220895298568207554924706494486709790089585773581447139024819366484617067643862923821174578132381404045225537724922355917737191443476738183156619271477344846716060997041706765920488392521346954370234605596534371205052913391651084238833069263785246</span></span><br><span class="line"><span class="string">Hint 50: 89, 7, 10398214245820233588167072072340460997067473220261572021578267549114000461324485988447437613040475809210011162256875428799327091235990171928216379105895288609773032862919523980293555963618323001564571973363418294497086861386518673361280706598614868452173330762143105775824076992409365806017218778102139861298703673447295670293191397994589110648541822608470022190616048229374246581750506635166699349805517119679503917519913987281318125804952325118589261418014369477837522696543190827291142488222603361805610512683583242709234195072960764001035300916480662591147878968245702960413084896858751962028377013605141587432900</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your goal: recover the flag by factoring n using the hints!</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>


<p>$$<br>\begin{gather}<br>we\ know\ that\ H&#x3D;b_i^{p-1}+b_j^{p-1}\ (mod\ n) \<br>because\ n&#x3D;p*q \<br>so\ H \equiv (b_i^{p-1}+b_j^{p-1})\ (mod\ p) \<br>and\ according\ to\ Fermat’s\ Little\ Theorom\ H \equiv 2\ (mod\ p) \<br>so\ we\ reach\ the\ conclusion\ p|(H-2) \<br>notice\ that\ p|n \<br>so\ we\ can\ get\ p\ from\ :\ p&#x3D;gcd(H-2,n) \<br>then\ we\ get\ q&#x3D;n&#x2F;&#x2F;p<br>\end{gather}<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"></span><br><span class="line">n = <span class="number">16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span></span><br><span class="line"></span><br><span class="line">hints_text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Hint 1: 11, 41, 403072318395713195475880235840306655046644537786837658466183670390322357403650602210882802453171853452</span></span><br><span class="line"><span class="string">Hint 2: 73, 7, 3401877351823051464833008106697922874740843547186522246399577691648145322938787488999079423405760696040635223407580102549819096176975820017380148265275786281647240647714533261221890310813882987089721138616513427711006945061727486708277298401545762448776593105730005387022319319199166969225690343981500127626848336242187816071435842118963634505746771844269484845077330851526393327015758760003053231670737896550596266539249975891234238005583184203089180325261872944167834576158878843510707348603774425827560724587546720860765943393963597645881666559247252842017499263265738255716811999328445725902262302532911214255949</span></span><br><span class="line"><span class="string">Hint 3: 59, 73, 695583691945177012011155613294846891840015729899504980764916686517371703553347581254163445300367305365949600797847620946823894152274689248119430670857791635723385692575931740078475490085973951317953049329486264578815530286784178680687403627415153526425715193114420845091853572366108176759184115038228886689580295865909953096284457818874267153151571968297454864850732608316298813594124020007025412733770104355236849081247730461956131749267446455113813284775308663385548094921945410215359273656658830019785099633226412843434625002115741084636776823289994271249660745143685585443820708578849162449717982725541307852715</span></span><br><span class="line"><span class="string">Hint 4: 53, 17, 971645701575323882519635342913625889703399294086</span></span><br><span class="line"><span class="string">Hint 5: 17, 53, 15015015166119321293244100074414416277924832658329700344653519929879563546652512240571777007009139132526751717913688831473249036114283479537249767699902565862566840754892319936718933957878788242522102884592375092063435348463420495622162622111752797419564087812071877456034189172928466087325995711799494559632348117577986369270044265839851198529901138826760234172452522279821372814789053868333623123766583799003287221335420456780264904184548645200345715153696373219687248029519611142514212181449677795769427641367964609639782220743835161725500332507591502818244881229659746207461229056486960160782643424330243354078694</span></span><br><span class="line"><span class="string">Hint 6: 59, 19, 4427802296687944448870952484227318</span></span><br><span class="line"><span class="string">Hint 7: 19, 43, 19174465169354813231681320402781559275699092043658101294284851123118510716279410</span></span><br><span class="line"><span class="string">Hint 8: 23, 31, 6031706827842456717715236244872427215835819411314168938820265741988730625387931647610750902952789928566569174296650515449892611198040938188209413722806254050103019879240215344570043498312370280623702924998835728624935413985841142180365335178468710734638030582183503463305813229510689954065159041592316788178873050291779739508108222965509434291492950189742558594400755699777715854046635146464467729949201239668741264832027750549876625288984575624485894153879412247669943493660233937543961086506015000295606199222800612415043850877838520358081044378561877650595040905680464898635661677396546195369907960492865630959945</span></span><br><span class="line"><span class="string">Hint 9: 73, 31, 14201978515584496685882877364621713654579319459919970854066889531106363038011334520524797899491133943665135480301300406440254472658620428164578914318059588912647092994632856690</span></span><br><span class="line"><span class="string">Hint 10: 31, 3, 17761887753093897979823770061456102763834352</span></span><br><span class="line"><span class="string">Hint 11: 13, 5, 4150700388609705807509972385476068337626559497757356803399419065000783917890225153250286903799441660433187538279583874523190497602462150199426414868861228792088666515397312761673326022980940385774334828394940770351447957541072690963220641780722897399543555486513918873014494692941882646929202605685305683969151271831603708612223260616432695010847067252877343217676963276876850265407927146383572955861063428706012170676831524971272198283920333900403902257748241220365118645448662797961778388544299359695919130547938351588261698392641490575786350259413542725944665834486513968924860904668074607650304874723425230270137</span></span><br><span class="line"><span class="string">Hint 12: 59, 53, 2093308535564899860358544644764036388478107502010763064242342417957960952425000274395405300689532194265342136032111944045432326085818281844400947666782274940461183395046865284971635536544260910022728631047126094710543502860882170401987674931187922422766222327719930375318976698721098197543008758760603140658147997152753438270623866111022164350986375651437321309108736011279113592001916870502347116720151257306071411569096876275005515839079136440506703094781753301521917670413306257490297241974169467740732230454155267623129991881695623072243477621355484939295049508367225410929080326109567111654067945546042372106278</span></span><br><span class="line"><span class="string">Hint 13: 11, 89, 5773679028890369456276328097218681131210336197851484718484213121094699090839722641329327818066934448088431288328288112007488949292271360565624555172295051667285077138864510745740214905953043079468933679191715551224964421931824712984605682049449568976492220103844351216496482668448767237697296740468431846671505265143619239976063901580555986558904470931013978569579237148514276178765419852198637961774494186181747458089405228411950572658310072067499489988259824774767508198451267875000556446298608250644009748818937568123418528009187811944967998576518784004540892824519032050506460017670585483238226301820712571645579</span></span><br><span class="line"><span class="string">Hint 14: 59, 19, 10974757986236006288348468568336947121923978268025782618680419380484847824293845383379274809628633982884248524866285416869994466804493799071019695089232140692475376148645650118342055726520583120333882910989811592931370723715884717392658914626279560914541425986351478710240862377226197891323537525676367683258652280225895980668977840969537035757009985713502197856706880646989184201990423727195172560560704893733494792945340405983958264929760613990510042281137251536502371683060105493456566203202995676363796508260438545252515574493473542492715179349497866152824132141129238032807684278789579870873990631709515352502373</span></span><br><span class="line"><span class="string">Hint 15: 11, 59, 8286765915642893643722267671556930668422080363489440619486004330134849571178036674986475802754804260626759450923775241201472288503107728483612582960417838690160802</span></span><br><span class="line"><span class="string">Hint 16: 3, 83, 8670564904343374156075891784422797917915847070310520984332279769504164524019002920437878667712734918407503893528964609388615752378009668179394550543334742880513288696193899579334352041612737521648871122300770732109991958777364103317237896209222739571605930423722098331428587046952745581887767018125449661836385756401767146216848185513274686419811084754784129338190887685792489185844961970682436930953762662159256843649680197802836233628748219421311091068027884246286801955132580168006746385788553263325371239064547214943270463799271582693307097866515323559640081377472410365311796667103389327125755510398234792960539</span></span><br><span class="line"><span class="string">Hint 17: 47, 71, 15189655529337297599070621327692775647472437654342284733419279459044091245709484592008784236836038238199431339530080798833863694019082099360867975411468181802365883838048650755521947739185044832121750278668725458779161264572106488221158049174704002405104694045711051726668876267794954827804265584531526809688162851528267958117474561865081871142026481602702358611977383838840467216409782013973906761226139903245114056975231832568083538564658843330419770362826462102622789108069389249602641189148715388059622341376715417265924644704691316367196722599195793773962428198040205512616444509750834973953022693785550802266112</span></span><br><span class="line"><span class="string">Hint 18: 19, 29, 14661046810005357468594301664850836437610256328712330874381003343699942748425302158171105550644727048051206458117828772075144383589551129619743654527620413132286889305278690645291359466534057249273843187124449541437587033949823571613090619667989912739101162245067852658322665279694710401800444138141346856093835079283227374648099624120782619771322472623630789096431414534527222485118949515372622085183912510018177895906649522504991475861146404995703763107816964209369487501529056212864220862713277632632268594192926804994930950930762255940853728034617285828125545163750399143037606327606535126251763073693473953686744</span></span><br><span class="line"><span class="string">Hint 19: 11, 89, 13357214564583644951510034650716277516325510600111365531856471059002907497767937445827192806732793166523983315887101899445087845542550038342480500237151465231405685422545530090065005109607310864977025325103465672450850540379234341279749113886947539400845321822481006994262700375964062063857363515290494376286961284725864589465065587339836635723085250544188242927462327068925005089561746960078398647971113589281563663689024296134195815738058179266887469473137997216792436310641839801585271790331365746442208348676200753457562160444740691258422882276851839616144554731981681550535123108350101531030525324694963994545288</span></span><br><span class="line"><span class="string">Hint 20: 13, 19, 9015439113692415723812039454602636203717179069784080604236209577969030957184510380132987544909218798262905505307236620420364723156896628015021747981816896133290154232921264396063118665954041870382404950626337554885082880595372492300185559547705412727112020773895391734178675568118417294113429562448849544338564697858353479059676992341239979279973948191000090925611122966827392226766571948922617345703402518639464697367975459916964712370264229447747875703346922955116402649868815187647332682627727429521327349380558524025434437065348919358179886784373948470464530596295968257196117932806673623409596232224263656709447</span></span><br><span class="line"><span class="string">Hint 21: 17, 89, 1232624071183606371752171179827692250773859330394635710762162149851456772281037111827897119725547063233395640472176481922500789994068941245743063373416785659254352015310032922118348550975562</span></span><br><span class="line"><span class="string">Hint 22: 67, 83, 1126066176169173986258375138688137558142264839106063302940880092042502490911057016254959754435510429411384392032847908273635563612047472121950839934733905729015943917767915064618640585969621038467420076188953203812632416692873236731402216410500667938438399832227071790611412372173974174687603713326333791754140419675029772154828193139783484205710539042656417324250808919494712510406268629862104562237889399268931862879343990757365436458551497886263701914349819002099339457690106946122543529626710290881457346334759953170142024757161589525394691005814751979092184245953191693247075620270045838678527511170972567753351</span></span><br><span class="line"><span class="string">Hint 23: 41, 97, 15061728396574720128871454281806425283902878531290205263072044930084328354647716799950058691868870125292816458036423472349601649870044904984377004711678761714808846252355372756850495640148784156530292575757175420916873271609977179541391067607437946628688811886889502712607514447458904992024279765998865875618672417318528806259694052202283848620150531327490085874935926140164888318138777816635210686133434879564761574366090585467327313351792501721900090022412568322566880308204689579089754113916523137219409702840025596606460438071507115794360457519041650146002247978792944063933568992230154174930543323173071240960636</span></span><br><span class="line"><span class="string">Hint 24: 7, 23, 107006904423598033367949136709476534616</span></span><br><span class="line"><span class="string">Hint 25: 79, 47, 11094334665560612802457947914579705831928780165312070004861180761238832002874428458670163845939464475999733253092738012391076484871479088986479536610030564639805718143084622127711215172458485326388902083413575454799106868355391943732802994224342313418146481622340282330554260946195940723120836406549666330792363893799020720281135898034922255022048435484533585962047978284629786026663018345757890693521562666203031553493103945295693195640052093415731503407816366337336182698796883001653465915740746118519384260984893835094879165736186434278489286286227662273545663256993867922180157248380291757381125272120891684062194</span></span><br><span class="line"><span class="string">Hint 26: 59, 73, 4064264878148785166802093462858575465400091342645180541176126645875623098033551060982695656331190143572426766578696362147717218779335361493125256534627342192680373626652482508115615860816250319187188097915962706304133850035098343668277834974105321147191342624944627482006284223163704828843061145141268544104282644658022010819808655796239544272048394743182820455393255285941665799519906799024432739271653191031181064778284104887384076188431552852025837101339257686236262365247791750207700069395619856622961279534162976795147959769683692604340368460731405668330115156114576764572051491629821619308816381773343755003534</span></span><br><span class="line"><span class="string">Hint 27: 67, 37, 13951782965760049234481961368802553800278133941697263631552649243302664977209715848353709633491008434674270268090076527067844931388512019333805006404853566312201157392447713057698715800623288234051899693554210937852453814575305705182660789018065999222430838475037429354174069134372859946362529872754325135924297601113491133129277121309644377255711296412090554983403167436585565758988120192517511808267055408632606896756685326534561420410005038161122481109870042764517919065341900975187982359357007105413042469550052322588976438466403370644683889314221651454587673986716491269580073476431119104550125907982617819198239</span></span><br><span class="line"><span class="string">Hint 28: 71, 31, 14592451107942406172703460352000704126425716661469483183610425663886284772375260143470595014699236417504356417924516247683378564032172689094243907515271202472795378941272772693424353756938883720892780719870429492112844354792067076527090697208293397879373413452057503440196643066732299886678533556377726500394447831070628632364135576812382061688937462189566815186722078015421531935330987991868677259308976254080329342447669466494877857082494259824027412023017042305976083947770306599290459206333751309651343338718031684134413354721116695889173022783305688553309591139544114673672159391172663588390812561345603404875445</span></span><br><span class="line"><span class="string">Hint 29: 61, 37, 150312118586919145020616357224172487248862369450901081305248777087453651799298780184965167114015639778324633934952775965666791061680751287444693564273797597220185626300049938</span></span><br><span class="line"><span class="string">Hint 30: 47, 89, 5435525789990781146665058968159824543197878249058619814486157180575648579639831493916004219973973832266296536703517577992770</span></span><br><span class="line"><span class="string">Hint 31: 23, 47, 16103071775810171711924674905790805963818714309292465098237116772593040021211622298924186932004880334851627830206994635151992140064405277570483377357957039009351094902151630023493150975576584876244834021621269645929479405478143057020268612485343670663377970673925984030126760947109176763636955974818654880191024493408598053751276065135442200582652319408920748644591450674320233708025358524648197707659990862662361862539842868417063320792767415984991601751165223638123837341091365974671765054733794332399697028713963544373254318631595083356458002718583341127602790857490164278343070475882464426640213476914415482369850</span></span><br><span class="line"><span class="string">Hint 32: 29, 5, 13149325842021723251134510511729784479095642778506166091034934686556554381120350749714138697288609601129918017821541343485285067285202422145639363694603240119439803374916552440509169187395808575353190466385753062164445875730603626277916455911345416839502129509688066724158296752117066013823226052016786749548019509350864881585069802037870118674424466298682508091272797804735861773714128160193020313575834557745724129735757517340056227714959610755715392915985854554070909168057367535004631491240072926342019254725105436116655974774609052713231818128446311960013765270122065871739363402131985754839033491581530499347992</span></span><br><span class="line"><span class="string">Hint 33: 89, 47, 630043523370452187379224662747648830902214688021486477430843243593080113724992705480996062907676256037302619160067814028518895461989971281884155808829193898017336</span></span><br><span class="line"><span class="string">Hint 34: 19, 59, 5312300113767710347282768227082829679387523215214639151760217349511385597102767288546324009076948101196442028352053632460946433171294574346446379257281949909272350819311609431501573807000878460778313626108872598317920103278246614995180550162481588759079785633301645095994306260526442257399195256822168763040046685053639779110740308012206330181637380011462498603874585251040951562533555627840386291011622732627801692079226133918094516784934996032323522126557227339640405344352939596441336679652918394074410690904621730980459695004938137633444530118011543020946033976566969594506053598637256025269420788063085529221486</span></span><br><span class="line"><span class="string">Hint 35: 59, 3, 13338480097536050870847065134681408887393061870891194580910295898171005379071202538125320488322264936939611934926773854147441861842696082224910493485968940453414962504999277326912024770737526865763322593711772391102570024742439366641421857370464779798305027785021436688758138471130400190763565033556147205447698037378616533728663507465789889356211004747849498360714349678453175418183091908832867382402195272783569030789904261178845317149753713695808383033170623145131434242158410724256492198680651336056844232593215970896169424430059260906555229446741538286239350780216208715553935143523165464773688871774009588738407</span></span><br><span class="line"><span class="string">Hint 36: 67, 2, 8256928556897492704838762552986750294374712035464071847912955091323033935694693535736594865997626239305042785518308139569682623007419575794366667620985270619928978345775201291927479777879409352040290541010779775363393802966114845982777093715738330158248145557248971011553853095404328553837691636026735523457849132602891079774484964955413419103753159331087739019434888120001297351898315190776895144785024767468167340726846414096469818750219466508467856583779003457862584610836846910059997868710036273917335512342095635575374346404071250572917845292452258621324256922950179010754476790644241744968537946791784277331172</span></span><br><span class="line"><span class="string">Hint 37: 11, 89, 469829525495433863398701036274262995240821686827512278740409156383771339857992568557981522</span></span><br><span class="line"><span class="string">Hint 38: 53, 17, 15381013223078846537731461466880636394199540595403435401138127547481863401431466372374802606225281410197388364722944495843405467862781503434970989158584650159590980399087359088118746163629618532987297413548047215179053477589410157484215376788161320381404390190467326828317085039705167675630596365709188985681649747552770255068423205419746730136649403555515290098619746175600947097893366036430479763751257652595334352418296864541247999321025232348500763810371215286305853572498789766256531460974011022731922336715523379552064525311328532274496963226072015892784253991084576242734695083889820166631064731394426574244137</span></span><br><span class="line"><span class="string">Hint 39: 59, 3, 8639902842024035953048638563768315927624671856924547112209526883962456853052089935252707927468432895933170836045185383394096573378220873632433306851623471094895240704466661122788392467144892335530991171751297377896525529639348516066396938968040587426508605861054726429454030686327018745441753930983556245291730653368996527050046737903050080495173995563726990564829713815768651787483101363848070083858443766098560638337868296111441788798574965477355431173836128839250967090465226610709666720508328978510631834435136772497463531551713080290889081436462800389414847971067210139076388894646477223534324245688231308651402</span></span><br><span class="line"><span class="string">Hint 40: 71, 2, 35228394523315997738820412922291535639435039748226420541446858967158850258697393757215146296389518178994242807247547892971367759083443187781159</span></span><br><span class="line"><span class="string">Hint 41: 71, 89, 6240983929786483220051416467719053988488038641934890929981073832233939427834145472336915358758745943895354212032680367743535480193473825955326802869864352912264819240397323037315537988324410288546472301626890591739573348191915387074878814318018257079325106269383242877918486075024690767741729879076813581842036944498326059102754583317760100647490256432861228914984872474683425397073112462956198249407553140398404673370857128292911829788563089759423977978816627360219756198454057710015406165962422617662704219899517474510659197047034325834333381214858621450033089047323717051044225354940003754145032127292424992011101</span></span><br><span class="line"><span class="string">Hint 42: 41, 11, 6984059054701243194406577182995741240436897138602476775543220094645161472633895356320870691493565356230021817198695018272393666667370608977208110764253393769787442206738887651454907864559105056199727308147026476795306714769493199003447522266774033773324562270207374768320253619068701592065984601594887388312013493599257403722865953095442171057100657271578293280686338908523864018983343500587769033822586560003572736592272152317739316444108939218480574158527171198620726886917802598591993658035939705289787249746288650701612275221097113840902054486416966701593345265607809381111897049158093808534604642731640119152868</span></span><br><span class="line"><span class="string">Hint 43: 13, 29, 9610425425501485449537748361164652677158792621032292104946727266655594704290554003044377640635938997615382559405839696633456524257520749570798069876408676921921508491566094310451535812726509625559772552216775984034994654686077581771306574807821000988687494843385541833458873739204271564568689723925761973189708592881482846646426280049739796580929850941981882154358359008000707906221459919505725630791914755910838899191924833300609856950819107362413681305294507489838444421285910012653866140490877420620551310798317895506704520509435554786438387597440096937627702835916143794698887778982888695219967982245649746655470</span></span><br><span class="line"><span class="string">Hint 44: 47, 97, 794708560552308405126546731517428100557886745717835758758542380710685584</span></span><br><span class="line"><span class="string">Hint 45: 3, 41, 4366286865897405386543255708293800522386204706169307328366554555364884083859171277798722946451756634920858627299532823660480318239049230750988476049477513092520844569149267106332990711387926038335306437738094725423916554317517443566123618496555545533680705744831228568422251969382492688050958971980479679805428102801749764130245809570484750989852311926567073592760547445916703018635471776441628270869914109919847570929937108398744190319099944135878164624117925789234408527770792315261913666378047301366117348007407689729553121872429672477943763065031289363375897860958687532065443830782060680953252171706108298186067</span></span><br><span class="line"><span class="string">Hint 46: 53, 13, 16599275744410550408933364882313950383421717117863259063696626313760940800128182804380262220526496674159136503269710326208644142632589833265263673629452996345476574747374747172655476596826644020872255782962700686562762713813009141052898954099526049199438330249525172937305118217295550996402876461138835393788249817466964132570303998739392864522160381559518796827917831858448710285259754350691301608261901046038810797165013301247129220438986641677769203536623610901604156282036632560795746698128751128683870700853339493839501889121028640592461819470558005091594236201609522690232023400257649767388230656904982965702400</span></span><br><span class="line"><span class="string">Hint 47: 61, 83, 9953189432255063894070711778963178970743198121753649081719130469512753806047549503962109442976714615255038871181051195512724207218843889262884288045589566753004137388059340730864662203711021106738767094228552897493653199240432249671119014845998208040396103544771523200759949973732641979644934204944350638114647371917538547803820215871447465362042956264048360078551647879310238285850657470764222027085496193016418088396386760643015475367197907378932626248164269818716905644542858090723472987968554892684192736976050169896444520698548656309379499864809652240244453616286236722509397142224233180948147011605558427902848</span></span><br><span class="line"><span class="string">Hint 48: 47, 73, 11137871466581047781242984634852964336706264103460602528475970728553465644713327296350923627071860721778412789236714773697433892321959279504008377433584604885817319604115996426320874382244073671694322092160768350159529231732048447670177579115854882538413223938721279445190025525651472499343624011272214336778696111400347742318222789215043195711269360705507743463500549755479755775737105743290208621332589467304719937369513194207595213182980370357559166180993485168866418076474829491707312908665547905615295104716814273672708222960604034067248688735024594069804630472429600684961470444745009128678939204098625367015452</span></span><br><span class="line"><span class="string">Hint 49: 37, 43, 8547801237237556680245447121357531340087815887730999035326630934574339083867172461996679202294604204246415617087303468869638590371489396511890451394149215396045103967365422720335104673107126428846330142015210956274026922065251671248521248406703003517010268831048835400375497130725745344823402860499648204664008236488552255035422928921490487905318800334939525030207122862220895298568207554924706494486709790089585773581447139024819366484617067643862923821174578132381404045225537724922355917737191443476738183156619271477344846716060997041706765920488392521346954370234605596534371205052913391651084238833069263785246</span></span><br><span class="line"><span class="string">Hint 50: 89, 7, 10398214245820233588167072072340460997067473220261572021578267549114000461324485988447437613040475809210011162256875428799327091235990171928216379105895288609773032862919523980293555963618323001564571973363418294497086861386518673361280706598614868452173330762143105775824076992409365806017218778102139861298703673447295670293191397994589110648541822608470022190616048229374246581750506635166699349805517119679503917519913987281318125804952325118589261418014369477837522696543190827291142488222603361805610512683583242709234195072960764001035300916480662591147878968245702960413084896858751962028377013605141587432900</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line"></span><br><span class="line">    lines = hints_text.strip().split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 解析格式: &quot;Hint 1: 11, 41, 4030...&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> line: <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            content = line.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">            parts = content.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">            hint_val = <span class="built_in">int</span>(parts[<span class="number">2</span>].strip())</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 计算 p = gcd(hint_value - 2, n)</span></span><br><span class="line">            p = math.gcd(hint_val - <span class="number">2</span>, n)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; n:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;[+] Success! Found factor p from <span class="subst">&#123;line.split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                q = n // p</span><br><span class="line"></span><br><span class="line">                phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                d = inverse(e, phi)</span><br><span class="line">                </span><br><span class="line">                m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">                flag = long_to_bytes(m)</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[+] Flag: <span class="subst">&#123;flag.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p>得到<strong>ISCTF{M0dIFi3D_f3RM47_7H30r3m_I5_fUn_8U7_h4rD3r!}</strong></p>
<p>实际上这题只需要一个hint即可恢复出素数p？</p>
<ul>
<li><p>小蓝鲨的密码箱</p>
<blockquote>
<p>小蓝鲨有一个神秘的black-box，里面藏着它最珍贵的秘密。小蓝鲨告诉我们，只有知道密码箱的运算逻辑，你才能知道它的秘密。</p>
</blockquote>
</li>
</ul>
<p>这题比较传奇，误打误撞做对了</p>
<p>密码黑盒，要求输入a,b,c和明文</p>
<p>既然是黑盒那就试试看，明文设为A，经过几次尝试发现：</p>
<p>1.a,b,c!&#x3D;0</p>
<p>2.a,c允许是负数</p>
<p>在测试数字1的时候密文始终输出来是00，a&#x3D;b&#x3D;1,c&#x3D;-2的时候输出：</p>
<p>密文:<br>00<br>Flag:<br>00 00 00 -1 -1 00 -1 00 -1 00 00 00 -1 -1 00 -1 -1 00 00 00 -1 -1 00 -1 00 -1 -1 00 00 00 00 00 00 -1 00 -1 -1 -1 -1 00 -1 -1 00</p>
<p>于是莫名其妙的试了一下a&#x3D;1, b&#x3D;1, c&#x3D;2147483648：</p>
<p>密文:<br>42<br>Flag:</p>
<p>4a 54 44 55 47 7c 39 36 39 66 38 38 35 37 2e 31 31 32 3a 2e 35 31 62 65 2e 63 37 38 64 2e 32 36 3a 63 62 67 39 35 63 36 63 39 7e</p>
<p>事实上42是66的十进制表示，所以每个字节凯撒移位1即可得到<strong>ISCTF{858e7746-0019-40ad-b67c-159baf84b5b8}</strong></p>
<ul>
<li><p>baby_math</p>
<blockquote>
<p>死去的记忆突然被唤醒了</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag)) </span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line">a,b = bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]),bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:])</span><br><span class="line">x   = R(<span class="number">0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100</span>)</span><br><span class="line"> </span><br><span class="line">enc = a*cos(x)+b*sin(x) </span><br><span class="line"></span><br><span class="line"><span class="comment">#1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52</span></span><br></pre></td></tr></table></figure>

<p>这个题是真没想到和LLL有关，AI梭的<br>$$<br>\begin{gather}<br>a⋅cos(x)+b⋅sin(x)≈enc\<br>we\ need\ to\ find\ a,b\ let\ a·cos(x)+b·sin(x)-enc≈0 \</p>
<p>\end{gather}<br>$$</p>
<p>$$<br>M &#x3D;<br>\begin{pmatrix}<br>1 &amp; 0 &amp; \lfloor K\cdot\cos(x) \rceil \<br>0 &amp; 1 &amp; \lfloor K\cdot\sin(x) \rceil \<br>0 &amp; 0 &amp; \lfloor K\cdot\text{enc} \rceil<br>\end{pmatrix}<br>$$</p>
<p>$$<br>v&#x3D;(a,b,⌊K(acosx+bsinx)⌋−⌊K⋅enc⌉)≈(a,b,0)<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">x_str = <span class="string">&quot;0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100&quot;</span></span><br><span class="line">enc_str = <span class="string">&quot;1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置高精度环境</span></span><br><span class="line"><span class="comment"># 题目中使用了 RealField(1000)，我们需要匹配这个精度</span></span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line">x = R(x_str)</span><br><span class="line">enc = R(enc_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 构造格 (Lattice)</span></span><br><span class="line"><span class="comment"># 目标方程: a * cos(x) + b * sin(x) - enc ≈ 0</span></span><br><span class="line"><span class="comment"># 放大因子 K。由于输入精度约为 1000 bits (300 digits)，我们设置 K 接近这个精度。</span></span><br><span class="line">K = <span class="number">10</span>**<span class="number">300</span> </span><br><span class="line"></span><br><span class="line">M = Matrix(ZZ, [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="built_in">round</span>(K * cos(x))],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="built_in">round</span>(K * sin(x))],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">round</span>(K * enc)]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. LLL 格归约</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Running LLL...&quot;</span>)</span><br><span class="line">M_reduced = M.LLL()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 提取结果</span></span><br><span class="line"><span class="comment"># LLL 归约后的矩阵第一行通常就是最短向量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Checking rows for flag...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> M_reduced:</span><br><span class="line"></span><br><span class="line">    a_cand = <span class="built_in">abs</span>(row[<span class="number">0</span>])</span><br><span class="line">    b_cand = <span class="built_in">abs</span>(row[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 简单的过滤：a 和 b 不应为 0</span></span><br><span class="line">    <span class="keyword">if</span> a_cand == <span class="number">0</span> <span class="keyword">or</span> b_cand == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 尝试转换为字节</span></span><br><span class="line">        part1 = long_to_bytes(Integer(a_cand))</span><br><span class="line">        part2 = long_to_bytes(Integer(b_cand))</span><br><span class="line">        </span><br><span class="line">        flag_cand = part1 + part2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;ISCTF&#123;&#x27;</span> <span class="keyword">in</span> flag_cand:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found Candidate: <span class="subst">&#123;flag_cand&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{164a3221-7306-4024-88c3-4ef557b86895}</strong></p>
<ul>
<li><p>小蓝鲨的RSA密文</p>
<blockquote>
<p>“小蓝鲨是海洋数学天才，它最近正在深耕RSA领域。你嗤之以鼻，心想RSA不是最基础的密码学知识吗？于是你信誓旦旦的跑到小蓝鲨面前告诉它你已经完全掌握了RSA，并宣称所有的RSA题目你都能做出来。 小蓝鲨意味深长的看了你一眼，并出了一道RSA来考考你。现在，该你向它证明你的实力了。”</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json, secrets</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">N = getPrime(<span class="number">512</span>) * getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">a2_high = a2 &gt;&gt; LOW_BITS</span><br><span class="line"></span><br><span class="line">aes_key = secrets.token_bytes(<span class="number">16</span>)</span><br><span class="line">m = bytes_to_long(aes_key)</span><br><span class="line"></span><br><span class="line">f = a2 * (m * m) + a1 * m + a0</span><br><span class="line"></span><br><span class="line">c = (<span class="built_in">pow</span>(m, e) + f) % N</span><br><span class="line"></span><br><span class="line">iv = secrets.token_bytes(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(aes_key, AES.MODE_CBC, iv=iv)</span><br><span class="line">ct = cipher.encrypt(pad(FLAG, <span class="number">16</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">N = 121288600621198389662246479277632294800423697823363188896668775456771641807233781416525282234787873435904747571468452950479817935684848143651716343606633656969395065588423982440884464542428742861388200306417822228591316703916504170245990423925894477848679490979364923848426643149659758241239900845544537886777</span></span><br><span class="line"><span class="string">c = 3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span></span><br><span class="line"><span class="string">a2_high = 9012778</span></span><br><span class="line"><span class="string">LOW_BITS = 16</span></span><br><span class="line"><span class="string">a1 = 621315</span></span><br><span class="line"><span class="string">a0 = 452775142</span></span><br><span class="line"><span class="string">iv = bf38e64bb5c1b069a07b7d1d046a9010</span></span><br><span class="line"><span class="string">ct = 8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>翻译一下<br>$$<br>\begin{gather}<br>assume\ FLAG&#x3D;P \<br>f&#x3D;a2<em>m^2+a1</em>m+a0 \<br>c&#x3D;(m^e+f)\ mod\ n \<br>so\ c&#x3D;(m^3+a2<em>m^2+a1</em>m+a0)\ mod\ n \<br>P’&#x3D;pad(P)&#x3D;P_1’||P_2’||…||P_n’ \<br>C_0&#x3D;iv \<br>C_i&#x3D;AES_K(P_i’\ xor\ C_{i-1}) \<br>ct&#x3D;C_1||C_2||…||C_n \<br>\<br>a2high&#x3D;a2&gt;&gt;16 \<br>\end{gather}<br>$$<br>先爆破a2再恢复m<br>$$<br>x∈[0,1,…,2^{16}-1] \<br>a2&#x3D;a2high&lt;&lt;16+x \<br>c&#x3D;m^3+a2<em>m^2+a1</em>m+a0 \<br>define\ h(m)&#x3D;m^3+a2<em>m^2+a1</em>m+a0-c \<br>we\ need\ to\ find\ m\ let\ h(m)&#x3D;0 \<br>$$<br>可以使用二分法找到m。注意！m不是明文哦，m&#x3D;long_to_bytes(aes_key)<br>$$<br>aes-key&#x3D;bytes(m) \<br>ct&#x3D;C_1||C_2||…||C_n \<br>P_1’&#x3D;AES_K^{-1}(C_1)\ xor\ iv \<br>P_i’&#x3D;AES_K^{-1}(C_i)\ xor\ C_{i-1} \<br>P’&#x3D;P_1’||P_2’||…||P_n’ \<br>FLAG&#x3D;P&#x3D;unpad(P’)\<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">c = <span class="number">3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span></span><br><span class="line">a2_high = <span class="number">9012778</span></span><br><span class="line">LOW_BITS = <span class="number">16</span></span><br><span class="line">a1 = <span class="number">621315</span></span><br><span class="line">a0 = <span class="number">452775142</span></span><br><span class="line">iv_hex = <span class="string">&quot;bf38e64bb5c1b069a07b7d1d046a9010&quot;</span></span><br><span class="line">ct_hex = <span class="string">&quot;8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5&quot;</span></span><br><span class="line"></span><br><span class="line">iv = binascii.unhexlify(iv_hex)</span><br><span class="line">ct = binascii.unhexlify(ct_hex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_m</span>():</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">1</span> &lt;&lt; <span class="number">128</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; LOW_BITS):</span><br><span class="line">        <span class="comment"># Reconstruct potential a2</span></span><br><span class="line">        a2 = (a2_high &lt;&lt; LOW_BITS) + x</span><br><span class="line"></span><br><span class="line">        target = c</span><br><span class="line"></span><br><span class="line">        l, r = low, high</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        m_candidate = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line">            val = mid**<span class="number">3</span> + a2 * mid**<span class="number">2</span> + a1 * mid + a0</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> val == target:</span><br><span class="line">                <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">elif</span> val &lt; target:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = mid - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Searching for m...&quot;</span>)</span><br><span class="line">m = solve_m()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Found m: <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line">    key = long_to_bytes(m)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Decrypt</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cipher = AES.new(key, AES.MODE_CBC, iv=iv)</span><br><span class="line">        flag = unpad(cipher.decrypt(ct), <span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag.decode())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Decryption failed:&quot;</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Failed to find m.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{i7_533M5_Lik3_You_R34lLy_UNd3R574nd_Polinomials_4nD_RSA}</strong></p>
<ul>
<li><p>小蓝鲨的LFSR系统</p>
<blockquote>
<p>“小蓝鲨是海洋情报局的新晋密码专家，它设计了一个基于LFSR的流密码系统来加密机密信息。这个系统看起来简单高效，但小蓝鲨不知道的是，LFSR在某些情况下可能存在安全隐患。 一天，小蓝鲨的加密系统被神秘的黑客组织””深海幽灵””入侵，他们截获了一段加密信息。作为海洋安全部门的成员，你需要分析这个加密系统，找出潜在的弱点，并解密被截获的信息。”</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simple_lfsr_encrypt</span>(<span class="params">plaintext, init_state</span>):</span><br><span class="line">    mask = [random.randint(<span class="number">0</span>,<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line">    </span><br><span class="line">    state = init_state.copy()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        feedback = <span class="built_in">sum</span>(state[i] &amp; mask[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)) % <span class="number">2</span></span><br><span class="line">        state.append(feedback)</span><br><span class="line">    </span><br><span class="line">    key = <span class="built_in">bytes</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> mask[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>]), <span class="number">2</span>) </span><br><span class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line">    </span><br><span class="line">    keystream = (key * (<span class="built_in">len</span>(plaintext)//<span class="number">16</span> + <span class="number">1</span>))[:<span class="built_in">len</span>(plaintext)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(p ^ k <span class="keyword">for</span> p, k <span class="keyword">in</span> <span class="built_in">zip</span>(plaintext, keystream)), mask</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">initState = [0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0]</span></span><br><span class="line"><span class="string">outputState = [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1]</span></span><br><span class="line"><span class="string">ciphertext = &#x27;4b3be165a0a0edd67ca8f143884826725107fd42d6a6&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>有点像测信道攻击<br>$$<br>\begin{gather}<br>initState&#x3D;(s_1,s_2,…,s_{128}) \<br>outputState&#x3D;(s_{129},s_{130},…,s_{383}) \<br>let\ K&#x3D;(K_0,K_1,…,K_{15}) \<br>\<br>encrypt\ process: \<br>s_{n+128}&#x3D;xor_{i&#x3D;0}^{127}{(mask[i]·s_{n+i})}(for\ n\ from\ 0\ to\ 255) \<br>K_j&#x3D;\sum_{k&#x3D;0}^{15}{(mask[8j+k]*2^{7-k})}(for\ j\ from\ 0\ to\ 15) \<br>notice\ keystream&#x3D;(K_0,K_1,…,K_{15},K_0,K_1,…) \<br>ciphertext_i&#x3D;plaintext_i\ xor\ K_{i\ mod\ 16} \<br>\<br>decrypt\ process: \<br>let\ stream&#x3D;(s_1,s_2,…,s_{384}) \<br>so\ stream&#x3D;initState||outputState \<br>define\ matrix\ A: A_{n,i}&#x3D;s_{n+i}\<br>define\ matrix\ M: M&#x3D;(mask[0],mask[1],…,mask[127])^T \<br>define\ matrix\ B: B&#x3D;(s_{128},s_{129},…,s{383})\<br>so\ A·M&#x3D;B \<br>After\ we\ get\ M,we\ know\ mask[i]\ and\ we\ can\ get\ keystream \<br>plaintext_i&#x3D;ciphertext_i\ xor\ K_{i\ mod\ 16} \<br>\end{gather}<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据</span></span><br><span class="line">initState = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">outputState = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">ciphertext_hex = <span class="string">&#x27;4b3be165a0a0edd67ca8f143884826725107fd42d6a6&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 求解 Mask (高斯消元法)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_mask</span>(<span class="params">init, output</span>):</span><br><span class="line">    </span><br><span class="line">    stream = init + output</span><br><span class="line">    N = <span class="number">128</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构建增广矩阵 (Augmented Matrix)</span></span><br><span class="line">    <span class="comment"># 每一行代表一个方程： Sum(stream[i+j] * mask[j]) = stream[i+N]</span></span><br><span class="line">    <span class="comment"># Matrix A 的大小为 128x128，向量 b 的大小为 128</span></span><br><span class="line">    <span class="comment"># 我们只需要前128个方程就足以求解（假设线性无关）</span></span><br><span class="line">    </span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="comment"># 系数行：stream[i] 到 stream[i+127]</span></span><br><span class="line">        row = stream[i : i+N]</span><br><span class="line">        <span class="comment"># 目标值：stream[i+128]</span></span><br><span class="line">        target = stream[i+N]</span><br><span class="line">        <span class="comment"># 将目标值附加到行末，方便处理</span></span><br><span class="line">        matrix.append(row + [target])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 高斯消元 (GF(2))</span></span><br><span class="line">    pivot_row = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="keyword">if</span> pivot_row &gt;= N:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 寻找当前列为1的行（主元）</span></span><br><span class="line">        <span class="keyword">if</span> matrix[pivot_row][col] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pivot_row + <span class="number">1</span>, N):</span><br><span class="line">                <span class="keyword">if</span> matrix[i][col] == <span class="number">1</span>:</span><br><span class="line">                    matrix[pivot_row], matrix[i] = matrix[i], matrix[pivot_row]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 这一列全是0，无法作为主元，继续下一列</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 用主元行消除其他行的当前列</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            <span class="keyword">if</span> i != pivot_row <span class="keyword">and</span> matrix[i][col] == <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># 行异或</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col, N + <span class="number">1</span>):</span><br><span class="line">                    matrix[i][j] ^= matrix[pivot_row][j]</span><br><span class="line">        </span><br><span class="line">        pivot_row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取解</span></span><br><span class="line">    mask = [<span class="number">0</span>] * N</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="comment"># 矩阵现在应该是单位矩阵形式，最后一列是解</span></span><br><span class="line">        <span class="comment"># 检查主元位置</span></span><br><span class="line">        <span class="keyword">if</span> matrix[i][i] == <span class="number">1</span>:</span><br><span class="line">            mask[i] = matrix[i][N]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> mask</span><br><span class="line"></span><br><span class="line">recovered_mask = solve_mask(initState, outputState)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[-] Mask recovered. First 16 bits: <span class="subst">&#123;recovered_mask[:<span class="number">16</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 恢复 Key 并解密</span></span><br><span class="line">key = <span class="built_in">bytes</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> recovered_mask[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>]), <span class="number">2</span>) </span><br><span class="line">           <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[-] Key recovered: <span class="subst">&#123;key&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">ciphertext = binascii.unhexlify(ciphertext_hex)</span><br><span class="line"></span><br><span class="line">keystream = (key * (<span class="built_in">len</span>(ciphertext)//<span class="number">16</span> + <span class="number">1</span>))[:<span class="built_in">len</span>(ciphertext)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异或解密</span></span><br><span class="line">plaintext = <span class="built_in">bytes</span>(p ^ k <span class="keyword">for</span> p, k <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertext, keystream))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;plaintext.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{lf5R_jUst_So_s0}</strong></p>
<ul>
<li><p>Power_tower</p>
<blockquote>
<p>你知道拓展欧拉定理吗</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> number</span><br><span class="line"></span><br><span class="line">m = <span class="string">b&#x27;ISCTF&#123;****************&#125;&#x27;</span></span><br><span class="line">flag = bytes_to_long(m)</span><br><span class="line">n = getPrime(<span class="number">256</span>)</span><br><span class="line">t = getPrime(<span class="number">63</span>)</span><br><span class="line">l = <span class="built_in">pow</span>(<span class="number">2</span>,<span class="built_in">pow</span>(<span class="number">2</span>,t),n)</span><br><span class="line">c = flag ^ l</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">t = 6039738711082505929</span></span><br><span class="line"><span class="string">n = 107502945843251244337535082460697583639357473016005252008262865481138355040617</span></span><br><span class="line"><span class="string">c = 114092817888610184061306568177474033648737936326143099257250807529088213565247</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>$$<br>\begin{gather}<br>l\equiv2^{2^t}\ (mod\ n) \<br>c&#x3D;flag\ xor\ l \<br>\end{gather}<br>$$</p>
<p>需要提防的是，1.2** ( 2**t )太大，直接跑跑不出来 2.n是伪素数，实际上给的是光滑数</p>
<p>结合提示，扩展欧拉定理<br>$$<br>\begin{gather}<br>First,factor(n) \<br>\phi(n)&#x3D;\prod_{i&#x3D;1}^{?}{p_n} \<br>because\ obviously\ gcd(2,n)&#x3D;1 \<br>so\ 2^{2^t}\ mod\ n\ \equiv 2^{2^t\ mod\ \phi(n)}\ mod\ n \<br>then\ flag&#x3D;c\ xor\ l \<br>\end{gather}<br>$$</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">t = <span class="number">6039738711082505929</span></span><br><span class="line">n = <span class="number">107502945843251244337535082460697583639357473016005252008262865481138355040617</span></span><br><span class="line">c = <span class="number">114092817888610184061306568177474033648737936326143099257250807529088213565247</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line"></span><br><span class="line">    factors_data = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        api_url = <span class="string">f&quot;http://factordb.com/api?query=<span class="subst">&#123;n&#125;</span>&quot;</span></span><br><span class="line">        r = requests.get(api_url, timeout=<span class="number">10</span>)</span><br><span class="line">        data = r.json()</span><br><span class="line">        factors_data = data[<span class="string">&#x27;factors&#x27;</span>] </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算 phi(n)</span></span><br><span class="line">    phi = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> factors_data:</span><br><span class="line">        p_val = <span class="built_in">int</span>(item[<span class="number">0</span>])</span><br><span class="line">        e_val = <span class="built_in">int</span>(item[<span class="number">1</span>])</span><br><span class="line">        phi *= (p_val - <span class="number">1</span>) * (p_val ** (e_val - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算 l = 2^(2^t) mod n</span></span><br><span class="line">    exponent = <span class="built_in">pow</span>(<span class="number">2</span>, t, phi)</span><br><span class="line">    </span><br><span class="line">    l = <span class="built_in">pow</span>(<span class="number">2</span>, exponent, n)</span><br><span class="line">    </span><br><span class="line">    m = <span class="built_in">int</span>(c) ^ <span class="built_in">int</span>(l) </span><br><span class="line">    </span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n<span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{Euler_1s_v3ry|useful!!!!!}</strong></p>
<ul>
<li><p>easy_RSA</p>
<blockquote>
<p>我们的爱情像欧拉函数φ(n)——无限趋近却永远达不到n的完美互质，最终只剩周期性的怀念在模n的世界里循环证明</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(<span class="string">b&quot;ISCTF&#123;dummy_flag&#125;&quot;</span>)</span><br><span class="line">ct1 = <span class="built_in">pow</span>(msg, e, N)</span><br><span class="line">ct2 = <span class="built_in">pow</span>(msg, p+q, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;N = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct1 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;ct2 = &#125;</span>&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">N = 17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span></span><br><span class="line"><span class="string">ct1 = 5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span></span><br><span class="line"><span class="string">ct2 = 11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>这题和一般RSA有啥区别呢？<br>$$<br>\begin{gather}<br>ct1&#x3D;m^e\ mod\ n \<br>but\ ct2&#x3D;m^{p+q}\ mod\ n\ is\ dangerous \<br>p+q&#x3D;N+1-\phi(n) \<br>so\ ct2&#x3D;m^{N+1-\phi(n)}\ mod\ n \<br>if\ (most\ likely)\ gcd(m,n)&#x3D;1 \<br>ct2&#x3D;m^{n+1}·m^{-\phi(n)}\ &#x3D;m^{n+1}·(m^{\phi(n)})^{-1}\ mod\ n \<br>so\ ct2\equiv m^{n+1}\ mod\ n\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ***(1) \<br>if\ (maybe)\ gcd(n,e+1)&#x3D;1 \<br>then\ we\ notice\ that\ m&#x3D;m^1&#x3D;m^{u·e+v·(n+1)}\ mod\ n  \ \ \ \ \ \ \ \ \ \ \ \ \ \ ***(2) \<br>m&#x3D;(m^e)^u·(m^{n+1})^v \equiv ct1^u·ct2^v\ mod\ n<br>\end{gather}<br>$$<br>式（1）用到了欧拉定理（Euler Theorem）；式（2）用到了裴蜀定理（Bézout’s Lemma）。如果g!&#x3D;1，求解会很困难。</p>
<p>解出u,v需用扩展欧几里得算法，用gmpy2库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span></span><br><span class="line">ct1 = <span class="number">5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span></span><br><span class="line">ct2 = <span class="number">11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">e1 = e</span><br><span class="line">e2 = N + <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">g, u, v = gmpy2.gcdext(e1, e2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># gmpy2.powmod 支持负数指数，会自动计算模逆</span></span><br><span class="line">    m = (gmpy2.powmod(ct1, u, N) * gmpy2.powmod(ct2, v, N)) % N</span><br><span class="line">    </span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag.decode()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Error: GCD is not 1&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>加个小备注:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line">g = math.gcd(a, b)  <span class="comment"># 求解a,b的最大公因数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gmpy2</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">g, s, t = gmpy2.gcdext(u, v)  <span class="comment"># 返回 gcd 和系数u,v 用于扩展欧几里得算法</span></span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{Congratulations_you_master_Mathematical_ability}</strong></p>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h3><ul>
<li><p>ez_disk</p>
<blockquote>
<p>xx警方在翻斗小区抓捕了嫌疑人，并扣押了电脑里一个奇怪的虚拟磁盘，里面藏了犯罪嫌疑人的奇妙资料，运用所学尝试破解吧。</p>
<p>Hint:蓝鲨警局的阿sir说提取检材时末尾好像多了点东西</p>
</blockquote>
</li>
</ul>
<p>vmware尝试打开报错，然后卡了很久，试错的时候无意间发现7z可以打开。把oops！！where is passwd？.rar可以直接拖到E盘</p>
<p>需要密码，尝试ARCHPR爆破，试了很久。</p>
<p>能力不够，竟然很久都没有发现其实有一个倒置的jpg文件</p>


<p>FF D8 FF 记住了！</p>
<p>于是把数据提取出来再逆过来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;ez_disk.vmdk&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    </span><br><span class="line">tail_data = data[-<span class="number">50000</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反转字节顺序</span></span><br><span class="line">reversed_data = tail_data[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存为 JPEG</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;reversed.jpg&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(reversed_data)</span><br></pre></td></tr></table></figure>

<p>成功是成功了，然后各种隐写冲冲冲,stegsolve,steghide,exiftool，……全部失败</p>
<p>最终想起来之前string搜索看到的hint：<strong>all these bytes below must be useful</strong></p>


<p>看到了ftc，确信要把以下全部反转</p>
<p>全选保存为新文件然后用之前的脚本即可，但是大量出现在jpg结束之后的不可见字符是啥情况？半信半疑的时候喂给了AI</p>
<p>竟然是：那些 <code>â€Œ</code>、<code>â€</code>、<code>â€¬</code>、<code>ï»¿</code> 是 <strong>Unicode 零宽度字符</strong>的乱码显示</p>
<p>豁然开朗，和jpg无关</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">hex_data = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8D EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 8C EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 8C E2 80 8C EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D EF BB BF 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8D E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8D EF BB BF E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 AC E2 80 8D E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8D E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C EF BB BF EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C EF BB BF E2 80 AC 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF E2 80 AC EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 AC E2 80 8C E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8D E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 8D E2 80 AC 63 74 66 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C EF BB BF E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF E2 80 AC EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 AC E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理十六进制</span></span><br><span class="line">clean_hex = re.sub(<span class="string">r&#x27;[^0-9A-Fa-f]&#x27;</span>, <span class="string">&#x27;&#x27;</span>, hex_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    bytes_data = <span class="built_in">bytes</span>.fromhex(clean_hex)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;十六进制转换错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    full_text = bytes_data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;UTF-8解码成功，总字符数: <span class="subst">&#123;<span class="built_in">len</span>(full_text)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存到UTF-8文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;decoded_utf8.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(full_text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;已保存UTF-8文本到: decoded_utf8.txt&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示预览（前2000字符）</span></span><br><span class="line">    <span class="built_in">print</span>(full_text[:<span class="number">2000</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;UTF-8解码失败，尝试Latin-1解码...&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        full_text = bytes_data.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;decoded_latin1.txt&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>, errors=<span class="string">&quot;ignore&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(full_text)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n预览:&quot;</span>, full_text[:<span class="number">2000</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;解码失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;完成！&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>把得到的文本全部复制到<a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html">Unicode Steganography with Zero-Width Characters</a>解码</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this_p@ssw0rd_tha7_9ou_caN_n0t _brut3_Forc3_hhhhhhhhhhhhhhaHaa_no0b</span><br></pre></td></tr></table></figure>

<p>我真裂开了，这么长的密码我爆破个der</p>
<p>打开rar即可。<strong>ISCTF{320303e2-5c6a-489a-bcd3-e96a69a3eefc}</strong></p>
<ul>
<li><p>消失的flag</p>
<blockquote>
<p>“咦？我flag呢，我不是输出了么？</p>
<p>用户名：qyy</p>
<p>无密码”</p>
</blockquote>
</li>
</ul>
<p>nc容器，啥也没有，怀疑清屏</p>
<p>ssh连接并打印出清屏前的指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh qyy@challenge.bluesharkinfo.com -p 28892 | <span class="built_in">cat</span> -v</span><br></pre></td></tr></table></figure>

<p>得到<strong>ISCTF{9b39f3d8-3c8d-4655-b8bd-69f44ad21e87}</strong></p>
<ul>
<li><p>冲刺！偷摸零！</p>
<blockquote>
<p>小蓝鲨的实训作业……但似乎漏洞百出？（Flag有两段）</p>
<p>Hint:jar包里的东西也要看一眼</p>
</blockquote>
</li>
</ul>
<p>此题对新手颇有难度，这次对java程序也熟悉了不少</p>
<p>run-1.0-SNAPSHOT-jar-with-dependencies.jar 可以直接解压</p>
<p>看到了ctf.db直接点进去看看，乱码，搜索ISCTF可得到正确flag的前半段<strong>ISCTF{Tom0R1_Dash</strong></p>
<p>剩下的肯定是动态运行程序了</p>
<p>可以吃掉所有伤害快速结束游戏</p>
<p><img src="/images/image-20251209133437982.png"></p>
<p>于是游戏结束肯定是关键。下载<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6-min.jar">https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6-min.jar</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jd-gui-1.6.6-min.jar</span><br></pre></td></tr></table></figure>

<p>实现java反编译</p>
<p>打开文件，找到com.qf.run.GameOverView即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.pojo.Person;</span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JButton;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameOverView</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> &#123;</span><br><span class="line">  <span class="type">JLabel</span> <span class="variable">scoreJLabel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JButton</span> <span class="variable">againJButton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JButton</span> <span class="variable">exitJButton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JLabel</span> <span class="variable">hint1JLabel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">GameOverView</span><span class="params">(Person person)</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] encrypted = &#123; </span><br><span class="line">        <span class="number">5</span>, <span class="number">20</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">103</span>, <span class="number">111</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">18</span>, </span><br><span class="line">        <span class="number">32</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">40</span> &#125;;</span><br><span class="line">    <span class="type">byte</span> <span class="variable">key</span> <span class="operator">=</span> <span class="number">85</span>;</span><br><span class="line">    <span class="type">byte</span>[] decrypted = <span class="keyword">new</span> <span class="title class_">byte</span>[encrypted.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; encrypted.length; i++)</span><br><span class="line">      decrypted[i] = (<span class="type">byte</span>)(encrypted[i] ^ key); </span><br><span class="line">    <span class="type">String</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decrypted);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel = <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setText(<span class="string">&quot;\t&quot;</span> + person.getScore());</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setForeground(Color.ORANGE);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setSize(<span class="number">200</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setLocation(<span class="number">120</span>, <span class="number">30</span>);</span><br><span class="line">    add(<span class="built_in">this</span>.scoreJLabel);</span><br><span class="line">    <span class="built_in">this</span>.againJButton = <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    this.againJButton.setSize(100, 20);</span></span><br><span class="line"><span class="string">    this.againJButton.setLocation(80, 150);</span></span><br><span class="line"><span class="string">    this.againJButton.addActionListener(this);</span></span><br><span class="line"><span class="string">    add(this.againJButton);</span></span><br><span class="line"><span class="string">    this.exitJButton = new JButton();</span></span><br><span class="line"><span class="string">    this.exitJButton.setSize(100, 20);</span></span><br><span class="line"><span class="string">    this.exitJButton.setLocation(200, 150);</span></span><br><span class="line"><span class="string">    this.exitJButton.setText(&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.exitJButton.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">    add(<span class="built_in">this</span>.exitJButton);</span><br><span class="line">    <span class="built_in">this</span>.hint1JLabel = <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="built_in">this</span>.hint1JLabel.setText(<span class="string">&quot;\n);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setForeground(Color.ORANGE);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setSize(200, 20);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setLocation(120, 50);</span></span><br><span class="line"><span class="string">    add(this.hint1JLabel);</span></span><br><span class="line"><span class="string">    BackGroundImage backGroundImage = new BackGroundImage(&quot;</span>/image/pp.png<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    backGroundImage.setSize(393, 208);</span></span><br><span class="line"><span class="string">    add(backGroundImage);</span></span><br><span class="line"><span class="string">    setSize(393, 208);</span></span><br><span class="line"><span class="string">    setLocation(750, 300);</span></span><br><span class="line"><span class="string">    setTitle(&quot;</span>GAME OVER!!!<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    setUndecorated(true);</span></span><br><span class="line"><span class="string">    setVisible(true);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public void actionPerformed(ActionEvent e) &#123;</span></span><br><span class="line"><span class="string">    if (e.getSource().equals(this.againJButton)) &#123;</span></span><br><span class="line"><span class="string">      setVisible(false);</span></span><br><span class="line"><span class="string">      dispose();</span></span><br><span class="line"><span class="string">      Thread thread = new Thread(new LoadingView());</span></span><br><span class="line"><span class="string">      thread.start();</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    if (e.getSource().equals(this.exitJButton))</span></span><br><span class="line"><span class="string">      System.exit(0); </span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>固定密钥异或，可以秒</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">5</span>, <span class="number">20</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">103</span>, <span class="number">111</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">40</span>]</span><br><span class="line">key = <span class="number">85</span></span><br><span class="line">dec = [b ^ key <span class="keyword">for</span> b <span class="keyword">in</span> enc]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> dec))</span><br></pre></td></tr></table></figure>

<p>得到：PART2:_GuGu_GAGA!!}</p>
<p>所以<strong>ISCTF{Tom0R1_Dash_GuGu_GAGA!!}</strong></p>
<ul>
<li><p>Image_is_all_you_need</p>
<blockquote>
<p>你需要懂点AI和密码学</p>
</blockquote>
</li>
</ul>
<p>感觉此题颇难，超出能力范围。全程AI</p>
<p>share_secret.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> png</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocessing</span>(<span class="params">path</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(path)        </span><br><span class="line">    data = np.asarray(img)         </span><br><span class="line">    <span class="keyword">return</span> data.flatten(), data.shape </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert_text_chunk</span>(<span class="params">src_png, dst_png, text</span>):</span><br><span class="line">    reader = png.Reader(filename=src_png)     </span><br><span class="line">    chunks = reader.chunks()                   </span><br><span class="line">    chunk_list = <span class="built_in">list</span>(chunks)                  </span><br><span class="line">    chunk_item = <span class="built_in">tuple</span>([<span class="string">b&#x27;tEXt&#x27;</span>, text])        </span><br><span class="line"></span><br><span class="line">    index = <span class="number">1</span>                               </span><br><span class="line">    chunk_list.insert(index, chunk_item)   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(dst_png, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> dst_file:      </span><br><span class="line">        png.write_chunks(dst_file, chunk_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_text_chunk</span>(<span class="params">src_png, index=<span class="number">1</span></span>):</span><br><span class="line">    reader = png.Reader(filename=src_png)    </span><br><span class="line">    chunks = reader.chunks()                 </span><br><span class="line">    chunk_list = <span class="built_in">list</span>(chunks)                </span><br><span class="line">    img_extra = chunk_list[index][<span class="number">1</span>].decode() </span><br><span class="line">    img_extra = <span class="built_in">eval</span>(img_extra)           </span><br><span class="line">    <span class="keyword">return</span> img_extra                      </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">polynomial</span>(<span class="params">img, n, r</span>):</span><br><span class="line">    num_pixels = img.shape[<span class="number">0</span>]                  </span><br><span class="line">    coefficients = np.random.randint(low=<span class="number">0</span>, high=<span class="number">257</span>, size=(num_pixels, r - <span class="number">1</span>)) </span><br><span class="line">    secret_imgs = []                          </span><br><span class="line">    imgs_extra = []                             </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):                 </span><br><span class="line">        base = np.array([i ** j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, r)]) </span><br><span class="line">        base = np.matmul(coefficients, base)    </span><br><span class="line"></span><br><span class="line">        secret_img = (img + base) % <span class="number">257</span>         </span><br><span class="line"></span><br><span class="line">        indices = np.where(secret_img == <span class="number">256</span>)[<span class="number">0</span>] </span><br><span class="line">        img_extra = indices.tolist()            </span><br><span class="line">        secret_img[indices] = <span class="number">0</span>                 </span><br><span class="line"></span><br><span class="line">        secret_imgs.append(secret_img)          </span><br><span class="line">        imgs_extra.append(img_extra)          </span><br><span class="line">    <span class="keyword">return</span> np.array(secret_imgs), imgs_extra    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_size</span>(<span class="params">size_bytes</span>):</span><br><span class="line">    <span class="keyword">if</span> size_bytes == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0B&quot;</span></span><br><span class="line">    size_names = (<span class="string">&quot;B&quot;</span>, <span class="string">&quot;KB&quot;</span>, <span class="string">&quot;MB&quot;</span>, <span class="string">&quot;GB&quot;</span>, <span class="string">&quot;TB&quot;</span>, <span class="string">&quot;PB&quot;</span>, <span class="string">&quot;EB&quot;</span>, <span class="string">&quot;ZB&quot;</span>, <span class="string">&quot;YB&quot;</span>) </span><br><span class="line">    i = <span class="built_in">int</span>(math.floor(math.log(size_bytes, <span class="number">1024</span>))) </span><br><span class="line">    p = math.<span class="built_in">pow</span>(<span class="number">1024</span>, i)                           </span><br><span class="line">    s = <span class="built_in">round</span>(size_bytes / p, <span class="number">2</span>)                     </span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;s&#125;</span> <span class="subst">&#123;size_names[i]&#125;</span>&quot;</span>                    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_size</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        size = os.path.getsize(file_path)   </span><br><span class="line">        <span class="keyword">return</span> format_size(size)            </span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>               </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    image_path = <span class="string">&quot;secret.png&quot;</span>  </span><br><span class="line">    n = <span class="number">6</span>  </span><br><span class="line">    r = ?  </span><br><span class="line">    </span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n=== Starting image encoding process ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> r &gt; n:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Error: Threshold &#x27;r&#x27; cannot be greater than the total number &#x27;n&#x27; of shares&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    img_flattened, shape = preprocessing(image_path) </span><br><span class="line">    secret_imgs, imgs_extra = polynomial(img_flattened, n=n, r=r) </span><br><span class="line">    to_save = secret_imgs.reshape(n, *shape)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(to_save):       </span><br><span class="line">        secret_img_path = <span class="string">f&quot;secret_<span class="subst">&#123;i + <span class="number">1</span>&#125;</span>.png&quot;</span></span><br><span class="line">        Image.fromarray(img.astype(np.uint8)).save(secret_img_path) </span><br><span class="line">        img_extra = <span class="built_in">str</span>(<span class="built_in">list</span>((imgs_extra[i]))).encode() </span><br><span class="line">        insert_text_chunk(secret_img_path, secret_img_path, img_extra) </span><br><span class="line">        size = get_file_size(secret_img_path) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;secret_img_path&#125;</span> saved.&quot;</span>, size)</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=== Image encoding completed. Time elapsed: &#123;:.2f&#125; seconds ===&quot;</span>.<span class="built_in">format</span>(end_time - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>&#x2F;steg目录下的若干文件：</p>
<p>model.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> net <span class="keyword">import</span> simple_net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,cuda=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(Model, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.model = simple_net()</span><br><span class="line">        <span class="keyword">if</span> cuda:</span><br><span class="line">            <span class="variable language_">self</span>.model.cuda()</span><br><span class="line">        <span class="comment"># init_model(self)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.model(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_model</span>(<span class="params">mod</span>):</span><br><span class="line">    <span class="keyword">for</span> key, param <span class="keyword">in</span> mod.named_parameters():</span><br><span class="line">        split = key.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> param.requires_grad:</span><br><span class="line">            param.data = <span class="number">0.01</span> * torch.randn(param.data.shape).cuda()</span><br><span class="line">            <span class="keyword">if</span> split[-<span class="number">2</span>] == <span class="string">&#x27;conv5&#x27;</span>:</span><br><span class="line">                param.data.fill_(<span class="number">0.</span>)</span><br></pre></td></tr></table></figure>

<p>net.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> block <span class="keyword">import</span> INV_block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">simple_net</span>(nn.Module):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(simple_net, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.inv1 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv2 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv3 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv4 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv5 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv6 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv7 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv8 = INV_block()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line"></span><br><span class="line">        out = <span class="variable language_">self</span>.inv1(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>

<p>utils.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.init <span class="keyword">as</span> init</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> reedsolo <span class="keyword">import</span> RSCodec</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line">rs = RSCodec(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize_weights</span>(<span class="params">net_l, scale=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(net_l, <span class="built_in">list</span>):</span><br><span class="line">        net_l = [net_l]</span><br><span class="line">    <span class="keyword">for</span> net <span class="keyword">in</span> net_l:</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> net.modules():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(m, nn.Conv2d):</span><br><span class="line">                init.kaiming_normal_(m.weight, a=<span class="number">0</span>, mode=<span class="string">&#x27;fan_in&#x27;</span>)</span><br><span class="line">                m.weight.data *= scale  <span class="comment"># for residual block</span></span><br><span class="line">                <span class="keyword">if</span> m.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    m.bias.data.zero_()</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(m, nn.Linear):</span><br><span class="line">                init.kaiming_normal_(m.weight, a=<span class="number">0</span>, mode=<span class="string">&#x27;fan_in&#x27;</span>)</span><br><span class="line">                m.weight.data *= scale</span><br><span class="line">                <span class="keyword">if</span> m.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    m.bias.data.zero_()</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(m, nn.BatchNorm2d):</span><br><span class="line">                init.constant_(m.weight, <span class="number">1</span>)</span><br><span class="line">                init.constant_(m.bias.data, <span class="number">0.0</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(IWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        in_batch, in_channel, in_height, in_width = x.size()</span><br><span class="line">        <span class="comment">#print([in_batch, in_channel, in_height, in_width])</span></span><br><span class="line">        out_batch, out_channel, out_height, out_width = in_batch, <span class="built_in">int</span>(</span><br><span class="line">            in_channel / (r ** <span class="number">2</span>)), r * in_height, r * in_width</span><br><span class="line">        x1 = x[:, <span class="number">0</span>:out_channel, :, :] / <span class="number">2</span></span><br><span class="line">        x2 = x[:, out_channel:out_channel * <span class="number">2</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x3 = x[:, out_channel * <span class="number">2</span>:out_channel * <span class="number">3</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x4 = x[:, out_channel * <span class="number">3</span>:out_channel * <span class="number">4</span>, :, :] / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        h = torch.zeros([out_batch, out_channel, out_height, out_width]).<span class="built_in">float</span>().cuda()</span><br><span class="line"></span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 - x3 + x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 + x3 - x4</span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 - x3 - x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 + x3 + x4</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x01 = x[:, :, <span class="number">0</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x02 = x[:, :, <span class="number">1</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x1 = x01[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x2 = x02[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x3 = x01[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x4 = x02[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x_LL = x1 + x2 + x3 + x4</span><br><span class="line">        x_HL = -x1 - x2 + x3 + x4</span><br><span class="line">        x_LH = -x1 + x2 - x3 + x4</span><br><span class="line">        x_HH = x1 - x2 - x3 + x4</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x_LL, x_HL, x_LH, x_HH), <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_data</span>(<span class="params">cover,device</span>):</span><br><span class="line">    <span class="keyword">return</span> torch.zeros(cover.size(), device=device).random_(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auxiliary_variable</span>(<span class="params">shape</span>):</span><br><span class="line">    noise = torch.zeros(shape).cuda()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(noise.shape[<span class="number">0</span>]):</span><br><span class="line">        noise[i] = torch.randn(noise[i].shape).cuda()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> noise</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">computePSNR</span>(<span class="params">origin,pred</span>):</span><br><span class="line">    origin = np.array(origin)</span><br><span class="line">    origin = origin.astype(np.float32)</span><br><span class="line">    pred = np.array(pred)</span><br><span class="line">    pred = pred.astype(np.float32)</span><br><span class="line">    mse = np.mean((origin/<span class="number">1.0</span> - pred/<span class="number">1.0</span>) ** <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">if</span> mse &lt; <span class="number">1.0e-10</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span> * math.log10(<span class="number">255.0</span>**<span class="number">2</span>/mse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">width, height, depth, text, batch = <span class="number">1</span></span>):</span><br><span class="line">    message = text_to_bits(text) + [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    payload = message</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(payload) &lt; batch * width * height * depth:</span><br><span class="line">        payload += message</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    payload = payload[:batch * width * height * depth]</span><br><span class="line">    <span class="keyword">return</span> torch.FloatTensor(payload).view(batch, depth, height, width)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_to_bits</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">return</span> bytearray_to_bits(text_to_bytearray(text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytearray_to_bits</span>(<span class="params">x</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">        bits = <span class="built_in">bin</span>(i)[<span class="number">2</span>:]</span><br><span class="line">        bits = <span class="string">&#x27;00000000&#x27;</span>[<span class="built_in">len</span>(bits):] + bits</span><br><span class="line">        result.extend([<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bits])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_to_bytearray</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(text, <span class="built_in">str</span>), <span class="string">&quot;expected a string&quot;</span></span><br><span class="line">    x = zlib.compress(text.encode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    x = rs.encode(<span class="built_in">bytearray</span>(x))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bits_to_bytearray</span>(<span class="params">bits</span>):</span><br><span class="line">    ints = []</span><br><span class="line">    bits = np.array(bits)</span><br><span class="line">    bits = <span class="number">0</span> + bits</span><br><span class="line">    bits = bits = bits.tolist()</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bits) // <span class="number">8</span>):</span><br><span class="line">        byte = bits[b * <span class="number">8</span>:(b + <span class="number">1</span>) * <span class="number">8</span>]</span><br><span class="line">        ints.append(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> byte]), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>(ints)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytearray_to_text</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = rs.decode(x)</span><br><span class="line">        text = zlib.decompress(text[<span class="number">0</span>])</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> text.decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> BaseException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>block.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> initialize_weights</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dense connection</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResidualDenseBlock_out</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, bias=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ResidualDenseBlock_out, <span class="variable language_">self</span>).__init__()     </span><br><span class="line">        <span class="variable language_">self</span>.channel = <span class="number">12</span></span><br><span class="line">        <span class="variable language_">self</span>.hidden_size = <span class="number">32</span>   </span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="variable language_">self</span>.channel, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">2</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv4 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">3</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv5 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">4</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.channel, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.lrelu = nn.LeakyReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># initialization</span></span><br><span class="line">        initialize_weights([<span class="variable language_">self</span>.conv5], <span class="number">0.</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x2 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv2(torch.cat((x, x1), <span class="number">1</span>)))</span><br><span class="line">        x3 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv3(torch.cat((x, x1, x2), <span class="number">1</span>)))</span><br><span class="line">        x4 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv4(torch.cat((x, x1, x2, x3), <span class="number">1</span>)))</span><br><span class="line">        x5 = <span class="variable language_">self</span>.conv5(torch.cat((x, x1, x2, x3, x4), <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> x5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">INV_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, clamp=<span class="number">2.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.channels = <span class="number">3</span></span><br><span class="line">        <span class="variable language_">self</span>.clamp = clamp</span><br><span class="line">        <span class="comment"># ρ</span></span><br><span class="line">        <span class="variable language_">self</span>.r = ResidualDenseBlock_out()</span><br><span class="line">        <span class="comment"># η</span></span><br><span class="line">        <span class="variable language_">self</span>.y = ResidualDenseBlock_out()</span><br><span class="line">        <span class="comment"># φ</span></span><br><span class="line">        <span class="variable language_">self</span>.f = ResidualDenseBlock_out()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.exp(<span class="variable language_">self</span>.clamp * <span class="number">2</span> * (torch.sigmoid(s) - <span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1, x2 = (x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>),</span><br><span class="line">                  x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        y1 = x1 + t2</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        y2 = <span class="variable language_">self</span>.e(s1) * x2 + t1</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> torch.cat((y1, y2), <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>main.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> DWT, IWT, make_payload, auxiliary_variable, bits_to_bytearray, bytearray_to_text</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"></span><br><span class="line">transform_test = T.Compose([</span><br><span class="line">    T.ToTensor(),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">name</span>):</span><br><span class="line">    state_dicts = torch.load(name)</span><br><span class="line">    network_state_dict = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> state_dicts[<span class="string">&#x27;net&#x27;</span>].items() <span class="keyword">if</span> <span class="string">&#x27;tmp_var&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> k&#125;</span><br><span class="line">    simple_net.load_state_dict(network_state_dict)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform2tensor</span>(<span class="params">img</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">    img = img.convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    img = img.resize((<span class="number">600</span>, <span class="number">450</span>)) </span><br><span class="line">    <span class="keyword">return</span> transform_test(img).unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">cover, text</span>):</span><br><span class="line">    cover = transform2tensor(cover)</span><br><span class="line">    B, C, H, W = cover.size()       </span><br><span class="line">    payload = make_payload(W, H, C, text, B)</span><br><span class="line">    payload = payload.to(device)</span><br><span class="line">    cover_input = dwt(cover)</span><br><span class="line">    payload_input = dwt(payload)        </span><br><span class="line">    input_img = torch.cat([cover_input, payload_input], dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad(): </span><br><span class="line">        output = simple_net(input_img)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> input_img  </span><br><span class="line">    torch.cuda.empty_cache()  </span><br><span class="line"></span><br><span class="line">    output_steg = output.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span> * <span class="number">3</span>)</span><br><span class="line">    output_img = iwt(output_steg)</span><br><span class="line">    torchvision.utils.save_image(output_img, <span class="string">&#x27;./secret.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    simple_net = Model()</span><br><span class="line">    load(<span class="string">&#x27;misuha.taki&#x27;</span>)</span><br><span class="line">    simple_net.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    dwt = DWT()</span><br><span class="line">    iwt = IWT()</span><br><span class="line">    </span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    text = <span class="string">r&#x27;flag&#123;there_is_flag&#125;&#x27;</span></span><br><span class="line">    steg = <span class="string">r&#x27;./secret.png&#x27;</span></span><br><span class="line">    cover = <span class="string">&#x27;./xxx.png&#x27;</span></span><br><span class="line">    encode(cover, text)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20251209134911503.png"></p>
<p><img src="/images/image-20251209140404466.png"></p>
<p><img src="/images/image-20251209135517422.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.init <span class="keyword">as</span> init</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> png</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> reedsolo <span class="keyword">import</span> RSCodec, ReedSolomonError</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 1: 图片重组 (SSS Reconstruct) =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_lagrange_coeffs</span>(<span class="params">n=<span class="number">6</span>, modulus=<span class="number">257</span></span>):</span><br><span class="line">    coeffs = []</span><br><span class="line">    x = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        x_j = x[j]</span><br><span class="line">        numerator = <span class="number">1</span></span><br><span class="line">        denominator = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> m == j:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            x_m = x[m]</span><br><span class="line">            numerator = (numerator * (-x_m)) % modulus</span><br><span class="line">            denominator = (denominator * (x_j - x_m)) % modulus</span><br><span class="line">        inv_denominator = <span class="built_in">pow</span>(denominator, -<span class="number">1</span>, modulus)</span><br><span class="line">        coeff = (numerator * inv_denominator) % modulus</span><br><span class="line">        coeffs.append(coeff)</span><br><span class="line">    <span class="keyword">return</span> coeffs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_text_chunk_fix</span>(<span class="params">src_png</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;读取PNG的tEXt块获取值为256的像素索引&quot;&quot;&quot;</span></span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        reader = png.Reader(filename=src_png)</span><br><span class="line">        <span class="comment"># 必须把 chunks 转为 list 才能遍历</span></span><br><span class="line">        chunks = <span class="built_in">list</span>(reader.chunks())</span><br><span class="line">        <span class="keyword">for</span> chunk_type, chunk_data <span class="keyword">in</span> chunks:</span><br><span class="line">            <span class="keyword">if</span> chunk_type == <span class="string">b&#x27;tEXt&#x27;</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># chunk_data 通常包含 keyword + \x00 + text，或者根据写入方式只有 text</span></span><br><span class="line">                    <span class="comment"># 我们尝试解码并寻找列表格式 &quot;[...]&quot;</span></span><br><span class="line">                    data_str = chunk_data.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;[&quot;</span> <span class="keyword">in</span> data_str <span class="keyword">and</span> <span class="string">&quot;]&quot;</span> <span class="keyword">in</span> data_str:</span><br><span class="line">                        start = data_str.find(<span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">                        end = data_str.rfind(<span class="string">&#x27;]&#x27;</span>) + <span class="number">1</span></span><br><span class="line">                        list_str = data_str[start:end]</span><br><span class="line">                        found = <span class="built_in">eval</span>(list_str)</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(found, <span class="built_in">list</span>):</span><br><span class="line">                            indices = found</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[-] Warning: Failed to parse chunks in <span class="subst">&#123;src_png&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> indices</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reconstruct_image</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Starting Image Reconstruction (Shamir Secret Sharing)...&quot;</span>)</span><br><span class="line">    n = <span class="number">6</span></span><br><span class="line">    modulus = <span class="number">257</span></span><br><span class="line">    coeffs = get_lagrange_coeffs(n, modulus)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;secret_1.png&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] secret_1.png not found.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取尺寸</span></span><br><span class="line">    img1 = Image.<span class="built_in">open</span>(<span class="string">&quot;secret_1.png&quot;</span>)</span><br><span class="line">    img1_arr = np.asarray(img1)</span><br><span class="line">    flat_len = img1_arr.size</span><br><span class="line">    original_shape = img1_arr.shape</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># shares 容器</span></span><br><span class="line">    shares = np.zeros((n, flat_len), dtype=np.int32)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        fname = <span class="string">f&quot;secret_<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>.png&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fname):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[-] Missing <span class="subst">&#123;fname&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            </span><br><span class="line">        img = Image.<span class="built_in">open</span>(fname)</span><br><span class="line">        data = np.asarray(img).flatten().astype(np.int32)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 修正 256</span></span><br><span class="line">        extra_indices = read_text_chunk_fix(fname)</span><br><span class="line">        <span class="keyword">if</span> extra_indices:</span><br><span class="line">            <span class="comment"># 过滤越界索引</span></span><br><span class="line">            valid_indices = [idx <span class="keyword">for</span> idx <span class="keyword">in</span> extra_indices <span class="keyword">if</span> idx &lt; flat_len]</span><br><span class="line">            data[valid_indices] = <span class="number">256</span></span><br><span class="line">            </span><br><span class="line">        shares[i] = data</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(extra_indices) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Loaded <span class="subst">&#123;fname&#125;</span>: fixed <span class="subst">&#123;<span class="built_in">len</span>(extra_indices)&#125;</span> pixels (256 values).&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;    Loaded <span class="subst">&#123;fname&#125;</span>: no extra pixels found.&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Calculating interpolation...&quot;</span>)</span><br><span class="line">    reconstructed = np.zeros(flat_len, dtype=np.int32)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        term = (shares[i] * coeffs[i]) % modulus</span><br><span class="line">        reconstructed = (reconstructed + term) % modulus</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(reconstructed &gt; <span class="number">255</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Warning: Some pixels &gt; 255 after reconstruction. Clipping.&quot;</span>)</span><br><span class="line">        reconstructed = np.clip(reconstructed, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        </span><br><span class="line">    reconstructed = reconstructed.astype(np.uint8).reshape(original_shape)</span><br><span class="line">    save_path = <span class="string">&quot;secret_restored.png&quot;</span></span><br><span class="line">    Image.fromarray(reconstructed).save(save_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Reconstructed image saved to <span class="subst">&#123;save_path&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> save_path</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 2: 深度学习模型 =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResidualDenseBlock_out</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, bias=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ResidualDenseBlock_out, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.channel = <span class="number">12</span></span><br><span class="line">        <span class="variable language_">self</span>.hidden_size = <span class="number">32</span></span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="variable language_">self</span>.channel, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">2</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv4 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">3</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv5 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">4</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.channel, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.lrelu = nn.LeakyReLU(inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x2 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv2(torch.cat((x, x1), <span class="number">1</span>)))</span><br><span class="line">        x3 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv3(torch.cat((x, x1, x2), <span class="number">1</span>)))</span><br><span class="line">        x4 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv4(torch.cat((x, x1, x2, x3), <span class="number">1</span>)))</span><br><span class="line">        x5 = <span class="variable language_">self</span>.conv5(torch.cat((x, x1, x2, x3, x4), <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> x5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">INV_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, clamp=<span class="number">2.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.channels = <span class="number">3</span></span><br><span class="line">        <span class="variable language_">self</span>.clamp = clamp</span><br><span class="line">        <span class="variable language_">self</span>.r = ResidualDenseBlock_out()</span><br><span class="line">        <span class="variable language_">self</span>.y = ResidualDenseBlock_out()</span><br><span class="line">        <span class="variable language_">self</span>.f = ResidualDenseBlock_out()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.exp(<span class="variable language_">self</span>.clamp * <span class="number">2</span> * (torch.sigmoid(s) - <span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1, x2 = x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>), x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>)</span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        y1 = x1 + t2</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        y2 = <span class="variable language_">self</span>.e(s1) * x2 + t1</span><br><span class="line">        <span class="keyword">return</span> torch.cat((y1, y2), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">self, x</span>):</span><br><span class="line">        y1, y2 = x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>), x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>)</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        x2 = (y2 - t1) / <span class="variable language_">self</span>.e(s1)</span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        x1 = y1 - t2</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x1, x2), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">simple_net</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(simple_net, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.inv1 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv2 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv3 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv4 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv5 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv6 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv7 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv8 = INV_block()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.inv1(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8.inverse(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv1.inverse(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x01 = x[:, :, <span class="number">0</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x02 = x[:, :, <span class="number">1</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x1 = x01[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x2 = x02[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x3 = x01[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x4 = x02[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x_LL = x1 + x2 + x3 + x4</span><br><span class="line">        x_HL = -x1 - x2 + x3 + x4</span><br><span class="line">        x_LH = -x1 + x2 - x3 + x4</span><br><span class="line">        x_HH = x1 - x2 - x3 + x4</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x_LL, x_HL, x_LH, x_HH), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(IWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        in_batch, in_channel, in_height, in_width = x.size()</span><br><span class="line">        out_batch, out_channel, out_height, out_width = in_batch, <span class="built_in">int</span>(</span><br><span class="line">            in_channel / (r ** <span class="number">2</span>)), r * in_height, r * in_width</span><br><span class="line">        x1 = x[:, <span class="number">0</span>:out_channel, :, :] / <span class="number">2</span></span><br><span class="line">        x2 = x[:, out_channel:out_channel * <span class="number">2</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x3 = x[:, out_channel * <span class="number">2</span>:out_channel * <span class="number">3</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x4 = x[:, out_channel * <span class="number">3</span>:out_channel * <span class="number">4</span>, :, :] / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        h = torch.zeros([out_batch, out_channel, out_height, out_width]).<span class="built_in">float</span>().to(x.device)</span><br><span class="line"></span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 - x3 + x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 + x3 - x4</span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 - x3 - x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 + x3 + x4</span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 3: Payload 解码与爆破 =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_payload</span>(<span class="params">model, img_path</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Decoding payload from <span class="subst">&#123;img_path&#125;</span>...&quot;</span>)</span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 读取和预处理</span></span><br><span class="line">    img = Image.<span class="built_in">open</span>(img_path).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">    img = img.resize((<span class="number">600</span>, <span class="number">450</span>)) </span><br><span class="line">    transform = T.Compose([T.ToTensor()])</span><br><span class="line">    steg_tensor = transform(img).unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line">    </span><br><span class="line">    dwt = DWT().to(device)</span><br><span class="line">    iwt = IWT().to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 逆向推理</span></span><br><span class="line">    steg_dwt = dwt(steg_tensor)</span><br><span class="line">    z_tensor = torch.zeros_like(steg_dwt).to(device)</span><br><span class="line">    inp_rev = torch.cat((steg_dwt, z_tensor), dim=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        out_rev = model.reverse(inp_rev)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取 payload 通道</span></span><br><span class="line">    payload_dwt = out_rev.narrow(<span class="number">1</span>, <span class="number">12</span>, <span class="number">12</span>)</span><br><span class="line">    payload_img_tensor = iwt(payload_dwt)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换为比特流</span></span><br><span class="line">    payload_flat = payload_img_tensor.view(-<span class="number">1</span>).cpu().numpy()</span><br><span class="line">    bits = (payload_flat &gt; <span class="number">0.5</span>).astype(<span class="built_in">int</span>).tolist()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[*] Extracted <span class="subst">&#123;<span class="built_in">len</span>(bits)&#125;</span> bits. Converting to bytearray...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    byte_buffer = []</span><br><span class="line">    <span class="comment"># 仅处理前 2000 个字节足够了，因为 Flag 通常很短</span></span><br><span class="line">    limit_bytes = <span class="number">2000</span> </span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">min</span>(<span class="built_in">len</span>(bits) // <span class="number">8</span>, limit_bytes)):</span><br><span class="line">        byte_bits = bits[b * <span class="number">8</span>:(b + <span class="number">1</span>) * <span class="number">8</span>]</span><br><span class="line">        byte_val = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> byte_bits]), <span class="number">2</span>)</span><br><span class="line">        byte_buffer.append(byte_val)</span><br><span class="line">    </span><br><span class="line">    data = <span class="built_in">bytearray</span>(byte_buffer)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Brute-forcing RS message length (assuming msg at start)...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    rs = RSCodec(<span class="number">128</span>) <span class="comment"># nsym = 128</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 爆破长度：从 nsym + 1 开始尝试</span></span><br><span class="line">    <span class="comment"># 假设消息长度在 1 到 200 字节之间，所以总长度在 129 到 328 之间</span></span><br><span class="line">    found_flag = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">130</span>, <span class="number">500</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            candidate = data[:length]</span><br><span class="line">            <span class="comment"># 尝试 RS 解码</span></span><br><span class="line">            decoded = rs.decode(candidate)[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 尝试 Zlib 解压</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = zlib.decompress(decoded)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n[SUCCESS] Found valid message at length <span class="subst">&#123;length&#125;</span>!&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Content: <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    flag_str = text.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Flag: <span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">&quot;flag&#123;&quot;</span> <span class="keyword">in</span> flag_str:</span><br><span class="line">                        found_flag = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Raw decrypted: <span class="subst">&#123;text&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> zlib.error:</span><br><span class="line">                <span class="comment"># RS check passed but zlib failed</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> (ReedSolomonError, ValueError):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Brute-force finished without finding &#x27;flag&#123;&#x27;. Check the raw content above if any success.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 恢复图片</span></span><br><span class="line">    restored_img = reconstruct_image()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> restored_img:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 加载模型</span></span><br><span class="line">    device = torch.device(<span class="string">&quot;cuda:0&quot;</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">    model = simple_net().to(device)</span><br><span class="line">    </span><br><span class="line">    possible_paths = [<span class="string">&#x27;steg/misuha.taki&#x27;</span>, <span class="string">&#x27;misuha.taki&#x27;</span>, <span class="string">&#x27;../misuha.taki&#x27;</span>]</span><br><span class="line">    model_path = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> possible_paths:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(p):</span><br><span class="line">            model_path = p</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> model_path:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] Loading model from <span class="subst">&#123;model_path&#125;</span>...&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            state_dicts = torch.load(model_path, map_location=device)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;net&#x27;</span> <span class="keyword">in</span> state_dicts:</span><br><span class="line">                raw_state_dict = state_dicts[<span class="string">&#x27;net&#x27;</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                raw_state_dict = state_dicts</span><br><span class="line">            </span><br><span class="line">            new_state_dict = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> raw_state_dict.items():</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;tmp_var&#x27;</span> <span class="keyword">in</span> k:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                new_key = k</span><br><span class="line">                <span class="keyword">if</span> new_key.startswith(<span class="string">&#x27;model.&#x27;</span>):</span><br><span class="line">                    new_key = new_key[<span class="number">6</span>:]</span><br><span class="line">                new_state_dict[new_key] = v</span><br><span class="line">                </span><br><span class="line">            model.load_state_dict(new_state_dict)</span><br><span class="line">            model.<span class="built_in">eval</span>()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] Model loaded successfully.&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[-] Error loading model: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Model file (misuha.taki) not found.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 解码</span></span><br><span class="line">    decode_payload(model, restored_img)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>得到flag{Sh4r3_S3reCTTt_wiTh_Ai_H@@@@}，<strong>ISCTF{Sh4r3_S3reCTTt_wiTh_Ai_H@@@@}</strong></p>
<ul>
<li><p>爱玩游戏的小蓝鲨</p>
<blockquote>
<p>小蓝鲨说 它将永远追随刻律德菈</p>
<p>Hint:换行也应该带个下划线，刻律德拉是凯撒但这里不是凯撒。</p>
</blockquote>
</li>
</ul>
<p>很明显像素，还原成二维图像即可。</p>
<p>一共192318行，分解一下质因式即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">pixels = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># 去除括号</span></span><br><span class="line">        line = line.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        parts = line.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(parts) == <span class="number">3</span>:</span><br><span class="line">            r, g, b = <span class="built_in">map</span>(<span class="built_in">int</span>, parts)</span><br><span class="line">            pixels.append((r, g, b))</span><br><span class="line"></span><br><span class="line">N = <span class="built_in">len</span>(pixels)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;总像素数: <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 候选 (width, height)</span></span><br><span class="line">candidates = [(<span class="number">482</span>, <span class="number">399</span>), (<span class="number">399</span>, <span class="number">482</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> w, h <span class="keyword">in</span> candidates:</span><br><span class="line">    <span class="keyword">if</span> w * h != N:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;尺寸 <span class="subst">&#123;w&#125;</span>x<span class="subst">&#123;h&#125;</span> 不匹配总像素&quot;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;尝试尺寸: <span class="subst">&#123;w&#125;</span>x<span class="subst">&#123;h&#125;</span>&quot;</span>)</span><br><span class="line">    img = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (w, h))</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">            img.putpixel((x, y), pixels[idx])</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line">    img.save(<span class="string">f&#x27;flag_<span class="subst">&#123;w&#125;</span>x<span class="subst">&#123;h&#125;</span>.png&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;保存为 flag_<span class="subst">&#123;w&#125;</span>x<span class="subst">&#123;h&#125;</span>.png&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/flag_482x399.png"></p>
<p>一下子也不晓得是什么游戏的文字，交给Rycbartbad，找到了星穹铁道里面的翁法罗斯文字</p>
<p>手动翻译得到QKEMK{al4t_k4nT_auMm3_U0Kv_yzV94e3_kg_yp3_O0teI}</p>
<p>明显是Vigenere，密钥是ISCTF：ISCTF{st4r_r4iL_isTh3_M0St_fuN94m3_in_th3_W0rlD}</p>
<p>补一下漏掉的下划线<strong>ISCTF{st4r_r4iL_is_Th3_M0St_fuN_94m3_in_th3_W0rlD}</strong></p>
<ul>
<li><p>美丽的风景照</p>
<blockquote>
<p>做题做累了吧，来看看风景吧！</p>
<p>Hint1:按照彩虹颜色排序试试看</p>
<p>Hint2:这照片里的古建筑上怎么写个明光大正”“那是正大光明，古风都是倒着来的</p>
</blockquote>
</li>
</ul>
<p>附件:zip</p>
<p>简单file发现zip，直接改后缀解压，得到一张gif，字符串肉眼可见，随便找个网站extracted就行，随波逐流也可</p>
<p>轻松得到jqW2 ZXw8T 7HLo8 6yRWh Dg2C 98Mz 3CaEK</p>
<p>不像是base64，比较像base58，试了都失败了</p>
<p>Hint1给出后重排，可以得到jqW2Dg2C7HLo86yRWh3CaEKZXw8T98Mz，解码还是错误</p>
<p>Hint2给出以后实在是无语了，继续重排2WqjC2gD7HLo86yRWhKEaC3ZXw8T98Mz，注意别忘了青花瓷也是“古代”。</p>
<p>base58解码得到<strong>ISCTF{H0w_834u71fu1!!!}</strong></p>
<ul>
<li><p>小蓝鲨的千层FLAG</p>
<blockquote>
<p>“如果你愿一层一层一层地剥开我的 Zip 你会发现，你会流泪—— 埋在最深处 8+4 的真正奥秘……”</p>
<p>Hint:可参考资料：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/255145.html">https://www.freebuf.com/articles/network/255145.html</a></p>
</blockquote>
</li>
</ul>
<p>本来想抢血的，但无奈写脚本能力太差，花了很久时间</p>
<p>嵌套压缩包，HxD打开，文件末尾写了密码。试着手动解压一次，规律都一样，只是数字-1，那就循环解压缩了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;flagggg&quot;</span></span><br><span class="line">start_n = <span class="number">999</span></span><br><span class="line"></span><br><span class="line">password_pattern = re.<span class="built_in">compile</span>(<span class="string">rb&quot;The password is ([\x21-\x7e]+)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_password_from_zip</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;从 ZIP 尾部附加数据解析密码&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    matches = <span class="built_in">list</span>(password_pattern.finditer(data))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> matches:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> matches[-<span class="number">1</span>].group(<span class="number">1</span>)  <span class="comment"># bytes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_with_7z</span>(<span class="params">zip_path, out_path, password</span>):</span><br><span class="line"></span><br><span class="line">    cmd = [</span><br><span class="line">        <span class="string">&quot;7z&quot;</span>, <span class="string">&quot;x&quot;</span>, zip_path,</span><br><span class="line">        <span class="string">f&quot;-p<span class="subst">&#123;password.decode()&#125;</span>&quot;</span>,</span><br><span class="line">        <span class="string">f&quot;-o.&quot;</span>,         <span class="comment"># 输出到当前目录</span></span><br><span class="line">        <span class="string">&quot;-y&quot;</span>            <span class="comment"># 自动覆盖</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 调用: <span class="subst">&#123;<span class="string">&#x27; &#x27;</span>.join(cmd)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行 7z</span></span><br><span class="line">    result = subprocess.run(cmd, capture_output=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查错误</span></span><br><span class="line">    <span class="keyword">if</span> result.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(result.stdout.decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(result.stderr.decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(out_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 若内部文件不是预期名字，尝试找刚解出的文件</span></span><br><span class="line">    files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">&quot;.&quot;</span>) <span class="keyword">if</span> f.endswith(<span class="string">&quot;.zip&quot;</span>)]</span><br><span class="line">    <span class="keyword">if</span> files:</span><br><span class="line">        os.rename(files[<span class="number">0</span>], out_path)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(start_n, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        in_file = <span class="string">f&quot;<span class="subst">&#123;prefix&#125;</span><span class="subst">&#123;n:03d&#125;</span>.zip&quot;</span></span><br><span class="line">        out_file = <span class="string">f&quot;<span class="subst">&#123;prefix&#125;</span><span class="subst">&#123;(n-<span class="number">1</span>):03d&#125;</span>.zip&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\n=== 处理 <span class="subst">&#123;in_file&#125;</span> ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(in_file):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;[!] 文件不存在：<span class="subst">&#123;in_file&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        pwd = get_password_from_zip(in_file)</span><br><span class="line">        <span class="keyword">if</span> pwd <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] 找不到密码！&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] 提取到密码: <span class="subst">&#123;pwd.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        ok = extract_with_7z(in_file, out_file, pwd)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] 7z 解压失败&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[+] 输出: <span class="subst">&#123;out_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>得到了flagggg000.zip，然后又是flagggg99.zip，手动解压出flagggg99.zip，脚本基本上同上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">current_file = <span class="string">&quot;flagggg99.zip&quot;</span></span><br><span class="line"></span><br><span class="line">pwd_re = re.<span class="built_in">compile</span>(<span class="string">rb&quot;The password is ([0-9A-Fa-f]+)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析文件名中的数字</span></span><br><span class="line">name_re = re.<span class="built_in">compile</span>(<span class="string">r&quot;flagggg(\d+)\.zip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] 当前 ZIP: <span class="subst">&#123;current_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读密码</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(current_file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line"></span><br><span class="line">    m = pwd_re.search(data)</span><br><span class="line"></span><br><span class="line">    password = m.group(<span class="number">1</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 解析到密码:&quot;</span>, password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解压</span></span><br><span class="line">    cmd = [<span class="string">&quot;7z&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">f&quot;-p<span class="subst">&#123;password&#125;</span>&quot;</span>, current_file, <span class="string">&quot;-y&quot;</span>]</span><br><span class="line">    proc = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> proc.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] 解压失败！&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(proc.stdout)</span><br><span class="line">        <span class="built_in">print</span>(proc.stderr)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配文件名</span></span><br><span class="line">    m2 = name_re.fullmatch(current_file)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[!] 文件名不符合 flagggg&lt;数字&gt;.zip 格式&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    num = <span class="built_in">int</span>(m2.group(<span class="number">1</span>))</span><br><span class="line">    next_num = num - <span class="number">1</span></span><br><span class="line">    <span class="comment"># 下一层文件名（自动匹配数字长度）</span></span><br><span class="line">    next_file = <span class="string">f&quot;flagggg<span class="subst">&#123;next_num&#125;</span>.zip&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(next_file):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 未找到下一层：&quot;</span>, next_file)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] 可能已经全部解完！&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] 解压得到下一层:&quot;</span>, next_file)</span><br><span class="line">    current_file = next_file</span><br></pre></td></tr></table></figure>

<p>解压到flagggg3.zip，出题人开始玩心眼子了:The password is… wait, I forgot! But you must know what’s inside, right?</p>
<p>查看Hint，提示已知明文攻击。bkcrack</p>
<p>这一块我还没完全掌握，没有成功。交给了Rycbartbad解出，复现后的正确命令行如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/99]</span><br><span class="line">└─# <span class="built_in">echo</span> -n <span class="string">&quot;flagggg1.zip&quot;</span> &gt; plain</span><br><span class="line">./bkcrack.exe -C flagggg3.zip -c flagggg2.zip -p plain -o 30 -x 0 504B0304</span><br><span class="line">bkcrack 1.8.0 - 2025-08-18</span><br><span class="line">[22:28:11] Z reduction using 4 bytes of known plaintext</span><br><span class="line">100.0 % (4 / 4)</span><br><span class="line">[22:28:11] Attack on 1388313 Z values at index 37</span><br><span class="line">Keys: ae0c4b27 66c21cba b9a7958f</span><br><span class="line">10.1 % (139941 / 1388313)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the attack with the option: --continue-attack 139941</span><br><span class="line">[22:29:19] Keys</span><br><span class="line">ae0c4b27 66c21cba b9a7958f</span><br><span class="line"></span><br><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/99]</span><br><span class="line">└─# ./bkcrack.exe -C flagggg3.zip -c flagggg2.zip -k ae0c4b27 66c21cba b9a7958f -d flagggg2_decrypted.zip</span><br><span class="line">bkcrack 1.8.0 - 2025-08-18</span><br><span class="line">[22:32:50] Writing deciphered data flagggg2_decrypted.zip</span><br><span class="line">Wrote deciphered data (not compressed).</span><br></pre></td></tr></table></figure>

<p>要进攻flagggg2.zip把它弄出来，需要的是flagggg2.zip的明文即flagggg1.zip和50 4B 03 04</p>
<p>成功后得到flagggg2_decrypted.zip，剩下的没有密码，手动解压即可</p>
<p>得到flagggg.txt，<strong>ISCTF{3f165c87-c0d4-4903-9c47-3a8d3b9c83df}</strong></p>
<ul>
<li><p>星髓宝盒</p>
<blockquote>
<p>“什么什么什么，，，你竟然不知道什么是星髓宝盒！！！</p>
<p>星髓宝盒里的flag是只能留给优秀学生的奖励，优秀学生自会知道它的咒语！！！”</p>
</blockquote>
</li>
</ul>
<p>改后缀解压，得到星髓宝盒.png，pngcheck，发现有多余数据且binwalk分离失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foremost 1.png</span><br></pre></td></tr></table></figure>

<p>foremost分离，提取出来了一个zip，再直接解压</p>
<p>真-星髓宝盒.zip需要密码，flag应该就在里面。查看你是优秀学生吗.txt，明显0宽隐写</p>
<p><a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html">https://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>要多积累几个网站，这次碰到的就是双重隐写</p>
<p><a target="_blank" rel="noopener" href="https://www.guofei.site/pictures_for_blog/app/text_watermark/v1.html">文本隐水印</a>在这个网站成功去掉第一层零宽字符：‌‌‌‌‌</p>
<p>﻿‍‍‌‌‌‌‍‬‌‬‌‌‌‌‌﻿‌‬‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‬‌‌‌‌‌‍‬‍‍‌‌‌‌‌﻿‍‬‌‌‌‌‌﻿‬‌‌‌‌‌‌﻿‌﻿‌‌‌‌‌﻿‍‬你虽然能走到这一步‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‌‌‌‌‌‌‌﻿‌‬‌‌‌‌‌﻿‌‌‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‍‬‌‌‌‌‍‬‍‍‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‌﻿‌‌‌‌‌﻿‌‍‌‌‌‌‌﻿‍‬‌‌‌‌‌﻿‍﻿‌‌‌‌‌﻿‍‍‌‌‌‌‌﻿‍‬‌‌‌‌‍‬‍‌‌‌‌‌‌﻿‌﻿，‌‌‌‌‍‬‌‬‌‌‌‌‌﻿‍‍‌‌‌‌‌﻿‬‌但还不是优秀学生哦‌‌‌‌‍‬‍‍‌‌‌‌‍‬‌﻿，‌‌‌‌‌﻿‍‌flag是专属于优秀学生的奖励，优秀学生自会知道他的咒语</p>
<p>但是第二层又失败了，此时在<a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html%E5%8F%88%E6%88%90%E5%8A%9F%E5%8E%BB%E6%8E%89%E4%BA%86%E7%AC%AC%E4%BA%8C%E5%B1%82">https://330k.github.io/misc_tools/unicode_steganography.html又成功去掉了第二层</a></p>
<p>得到5b298e6836902096e9316756d3b58ec4</p>
<p>直接作为密码失败了，感觉像是md5，才想起来还有一个jpg没用上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/baobao/output/zip/00001795]</span><br><span class="line">└─# exiftool 星髓宝盒.jpg</span><br><span class="line">ExifTool Version Number         : 13.25</span><br><span class="line">File Name                       : 星髓宝盒.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 286 kB</span><br><span class="line">File Modification Date/Time     : 2025:09:11 20:00:50+08:00</span><br><span class="line">File Access Date/Time           : 2025:12:09 14:59:17+08:00</span><br><span class="line">File Inode Change Date/Time     : 2025:12:09 14:57:13+08:00</span><br><span class="line">File Permissions                : -rwxrwxrwx</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">Resolution Unit                 : inches</span><br><span class="line">X Resolution                    : 96</span><br><span class="line">Y Resolution                    : 96</span><br><span class="line">Exif Byte Order                 : Big-endian (Motorola, MM)</span><br><span class="line">Artist                          : 来杯冰美式！</span><br><span class="line">XP Comment                      : https://www.somd5.com/</span><br><span class="line">XP Author                       : 来杯冰美式！</span><br><span class="line">Padding                         : (Binary data 234 bytes, use -b option to extract)</span><br><span class="line">About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b</span><br><span class="line">Creator                         : 来杯冰美式！</span><br><span class="line">Image Width                     : 1024</span><br><span class="line">Image Height                    : 576</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="line">Image Size                      : 1024x576</span><br><span class="line">Megapixels                      : 0.590</span><br></pre></td></tr></table></figure>

<p>exif数据发现一个网站<a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a></p>
<p>解密得到!!!@@@###123，难怪ARCHPR试了半天失败了，这密码当然爆破不出</p>
<p>解压得到flag.txt:<strong>ISCTF{1e7553787953e74113be4edfe8ca0e59}</strong></p>
<ul>
<li><p>阿利维亚的传说</p>
<blockquote>
<p>你知道阿利维亚的传说吗</p>
</blockquote>
</li>
</ul>
<p>解压得到png和docx，docx必考改zip解压</p>
<p>先看看png有什么异常，pngcheck有附加数据，binwalk分离出zip，直接解压需要密码，尝试爆破</p>
<p>ARCHPR秒出8652，得到</p>
<p>谕言3:<br>T&#x3D;FMfr<br>R&#x3D;iytY<br>U&#x3D;nGFo<br>E&#x3D;diou</p>
<p>看起来是第三段，FindMyGiftForYou</p>
<p>试一下zsteg，得到明显base64:6LCV6KiAMjoKVz1Ib2VpaApIPW91VGdvCmw9cE1oaGkKTD1lYWV0YwpFPVlrckNl</p>
<p>解密得到</p>
<p>è°è¨2:<br>W&#x3D;Hoeih<br>H&#x3D;ouTgo<br>l&#x3D;pMhhi<br>L&#x3D;eaetc<br>E&#x3D;YkrCe</p>
<p>第二段是HopeYouMakeTherightChoice(注意r小写，做题时候没注意)</p>
<p>回看docx，先直接打开看看，提示（解出的每段flag后面加_,类似于flag1_flag2_flag3），那就找找flag1</p>
<p>改字体颜色没发现异常，解压查看，后面的交给Rycbartbad师傅了</p>
<p>&#x2F;word下找到documents.xml，得到</p>
<p>谕言1:</p>
<p>V&#x3D;Dortt</p>
<p>A&#x3D;otuTa</p>
<p>N&#x3D;NTsin</p>
<p>得到DoNotTrustTitan</p>
<p><strong>ISCTF{DoNotTrustTitan_HopeYouMakeTherightChoice_FindMyGiftForYou}</strong></p>
<ul>
<li><p>湖心亭看雪</p>
<blockquote>
<p>张岱在“雪”景中有感而发</p>
</blockquote>
</li>
</ul>
<p>看眼题干基本上就知道是snow隐写</p>
<p>点开py，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">b&#x27;*********&#x27;</span> <span class="comment">#这个东西你以后要用到</span></span><br><span class="line">b = <span class="string">b&#x27;blueshark&#x27;</span> </span><br><span class="line">c = <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"><span class="built_in">print</span>(c.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment">#c = 53591611155a51405e</span></span><br></pre></td></tr></table></figure>

<p>解个密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="built_in">bytes</span>([<span class="number">83</span>, <span class="number">89</span>, <span class="number">22</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">90</span>, <span class="number">81</span>, <span class="number">64</span>, <span class="number">94</span>])</span><br><span class="line">b = <span class="built_in">bytes</span>([<span class="number">98</span>, <span class="number">108</span>, <span class="number">117</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">107</span>])</span><br><span class="line">a = <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(c, b)])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>

<p>得到<strong>15ctf2025</strong></p>
<p>接下来看看jpg什么情况，exiftool全部正常，binwalk和foremost全部失效</p>
<p>拉进010editor看看，发现最后多了数据</p>
<p>14 00 09 00，补上50 4B 03 04保存为zip</p>
<p>加密了，输入15ctf2025解密得到txt</p>
<p>snow解密即可，密钥猜想仍是15ctf2025</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./SNOW.exe -C -p <span class="string">&quot;15ctf2025&quot;</span> flag.txt</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{y0U_H4v3_kN0wn_Wh4t_15_Sn0w!!!}</strong></p>
<h3 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a><strong>OSINT</strong></h3><ul>
<li><p>OSINT-1,OSINT-2，纯图寻题，Google识图即可，精确位置手动调一调</p>
</li>
<li><p>OSINT-3 </p>
<p>这题就比较传奇了，把图片喂给AI，感觉明显不是中国，一开始试过乌克兰、白俄罗斯、美国。很早Grok就怀疑是在哈萨克斯坦，但是不是优先项。试了几次之后ChatGPT怀疑是在哈萨克斯坦，才找到正确方向。</p>
<p>信息点1：左侧的大片麦田，而且连绵不绝</p>
<p>信息点2：地上的车道分隔线是白色的</p>
<p>信息点2可以排除大部分国家如America，有的国家大部分地方Google街景没有覆盖，可直接排除</p>
<p>如果仔细观察，图片里面是有水印的，2024Google，所以在地图里面也可以根据水印快速排除</p>
<p><img src="/images/image-20251208234214270.png"></p>
<p>第一处，点进去查看公路，环视一下感觉稳了，就沿着公路一直找，最后还是找到了</p>
<p>一开始一直无法精确定位，后来想到可以借助途中左侧的一棵树，大致是西偏北30°，锁定了精确位置。</p>
<p>**ISCTF{immorally.misusing.began}**54.32161512496924, 65.7630826261645</p>
</li>
</ul>
<h3 id="SIGNIN"><a href="#SIGNIN" class="headerlink" title="SIGNIN"></a><strong>SIGNIN</strong></h3><ul>
<li><p>OSINT-4</p>
<blockquote>
<p>本题是放在SIGNIN类别下的OSINT主题的MISC类型的题，没有隐写，没有图寻。</p>
<p>OSINT系列通用靶机地址（请勿攻击平台）： </p>
<p><a target="_blank" rel="noopener" href="https://osint.imxbt.cn/">https://osint.imxbt.cn/</a><br><a target="_blank" rel="noopener" href="https://osint-isctf.aristore.top/">https://osint-isctf.aristore.top/</a></p>
</blockquote>
</li>
</ul>
<p>反复强调不是图寻,毕竟那张图上面随便标一个点，what3words的差别会巨大</p>
<p>很奇怪的是明明有附件，还给了OSINT网址，再联想到<strong>勇敢者的游戏</strong>，</p>
<p>是的，flag就是写在OSINT网站上的示例flag:ISCTF{like.crazy.thursdays}</p>
<p>不放心可以点开地图查查，确实是这儿</p>
<ul>
<li><p>老朋友、老朋友们和新朋友们</p>
<blockquote>
<p>。题的GALF到签取获ISCTF2025送发台后号众公息信鲨蓝向道一出会定肯年今FTCSI说里群在常们西东老</p>
</blockquote>
</li>
</ul>
<p>关注，发送5202FTCSI.<strong>ISCTF{0nce_M0re_With_Feeling_And_The_J0urney_C0ntinues!!}</strong></p>
<ul>
<li><p>小蓝鲨的RC4系统</p>
<blockquote>
<p>送都送了，再给一个。</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StreamCipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">self</span>.S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.j = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        key_bytes = <span class="variable language_">self</span>._key_to_bytes(key)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            j = (j + <span class="variable language_">self</span>.S[i] + key_bytes[i % <span class="built_in">len</span>(key_bytes)]) % <span class="number">256</span></span><br><span class="line">            <span class="variable language_">self</span>.S[i], <span class="variable language_">self</span>.S[j] = <span class="variable language_">self</span>.S[j], <span class="variable language_">self</span>.S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_key_to_bytes</span>(<span class="params">self, key</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key.encode()).digest()</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(key, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key).digest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_prga</span>(<span class="params">self</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.i = (<span class="variable language_">self</span>.i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.j = (<span class="variable language_">self</span>.j + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j] = <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]</span><br><span class="line">        K = <span class="variable language_">self</span>.S[(<span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i] + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">return</span> K</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crypt</span>(<span class="params">self, data</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">            data = data.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            key_byte = <span class="variable language_">self</span>._prga()</span><br><span class="line">            result.append(byte ^ key_byte)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_string</span>(<span class="params">text, key</span>):</span><br><span class="line">    </span><br><span class="line">    cipher = StreamCipher(key)</span><br><span class="line">    encrypted = cipher.crypt(text)</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ISCTF2025</span></span><br><span class="line"><span class="comment">#ba19a7116763ba8ba1c236c6bdc30187dcc8afb28c8fa5f266763880b74f5fff915613718f4d19c3baf4bbe24bd57303ce103d</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RC4Cipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="variable language_">self</span>.S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.j = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 密钥调度算法（KSA）</span></span><br><span class="line">        key_bytes = <span class="variable language_">self</span>._key_to_bytes(key)</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            j = (j + <span class="variable language_">self</span>.S[i] + key_bytes[i % <span class="built_in">len</span>(key_bytes)]) % <span class="number">256</span></span><br><span class="line">            <span class="variable language_">self</span>.S[i], <span class="variable language_">self</span>.S[j] = <span class="variable language_">self</span>.S[j], <span class="variable language_">self</span>.S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_key_to_bytes</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        将密钥转换为字节</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key.encode()).digest()</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(key, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key).digest()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;密钥必须是字符串或字节&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_prga</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        伪随机生成算法，生成密钥流字节</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.i = (<span class="variable language_">self</span>.i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.j = (<span class="variable language_">self</span>.j + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j] = <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]</span><br><span class="line">        K = <span class="variable language_">self</span>.S[(<span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i] + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">return</span> K</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crypt</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">            data = data.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>) <span class="keyword">and</span> data.startswith(<span class="string">&#x27;0x&#x27;</span>):</span><br><span class="line"></span><br><span class="line">            data = <span class="built_in">bytes</span>.fromhex(data.replace(<span class="string">&#x27;0x&#x27;</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">        </span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            key_byte = <span class="variable language_">self</span>._prga()</span><br><span class="line">            result.append(byte ^ key_byte)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_rc4</span>(<span class="params">ciphertext_hex, key</span>):</span><br><span class="line"></span><br><span class="line">    cipher = RC4Cipher(key)</span><br><span class="line">    ciphertext_bytes = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">    plaintext_bytes = cipher.crypt(ciphertext_bytes)</span><br><span class="line">    <span class="keyword">return</span> plaintext_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_decrypt</span>(<span class="params">ciphertext_hex, key</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = decrypt_rc4(ciphertext_hex, key)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            decoded_text = result.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;解密结果(UTF-8): <span class="subst">&#123;decoded_text&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;解密结果(hex): <span class="subst">&#123;result.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ASCII可打印字符:&quot;</span>)</span><br><span class="line">        ascii_chars = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">if</span> <span class="number">32</span> &lt;= b &lt;= <span class="number">126</span> <span class="keyword">else</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">for</span> b <span class="keyword">in</span> result)</span><br><span class="line">        <span class="built_in">print</span>(ascii_chars)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;解密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主程序</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line"></span><br><span class="line">    key = <span class="string">&quot;ISCTF2025&quot;</span></span><br><span class="line">    ciphertext_hex = <span class="string">&quot;ba19a7116763ba8ba1c236c6bdc30187dcc8afb28c8fa5f266763880b74f5fff915613718f4d19c3baf4bbe24bd57303ce103d&quot;</span></span><br><span class="line"></span><br><span class="line">    plaintext = try_decrypt(ciphertext_hex, key)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;密文字节数: <span class="subst">&#123;<span class="built_in">len</span>(<span class="built_in">bytes</span>.fromhex(ciphertext_hex))&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示密钥的SHA-256哈希</span></span><br><span class="line">    key_hash = hashlib.sha256(key.encode()).digest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;密钥SHA-256哈希: <span class="subst">&#123;key_hash.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>ISCTF{Welcome_to_ISCTF_&amp;_this_is_a_secret_with_RC4}</strong></p>
<ul>
<li><p>我去，Flag是真的！？</p>
<p>随便交，可惜没找到彩蛋</p>
<p><strong>ISCTF{我要投递简历加入蓝鲨信息!}</strong></p>
</li>
<li><p>What a crazy day!! 之勇敢者的游戏</p>
<p>hint-50pts，但是你很勇敢，得到了349pts<strong>ISCTF{7hank_you_&amp;_now_you_can_win_3v3n_mor3!!}</strong></p>
</li>
</ul>
<h3 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a><strong>应急响应</strong></h3><ul>
<li><p>hacker</p>
<blockquote>
<p>hacker在数据库的某个后台写入了很多的垃圾用户(注册)，请提交其IP。 Flag使用ISCTF{}包裹。</p>
</blockquote>
</li>
</ul>
<p>hacker.pcapng拖到wireshark，http.request.uri contains “&#x2F;register.php”过滤，于是<strong>ISCTF{192.168.37.177}</strong></p>
<p>这题一开始flag设置错误了，导致结果一直不对</p>
<ul>
<li><p>奇怪的shell文件</p>
<blockquote>
<p>小张同学是某安全团队的成员，负责公司服务器的日常安全检查。某天，他发现在一台关键业务服务器上存在异常行为，他的目标分析webshell连接工具，请提交工具名称作为flag以完成此次事件响应任务。 Flag使用ISCTF{}包裹。</p>
<p>附件下载： <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei">https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei</a></p>
<p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei">https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei</a></p>
</blockquote>
</li>
</ul>
<p>喂ai盲猜ISCTF{Behinder}，侥幸二血</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/22/SUSCTF2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/22/SUSCTF2025/" class="post-title-link" itemprop="url">SUSCTF2025</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-22 23:37:09" itemprop="dateCreated datePublished" datetime="2025-12-22T23:37:09+08:00">2025-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-23 00:01:37" itemprop="dateModified" datetime="2025-12-23T00:01:37+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <embed src="/pdf/SUSCTF2025.pdf" width="100%" height="600px">

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
